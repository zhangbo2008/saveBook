[1mdiff --git "a/javaee\345\274\200\345\217\221\347\232\204\351\242\240\350\246\206\350\200\205springboot\345\256\236\346\210\230.pdf" "b/javaee\345\274\200\345\217\221\347\232\204\351\242\240\350\246\206\350\200\205springboot\345\256\236\346\210\230.pdf"[m
[1mdeleted file mode 100644[m
[1mindex 7ed7cf6..0000000[m
[1m--- "a/javaee\345\274\200\345\217\221\347\232\204\351\242\240\350\246\206\350\200\205springboot\345\256\236\346\210\230.pdf"[m
[1m+++ /dev/null[m
[36m@@ -1,18300 +0,0 @@[m
[31m-                   ç‰ˆæƒä¿¡æ¯[m
[31m-[m
[31m-ä¹¦åï¼šJava EEå¼€å‘çš„é¢ è¦†è€…ï¼šSpring Bootå®æˆ˜[m
[31m-ä½œè€…ï¼šæ±ªäº‘é£[m
[31m-å‡ºç‰ˆç¤¾ï¼šç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾[m
[31m-ISBNï¼š978-7-121-28208-9[m
[31m-å®šä»·ï¼š89.00[m
[31m-[m
[31m-ç‰ˆæƒæ‰€æœ‰Â·ä¾µæƒå¿…ç©¶[m
[31m-                      å‰è¨€[m
[31m-[m
[31m-     æˆ‘æœ‰å°†å¹³æ—¶å·¥ä½œæ‰€æ‚Ÿå†™æˆåšå®¢ä»¥è®°å½•çš„ä¹ æƒ¯ï¼Œéšç€é€æ¸çš„[m
[31m-ç§¯ç´¯ï¼Œç»ˆäºå¯ä»¥å½¢æˆç›®å‰è¿™æ ·ä¸€æœ¬å®æˆ˜æ€§çš„æ‰‹å†Œã€‚æˆ‘å¹³æ—¶åœ¨é˜…[m
[31m-è¯»å¤§é‡çš„Springç›¸å…³ä¹¦ç±çš„æ—¶å€™å‘ç°ï¼šå¾ˆå¤šä¹¦ç±å¯¹çŸ¥è¯†çš„è®²è§£[m
[31m-ä¸€å‘³æ±‚å…¨æ±‚æ·±ï¼Œå¯¼è‡´è¯»è€…å¾ˆéš¾å¿«é€ŸæŒæ¡æŸä¸€é¡¹æŠ€æœ¯ï¼Œä¸”å› ä¸ºæ±‚[m
[31m-å…¨æ±‚æ·±è€Œå¿½ç•¥äº†æœ€ä½³å®è·µï¼Œè®©è¯»è€…äº‘é‡Œé›¾é‡Œï¼Œç”šè‡³åŠé€”è€ŒåºŸã€‚[m
[31m-[m
[31m-     æ‰€ä»¥æœ¬ä¹¦çš„æ¯ä¸ªç« èŠ‚çš„åŸºæœ¬æ¶æ„éƒ½æ˜¯ï¼šç‚¹ç›+å®æˆ˜ã€‚[m
[31m-[m
[31m-     ç‚¹ç›ï¼šç”¨æœ€ç®€ç»ƒçš„è¯­è¨€å»æè¿°å½“å‰çš„æŠ€æœ¯ï¼›[m
[31m-[m
[31m-     å®æˆ˜ï¼šå¯¹å½“å‰æŠ€æœ¯è¿›è¡Œå®æˆ˜æ„ä¹‰çš„ä»£ç æ¼”ç¤ºã€‚[m
[31m-[m
[31m-     æœ¬ä¹¦ä»£ç çš„å¦ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼šæŠ€æœ¯ç›¸å…³ï¼Œä¸šåŠ¡ä¸ç›¸å…³ã€‚åœ¨æœ¬[m
[31m-ä¹¦çš„å®æˆ˜ä¾‹å­ä¸­ä¸ä¼šå‡è®¾ä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼Œç„¶åè®©è¯»è€…æ—¢è¦ç†è§£[m
[31m-æŠ€æœ¯ï¼Œåˆè¦ç†è§£å‡è®¾çš„ä¸šåŠ¡ï¼Œæœ¬ä¹¦çš„ç›®æ ‡æ˜¯è®©è¯»è€…â€œå­¦ä¹ æ—¶åª[m
[31m-å…³æ³¨æŠ€æœ¯ï¼Œå¼€å‘æ—¶åªå…³æ³¨ä¸šåŠ¡â€ã€‚[m
[31m-[m
[31m-     æœ¬ä¹¦æ¶‰åŠçš„æŠ€æœ¯æ¯”è¾ƒå¹¿ï¼Œå°¤å…¶æ˜¯ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®æˆ˜Spring[m
[31m-Bootï¼Œè¿™è®©æˆ‘å¾ˆéš¾åœ¨ä¸€æœ¬ä¹¦ä¸­å¯¹æ¯ä¸€é¡¹æŠ€æœ¯ç»†èŠ‚éƒ½è¯¦ç»†è¯´æ˜ï¼›[m
[31m-æˆ‘å¸Œæœ›æœ¬ä¹¦èƒ½ä¸ºè¯»è€…åœ¨ç›¸å…³æŠ€æœ¯åº”ç”¨ä¸ŠæŠ›ç –å¼•ç‰ï¼Œè¯»è€…åœ¨é‡åˆ°[m
[31m-ç‰¹å®šæŠ€æœ¯çš„é—®é¢˜æ—¶å¯ä»¥å»å­¦ä¹ ç‰¹å®šæŠ€æœ¯çš„ç›¸å…³ä¹¦ç±ã€‚[m
[31m-[m
[31m-     Springåœ¨Java EEå¼€å‘ä¸­æ˜¯å®é™…æ„ä¹‰ä¸Šçš„æ ‡å‡†ï¼Œä½†æˆ‘ä»¬åœ¨å¼€[m
[31m-å‘Springçš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹è®©äººå¤´ç–¼çš„é—®é¢˜ï¼š[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰å¤§é‡é…ç½®æ–‡ä»¶çš„å®šä¹‰ï¼›[m
[31m-     ï¼ˆ2ï¼‰ä¸ç¬¬ä¸‰æ–¹è½¯ä»¶æ•´åˆçš„æŠ€æœ¯é—®é¢˜ã€‚[m
[31m-[m
[31m-     Springæ¯ä¸ªæ–°ç‰ˆæœ¬çš„æ¨å‡ºéƒ½ä»¥å‡å°‘é…ç½®ä½œä¸ºè‡ªå·±çš„ä¸»è¦ç›®[m
[31m-æ ‡ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ¨å‡º@Componentã€@Serviceã€@Repositoryã€[m
[31m-@Controlleræ³¨è§£åœ¨ç±»ä¸Šå£°æ˜Beanï¼›[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰æ¨å‡º@Configurationã€@Beançš„Javaé…ç½®æ¥æ›¿ä»£xmlé…[m
[31m-ç½®ã€‚[m
[31m-[m
[31m-     åœ¨è„šæœ¬è¯­è¨€å’Œæ•æ·å¼€å‘å¤§è¡Œå…¶é“çš„æ—¶ä»£ï¼ŒJava EEçš„å¼€å‘æ˜¾[m
[31m-å¾—å°¤ä¸ºç¬¨é‡ï¼Œè®©äººè¯¯è§£Java EEå¼€å‘å°±è¯¥å¦‚æ­¤ã€‚Springåœ¨æå‡[m
[31m-Java EEå¼€å‘æ•ˆç‡çš„è„šæ­¥ä¸Šä»æœªåœæ­¢è¿‡ï¼Œè€ŒSpring Bootçš„æ¨å‡ºæ˜¯[m
[31m-å…·æœ‰é¢ è¦†å’Œåˆ’æ—¶ä»£æ„ä¹‰çš„ã€‚Spring Bootå…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰éµå¾ªâ€œä¹ æƒ¯ä¼˜äºé…ç½®â€åŸåˆ™ï¼Œä½¿ç”¨Spring Bootåªéœ€å¾ˆå°‘[m
[31m-çš„é…ç½®ï¼Œå¤§éƒ¨åˆ†æ—¶å€™å¯ä»¥ä½¿ç”¨é»˜è®¤é…ç½®ï¼›[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰é¡¹ç›®å¿«é€Ÿæ­å»ºï¼Œå¯æ— é…ç½®æ•´åˆç¬¬ä¸‰æ–¹æ¡†æ¶ï¼›[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰å¯å®Œå…¨ä¸ä½¿ç”¨xmlé…ç½®ï¼Œåªä½¿ç”¨è‡ªåŠ¨é…ç½®å’ŒJava[m
[31m-Configï¼›[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰å†…åµŒServletï¼ˆå¦‚Tomcatï¼‰å®¹å™¨ï¼Œåº”ç”¨å¯ç”¨jaråŒ…è¿è¡Œ[m
[31m-ï¼ˆjavaâ€“jarï¼‰ï¼›[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰è¿è¡Œä¸­åº”ç”¨çŠ¶æ€çš„ç›‘æ§ã€‚[m
[31m-[m
[31m-     è™½ç„¶Spring Bootç»™æˆ‘ä»¬å¸¦æ¥äº†ç±»ä¼¼äºè„šæœ¬è¯­è¨€å¼€å‘çš„æ•ˆ[m
[31m-ç‡ï¼Œä½†Spring Booté‡Œæ²¡æœ‰ä½¿ç”¨ä»»ä½•è®©ä½ æ„å¤–çš„æŠ€æœ¯ï¼Œå®Œå…¨æ˜¯ä¸€[m
[31m-ä¸ªå•çº¯çš„åŸºäºSpringçš„åº”ç”¨ã€‚å¦‚Spring Bootçš„è‡ªåŠ¨é…ç½®æ˜¯é€šè¿‡[m
[31m-Spring 4.xçš„@Conditionalæ³¨è§£æ¥å®ç°çš„ï¼Œæ‰€ä»¥åœ¨å­¦ä¹ Spring[m
[31m-Bootä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¿«é€Ÿå­¦ä¹ Springä¸Spring MVCçš„åŸºç¡€çŸ¥[m
[31m-è¯†ã€‚[m
[31m-[m
[31m-     ç¬¬ä¸€éƒ¨åˆ†ï¼šç‚¹ç›Spring 4.x[m
[31m-[m
[31m-     å¿«é€Ÿå­¦ä¹ Spring 4.xçš„å„ä¸ªçŸ¥è¯†ç‚¹ï¼ŒåŒ…æ‹¬åŸºç¡€é…ç½®ã€å¸¸ç”¨é…[m
[31m-ç½®ä»¥åŠé«˜çº§é…ç½®ï¼Œä»¥ä¾¿ç†Ÿæ‚‰å¸¸ç”¨é…ç½®ï¼Œå¹¶ä½“ä¼šä½¿ç”¨Javaè¯­æ³•é…[m
[31m-ç½®æ‰€å¸¦æ¥çš„ä¾¿æ·ã€‚[m
[31m-[m
[31m-     ç¬¬äºŒéƒ¨åˆ†ï¼šç‚¹ç›Spring MVC 4.x[m
[31m-[m
[31m-     å¿«é€Ÿå­¦ä¹ Spring MVC 4.1çš„å„ä¸ªçŸ¥è¯†ç‚¹ï¼ŒMVCçš„å¼€å‘æ˜¯æˆ‘[m
[31m-ä»¬æ—¥å¸¸å¼€å‘å·¥ä½œä¸­æœ€å¸¸æ‰“äº¤é“çš„ï¼Œæ‰€ä»¥å­¦ä¹ Spring MVCå¯¹[m
[31m-Spring Bootçš„ä½¿ç”¨ææœ‰å¸®åŠ©ã€‚[m
[31m-[m
[31m-     ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®æˆ˜Spring Boot[m
[31m-[m
[31m-     è¿™éƒ¨åˆ†æ˜¯æ•´æœ¬ä¹¦çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæ¯ä¸ªç« èŠ‚éƒ½ä¼šé€šè¿‡è®²è§£å’Œå®[m
[31m-æˆ˜çš„ä¾‹å­æ¥æ¼”ç¤ºSpring Bootåœ¨å®é™…é¡¹ç›®ä¸­é‡åˆ°çš„æ–¹æ–¹é¢é¢çš„æƒ…[m
[31m-å†µï¼ŒçœŸæ­£è¾¾åˆ°è®©Spring Bootæˆä¸ºJava EEå¼€å‘çš„å®é™…è§£å†³æ–¹æ¡ˆã€‚[m
[31m-[m
[31m-     Spring Bootå‘å¸ƒäº2014å¹´4æœˆï¼Œæ ¹æ®çŸ¥ååšä¸»Baeldungçš„è°ƒ[m
[31m-æŸ¥ï¼Œæˆªè‡³2014å¹´å¹´åº•ï¼Œä½¿ç”¨Spring Bootä½œä¸ºSpringå¼€å‘æ–¹æ¡ˆçš„[m
[31m-å·²æœ‰34.1%ï¼Œè¿™æ˜¯å¤šä¹ˆæƒŠäººçš„é€Ÿåº¦ã€‚[m
[31m-[m
[31m-     å¸Œæœ›è¯»è€…åœ¨é˜…è¯»å®Œæœ¬ä¹¦åï¼Œèƒ½å¤Ÿå¿«é€Ÿæ›¿ä»£ç°æœ‰çš„å¼€å‘æ–¹[m
[31m-å¼ï¼Œä½¿ç”¨Spring Bootè¿›è¡Œé‡æ„ï¼Œå’Œå¤§é‡é…ç½®ä¸æ•´åˆå¼€å‘è¯´å†[m
[31m-è§ï¼[m
[31m-[m
[31m-     æœ¬ä¹¦æ˜¯æˆ‘çš„ç¬¬ä¸€æœ¬æŠ€æœ¯ä¹¦ç±ï¼Œä¸»è¦ç›®çš„æ˜¯è®©è¯»è€…å¿«é€Ÿä¸Šæ‰‹[m
[31m-Spring Bootè¿™é¡¹é¢ è¦†æ€§çš„Java EEå¼€å‘æŠ€æœ¯ï¼Œç”±äºä½œè€…æ°´å¹³æœ‰[m
[31m-é™ï¼Œä¹¦ä¸­çº°æ¼ä¹‹å¤„åœ¨æ‰€éš¾å…ï¼Œæ•¬è¯·è¯»è€…æ‰¹è¯„æŒ‡æ­£ã€‚[m
[31m-        ç¬¬ä¸€éƒ¨åˆ†ã€€ç‚¹ç›Spring 4.x[m
[31m-[m
[31m-ç¬¬1ç« ã€€SpringåŸºç¡€[m
[31m-[m
[31m-     åšJavaå¼€å‘çš„ç¨‹åºå‘˜éƒ½çŸ¥é“Springçš„å¤§åï¼Œå¸‚é¢ä¸Šå…³äº[m
[31m-Springçš„ä¹¦ç±ä¹Ÿæ˜¯æ±—ç‰›å……æ ‹ã€‚æœ¬ä¹¦ä»‹ç»çš„Spring 4.xä¸æ˜¯å¯¹[m
[31m-SpringçŸ¥è¯†ç‚¹çš„å…¨é¢è®²è§£ï¼Œè€Œæ˜¯å°†å·¥ä½œä¸­å¸¸ç”¨çš„Springç›¸å…³çš„[m
[31m-çŸ¥è¯†ç‚¹ç½—åˆ—å‡ºæ¥ï¼Œä»¥ç‚¹ç›çš„å½¢å¼ï¼ˆå¿«é€Ÿè®²è§£+ç¤ºä¾‹ï¼‰è®©è¯»è€…å¿«[m
[31m-é€ŸæŒæ¡Springåœ¨å¼€å‘ä¸­çš„å¸¸ç”¨çŸ¥è¯†ã€‚[m
[31m-1.1ã€€Springæ¦‚è¿°[m
[31m-[m
[31m-1.1.1ã€€Springçš„ç®€å²[m
[31m-[m
[31m-     Springçš„å†å²ç½‘ä¸Šæœ‰å¾ˆå¤šä»‹ç»ï¼Œä¸‹é¢è®²ä¸‹æˆ‘äº²å†çš„Springå‘[m
[31m-å±•çš„è¿‡ç¨‹ã€‚[m
[31m-[m
[31m-     ç¬¬ä¸€é˜¶æ®µï¼šxmlé…ç½®[m
[31m-[m
[31m-     åœ¨Spring 1.xæ—¶ä»£ï¼Œä½¿ç”¨Springå¼€å‘æ»¡çœ¼éƒ½æ˜¯xmlé…ç½®çš„[m
[31m-Beanï¼Œéšç€é¡¹ç›®çš„æ‰©å¤§ï¼Œæˆ‘ä»¬éœ€è¦æŠŠxmlé…ç½®æ–‡ä»¶åˆ†æ”¾åˆ°ä¸åŒ[m
[31m-çš„é…ç½®æ–‡ä»¶é‡Œï¼Œé‚£æ—¶å€™éœ€è¦é¢‘ç¹åœ°åœ¨å¼€å‘çš„ç±»å’Œé…ç½®æ–‡ä»¶ä¹‹é—´[m
[31m-åˆ‡æ¢ã€‚[m
[31m-[m
[31m-     ç¬¬äºŒé˜¶æ®µï¼šæ³¨è§£é…ç½®[m
[31m-[m
[31m-     åœ¨Spring 2.xæ—¶ä»£ï¼Œéšç€JDK 1.5å¸¦æ¥çš„æ³¨è§£æ”¯æŒï¼ŒSpringæ[m
[31m-ä¾›äº†å£°æ˜Beançš„æ³¨è§£ï¼ˆå¦‚@Componentã€@Serviceï¼‰ï¼Œå¤§å¤§å‡[m
[31m-å°‘äº†é…ç½®é‡ã€‚è¿™æ—¶Springåœˆå­é‡Œå­˜åœ¨ç€ä¸€ç§äº‰è®ºï¼šæ³¨è§£é…ç½®å’Œ[m
[31m-xmlé…ç½®ç©¶ç«Ÿå“ªä¸ªæ›´å¥½ï¼Ÿæˆ‘ä»¬æœ€ç»ˆçš„é€‰æ‹©æ˜¯åº”ç”¨çš„åŸºæœ¬é…ç½®[m
[31m-ï¼ˆå¦‚æ•°æ®åº“é…ç½®ï¼‰ç”¨xmlï¼Œä¸šåŠ¡é…ç½®ç”¨æ³¨è§£ã€‚[m
[31m-[m
[31m-     ç¬¬ä¸‰é˜¶æ®µï¼šJavaé…ç½®[m
[31m-[m
[31m-     ä»Spring 3.xåˆ°ç°åœ¨ï¼ŒSpringæä¾›äº†Javaé…ç½®çš„èƒ½åŠ›ï¼Œä½¿ç”¨[m
[31m-Javaé…ç½®å¯ä»¥è®©ä½ æ›´ç†è§£ä½ é…ç½®çš„Beanã€‚æˆ‘ä»¬ç›®å‰åˆšå¥½å¤„äºè¿™[m
[31m-ä¸ªæ—¶ä»£ï¼ŒSpring 4.xå’ŒSpring Bootéƒ½æ¨èä½¿ç”¨Javaé…ç½®ï¼Œæ‰€ä»¥æˆ‘[m
[31m-ä»¬åœ¨æœ¬ä¹¦é€šç¯‡å°†ä½¿ç”¨Javaé…ç½®ã€‚[m
[31m-1.1.2ã€€Springæ¦‚è¿°[m
[31m-[m
[31m-     Springæ¡†æ¶æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ä¼ä¸šçº§å¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹[m
[31m-æ¡ˆã€‚æ‰€è°“è§£å†³æ–¹æ¡ˆå°±æ˜¯å¯ä»¥åŸºäºSpringè§£å†³Java EEå¼€å‘çš„æ‰€æœ‰[m
[31m-é—®é¢˜ã€‚Springæ¡†æ¶ä¸»è¦æä¾›äº†IoCå®¹å™¨ã€AOPã€æ•°æ®è®¿é—®ã€Web[m
[31m-å¼€å‘ã€æ¶ˆæ¯ã€æµ‹è¯•ç­‰ç›¸å…³æŠ€æœ¯çš„æ”¯æŒã€‚[m
[31m-[m
[31m-     Springä½¿ç”¨ç®€å•çš„POJOï¼ˆPlain Old Java Objectï¼Œå³æ— ä»»ä½•[m
[31m-é™åˆ¶çš„æ™®é€šJavaå¯¹è±¡ï¼‰æ¥è¿›è¡Œä¼ä¸šçº§å¼€å‘ã€‚æ¯ä¸€ä¸ªè¢«Springç®¡[m
[31m-ç†çš„Javaå¯¹è±¡éƒ½ç§°ä¹‹ä¸ºBeanï¼›è€ŒSpringæä¾›äº†ä¸€ä¸ªIoCå®¹å™¨ç”¨æ¥[m
[31m-åˆå§‹åŒ–å¯¹è±¡ï¼Œè§£å†³å¯¹è±¡é—´çš„ä¾èµ–ç®¡ç†å’Œå¯¹è±¡çš„ä½¿ç”¨ã€‚[m
[31m-[m
[31m-     1.Springçš„æ¨¡å—[m
[31m-     Springæ˜¯æ¨¡å—åŒ–çš„ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åªä½¿ç”¨ä½ éœ€è¦çš„Spring[m
[31m-çš„æ¨¡å—ã€‚å¦‚å›¾1-1æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                 å›¾1-1ã€€Springçš„æ¨¡å—[m
[31m-[m
[31m-     å›¾1-1ä¸­çš„æ¯ä¸€ä¸ªæœ€å°å•å…ƒï¼ŒSpringéƒ½è‡³å°‘æœ‰ä¸€ä¸ªå¯¹åº”çš„jar[m
[31m-åŒ…ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ ¸å¿ƒå®¹å™¨ï¼ˆCore Containerï¼‰[m
[31m-[m
[31m-     Spring-Coreï¼šæ ¸å¿ƒå·¥å…·ç±»ï¼ŒSpringå…¶ä»–æ¨¡å—å¤§é‡ä½¿ç”¨[m
[31m-Spring-Coreï¼›[m
[31m-[m
[31m-     Spring-Beansï¼šSpringå®šä¹‰Beançš„æ”¯æŒï¼›[m
[31m-[m
[31m-     Spring-Contextï¼šè¿è¡Œæ—¶Springå®¹å™¨ï¼›[m
[31m-[m
[31m-     Spring-Context-Supportï¼šSpringå®¹å™¨å¯¹ç¬¬ä¸‰æ–¹åŒ…çš„é›†æˆæ”¯[m
[31m-æŒï¼›[m
[31m-[m
[31m-     Spring-Expressionï¼šä½¿ç”¨è¡¨è¾¾å¼è¯­è¨€åœ¨è¿è¡Œæ—¶æŸ¥è¯¢å’Œæ“ä½œ[m
[31m-å¯¹è±¡ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰AOP[m
[31m-[m
[31m-     Spring-AOPï¼šåŸºäºä»£ç†çš„AOPæ”¯æŒï¼›[m
[31m-[m
[31m-     Spring-Aspectsï¼šåŸºäºAspectJçš„AOPæ”¯æŒã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰æ¶ˆæ¯ï¼ˆMessagingï¼‰[m
[31m-[m
[31m-     Spring-Messagingï¼šå¯¹æ¶ˆæ¯æ¶æ„å’Œåè®®çš„æ”¯æŒã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰Web[m
[31m-[m
[31m-     Spring-Webï¼šæä¾›åŸºç¡€çš„Webé›†æˆçš„åŠŸèƒ½ï¼Œåœ¨Webé¡¹ç›®ä¸­[m
[31m-æä¾›Springçš„å®¹å™¨ï¼›[m
[31m-[m
[31m-     Spring-Webmvcï¼šæä¾›åŸºäºServletçš„Spring MVCï¼›[m
[31m-[m
[31m-     Spring-WebSocketï¼šæä¾›WebSocketåŠŸèƒ½ï¼›[m
[31m-     Spring-Webmvc-Portletï¼šæä¾›Portletç¯å¢ƒæ”¯æŒã€‚[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰æ•°æ®è®¿é—®/é›†æˆï¼ˆData Access/Integrationï¼‰[m
[31m-[m
[31m-     Spring-JDBCï¼šæä¾›ä»¥JDBCè®¿é—®æ•°æ®åº“çš„æ”¯æŒï¼›[m
[31m-[m
[31m-     Spring-TXï¼šæä¾›ç¼–ç¨‹å¼å’Œå£°æ˜å¼çš„äº‹åŠ¡æ”¯æŒï¼›[m
[31m-[m
[31m-     Spring-ORMï¼šæä¾›å¯¹å¯¹è±¡/å…³ç³»æ˜ å°„æŠ€æœ¯çš„æ”¯æŒï¼›[m
[31m-[m
[31m-     Spring-OXMï¼šæä¾›å¯¹å¯¹è±¡/xmlæ˜ å°„æŠ€æœ¯çš„æ”¯æŒï¼›[m
[31m-[m
[31m-     Spring-JMSï¼šæä¾›å¯¹JMSçš„æ”¯æŒã€‚[m
[31m-[m
[31m-     2.Springçš„ç”Ÿæ€[m
[31m-[m
[31m-     Springå‘å±•åˆ°ç°åœ¨å·²ç»ä¸ä»…ä»…æ˜¯Springæ¡†æ¶æœ¬èº«çš„å†…å®¹ï¼Œ[m
[31m-Springç›®å‰æä¾›äº†å¤§é‡çš„åŸºäºSpringçš„é¡¹ç›®ï¼Œå¯ä»¥ç”¨æ¥æ›´æ·±å…¥[m
[31m-åœ°é™ä½æˆ‘ä»¬çš„å¼€å‘éš¾åº¦ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚[m
[31m-[m
[31m-     ç›®å‰Springçš„ç”Ÿæ€é‡Œä¸»è¦æœ‰ä»¥ä¸‹é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±[m
[31m-é¡¹ç›®çš„éœ€è¦æ¥é€‰æ‹©ä½¿ç”¨ç›¸åº”çš„é¡¹ç›®ã€‚[m
[31m-[m
[31m-     Spring Bootï¼šä½¿ç”¨é»˜è®¤å¼€å‘é…ç½®æ¥å®ç°å¿«é€Ÿå¼€å‘ã€‚[m
[31m-[m
[31m-     Spring XDï¼šç”¨æ¥ç®€åŒ–å¤§æ•°æ®åº”ç”¨å¼€å‘ã€‚[m
[31m-[m
[31m-     Spring Cloudï¼šä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘æä¾›å·¥å…·é›†ã€‚[m
[31m-[m
[31m-     Spring Dataï¼šå¯¹ä¸»æµçš„å…³ç³»å‹å’ŒNoSQLæ•°æ®åº“çš„æ”¯æŒã€‚[m
[31m-[m
[31m-     Spring Integrationï¼šé€šè¿‡æ¶ˆæ¯æœºåˆ¶å¯¹ä¼ä¸šé›†æˆæ¨¡å¼ï¼ˆEIPï¼‰[m
[31m-çš„æ”¯æŒã€‚[m
[31m-[m
[31m-     Spring Batchï¼šç®€åŒ–åŠä¼˜åŒ–å¤§é‡æ•°æ®çš„æ‰¹å¤„ç†æ“ä½œã€‚[m
[31m-Spring Securityï¼šé€šè¿‡è®¤è¯å’Œæˆæƒä¿æŠ¤åº”ç”¨ã€‚[m
[31m-[m
[31m-     Spring HATEOASï¼šåŸºäºHATEOASåŸåˆ™ç®€åŒ–RESTæœåŠ¡å¼€[m
[31m-å‘ã€‚[m
[31m-[m
[31m-     Spring Socialï¼šä¸ç¤¾äº¤ç½‘ç»œAPIï¼ˆå¦‚Facebookã€æ–°æµªå¾®åš[m
[31m-ç­‰ï¼‰çš„é›†æˆã€‚[m
[31m-[m
[31m-Spring AMQPï¼šå¯¹åŸºäºAMQPçš„æ¶ˆæ¯çš„æ”¯æŒã€‚[m
[31m-[m
[31m-     Spring Mobileï¼šæä¾›å¯¹æ‰‹æœºè®¾å¤‡æ£€æµ‹çš„åŠŸèƒ½ï¼Œç»™ä¸åŒçš„è®¾[m
[31m-å¤‡è¿”å›ä¸åŒçš„é¡µé¢çš„æ”¯æŒã€‚[m
[31m-[m
[31m-     Spring for Androidï¼šä¸»è¦æä¾›åœ¨Androidä¸Šæ¶ˆè´¹RESTful[m
[31m-APIçš„åŠŸèƒ½ã€‚[m
[31m-[m
[31m-     Spring Web Flowï¼šåŸºäºSpring MVCæä¾›åŸºäºå‘å¯¼æµç¨‹å¼çš„[m
[31m-Webåº”ç”¨å¼€å‘ã€‚[m
[31m-[m
[31m-     Spring Web Servicesï¼šæä¾›äº†åŸºäºåè®®æœ‰é™çš„SOAP/Webæœ[m
[31m-åŠ¡ã€‚[m
[31m-[m
[31m-Spring LDAPï¼šç®€åŒ–ä½¿ç”¨LDAPå¼€å‘ã€‚[m
[31m-[m
[31m-     Spring  Sessionï¼šæä¾›ä¸€ä¸ªAPIåŠå®ç°æ¥ç®¡ç†ç”¨æˆ·ä¼šè¯ä¿¡[m
[31m-æ¯ã€‚[m
[31m-1.2ã€€Springé¡¹ç›®å¿«é€Ÿæ­å»º[m
[31m-[m
[31m-     è®²åˆ°é¡¹ç›®çš„æ­å»ºï¼Œä¹Ÿè®¸æœ‰äº›è¯»è€…ä½¿ç”¨çš„æ˜¯é€šè¿‡å¼€å‘å·¥å…·æ–°[m
[31m-å»ºé¡¹ç›®ï¼Œç„¶åå°†é¡¹ç›®æ‰€è¦ä¾èµ–çš„ç¬¬ä¸‰æ–¹jaråŒ…å¤åˆ¶åˆ°ä¸‹é¢çš„ç±»è·¯[m
[31m-å¾„ä¸‹ã€‚[m
[31m-[m
[31m-     æˆ‘ä»¬ç°åœ¨è¦å’Œè¿™ç§é¡¹ç›®æ­å»ºçš„æ–¹å¼è¯´æ‹œæ‹œäº†ï¼Œå› ä¸ºä¸Šè¿°æ­[m
[31m-å»ºæ–¹å¼æ²¡æœ‰ç¬¬ä¸‰æ–¹ç±»åº“çš„ä¾èµ–å…³ç³»ï¼Œåœ¨å¯¼å…¥ä¸€ä¸ªç‰¹å®šçš„jaråŒ…[m
[31m-æ—¶ï¼Œå¯èƒ½æ­¤jaråŒ…è¿˜ä¾èµ–äºå…¶ä»–çš„jaråŒ…ï¼Œå…¶ä»–çš„jaråŒ…åˆä¾èµ–äº[m
[31m-æ›´å¤šçš„jaråŒ…ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¹³å¸¸é‡åˆ°çš„ClassNotFoundé”™è¯¯çš„ä¸»[m
[31m-è¦åŸå› ã€‚[m
[31m-[m
[31m-     ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæˆ‘ä»¬æ€¥éœ€å¼•å…¥ä¸€ä¸ªé¡¹ç›®æ„å»ºå·¥å…·ã€‚ç›®[m
[31m-å‰ä¸»æµçš„é¡¹ç›®æ„å»ºå·¥å…·æœ‰ï¼šAntã€Mavenã€Gradleç­‰ã€‚æœ¬ä¹¦ä¸­æˆ‘[m
[31m-ä»¬ä½¿ç”¨Mavenä½œä¸ºé¡¹ç›®æ„å»ºå·¥å…·ã€‚[m
[31m-[m
[31m-1.2.1ã€€Mavenç®€ä»‹[m
[31m-[m
[31m-     Apache Mavenæ˜¯ä¸€ä¸ªè½¯ä»¶é¡¹ç›®ç®¡ç†å·¥å…·ã€‚åŸºäºé¡¹ç›®å¯¹è±¡æ¨¡[m
[31m-å‹ï¼ˆProject Object Modelï¼ŒPOMï¼‰çš„æ¦‚å¿µï¼ŒMavenå¯ç”¨æ¥ç®¡ç†[m
[31m-é¡¹ç›®çš„ä¾èµ–ã€ç¼–è¯‘ã€æ–‡æ¡£ç­‰ä¿¡æ¯ã€‚[m
[31m-[m
[31m-     ä½¿ç”¨Mavenç®¡ç†é¡¹ç›®æ—¶ï¼Œé¡¹ç›®ä¾èµ–çš„jaråŒ…å°†ä¸åœ¨åŒ…å«åœ¨é¡¹[m
[31m-ç›®å†…ï¼Œè€Œæ˜¯é›†ä¸­æ”¾ç½®åœ¨ç”¨æˆ·ç›®å½•ä¸‹çš„.m2æ–‡ä»¶å¤¹ä¸‹ã€‚[m
[31m-[m
[31m-1.2.2ã€€Mavenå®‰è£…[m
[31m-     1.ä¸‹è½½Maven[m
[31m-     æ ¹æ®æ“ä½œç³»ç»Ÿä¸‹è½½æ­£ç¡®çš„Mavenç‰ˆæœ¬ï¼Œå¹¶è§£å‹åˆ°ä»»æ„ç›®[m
[31m-å½•ã€‚[m
[31m-     Mavenä¸‹è½½åœ°å€ï¼šhttps://maven.apache.org/download.cgiã€‚[m
[31m-     2.é…ç½®Maven[m
[31m-     åœ¨ç³»ç»Ÿå±æ€§â†’é«˜çº§â†’ç¯å¢ƒå˜é‡ä¸­åˆ†åˆ«é…ç½®M2_HOMEå’Œ[m
[31m-Pathï¼Œå¦‚å›¾1-2æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                           å›¾1-2ã€€é…ç½®M2_HOMEå’ŒPath[m
[31m-[m
[31m-     3.æµ‹è¯•å®‰è£…[m
[31m-     åœ¨æ§åˆ¶å°è¾“å…¥â€œmvnâ€“vâ€ï¼Œè·å¾—å¦‚å›¾1-3æ‰€ç¤ºä¿¡æ¯è¡¨ç¤ºå®‰è£…æˆ[m
[31m-åŠŸã€‚[m
[31m-[m
[31m-                                    å›¾1-3ã€€å®‰è£…æˆåŠŸ[m
[31m-1.2.3ã€€Mavençš„pom.xml[m
[31m-[m
[31m-     Mavenæ˜¯åŸºäºé¡¹ç›®å¯¹è±¡æ¨¡å‹çš„æ¦‚å¿µè¿ä½œçš„ï¼Œæ‰€ä»¥Mavençš„[m
[31m-é¡¹ç›®éƒ½æœ‰ä¸€ä¸ªpom.xmlç”¨æ¥ç®¡ç†é¡¹ç›®çš„ä¾èµ–ä»¥åŠé¡¹ç›®çš„ç¼–è¯‘ç­‰[m
[31m-åŠŸèƒ½ã€‚[m
[31m-[m
[31m-     åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸‹é¢çš„å…ƒç´ ã€‚[m
[31m-[m
[31m-     1.dependencieså…ƒç´ [m
[31m-     <dependencies></dependencies>ï¼Œæ­¤å…ƒç´ åŒ…å«å¤šä¸ªé¡¹ç›®ä¾èµ–[m
[31m-éœ€è¦ä½¿ç”¨çš„<dependency></dependency>ã€‚[m
[31m-     2.dependencyå…ƒç´ [m
[31m-     <dependency></dependency>å†…éƒ¨é€šè¿‡groupIdã€artifactIdä»¥[m
[31m-åŠversionç¡®å®šå”¯ä¸€çš„ä¾èµ–ï¼Œæœ‰äººç§°è¿™ä¸‰ä¸ªä¸ºåæ ‡ï¼Œä»£ç å¦‚ä¸‹ã€‚[m
[31m-     groupIdï¼šç»„ç»‡çš„å”¯ä¸€æ ‡è¯†ã€‚[m
[31m-     artifactIdï¼šé¡¹ç›®çš„å”¯ä¸€æ ‡è¯†ã€‚[m
[31m-     versionï¼šé¡¹ç›®çš„ç‰ˆæœ¬ã€‚[m
[31m-[m
[31m-       <dependency>[m
[31m-              <groupId>org.springframework</groupId>[m
[31m-              <artifactId>spring-webmvc</artifactId>[m
[31m-              <version>4.1.5.RELEASE</version>[m
[31m-[m
[31m-       </dependency>[m
[31m-[m
[31m-     3.å˜é‡å®šä¹‰[m
[31m-     å˜é‡å®šä¹‰ï¼š<properties></properties>å¯å®šä¹‰å˜é‡åœ¨[m
[31m-dependencyä¸­å¼•ç”¨ï¼Œä»£ç å¦‚ä¸‹ã€‚[m
[31m-[m
[31m-<properties>                                           <spring-[m
[31m-[m
[31m-framework.version>4.1.5.RELEASE</spring-framework.version>[m
[31m-[m
[31m-</properties>[m
[31m-[m
[31m-<dependency>[m
[31m-       <groupId>org.springframework</groupId>[m
[31m-       <artifactId>spring-webmvc</artifactId>[m
[31m-       <version>${spring-framework.version}</version>[m
[31m-[m
[31m-</dependency>[m
[31m-[m
[31m-     4.ç¼–è¯‘æ’ä»¶[m
[31m-[m
[31m-     Mavenæä¾›äº†ç¼–è¯‘æ’ä»¶ï¼Œå¯åœ¨ç¼–è¯‘æ’ä»¶ä¸­æ¶‰åŠJavaçš„ç¼–è¯‘[m
[31m-çº§åˆ«ï¼Œä»£ç å¦‚ä¸‹ã€‚[m
[31m-[m
[31m-       <build>[m
[31m-                      <plugins>[m
[31m-                             <plugin>[m
[31m-                                    <groupId>org.apache.maven.plugins</groupId>[m
[31m-                                                                     <artifactId>maven-compiler-[m
[31m-[m
[31m-       plugin</artifactId>[m
[31m-                                    <version>2.3.2</version>[m
[31m-                                    <configuration>[m
[31m-                                           <source>1.7</source>[m
[31m-                                           <target>1.7</target>[m
[31m-                                    </configuration>[m
[31m-[m
[31m-                             </plugin>[m
[31m-                      </plugins>[m
[31m-       </build>[m
[31m-[m
[31m-     5.Mavenè¿ä½œæ–¹å¼[m
[31m-[m
[31m-     Mavenä¼šè‡ªåŠ¨æ ¹æ®dependencyä¸­çš„ä¾èµ–é…ç½®ï¼Œç›´æ¥é€šè¿‡äº’[m
[31m-è”ç½‘åœ¨Mavenä¸­å¿ƒåº“ä¸‹è½½ç›¸å…³ä¾èµ–åŒ…åˆ°.m2ç›®å½•ä¸‹ï¼Œ.m2ç›®å½•ä¸‹[m
[31m-æ˜¯ä½ æœ¬åœ°Mavenåº“ã€‚[m
[31m-[m
[31m-     å¦‚æœä½ ä¸çŸ¥é“ä½ æ‰€ä¾èµ–jaråŒ…çš„dependencyæ€ä¹ˆå†™çš„è¯ï¼Œæ¨[m
[31m-èåˆ°http://mvnrepository.comç½‘ç«™æ£€ç´¢ã€‚[m
[31m-[m
[31m-     è‹¥Mavenä¸­å¿ƒåº“ä¸­æ²¡æœ‰ä½ éœ€è¦çš„jaråŒ…ï¼ˆå¦‚Oracleï¼‰ï¼Œä½ éœ€[m
[31m-è¦é€šè¿‡ä¸‹é¢çš„Mavenå‘½ä»¤æ‰“åˆ°æœ¬åœ°Mavenåº“ååº”ç”¨å³å¯ï¼Œå¦‚å®‰[m
[31m-è£…Oracleé©±åŠ¨åˆ°æœ¬åœ°åº“ï¼š[m
[31m-[m
[31m-mvn install:install-file    -DgroupId=com.oracle  "-[m
[31m-DartifactId=ojdbc14"      "-Dpackaging=jar"       "-[m
[31m-"-Dversion=10.2.0.2.0"[m
[31m-Dfile=D:\ojdbc14.jar"[m
[31m-[m
[31m-1.2.4ã€€Springé¡¹ç›®çš„æ­å»º[m
[31m-[m
[31m-     1.åŸºäºSpring Tool Suiteæ­å»º[m
[31m-[m
[31m-     Spring Tool Suiteï¼ˆç®€ç§°STSï¼‰æ˜¯Springå®˜æ–¹æ¨å‡ºçš„åŸºäº[m
[31m-Eclipseçš„å¼€å‘å·¥å…·ï¼Œé›†æˆäº†M2Eï¼ˆMaven Integration for[m
[31m-Eclipseï¼‰ã€Spring IDEç­‰æ’ä»¶ã€‚è‹¥ä¹ æƒ¯äºç”¨Eclipseå¼€å‘é¡¹ç›®çš„[m
[31m-è¯ï¼ŒSTSåˆ™æ˜¯å¼€å‘Springé¡¹ç›®çš„ä¸äºŒä¹‹é€‰ã€‚è‹¥ä½ å½“å‰ä½¿ç”¨çš„æ˜¯[m
[31m-å¸¸è§„çš„Eclipseï¼Œè¯·å®‰è£…M2Eæ’ä»¶ã€‚STSä¸‹è½½åœ°å€ï¼š[m
[31m-https://spring.io/tools/sts/allã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ–°å»ºMavené¡¹ç›®ï¼Œå¦‚å›¾1-4æ‰€ç¤ºã€‚[m
[31m-                         å›¾1-4ã€€æ–°å»ºMavené¡¹ç›®[m
[31m-[m
[31m-ï¼ˆ2ï¼‰è¾“å‡ºæœ¬Mavené¡¹ç›®çš„åæ ‡å€¼ï¼Œå¦‚å›¾1-5æ‰€ç¤ºã€‚[m
[31m-ï¼ˆ3ï¼‰åœ¨STSä¸­ç”Ÿæˆå¦‚å›¾1-6æ‰€ç¤ºç»“æ„çš„é¡¹ç›®ã€‚[m
[31m-                            å›¾1-5ã€€è¾“å‡ºåæ ‡å€¼[m
[31m-[m
[31m-                            å›¾1-6ã€€é¡¹ç›®çš„ç»“æ„[m
[31m-[m
[31m-ï¼ˆ4ï¼‰ä¿®æ”¹pom.xmlã€‚å¢åŠ Springçš„ä¾èµ–ï¼Œæ·»åŠ ç¼–è¯‘æ’ä»¶ï¼Œ[m
[31m-å°†ç¼–è¯‘çº§åˆ«è®¾ç½®ä¸º1.7ã€‚[m
[31m-[m
[31m-       <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://ww[m
[31m-       instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://[m
[31m-       4.0.0.xsd">[m
[31m-[m
[31m-           <modelVersion>4.0.0</modelVersion>[m
[31m-           <groupId>com.wisely</groupId>[m
[31m-           <artifactId>highlight_spring4</artifactId>[m
[31m-           <version>0.0.1-SNAPSHOT</version>[m
[31m-           <properties>[m
[31m-[m
[31m-              <java.version>1.7</java.version>[m
[31m-           </properties>[m
[31m-           <dependencies>[m
[31m-[m
[31m-              <dependency>[m
[31m-                      <groupId>org.springframework</groupId>[m
[31m-                      <artifactId>spring-context</artifactId>[m
[31m-                      <version>4.1.6.RELEASE</version>[m
[31m-[m
[31m-              </dependency>[m
[31m-           </dependencies>[m
[31m-           <build>[m
[31m-[m
[31m-                      <plugins>[m
[31m-                             <plugin>[m
[31m-                                    <groupId>org.apache.maven.plugins</groupId>[m
[31m-                                                                     <artifactId>maven-compiler-[m
[31m-[m
[31m-       plugin</artifactId>[m
[31m-                                    <version>2.3.2</version>[m
[31m-                                    <configuration>[m
[31m-                                           <source>${java.version}</source>[m
[31m-                                           <target>${java.version}</target>[m
[31m-                                    </configuration>[m
[31m-[m
[31m-                             </plugin>[m
[31m-                      </plugins>[m
[31m-              </build>[m
[31m-       </project>[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰æ›´æ–°é¡¹ç›®ã€‚å•å‡»é¡¹ç›®å³é”®â†’Mavenâ†’Update[m
[31m-Projectâ†’highlight-spring4â†’Maven[m
[31m-Dependenciesâ†’Springâ†’expression-4.1.6RELEASE.jarï¼Œå¦‚å›¾1-7[m
[31m-æ‰€ç¤ºã€‚[m
[31m-                              å›¾1-7ã€€æ›´æ–°é¡¹ç›®[m
[31m-[m
[31m-ï¼ˆ6ï¼‰ä¾èµ–æ ‘æŸ¥çœ‹ï¼Œå¦‚å›¾1-8æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                            å›¾1-8ã€€ä¾èµ–æ ‘æŸ¥çœ‹[m
[31m-2.åŸºäºIntelliJ IDEAæ­å»º[m
[31m-[m
[31m-     IntelliJ IDEAæ˜¯Javaæœ€ä¼˜ç§€çš„å¼€å‘å·¥å…·ï¼šåŠŸèƒ½å…¨é¢ã€æç¤ºæ™º[m
[31m-èƒ½ã€å¼€å‘ä¸å¡é¡¿ã€æ–°æŠ€æœ¯æ”¯æŒå¿«ã€‚[m
[31m-[m
[31m-     IntelliJ IDEAåˆ†ä¸ºç¤¾åŒºç‰ˆå’Œå•†ä¸šç‰ˆï¼Œç¤¾åŒºç‰ˆå…è´¹ï¼Œå•†ä¸šç‰ˆ[m
[31m-åŠŸèƒ½å¼ºå¤§ã€‚å•†ä¸šç‰ˆæä¾›30å¤©çš„è¯•ç”¨ã€‚[m
[31m-[m
[31m-IntelliJ                                   IDEAä¸‹è½½åœ°å€ï¼š[m
[31m-[m
[31m-https://www.jetbrains.com/idea/download/ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ–°å»ºMavené¡¹ç›®ã€‚å•å‡»Fileâ†’Newâ†’Projectâ†’Mavenï¼Œ[m
[31m-å¦‚å›¾1-9æ‰€ç¤ºã€‚[m
[31m-[m
[31m-ï¼ˆ2ï¼‰è¾“å…¥Mavené¡¹ç›®åæ ‡å€¼ï¼Œå¦‚å›¾1-10æ‰€ç¤ºã€‚[m
[31m-[m
[31m-ï¼ˆ3ï¼‰é€‰æ‹©å­˜å‚¨è·¯å¾„ï¼Œå¦‚å›¾1-11æ‰€ç¤ºã€‚[m
[31m-[m
[31m-          å›¾1-9ã€€æ–°å»ºMavené¡¹ç›®[m
[31m-                                 å›¾1-10ã€€è¾“å…¥åæ ‡å€¼[m
[31m-[m
[31m-                                å›¾1-11ã€€é€‰æ‹©å­˜å‚¨è·¯å¾„[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰ä¿®æ”¹pom.xmlæ–‡ä»¶ï¼Œä½¿ç”¨ä¸Šä¾‹çš„pom.xmlæ–‡ä»¶å†…å®¹ï¼Œ[m
[31m-IDEAä¼šå¼€å¯è‡ªåŠ¨å¯¼å…¥Mavenä¾èµ–åŒ…åŠŸèƒ½ï¼Œå¦‚å›¾1-12æ‰€ç¤ºã€‚[m
[31m-                   å›¾1-12ã€€å¼€å¯è‡ªåŠ¨å¯¼å…¥MavenåŠŸèƒ½[m
[31m-[m
[31m-ï¼ˆ5ï¼‰ä¾èµ–æ ‘æŸ¥çœ‹ï¼Œå¦‚å›¾1-13æ‰€ç¤ºã€‚[m
[31m-                                 å›¾1-13ã€€ä¾èµ–æ ‘æŸ¥çœ‹[m
[31m-[m
[31m-     3.åŸºäºNetBeansæ­å»º[m
[31m-[m
[31m-     NetBeansæ˜¯Oracleå®˜æ–¹æ¨å‡ºçš„Javaå¼€å‘å·¥å…·ï¼Œä¸‹è½½åœ°å€å¦‚[m
[31m-ä¸‹ï¼šhttps://netbeans.org/downloads/ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ–°å»ºMavené¡¹ç›®ï¼Œå¦‚å›¾1-14æ‰€ç¤ºã€‚[m
[31m-                         å›¾1-14ã€€æ–°å»ºMavené¡¹ç›®[m
[31m-[m
[31m-ï¼ˆ2ï¼‰è¾“å…¥Mavenåæ ‡ï¼Œå¦‚å›¾1-15æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                         å›¾1-15ã€€è¾“å…¥Mavenåæ ‡[m
[31m-[m
[31m-ï¼ˆ3ï¼‰æ›´æ–°pom.xmlï¼Œå¦‚å›¾1-16æ‰€ç¤ºã€‚[m
[31m-                          å›¾1-16ã€€æ›´æ–°pom.xml[m
[31m-[m
[31m-ï¼ˆ4ï¼‰ä¾èµ–æ ‘æŸ¥çœ‹ï¼Œå¦‚å›¾1-17æ‰€ç¤ºã€‚[m
[31m-å›¾1-17ã€€ä¾èµ–æ ‘æŸ¥çœ‹[m
[31m-1.3ã€€SpringåŸºç¡€é…ç½®[m
[31m-[m
[31m-     Springæ¡†æ¶æœ¬èº«æœ‰å››å¤§åŸåˆ™ï¼š[m
[31m-[m
[31m-     1ï¼‰ä½¿ç”¨POJOè¿›è¡Œè½»é‡çº§å’Œæœ€å°ä¾µå…¥å¼å¼€å‘ã€‚[m
[31m-[m
[31m-     2ï¼‰é€šè¿‡ä¾èµ–æ³¨å…¥å’ŒåŸºäºæ¥å£ç¼–ç¨‹å®ç°æ¾è€¦åˆã€‚[m
[31m-[m
[31m-     3ï¼‰é€šè¿‡AOPå’Œé»˜è®¤ä¹ æƒ¯è¿›è¡Œå£°æ˜å¼ç¼–ç¨‹ã€‚[m
[31m-[m
[31m-     4ï¼‰ä½¿ç”¨AOPå’Œæ¨¡æ¿ï¼ˆtemplateï¼‰å‡å°‘æ¨¡å¼åŒ–ä»£ç ã€‚[m
[31m-[m
[31m-     Springæ‰€æœ‰åŠŸèƒ½çš„è®¾è®¡å’Œå®ç°éƒ½æ˜¯åŸºäºæ­¤å››å¤§åŸåˆ™çš„ã€‚[m
[31m-[m
[31m-1.3.1ã€€ä¾èµ–æ³¨å…¥[m
[31m-[m
[31m-     1.ç‚¹ç›[m
[31m-[m
[31m-     æˆ‘ä»¬ç»å¸¸è¯´çš„æ§åˆ¶ç¿»è½¬ï¼ˆInversion of Control-IOCï¼‰å’Œä¾èµ–[m
[31m-æ³¨å…¥ï¼ˆdependency injection-DIï¼‰åœ¨Springç¯å¢ƒä¸‹æ˜¯ç­‰åŒçš„æ¦‚[m
[31m-å¿µï¼Œæ§åˆ¶ç¿»è½¬æ˜¯é€šè¿‡ä¾èµ–æ³¨å…¥å®ç°çš„ã€‚æ‰€è°“ä¾èµ–æ³¨å…¥æŒ‡çš„æ˜¯å®¹[m
[31m-å™¨è´Ÿè´£åˆ›å»ºå¯¹è±¡å’Œç»´æŠ¤å¯¹è±¡é—´çš„ä¾èµ–å…³ç³»ï¼Œè€Œä¸æ˜¯é€šè¿‡å¯¹è±¡æœ¬[m
[31m-èº«è´Ÿè´£è‡ªå·±çš„åˆ›å»ºå’Œè§£å†³è‡ªå·±çš„ä¾èµ–ã€‚[m
[31m-[m
[31m-     ä¾èµ–æ³¨å…¥çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£è€¦ï¼Œä½“ç°äº†ä¸€ç§â€œç»„åˆâ€çš„ç†[m
[31m-å¿µã€‚å¦‚æœä½ å¸Œæœ›ä½ çš„ç±»å…·å¤‡æŸé¡¹åŠŸèƒ½çš„æ—¶å€™ï¼Œæ˜¯ç»§æ‰¿è‡ªä¸€ä¸ªå…·[m
[31m-æœ‰æ­¤åŠŸèƒ½çš„çˆ¶ç±»å¥½å‘¢ï¼Ÿè¿˜æ˜¯ç»„åˆå¦å¤–ä¸€ä¸ªå…·æœ‰è¿™ä¸ªåŠŸèƒ½çš„ç±»å¥½[m
[31m-å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸è¨€è€Œå–»çš„ï¼Œç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œå­ç±»å°†ä¸çˆ¶ç±»è€¦åˆï¼Œ[m
[31m-ç»„åˆå¦å¤–ä¸€ä¸ªç±»åˆ™ä½¿è€¦åˆåº¦å¤§å¤§é™ä½ã€‚[m
[31m-     Spring IoCå®¹å™¨ï¼ˆApplicationContextï¼‰è´Ÿè´£åˆ›å»ºBeanï¼Œå¹¶é€š[m
[31m-è¿‡å®¹å™¨å°†åŠŸèƒ½ç±»Beanæ³¨å…¥åˆ°ä½ éœ€è¦çš„Beanä¸­ã€‚Springæä¾›ä½¿ç”¨[m
[31m-xmlã€æ³¨è§£ã€Javaé…ç½®ã€groovyé…ç½®å®ç°Beançš„åˆ›å»ºå’Œæ³¨å…¥ã€‚[m
[31m-[m
[31m-     æ— è®ºæ˜¯xmlé…ç½®ã€æ³¨è§£é…ç½®è¿˜æ˜¯Javaé…ç½®ï¼Œéƒ½è¢«ç§°ä¸ºé…ç½®å…ƒ[m
[31m-æ•°æ®ï¼Œæ‰€è°“å…ƒæ•°æ®å³æè¿°æ•°æ®çš„æ•°æ®ã€‚å…ƒæ•°æ®æœ¬èº«ä¸å…·å¤‡ä»»ä½•[m
[31m-å¯æ‰§è¡Œçš„èƒ½åŠ›ï¼Œåªèƒ½é€šè¿‡å¤–ç•Œä»£ç æ¥å¯¹è¿™äº›å…ƒæ•°æ®è¡Œè§£æåè¿›[m
[31m-è¡Œä¸€äº›æœ‰æ„ä¹‰æ“ä½œã€‚Springå®¹å™¨è§£æè¿™äº›é…ç½®å…ƒæ•°æ®è¿›è¡ŒBean[m
[31m-åˆå§‹åŒ–ã€é…ç½®å’Œç®¡ç†ä¾èµ–ã€‚[m
[31m-[m
[31m-     å£°æ˜Beançš„æ³¨è§£ï¼š[m
[31m-[m
[31m-     @Componentç»„ä»¶ï¼Œæ²¡æœ‰æ˜ç¡®çš„è§’è‰²ã€‚[m
[31m-     @Serviceåœ¨ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆserviceå±‚ï¼‰ä½¿ç”¨ã€‚[m
[31m-     @Repositoryåœ¨æ•°æ®è®¿é—®å±‚ï¼ˆdaoå±‚ï¼‰ä½¿ç”¨ã€‚[m
[31m-     @Controlleråœ¨å±•ç°å±‚ï¼ˆMVCâ†’Spring MVCï¼‰ä½¿ç”¨ã€‚[m
[31m-[m
[31m-     æ³¨å…¥Beançš„æ³¨è§£ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é€šç”¨ã€‚[m
[31m-[m
[31m-     @Autowiredï¼šSpringæä¾›çš„æ³¨è§£ã€‚[m
[31m-     @Injectï¼šJSR-330æä¾›çš„æ³¨è§£ã€‚[m
[31m-     @Resourceï¼šJSR-250æä¾›çš„æ³¨è§£ã€‚[m
[31m-[m
[31m-     @Autowiredã€@Injectã€@Resourceå¯æ³¨è§£åœ¨setæ–¹æ³•ä¸Šæˆ–è€…[m
[31m-å±æ€§ä¸Šï¼Œç¬”è€…ä¹ æƒ¯æ³¨è§£åœ¨å±æ€§ä¸Šï¼Œä¼˜ç‚¹æ˜¯ä»£ç æ›´å°‘ã€å±‚æ¬¡æ›´æ¸…[m
[31m-æ™°ã€‚[m
[31m-[m
[31m-     åœ¨æœ¬èŠ‚æ¼”ç¤ºåŸºäºæ³¨è§£çš„Beançš„åˆå§‹åŒ–å’Œä¾èµ–æ³¨å…¥ï¼ŒSpring[m
[31m-å®¹å™¨ç±»é€‰ç”¨AnnotationConfigApplicationContextã€‚[m
[31m-[m
[31m-     2.ç¤ºä¾‹[m
[31m-     ï¼ˆ1ï¼‰ç¼–å†™åŠŸèƒ½ç±»çš„Beanã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch1.di;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-       @Service //1[m
[31m-       public class FunctionService {[m
[31m-[m
[31m-              public String sayHello(String word){[m
[31m-                      return "Hello " + word +" !";[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä½¿ç”¨@Serviceæ³¨è§£å£°æ˜å½“å‰FunctionServiceç±»æ˜¯Springç®¡[m
[31m-ç†çš„ä¸€ä¸ªBeanã€‚å…¶ä¸­ï¼Œä½¿ç”¨@Componentã€@Serviceã€[m
[31m-@Repositoryå’Œ@Controlleræ˜¯ç­‰æ•ˆçš„ï¼Œå¯æ ¹æ®éœ€è¦é€‰ç”¨ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰ä½¿ç”¨åŠŸèƒ½ç±»çš„Beanã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch1.di;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-       @Service //1[m
[31m-       public class UseFunctionService {[m
[31m-[m
[31m-              @Autowired //2[m
[31m-              FunctionService functionService;[m
[31m-[m
[31m-              public String SayHello(String word){[m
[31m-                      return functionService.sayHello(word);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ ä½¿ç”¨@Serviceæ³¨è§£å£°æ˜å½“å‰UseFunctionServiceç±»æ˜¯[m
[31m-Springç®¡ç†çš„ä¸€ä¸ªBeanã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨@Autowiredå°†FunctionServiceçš„å®ä½“Beanæ³¨å…¥åˆ°[m
[31m-UseFunctionServiceä¸­ï¼Œè®©UseFunctionServiceå…·å¤‡[m
[31m-FunctionServiceçš„åŠŸèƒ½ï¼Œæ­¤å¤„ä½¿ç”¨JSR-330çš„@Injectæ³¨è§£æˆ–è€…[m
[31m-JSR-250çš„@Resourceæ³¨è§£æ˜¯ç­‰æ•ˆçš„ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰é…ç½®ç±»ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch1.di;[m
[31m-       import org.springframework.context.annotation.ComponentScan;[m
[31m-       import org.springframework.context.annotation.Configuration;[m
[31m-       @Configuration //1[m
[31m-       @ComponentScan("com.wisely.highlight_spring4.ch1.di") //2[m
[31m-       public class DiConfig {[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ @Configurationå£°æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œåœ¨åé¢1.3.2[m
[31m-èŠ‚çš„Javaé…ç½®ä¸­æœ‰æ›´è¯¦ç»†çš„è¯´æ˜ï¼›[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨@ComponentScanï¼Œè‡ªåŠ¨æ‰«æåŒ…åä¸‹æ‰€æœ‰ä½¿ç”¨[m
[31m-@Serviceã€@Componentã€@Repositoryå’Œ@Controllerçš„ç±»ï¼Œå¹¶[m
[31m-æ³¨å†Œä¸ºBeanã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰è¿è¡Œã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch1.di;[m
[31m-       import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-       public class Main {[m
[31m-[m
[31m-              public static void main(String[] args) {[m
[31m-                       AnnotationConfigApplicationContext context =[m
[31m-                                          new AnnotationConfigApplicationContext(DiConfig.clas[m
[31m-       UseFunctionService useFunctionService = context.getBean(UseFunctionServ[m
[31m-[m
[31m-                       System.out.println(useFunctionService.SayHello("di"));[m
[31m-                      context.close();[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ ä½¿ç”¨AnnotationConfigApplicationContextä½œä¸ºSpringå®¹[m
[31m-å™¨ï¼Œæ¥å—è¾“å…¥ä¸€ä¸ªé…ç½®ç±»ä½œä¸ºå‚æ•°ï¼›[m
[31m-     â‘¡è·å¾—å£°æ˜é…ç½®çš„UseFunctionServiceçš„Beanã€‚[m
[31m-     ç»“æœå¦‚å›¾1-18æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾1-18ã€€è¿è¡Œç»“æœ[m
[31m-[m
[31m-1.3.2ã€€Javaé…ç½®[m
[31m-[m
[31m-     1.ç‚¹ç›[m
[31m-     Javaé…ç½®æ˜¯Spring 4.xæ¨èçš„é…ç½®æ–¹å¼ï¼Œå¯ä»¥å®Œå…¨æ›¿ä»£xml[m
[31m-é…ç½®ï¼›Javaé…ç½®ä¹Ÿæ˜¯Spring Bootæ¨èçš„é…ç½®æ–¹å¼ã€‚[m
[31m-[m
[31m-     Javaé…ç½®æ˜¯é€šè¿‡@Configurationå’Œ@Beanæ¥å®ç°çš„ã€‚[m
[31m-[m
[31m-     @Configurationå£°æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œç›¸å½“äºä¸€ä¸ª[m
[31m-     Springé…ç½®çš„xmlæ–‡ä»¶ã€‚[m
[31m-     @Beanæ³¨è§£åœ¨æ–¹æ³•ä¸Šï¼Œå£°æ˜å½“å‰æ–¹æ³•çš„è¿”å›å€¼ä¸ºä¸€ä¸ª[m
[31m-     Beanã€‚[m
[31m-[m
[31m-     æœ¬ä¹¦é€šç¯‡ä½¿ç”¨Javaé…ç½®å’Œæ³¨è§£æ··åˆé…ç½®ã€‚ä½•æ—¶ä½¿ç”¨Javaé…[m
[31m-ç½®æˆ–è€…æ³¨è§£é…ç½®å‘¢ï¼Ÿæˆ‘ä»¬ä¸»è¦çš„åŸåˆ™æ˜¯ï¼šå…¨å±€é…ç½®ä½¿ç”¨Javaé…[m
[31m-ç½®ï¼ˆå¦‚æ•°æ®åº“ç›¸å…³é…ç½®ã€MVCç›¸å…³é…ç½®ï¼‰ï¼Œä¸šåŠ¡Beançš„é…ç½®[m
[31m-ä½¿ç”¨æ³¨è§£é…ç½®ï¼ˆ@Serviceã€@Componentã€@Repositoryã€[m
[31m-@Controlleï¼‰ã€‚[m
[31m-[m
[31m-     æœ¬èŠ‚åªæ¼”ç¤ºç®€å•çš„Javaé…ç½®ï¼Œå…¨ä¹¦å„ä¸ªç« èŠ‚éƒ½ä¼šæœ‰å¤§é‡çš„[m
[31m-Javaé…ç½®çš„å†…å®¹ã€‚[m
[31m-[m
[31m-     2.ç¤ºä¾‹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰ç¼–å†™åŠŸèƒ½ç±»çš„Beanã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch1.javaconfig;[m
[31m-       //1[m
[31m-       public class FunctionService {[m
[31m-[m
[31m-              public String sayHello(String word){[m
[31m-                      return "Hello " + word +" !";[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ æ­¤å¤„æ²¡æœ‰ä½¿ç”¨@Serviceå£°æ˜Beanã€‚[m
[31m-ï¼ˆ2ï¼‰ä½¿ç”¨åŠŸèƒ½ç±»çš„Beanã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch1.javaconfig;[m
[31m-[m
[31m-import com.wisely.highlight_spring4.ch1.javaconfig.FunctionService;[m
[31m-//1[m
[31m-public class UseFunctionService {[m
[31m-[m
[31m-       //2[m
[31m-       FunctionService functionService;[m
[31m-[m
[31m-       public void setFunctionService(FunctionService functionService) {[m
[31m-              this.functionService = functionService;[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       public String SayHello(String word){[m
[31m-              return functionService.sayHello(word);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ æ­¤å¤„æ²¡æœ‰ä½¿ç”¨@Serviceå£°æ˜Beanã€‚[m
[31m-[m
[31m-â‘¡æ­¤å¤„æ²¡æœ‰ä½¿ç”¨@Autowiredæ³¨è§£æ³¨å…¥Beanã€‚[m
[31m-[m
[31m-ï¼ˆ3ï¼‰é…ç½®ç±»ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch1.javaconfig;[m
[31m-[m
[31m-import org.springframework.context.annotation.Bean;[m
[31m-import org.springframework.context.annotation.Configuration;[m
[31m-[m
[31m-@Configuration //1[m
[31m-public class JavaConfig {[m
[31m-[m
[31m-       @Bean //2[m
[31m-       public FunctionService functionService(){[m
[31m-[m
[31m-              return new FunctionService();[m
[31m-       }[m
[31m-              @Bean[m
[31m-              public UseFunctionService useFunctionService(){[m
[31m-[m
[31m-                      UseFunctionService useFunctionService = new UseFunctionService([m
[31m-                      useFunctionService.setFunctionService(functionService());//3[m
[31m-                      return useFunctionService;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       // @Bean[m
[31m-       // public UseFunctionService useFunctionService(FunctionService functi[m
[31m-       { //4[m
[31m-       // UseFunctionService useFunctionService = new UseFunctionService([m
[31m-       // useFunctionService.setFunctionService(functionService);[m
[31m-       // return useFunctionService;[m
[31m-       // }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä½¿ç”¨@Configurationæ³¨è§£è¡¨æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œè¿™[m
[31m-æ„å‘³ç€è¿™ä¸ªç±»é‡Œå¯èƒ½æœ‰0ä¸ªæˆ–è€…å¤šä¸ª@Beanæ³¨è§£ï¼Œæ­¤å¤„æ²¡æœ‰ä½¿[m
[31m-ç”¨åŒ…æ‰«æï¼Œæ˜¯å› ä¸ºæ‰€æœ‰çš„Beanéƒ½åœ¨æ­¤ç±»ä¸­å®šä¹‰äº†ã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨@Beanæ³¨è§£å£°æ˜å½“å‰æ–¹æ³•FunctionServiceçš„è¿”å›å€¼[m
[31m-æ˜¯ä¸€ä¸ªBeanï¼ŒBeançš„åç§°æ˜¯æ–¹æ³•åã€‚[m
[31m-[m
[31m-     â‘¢æ³¨å…¥FunctionServiceçš„Beanæ—¶å€™ç›´æ¥è°ƒç”¨[m
[31m-functionServiceï¼ˆï¼‰ã€‚[m
[31m-[m
[31m-     â‘£å¦å¤–ä¸€ç§æ³¨å…¥çš„æ–¹å¼ï¼Œç›´æ¥å°†FunctionServiceä½œä¸ºå‚æ•°[m
[31m-ç»™useFunctionServiceï¼ˆï¼‰ï¼Œè¿™ä¹Ÿæ˜¯Springå®¹å™¨æä¾›çš„æå¥½çš„åŠŸ[m
[31m-èƒ½ã€‚åœ¨Springå®¹å™¨ä¸­ï¼Œåªè¦å®¹å™¨ä¸­å­˜åœ¨æŸä¸ªBeanï¼Œå°±å¯ä»¥åœ¨å¦[m
[31m-å¤–ä¸€ä¸ªBeançš„å£°æ˜æ–¹æ³•çš„å‚æ•°ä¸­å†™å…¥ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰è¿è¡Œã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch1.javaconfig;[m
[31m-       import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-       public class Main {[m
[31m-[m
[31m-              public static void main(String[] args) {[m
[31m-                       AnnotationConfigApplicationContext context =[m
[31m-                                           new AnnotationConfigApplicationContext(JavaConfig.c[m
[31m-                       UseFunctionService useFunctionService = context.getBean(UseFun[m
[31m-                       System.out.println(useFunctionService.SayHello("java config"))[m
[31m-                       context.close();[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ç»“æœå¦‚å›¾1-19æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾1-19ã€€è¿è¡Œç»“æœ[m
[31m-[m
[31m-1.3.3ã€€AOP[m
[31m-[m
[31m-     1.ç‚¹ç›[m
[31m-     AOPï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œç›¸å¯¹äºOOPé¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚[m
[31m-     Springçš„AOPçš„å­˜åœ¨ç›®çš„æ˜¯ä¸ºäº†è§£è€¦ã€‚AOPå¯ä»¥è®©ä¸€ç»„ç±»[m
[31m-å…±äº«ç›¸åŒçš„è¡Œä¸ºã€‚åœ¨OOPä¸­åªèƒ½é€šè¿‡ç»§æ‰¿ç±»å’Œå®ç°æ¥å£ï¼Œæ¥ä½¿[m
[31m-ä»£ç çš„è€¦åˆåº¦å¢å¼ºï¼Œä¸”ç±»ç»§æ‰¿åªèƒ½ä¸ºå•ç»§æ‰¿ï¼Œé˜»ç¢æ›´å¤šè¡Œä¸ºæ·»[m
[31m-åŠ åˆ°ä¸€ç»„ç±»ä¸Šï¼ŒAOPå¼¥è¡¥äº†OOPçš„ä¸è¶³ã€‚[m
[31m-[m
[31m-     Springæ”¯æŒAspectJçš„æ³¨è§£å¼åˆ‡é¢ç¼–ç¨‹ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰ä½¿ç”¨@Aspectå£°æ˜æ˜¯ä¸€ä¸ªåˆ‡é¢ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰ä½¿ç”¨@Afterã€@Beforeã€@Aroundå®šä¹‰å»ºè¨€[m
[31m-ï¼ˆadviceï¼‰ï¼Œå¯ç›´æ¥å°†æ‹¦æˆªè§„åˆ™ï¼ˆåˆ‡ç‚¹ï¼‰ä½œä¸ºå‚æ•°ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰å…¶ä¸­@Afterã€@Beforeã€@Aroundå‚æ•°çš„æ‹¦æˆªè§„åˆ™ä¸º[m
[31m-åˆ‡ç‚¹ï¼ˆPointCutï¼‰ï¼Œä¸ºäº†ä½¿åˆ‡ç‚¹å¤ç”¨ï¼Œå¯ä½¿ç”¨@PointCutä¸“é—¨å®š[m
[31m-ä¹‰æ‹¦æˆªè§„åˆ™ï¼Œç„¶ååœ¨@Afterã€@Beforeã€@Aroundçš„å‚æ•°ä¸­è°ƒ[m
[31m-ç”¨ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰å…¶ä¸­ç¬¦åˆæ¡ä»¶çš„æ¯ä¸€ä¸ªè¢«æ‹¦æˆªå¤„ä¸ºè¿æ¥ç‚¹[m
[31m-ï¼ˆJoinPointï¼‰ã€‚[m
[31m-[m
[31m-     æœ¬èŠ‚ç¤ºä¾‹å°†æ¼”ç¤ºåŸºäºæ³¨è§£æ‹¦æˆªå’ŒåŸºäºæ–¹æ³•è§„åˆ™æ‹¦æˆªä¸¤ç§æ–¹[m
[31m-å¼ï¼Œæ¼”ç¤ºä¸€ç§æ¨¡æ‹Ÿè®°å½•æ“ä½œçš„æ—¥å¿—ç³»ç»Ÿçš„å®ç°ã€‚å…¶ä¸­æ³¨è§£å¼æ‹¦[m
[31m-æˆªèƒ½å¤Ÿå¾ˆå¥½åœ°æ§åˆ¶è¦æ‹¦æˆªçš„ç²’åº¦å’Œè·å¾—æ›´ä¸°å¯Œçš„ä¿¡æ¯ï¼ŒSpring[m
[31m-æœ¬èº«åœ¨äº‹åŠ¡å¤„ç†ï¼ˆ@Transcationalï¼‰å’Œæ•°æ®ç¼“å­˜ï¼ˆ@Cacheable[m
[31m-ç­‰ï¼‰ä¸Šé¢éƒ½ä½¿ç”¨æ­¤ç§å½¢å¼çš„æ‹¦æˆªã€‚[m
[31m-[m
[31m-     2.ç¤ºä¾‹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ·»åŠ spring aopæ”¯æŒåŠAspectJä¾èµ–ã€‚[m
[31m-[m
[31m-                      <!-- spring aop[m
[31m-[m
[31m-       æ”¯æŒ -->[m
[31m-                      <dependency>[m
[31m-                     <groupId>org.springframework</groupId>[m
[31m-                     <artifactId>spring-aop[m
[31m-[m
[31m-</artifactId>[m
[31m-                     <version>4.1.6.RELEASE</version>[m
[31m-[m
[31m-              </dependency>[m
[31m-              <!-- aspectj[m
[31m-[m
[31m-æ”¯æŒ -->[m
[31m-              <dependency>[m
[31m-                     <groupId>org.aspectj</groupId>[m
[31m-                     <artifactId>aspectjrt</artifactId>[m
[31m-                     <version>1.8.5</version>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>org.aspectj</groupId>[m
[31m-                     <artifactId>aspectjweaver[m
[31m-[m
[31m-</artifactId>[m
[31m-                     <version>1.8.5</version>[m
[31m-[m
[31m-              </dependency>[m
[31m-[m
[31m-ï¼ˆ2ï¼‰ç¼–å†™æ‹¦æˆªè§„åˆ™çš„æ³¨è§£ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch1.aop;[m
[31m-import java.lang.annotation.Documented;[m
[31m-import java.lang.annotation.ElementType;[m
[31m-import java.lang.annotation.Retention;[m
[31m-import java.lang.annotation.RetentionPolicy;[m
[31m-import java.lang.annotation.Target;[m
[31m-       @Target(ElementType.METHOD)[m
[31m-       @Retention(RetentionPolicy.RUNTIME)[m
[31m-       @Documented[m
[31m-       public @interface Action {[m
[31m-[m
[31m-              String name();[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     è¿™é‡Œè®²ä¸‹æ³¨è§£ï¼Œæ³¨è§£æœ¬èº«æ˜¯æ²¡æœ‰åŠŸèƒ½çš„ï¼Œå°±å’Œxmlä¸€æ ·ã€‚[m
[31m-æ³¨è§£å’Œxmléƒ½æ˜¯ä¸€ç§å…ƒæ•°æ®ï¼Œå…ƒæ•°æ®å³è§£é‡Šæ•°æ®çš„æ•°æ®ï¼Œè¿™å°±[m
[31m-æ˜¯æ‰€è°“é…ç½®ã€‚[m
[31m-[m
[31m-     æ³¨è§£çš„åŠŸèƒ½æ¥è‡ªç”¨è¿™ä¸ªæ³¨è§£çš„åœ°æ–¹ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰ç¼–å†™ä½¿ç”¨æ³¨è§£çš„è¢«æ‹¦æˆªç±»ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch1.aop;[m
[31m-[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-[m
[31m-       @Service[m
[31m-       public class DemoAnnotationService {[m
[31m-[m
[31m-              @Action(name="æ³¨è§£å¼æ‹¦æˆªçš„addæ“ä½œ")[m
[31m-              public void add(){}[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰ç¼–å†™ä½¿ç”¨æ–¹æ³•è§„åˆ™è¢«æ‹¦æˆªç±»ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch1.aop;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-       @Service[m
[31m-       public class DemoMethodService {[m
[31m-[m
[31m-              public void add(){}[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ5ï¼‰ç¼–å†™åˆ‡é¢ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch1.aop;[m
[31m-[m
[31m-import java.lang.reflect.Method;[m
[31m-[m
[31m-import org.aspectj.lang.JoinPoint;[m
[31m-import org.aspectj.lang.annotation.After;[m
[31m-import org.aspectj.lang.annotation.Aspect;[m
[31m-import org.aspectj.lang.annotation.Before;[m
[31m-import org.aspectj.lang.annotation.Pointcut;[m
[31m-import org.aspectj.lang.reflect.MethodSignature;[m
[31m-import org.springframework.stereotype.Component;[m
[31m-[m
[31m-@Aspect //1[m
[31m-@Component //2[m
[31m-public class LogAspect {[m
[31m-[m
[31m-       @Pointcut("@annotation(com.wisely.highlight_spring4.ch1.aop.Action)[m
[31m-       public void annotationPointCut(){};[m
[31m-[m
[31m-          @After("annotationPointCut()") //4[m
[31m-              public void after(JoinPoint joinPoint) {[m
[31m-                     MethodSignature signature = (MethodSignature) joinPoint.get[m
[31m-                     Method method = signature.getMethod();[m
[31m-                     Action action = method.getAnnotation(Action.class);[m
[31m-                                                              System.out.println("æ³¨è§£å¼æ‹¦[m
[31m-[m
[31m-æˆª " + action.name()); //5[m
[31m-              }[m
[31m-[m
[31m-            @Before("execution(* com.wisely.highlight_spring4.ch1.aop.DemoMe[m
[31m-(..))") //6[m
[31m-[m
[31m-              public void before(JoinPoint joinPoint){[m
[31m-                     MethodSignature signature = (MethodSignature) joinPoint.get[m
[31m-                     Method method = signature.getMethod();[m
[31m-                                                        System.out.println("æ–¹æ³•è§„åˆ™å¼æ‹¦[m
[31m-[m
[31m-æˆª,"+method.getName());[m
[31m-              }[m
[31m-[m
[31m-}[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é€šè¿‡@Aspectæ³¨è§£å£°æ˜ä¸€ä¸ªåˆ‡é¢ã€‚[m
[31m-[m
[31m-     â‘¡é€šè¿‡@Componentè®©æ­¤åˆ‡é¢æˆä¸ºSpringå®¹å™¨ç®¡ç†çš„Beanã€‚[m
[31m-[m
[31m-     â‘¢é€šè¿‡@PointCutæ³¨è§£å£°æ˜åˆ‡ç‚¹ã€‚[m
[31m-[m
[31m-     â‘£é€šè¿‡@Afteræ³¨è§£å£°æ˜ä¸€ä¸ªå»ºè¨€ï¼Œå¹¶ä½¿ç”¨@PointCutå®šä¹‰[m
[31m-çš„åˆ‡ç‚¹ã€‚[m
[31m-[m
[31m-     â‘¤é€šè¿‡åå°„å¯è·å¾—æ³¨è§£ä¸Šçš„å±æ€§ï¼Œç„¶ååšæ—¥å¿—è®°å½•ç›¸å…³çš„[m
[31m-æ“ä½œï¼Œä¸‹é¢çš„ç›¸åŒã€‚[m
[31m-[m
[31m-     â‘¥é€šè¿‡@Beforeæ³¨è§£å£°æ˜ä¸€ä¸ªå»ºè¨€ï¼Œæ­¤å»ºè¨€ç›´æ¥ä½¿ç”¨æ‹¦æˆª[m
[31m-è§„åˆ™ä½œä¸ºå‚æ•°ã€‚[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰é…ç½®ç±»ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch1.aop;[m
[31m-[m
[31m-       import org.springframework.context.annotation.ComponentScan;[m
[31m-       import org.springframework.context.annotation.Configuration;[m
[31m-       import org.springframework.context.annotation.EnableAspectJAutoProxy;[m
[31m-[m
[31m-       @Configuration[m
[31m-       @ComponentScan("com.wisely.highlight_spring4.ch1.aop")[m
[31m-       @EnableAspectJAutoProxy //1[m
[31m-       public class AopConfig {[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä½¿ç”¨@EnableAspectJAutoProxyæ³¨è§£å¼€å¯Springå¯¹AspectJ[m
[31m-ä»£ç†çš„æ”¯æŒã€‚[m
[31m-ï¼ˆ7ï¼‰è¿è¡Œã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch1.aop;[m
[31m-import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-public class Main {[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-                AnnotationConfigApplicationContext context =[m
[31m-                                    new AnnotationConfigApplicationContext(AopConfig.cl[m
[31m-                DemoAnnotationService demoAnnotationService = context.getBean([m
[31m-                DemoMethodService demoMethodService = context.getBean(DemoMeth[m
[31m-                demoAnnotationService.add();[m
[31m-                demoMethodService.add();[m
[31m-                context.close();[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ç»“æœå¦‚å›¾1-20æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾1-20ã€€è¿è¡Œç»“æœ[m
[31m-ç¬¬2ç« ã€€Springå¸¸ç”¨é…ç½®[m
[31m-[m
[31m-2.1ã€€Beançš„Scope[m
[31m-[m
[31m-2.1.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     Scopeæè¿°çš„æ˜¯Springå®¹å™¨å¦‚ä½•æ–°å»ºBeançš„å®ä¾‹çš„ã€‚Spring[m
[31m-çš„Scopeæœ‰ä»¥ä¸‹å‡ ç§ï¼Œé€šè¿‡@Scopeæ³¨è§£æ¥å®ç°ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰Singletonï¼šä¸€ä¸ªSpringå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªBeançš„å®ä¾‹ï¼Œ[m
[31m-æ­¤ä¸ºSpringçš„é»˜è®¤é…ç½®ï¼Œå…¨å®¹å™¨å…±äº«ä¸€ä¸ªå®ä¾‹ã€‚[m
[31m-[m
[31m-ï¼ˆ2ï¼‰Prototypeï¼šæ¯æ¬¡è°ƒç”¨æ–°å»ºä¸€ä¸ªBeançš„å®ä¾‹ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰Requestï¼šWebé¡¹ç›®ä¸­ï¼Œç»™æ¯ä¸€ä¸ªhttp requestæ–°å»ºä¸€ä¸ª[m
[31m-Beanå®ä¾‹ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰Sessionï¼šWebé¡¹ç›®ä¸­ï¼Œç»™æ¯ä¸€ä¸ªhttp sessionæ–°å»ºä¸€ä¸ª[m
[31m-Beanå®ä¾‹ã€‚[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰GlobalSessionï¼šè¿™ä¸ªåªåœ¨portalåº”ç”¨ä¸­æœ‰ç”¨ï¼Œç»™æ¯ä¸€[m
[31m-ä¸ªglobal http sessionæ–°å»ºä¸€ä¸ªBeanå®ä¾‹ã€‚[m
[31m-[m
[31m-å¦å¤–ï¼Œåœ¨Spring      Batchä¸­è¿˜æœ‰ä¸€ä¸ªScopeæ˜¯ä½¿ç”¨[m
[31m-[m
[31m-@StepScopeï¼Œæˆ‘ä»¬å°†åœ¨æ‰¹å¤„ç†ä¸€èŠ‚ä»‹ç»è¿™ä¸ªScopeã€‚[m
[31m-[m
[31m-     æœ¬ä¾‹ç®€å•æ¼”ç¤ºé»˜è®¤çš„singletonå’ŒPrototypeï¼Œåˆ†åˆ«ä»Springå®¹[m
[31m-å™¨ä¸­è·å¾—2æ¬¡Beanï¼Œåˆ¤æ–­Beançš„å®ä¾‹æ˜¯å¦ç›¸ç­‰ã€‚[m
[31m-2.1.2ã€€ç¤ºä¾‹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰ç¼–å†™Singletonçš„Beanã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch2.scope;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-       @Service //1[m
[31m-       public class DemoSingletonService {[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ é»˜è®¤ä¸ºSingletonï¼Œç›¸å½“äº@Scopeï¼ˆâ€œsingletonâ€ï¼‰ã€‚[m
[31m-     ï¼ˆ2ï¼‰ç¼–å†™Prototypeçš„Beanã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch2.scope;[m
[31m-       import org.springframework.context.annotation.Scope;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-       @Service[m
[31m-       @Scope("prototype")//1[m
[31m-       public class DemoPrototypeService {[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ å£°æ˜Scopeä¸ºPrototypeã€‚[m
[31m-ï¼ˆ3ï¼‰é…ç½®ç±»ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch2.scope;[m
[31m-import org.springframework.context.annotation.ComponentScan;[m
[31m-import org.springframework.context.annotation.Configuration;[m
[31m-@Configuration[m
[31m-@ComponentScan("com.wisely.highlight_spring4.ch2.scope")[m
[31m-public class ScopeConfig {[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ4ï¼‰è¿è¡Œã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch2.scope;[m
[31m-import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-public class Main {[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-              AnnotationConfigApplicationContext context =[m
[31m-                             new AnnotationConfigApplicationContext(ScopeConfig.clas[m
[31m-[m
[31m-DemoSingletonService s1 = context.getBean(DemoSingletonService.class);[m
[31m-              DemoSingletonService s2 = context.getBean(DemoSingletonService.[m
[31m-              DemoPrototypeService p1 = context.getBean(DemoPrototypeService.[m
[31m-              DemoPrototypeService p2 = context.getBean(DemoPrototypeService.[m
[31m-              System.out.println("s1ä¸s2æ˜¯å¦ç›¸ç­‰ï¼š"+s1.equals(s2));[m
[31m-              System.out.println("p1ä¸p2æ˜¯å¦ç›¸ç­‰ï¼š"+p1.equals(p2));[m
[31m-              context.close();[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ç»“æœå¦‚å›¾2-1æ‰€ç¤ºã€‚[m
[31m-å›¾2-1ã€€è¿è¡Œç»“æœ[m
[31m-2.2ã€€Spring ELå’Œèµ„æºè°ƒç”¨[m
[31m-[m
[31m-2.2.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     Spring EL-Springè¡¨è¾¾å¼è¯­è¨€ï¼Œæ”¯æŒåœ¨xmlå’Œæ³¨è§£ä¸­ä½¿ç”¨è¡¨[m
[31m-è¾¾å¼ï¼Œç±»ä¼¼äºJSPçš„ELè¡¨è¾¾å¼è¯­è¨€ã€‚[m
[31m-[m
[31m-     Springå¼€å‘ä¸­ç»å¸¸æ¶‰åŠè°ƒç”¨å„ç§èµ„æºçš„æƒ…å†µï¼ŒåŒ…å«æ™®é€šæ–‡[m
[31m-ä»¶ã€ç½‘å€ã€é…ç½®æ–‡ä»¶ã€ç³»ç»Ÿç¯å¢ƒå˜é‡ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Spring[m
[31m-çš„è¡¨è¾¾å¼è¯­è¨€å®ç°èµ„æºçš„æ³¨å…¥ã€‚[m
[31m-[m
[31m-     Springä¸»è¦åœ¨æ³¨è§£@Valueçš„å‚æ•°ä¸­ä½¿ç”¨è¡¨è¾¾å¼ã€‚[m
[31m-     æœ¬èŠ‚æ¼”ç¤ºå®ç°ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š[m
[31m-     ï¼ˆ1ï¼‰æ³¨å…¥æ™®é€šå­—ç¬¦ï¼›[m
[31m-     ï¼ˆ2ï¼‰æ³¨å…¥æ“ä½œç³»ç»Ÿå±æ€§ï¼›[m
[31m-     ï¼ˆ3ï¼‰æ³¨å…¥è¡¨è¾¾å¼è¿ç®—ç»“æœï¼›[m
[31m-     ï¼ˆ4ï¼‰æ³¨å…¥å…¶ä»–Beançš„å±æ€§ï¼›[m
[31m-     ï¼ˆ5ï¼‰æ³¨å…¥æ–‡ä»¶å†…å®¹ï¼›[m
[31m-     ï¼ˆ6ï¼‰æ³¨å…¥ç½‘å€å†…å®¹ï¼›[m
[31m-     ï¼ˆ7ï¼‰æ³¨å…¥å±æ€§æ–‡ä»¶ã€‚[m
[31m-[m
[31m-2.2.2ã€€ç¤ºä¾‹[m
[31m-     ï¼ˆ1ï¼‰å‡†å¤‡ï¼Œå¢åŠ commons-ioå¯ç®€åŒ–æ–‡ä»¶ç›¸å…³æ“ä½œï¼Œæœ¬ä¾‹[m
[31m-ä¸­ä½¿ç”¨commons-ioå°†fileè½¬æ¢æˆå­—ç¬¦ä¸²ï¼š[m
[31m-[m
[31m-       <dependency>[m
[31m-                             <groupId>commons-io</groupId>[m
[31m-                             <artifactId>commons-io</artifactId>[m
[31m-                             <version>2.3</version>[m
[31m-[m
[31m-                      </dependency>[m
[31m-[m
[31m-     åœ¨com.wisely.highlight_spring4.ch2.elåŒ…ä¸‹æ–°å»ºtest.txtï¼Œå†…å®¹[m
[31m-éšæ„ã€‚[m
[31m-[m
[31m-     åœ¨com.wisely.highlight_spring4.ch2.elåŒ…ä¸‹æ–°å»º[m
[31m-test.propertiesï¼Œå†…å®¹å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       book.author=wangyunfei[m
[31m-       book.name=spring boot[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰éœ€è¢«æ³¨å…¥çš„Beanã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch2.el;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Value;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-[m
[31m-       @Service[m
[31m-       public class DemoService {[m
[31m-[m
[31m-              @Value("å…¶ä»–ç±»çš„å±æ€§") //1[m
[31m-              private String another;[m
[31m-[m
[31m-              public String getAnother() {[m
[31m-                      return another;[m
[31m-[m
[31m-              }[m
[31m-              public void setAnother(String another) {[m
[31m-[m
[31m-                      this.another = another;[m
[31m-              }[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ æ­¤å¤„ä¸ºæ³¨å…¥æ™®é€šå­—ç¬¦ä¸²[m
[31m-[m
[31m-ï¼ˆ3ï¼‰æ¼”ç¤ºé…ç½®ç±»ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch2.el;[m
[31m-[m
[31m-import org.apache.commons.io.IOUtils;[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.beans.factory.annotation.Value;[m
[31m-import org.springframework.context.annotation.Bean;[m
[31m-import org.springframework.context.annotation.ComponentScan;[m
[31m-import org.springframework.context.annotation.Configuration;[m
[31m-import org.springframework.context.annotation.PropertySource;[m
[31m-import org.springframework.context.support.PropertySourcesPlaceholderCo[m
[31m-import org.springframework.core.env.Environment;[m
[31m-import org.springframework.core.io.Resource;[m
[31m-[m
[31m-@Configuration[m
[31m-@ComponentScan("com.wisely.highlight_spring4.ch2.el")[m
[31m-@PropertySource("classpath:com/wisely/highlight_spring4/ch2/el/test.pro[m
[31m-public class ElConfig {[m
[31m-[m
[31m-       @Value("I Love You!") //1[m
[31m-       private String normal;[m
[31m-[m
[31m-       @Value("#{systemProperties['os.name']}") //2[m
[31m-       private String osName;[m
[31m-[m
[31m-       @Value("#{ T(java.lang.Math).random() * 100.0 }") //3[m
[31m-       private double randomNumber;[m
[31m-[m
[31m-       @Value("#{demoService.another}") //4[m
[31m-       private String fromAnother;[m
[31m-[m
[31m-       @Value("classpath:com/wisely/highlight_spring4/ch2/el/test.txt") //[m
[31m-       private Resource testFile;[m
[31m-[m
[31m-       @Value("http://www.baidu.com") //6[m
[31m-       private Resource testUrl;[m
[31m-[m
[31m-       @Value("${book.name}") //7[m
[31m-       private String bookName;[m
[31m-[m
[31m-       @Autowired[m
[31m-       private Environment environment; //7[m
[31m-[m
[31m-       @Bean //7[m
[31m-       public static PropertySourcesPlaceholderConfigurer propertyConfigur[m
[31m-[m
[31m-              return new PropertySourcesPlaceholderConfigurer();[m
[31m-       }[m
[31m-[m
[31m-       public void outputResource() {[m
[31m-              try {[m
[31m-                     System.out.println(normal);[m
[31m-                     System.out.println(osName);[m
[31m-                     System.out.println(randomNumber);[m
[31m-                     System.out.println(fromAnother);[m
[31m-[m
[31m-                     System.out.println(IOUtils.toString(testFile.getInputStream[m
[31m-                     System.out.println(IOUtils.toString(testUrl.getInputStream([m
[31m-                     System.out.println(bookName);[m
[31m-                     System.out.println(environment.getProperty("book.author"));[m
[31m-              } catch (Exception e) {[m
[31m-                     e.printStackTrace();[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ æ³¨å…¥æ™®é€šå­—ç¬¦ä¸²ã€‚[m
[31m-[m
[31m-â‘¡æ³¨å…¥æ“ä½œç³»ç»Ÿå±æ€§ã€‚[m
[31m-[m
[31m-â‘¢æ³¨å…¥è¡¨è¾¾å¼ç»“æœã€‚[m
[31m-[m
[31m-â‘£æ³¨å…¥å…¶ä»–Beanå±æ€§ã€‚[m
[31m-     â‘¤æ³¨å…¥æ–‡ä»¶èµ„æºã€‚[m
[31m-[m
[31m-     â‘¥æ³¨å…¥ç½‘å€èµ„æºã€‚[m
[31m-[m
[31m-     â‘¦æ³¨å…¥é…ç½®æ–‡ä»¶ã€‚[m
[31m-[m
[31m-     æ³¨å…¥é…ç½®é…ä»¶éœ€ä½¿ç”¨@PropertySourceæŒ‡å®šæ–‡ä»¶åœ°å€ï¼Œè‹¥ä½¿[m
[31m-ç”¨@Valueæ³¨å…¥ï¼Œåˆ™è¦é…ç½®ä¸€ä¸ª[m
[31m-PropertySourcesPlaceholderConfigurerçš„Beanã€‚æ³¨æ„ï¼Œ[m
[31m-@Valueï¼ˆ"${book.name}"ï¼‰ä½¿ç”¨çš„æ˜¯â€œ$â€ï¼Œè€Œä¸æ˜¯â€œ#â€ã€‚[m
[31m-[m
[31m-     æ³¨å…¥Propertiesè¿˜å¯ä»Environmentä¸­è·å¾—ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰è¿è¡Œã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch2.el;[m
[31m-[m
[31m-import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-[m
[31m-public class Main {[m
[31m-[m
[31m-public static void main(String[] args) {[m
[31m-         AnnotationConfigApplicationContext context =[m
[31m-                             new AnnotationConfigApplicationContext(ResourceConf[m
[31m-[m
[31m-          ElConfig resourceService = context.getBean(ElConfig.class);[m
[31m-[m
[31m-          resourceService.outputResource();[m
[31m-[m
[31m-          context.close();[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ç»“æœå¦‚å›¾2-2æ‰€ç¤ºã€‚[m
[31m-å›¾2-2ã€€è¿è¡Œç»“æœ[m
[31m-2.3ã€€Beançš„åˆå§‹åŒ–å’Œé”€æ¯[m
[31m-[m
[31m-2.3.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     åœ¨æˆ‘ä»¬å®é™…å¼€å‘çš„æ—¶å€™ï¼Œç»å¸¸ä¼šé‡åˆ°åœ¨Beanåœ¨ä½¿ç”¨ä¹‹å‰æˆ–[m
[31m-è€…ä¹‹ååšäº›å¿…è¦çš„æ“ä½œï¼ŒSpringå¯¹Beançš„ç”Ÿå‘½å‘¨æœŸçš„æ“ä½œæä¾›[m
[31m-äº†æ”¯æŒã€‚åœ¨ä½¿ç”¨Javaé…ç½®å’Œæ³¨è§£é…ç½®ä¸‹æä¾›å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰Javaé…ç½®æ–¹å¼ï¼šä½¿ç”¨@Beançš„initMethodå’Œ[m
[31m-destroyMethodï¼ˆç›¸å½“äºxmlé…ç½®çš„init-methodå’Œdestory-[m
[31m-methodï¼‰ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰æ³¨è§£æ–¹å¼ï¼šåˆ©ç”¨JSR-250çš„@PostConstructå’Œ[m
[31m-@PreDestroyã€‚[m
[31m-[m
[31m-2.3.2ã€€æ¼”ç¤º[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰å¢åŠ JSR250æ”¯æŒã€‚[m
[31m-[m
[31m-       <dependency>[m
[31m-                             <groupId>javax.annotation</groupId>[m
[31m-                             <artifactId>jsr250-api[m
[31m-[m
[31m-       </artifactId>[m
[31m-                             <version>1.0</version>[m
[31m-[m
[31m-                      </dependency>[m
[31m-ï¼ˆ2ï¼‰ä½¿ç”¨@Beanå½¢å¼çš„Beanã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch2.prepost;[m
[31m-[m
[31m-public class BeanWayService {[m
[31m-[m
[31m-   public void init(){[m
[31m-[m
[31m-      System.out.println("@Bean-init-method");[m
[31m-[m
[31m-   }[m
[31m-[m
[31m-   public BeanWayService() {[m
[31m-[m
[31m-      super();[m
[31m-[m
[31m-                        System.out.println("åˆå§‹åŒ–æ„é€ å‡½æ•°-[m
[31m-[m
[31m-BeanWayService");[m
[31m-[m
[31m-   }[m
[31m-[m
[31m-   public void destroy(){[m
[31m-[m
[31m-      System.out.println("@Bean-destory-method");[m
[31m-[m
[31m-   }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ3ï¼‰ä½¿ç”¨JSR250å½¢å¼çš„Beanã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch2.prepost;[m
[31m-[m
[31m-import javax.annotation.PostConstruct;[m
[31m-import javax.annotation.PreDestroy;[m
[31m-[m
[31m-public class JSR250WayService {[m
[31m-       @PostConstruct //1[m
[31m-       public void init(){[m
[31m-              System.out.println("jsr250-init-method");[m
[31m-       }[m
[31m-       public JSR250WayService() {[m
[31m-              super();[m
[31m-              System.out.println("åˆå§‹åŒ–æ„é€ å‡½æ•°-JSR250WayService");[m
[31m-       }[m
[31m-       @PreDestroy //2[m
[31m-       public void destroy(){[m
[31m-              System.out.println("jsr250-destory-method");[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ @PostConstructï¼Œåœ¨æ„é€ å‡½æ•°æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œã€‚[m
[31m-[m
[31m-     â‘¡@PreDestroyï¼Œåœ¨Beané”€æ¯ä¹‹å‰æ‰§è¡Œã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰é…ç½®ç±»ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch2.prepost;[m
[31m-[m
[31m-       import org.springframework.context.annotation.Bean;[m
[31m-       import org.springframework.context.annotation.ComponentScan;[m
[31m-       import org.springframework.context.annotation.Configuration;[m
[31m-[m
[31m-       @Configuration[m
[31m-       @ComponentScan("com.wisely.highlight_spring4.ch2.prepost")[m
[31m-       public class PrePostConfig {[m
[31m-[m
[31m-              @Bean(initMethod="init",destroyMethod="destroy") //1[m
[31m-              BeanWayService beanWayService(){[m
[31m-[m
[31m-                      return new BeanWayService();[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              JSR250WayService jsr250WayService(){[m
[31m-[m
[31m-                      return new JSR250WayService();[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ initMethodå’ŒdestroyMethodæŒ‡å®šBeanWayServiceç±»çš„init[m
[31m-å’Œdestroyæ–¹æ³•åœ¨æ„é€ ä¹‹åã€Beané”€æ¯ä¹‹å‰æ‰§è¡Œã€‚[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰è¿è¡Œã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch2.prepost;[m
[31m-import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-public class Main {[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-              AnnotationConfigApplicationContext context =[m
[31m-                             new AnnotationConfigApplicationContext(PrePostConfig.cl[m
[31m-              BeanWayService beanWayService = context.getBean(BeanWayService.[m
[31m-              JSR250WayService jsr250WayService = context.getBean(JSR250WaySe[m
[31m-              context.close();[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ç»“æœå¦‚å›¾2-3æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾2-3ã€€è¿è¡Œç»“æœ[m
[31m-2.4ã€€Profile[m
[31m-[m
[31m-2.4.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     Profileä¸ºåœ¨ä¸åŒç¯å¢ƒä¸‹ä½¿ç”¨ä¸åŒçš„é…ç½®æä¾›äº†æ”¯æŒï¼ˆå¼€å‘[m
[31m-ç¯å¢ƒä¸‹çš„é…ç½®å’Œç”Ÿäº§ç¯å¢ƒä¸‹çš„é…ç½®è‚¯å®šæ˜¯ä¸åŒçš„ï¼Œä¾‹å¦‚ï¼Œæ•°æ®[m
[31m-åº“çš„é…ç½®ï¼‰ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰é€šè¿‡è®¾å®šEnvironmentçš„ActiveProfilesæ¥è®¾å®šå½“å‰[m
[31m-contextéœ€è¦ä½¿ç”¨çš„é…ç½®ç¯å¢ƒã€‚åœ¨å¼€å‘ä¸­ä½¿ç”¨@Profileæ³¨è§£ç±»æˆ–[m
[31m-è€…æ–¹æ³•ï¼Œè¾¾åˆ°åœ¨ä¸åŒæƒ…å†µä¸‹é€‰æ‹©å®ä¾‹åŒ–ä¸åŒçš„Beanã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰é€šè¿‡è®¾å®šjvmçš„spring.profiles.activeå‚æ•°æ¥è®¾ç½®é…ç½®[m
[31m-ç¯å¢ƒã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰Webé¡¹ç›®è®¾ç½®åœ¨Servletçš„context parameterä¸­ã€‚[m
[31m-[m
[31m-     Servlet 2.5åŠä»¥ä¸‹ï¼š[m
[31m-[m
[31m-       <servlet>[m
[31m-                       <servlet-name>dispatcher</servlet-name> <servlet-[m
[31m-[m
[31m-       class>org.springframework.web.servlet.DispatcherServlet</servlet-[m
[31m-       class>[m
[31m-[m
[31m-              <init-param>[m
[31m-                      <param-name>spring.profiles.active</param-name>[m
[31m-                      <param-value>production</param-value>[m
[31m-[m
[31m-              </init-param>[m
[31m-       </servlet>[m
[31m-[m
[31m-     Servlet 3.0åŠä»¥ä¸Šï¼š[m
[31m-       public class WebInit implements WebApplicationInitializer {[m
[31m-              @Override[m
[31m-              public void onStartup(ServletContext container) throws ServletExcep[m
[31m-                      container.setInitParameter("spring.profiles.default", "dev");[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-2.4.2ã€€æ¼”ç¤º[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰ç¤ºä¾‹Beanã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch2.profile;[m
[31m-[m
[31m-       public class DemoBean {[m
[31m-              private String content;[m
[31m-              public DemoBean(String content) {[m
[31m-                      super();[m
[31m-                      this.content = content;[m
[31m-              }[m
[31m-              public String getContent() {[m
[31m-                      return content;[m
[31m-              }[m
[31m-              public void setContent(String content) {[m
[31m-                      this.content = content;[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰Profileé…ç½®ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch2.profile;[m
[31m-import org.springframework.context.annotation.Bean;[m
[31m-import org.springframework.context.annotation.Configuration;[m
[31m-import org.springframework.context.annotation.Profile;[m
[31m-[m
[31m-@Configuration[m
[31m-public class ProfileConfig {[m
[31m-[m
[31m-       @Bean[m
[31m-       @Profile("dev") //1[m
[31m-       public DemoBean devDemoBean() {[m
[31m-[m
[31m-              return new DemoBean("from development profile");[m
[31m-       }[m
[31m-[m
[31m-       @Bean[m
[31m-       @Profile("prod") //2[m
[31m-       public DemoBean prodDemoBean() {[m
[31m-[m
[31m-              return new DemoBean("from production profile");[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ Profileä¸ºdevæ—¶å®ä¾‹åŒ–devDemoBeanã€‚[m
[31m-[m
[31m-â‘¡Profileä¸ºprodæ—¶å®ä¾‹åŒ–prodDemoBeanã€‚[m
[31m-[m
[31m-ï¼ˆ3ï¼‰è¿è¡Œã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch2.profile;[m
[31m-[m
[31m-import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-[m
[31m-public class Main {[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-                  AnnotationConfigApplicationContext context =[m
[31m-                                new AnnotationConfigApplicationContext();[m
[31m-[m
[31m-                  context.getEnvironment().setActiveProfiles("prod"); //1[m
[31m-                  context.register(ProfileConfig.class);//2[m
[31m-                  context.refresh(); //3[m
[31m-          DemoBean demoBean = context.getBean(DemoBean.class);[m
[31m-          System.out.println(demoBean.getContent());[m
[31m-          context.close();[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-â‘ å…ˆå°†æ´»åŠ¨çš„Profileè®¾ç½®ä¸ºprodã€‚[m
[31m-â‘¡åç½®æ³¨å†ŒBeané…ç½®ç±»ï¼Œä¸ç„¶ä¼šæŠ¥Beanæœªå®šä¹‰çš„é”™è¯¯ã€‚[m
[31m-â‘¢åˆ·æ–°å®¹å™¨ã€‚[m
[31m-ç»“æœå¦‚å›¾2-4æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                    å›¾2-4ã€€è¿è¡Œç»“æœ[m
[31m-[m
[31m-     å°†context.getEnvironmentï¼ˆï¼‰.setActiveProfilesï¼ˆâ€œprodâ€ï¼‰[m
[31m-ä¿®æ”¹ä¸ºcontext.getEnvironmentï¼ˆï¼‰.setActiveProfilesï¼ˆâ€devâ€ï¼‰ï¼Œ[m
[31m-æ•ˆæœå¦‚å›¾2-5æ‰€ç¤ºã€‚[m
[31m-å›¾2-5ã€€ä¿®æ”¹çš„æ•ˆæœ[m
[31m-2.5ã€€äº‹ä»¶ï¼ˆApplication Eventï¼‰[m
[31m-[m
[31m-2.5.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     Springçš„äº‹ä»¶ï¼ˆApplication Eventï¼‰ä¸ºBeanä¸Beanä¹‹é—´çš„æ¶ˆ[m
[31m-æ¯é€šä¿¡æä¾›äº†æ”¯æŒã€‚å½“ä¸€ä¸ªBeanå¤„ç†å®Œä¸€ä¸ªä»»åŠ¡ä¹‹åï¼Œå¸Œæœ›å¦[m
[31m-å¤–ä¸€ä¸ªBeançŸ¥é“å¹¶èƒ½åšç›¸åº”çš„å¤„ç†ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦è®©å¦å¤–ä¸€[m
[31m-ä¸ªBeanç›‘å¬å½“å‰Beanæ‰€å‘é€çš„äº‹ä»¶ã€‚[m
[31m-[m
[31m-     Springçš„äº‹ä»¶éœ€è¦éµå¾ªå¦‚ä¸‹æµç¨‹ï¼š[m
[31m-     ï¼ˆ1ï¼‰è‡ªå®šä¹‰äº‹ä»¶ï¼Œé›†æˆApplicationEventã€‚[m
[31m-     ï¼ˆ2ï¼‰å®šä¹‰äº‹ä»¶ç›‘å¬å™¨ï¼Œå®ç°ApplicationListenerã€‚[m
[31m-     ï¼ˆ3ï¼‰ä½¿ç”¨å®¹å™¨å‘å¸ƒäº‹ä»¶ã€‚[m
[31m-[m
[31m-2.5.2ã€€ç¤ºä¾‹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰è‡ªå®šä¹‰äº‹ä»¶ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch2.event;[m
[31m-       import org.springframework.context.ApplicationEvent;[m
[31m-       public class DemoEvent extends ApplicationEvent{[m
[31m-[m
[31m-              private static final long serialVersionUID = 1L;[m
[31m-              private String msg;[m
[31m-              public DemoEvent(Object source,String msg) {[m
[31m-              super(source);[m
[31m-              this.msg = msg;[m
[31m-       }[m
[31m-       public String getMsg() {[m
[31m-              return msg;[m
[31m-       }[m
[31m-       public void setMsg(String msg) {[m
[31m-              this.msg = msg;[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ2ï¼‰äº‹ä»¶ç›‘å¬å™¨ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch2.event;[m
[31m-import org.springframework.context.ApplicationListener;[m
[31m-import org.springframework.stereotype.Component;[m
[31m-@Component[m
[31m-public class DemoListener implements ApplicationListener<DemoEvent> {//[m
[31m-[m
[31m-       public void onApplicationEvent(DemoEvent event) {//2[m
[31m-              String msg = event.getMsg();[m
[31m-               System.out.println("æˆ‘(bean-demoListener)æ¥æ”¶åˆ°äº†bean-[m
[31m-[m
[31m-demoPublisherå‘å¸ƒçš„æ¶ˆæ¯:"+ msg);[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-â‘ å®ç°ApplicationListeneræ¥å£ï¼Œå¹¶æŒ‡å®šç›‘å¬çš„äº‹ä»¶ç±»å‹ã€‚[m
[31m-â‘¡ä½¿ç”¨onApplicationEventæ–¹æ³•å¯¹æ¶ˆæ¯è¿›è¡Œæ¥å—å¤„ç†ã€‚[m
[31m-ï¼ˆ3ï¼‰äº‹ä»¶å‘å¸ƒç±»ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch2.event;[m
[31m-[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.context.ApplicationContext;[m
[31m-import org.springframework.stereotype.Component;[m
[31m-[m
[31m-@Component[m
[31m-public class DemoPublisher {[m
[31m-[m
[31m-       @Autowired[m
[31m-       ApplicationContext applicationContext; //1[m
[31m-[m
[31m-       public void publish(String msg){[m
[31m-              applicationContext.publishEvent(new DemoEvent(this, msg)); //2[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ æ³¨å…¥ApplicationContextç”¨æ¥å‘å¸ƒäº‹ä»¶ã€‚[m
[31m-â‘¡ä½¿ç”¨ApplicationContextçš„publishEventæ–¹æ³•æ¥å‘å¸ƒã€‚[m
[31m-ï¼ˆ4ï¼‰é…ç½®ç±»ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch2.event;[m
[31m-[m
[31m-import org.springframework.context.annotation.ComponentScan;[m
[31m-import org.springframework.context.annotation.Configuration;[m
[31m-[m
[31m-@Configuration[m
[31m-@ComponentScan("com.wisely.highlight_spring4.ch2.event")[m
[31m-public class EventConfig {[m
[31m-[m
[31m-}[m
[31m-ï¼ˆ5ï¼‰è¿è¡Œã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch2.event;[m
[31m-[m
[31m-import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-[m
[31m-public class Main {[m
[31m-[m
[31m-public static void main(String[] args) {[m
[31m-         AnnotationConfigApplicationContext context =[m
[31m-                             new AnnotationConfigApplicationContext(EventConfig.[m
[31m-[m
[31m-          DemoPublisher demoPublisher = context.getBean(DemoPublisher.cl[m
[31m-[m
[31m-          demoPublisher.publish("hello application event");[m
[31m-[m
[31m-          context.close();[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ç»“æœå¦‚å›¾2-6æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                     å›¾2-6ã€€è¿è¡Œç»“æœ[m
[31m-ç¬¬3ç« ã€€Springé«˜çº§è¯é¢˜[m
[31m-[m
[31m-3.1ã€€Spring Aware[m
[31m-[m
[31m-3.1.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     Springçš„ä¾èµ–æ³¨å…¥çš„æœ€å¤§äº®ç‚¹å°±æ˜¯ä½ æ‰€æœ‰çš„Beanå¯¹Springå®¹[m
[31m-å™¨çš„å­˜åœ¨æ˜¯æ²¡æœ‰æ„è¯†çš„ã€‚å³ä½ å¯ä»¥å°†ä½ çš„å®¹å™¨æ›¿æ¢æˆåˆ«çš„å®¹[m
[31m-å™¨ï¼Œå¦‚Google Guiceï¼Œè¿™æ—¶Beanä¹‹é—´çš„è€¦åˆåº¦å¾ˆä½ã€‚[m
[31m-[m
[31m-     ä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ ä¸å¯é¿å…çš„è¦ç”¨åˆ°Springå®¹å™¨æœ¬èº«[m
[31m-çš„åŠŸèƒ½èµ„æºï¼Œè¿™æ—¶ä½ çš„Beanå¿…é¡»è¦æ„è¯†åˆ°Springå®¹å™¨çš„å­˜åœ¨ï¼Œ[m
[31m-æ‰èƒ½è°ƒç”¨Springæ‰€æä¾›çš„èµ„æºï¼Œè¿™å°±æ˜¯æ‰€è°“çš„Spring Awareã€‚[m
[31m-å…¶å®Spring Awareæœ¬æ¥å°±æ˜¯Springè®¾è®¡ç”¨æ¥æ¡†æ¶å†…éƒ¨ä½¿ç”¨çš„ï¼Œ[m
[31m-è‹¥ä½¿ç”¨äº†Spring Awareï¼Œä½ çš„Beanå°†ä¼šå’ŒSpringæ¡†æ¶è€¦åˆã€‚[m
[31m-[m
[31m-     Springæä¾›çš„Awareæ¥å£å¦‚è¡¨3-1æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                          è¡¨3-1ã€€Springæä¾›çš„Awareæ¥å£[m
[31m-[m
[31m-     Spring Awareçš„ç›®çš„æ˜¯ä¸ºäº†è®©Beanè·å¾—Springå®¹å™¨çš„æœåŠ¡ã€‚[m
[31m-å› ä¸ºApplicationContextæ¥å£é›†æˆäº†MessageSourceæ¥å£ã€[m
[31m-ApplicationEventPublisheræ¥å£å’ŒResourceLoaderæ¥å£ï¼Œæ‰€ä»¥[m
[31m-Beanç»§æ‰¿ApplicationContextAwareå¯ä»¥è·å¾—Springå®¹å™¨çš„æ‰€æœ‰[m
[31m-æœåŠ¡ï¼Œä½†åŸåˆ™ä¸Šæˆ‘ä»¬è¿˜æ˜¯ç”¨åˆ°ä»€ä¹ˆæ¥å£ï¼Œå°±å®ç°ä»€ä¹ˆæ¥å£ã€‚[m
[31m-[m
[31m-3.1.2ã€€ç¤ºä¾‹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰å‡†å¤‡ã€‚åœ¨com.wisely.highlight_spring4.ch3.awareåŒ…ä¸‹[m
[31m-æ–°å»ºä¸€ä¸ªtest.txtï¼Œå†…å®¹éšæ„ï¼Œç»™ä¸‹é¢çš„å¤–éƒ¨èµ„æºåŠ è½½ä½¿ç”¨ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰Spring Awareæ¼”ç¤ºBeanã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch3.aware;[m
[31m-[m
[31m-       import java.io.IOException;[m
[31m-[m
[31m-       import org.apache.commons.io.IOUtils;[m
[31m-       import org.springframework.beans.factory.BeanNameAware;[m
[31m-       import org.springframework.context.ResourceLoaderAware;[m
[31m-       import org.springframework.core.io.Resource;[m
[31m-       import org.springframework.core.io.ResourceLoader;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-[m
[31m-       @Service[m
[31m-       public class AwareService implements BeanNameAware,ResourceLoaderAware{[m
[31m-[m
[31m-              private String beanName;[m
[31m-              private ResourceLoader loader;[m
[31m-[m
[31m-              @Override[m
[31m-              public void setResourceLoader(ResourceLoader resourceLoader) {//2[m
[31m-[m
[31m-                      this.loader = resourceLoader;[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public void setBeanName(String name) {//3[m
[31m-[m
[31m-                      this.beanName = name;[m
[31m-              }[m
[31m-[m
[31m-              public void outputResult(){[m
[31m-                      System.out.println("Beançš„åç§°ä¸ºï¼š" + beanName);[m
[31m-                      Resource resource =[m
[31m-                                    loader.getResource("classpath:com/wisely/highlight_spri[m
[31m-[m
[31m-                      try{[m
[31m-                                   System.out.println("ResourceLoaderåŠ è½½çš„æ–‡ä»¶å†…å®¹[m
[31m-[m
[31m-       ä¸º: " + IOUtils.toString(resource.getInputStream()));[m
[31m-[m
[31m-                           }catch(IOException e){[m
[31m-                             e.printStackTrace();[m
[31m-[m
[31m-                           }[m
[31m-                      }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ å®ç°BeanNameAwareã€ResourceLoaderAwareæ¥å£ï¼Œè·å¾—[m
[31m-Beanåç§°å’Œèµ„æºåŠ è½½çš„æœåŠ¡ã€‚[m
[31m-[m
[31m-     â‘¡å®ç°ResourceLoaderAwareéœ€é‡å†™setResourceLoaderã€‚[m
[31m-[m
[31m-     â‘¢å®ç°BeanNameAwareéœ€é‡å†™setBeanNameæ–¹æ³•ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰é…ç½®ç±»ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch3.aware;[m
[31m-[m
[31m-       import org.springframework.context.annotation.ComponentScan;[m
[31m-       import org.springframework.context.annotation.Configuration;[m
[31m-       @Configuration[m
[31m-       @ComponentScan("com.wisely.highlight_spring4.ch3.aware")[m
[31m-       public class AwareConfig {[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰è¿è¡Œã€‚[m
[31m-package com.wisely.highlight_spring4.ch3.aware;[m
[31m-import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-public class Main {[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-              AnnotationConfigApplicationContext context =[m
[31m-                             new AnnotationConfigApplicationContext(AwareConfig.clas[m
[31m-              AwareService awareService = context.getBean(AwareService.class)[m
[31m-              awareService.outputResult();[m
[31m-              context.close();[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ç»“æœå¦‚å›¾3-1æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾3-1ã€€è¿è¡Œç»“æœ[m
[31m-3.2ã€€å¤šçº¿ç¨‹[m
[31m-[m
[31m-3.2.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     Springé€šè¿‡ä»»åŠ¡æ‰§è¡Œå™¨ï¼ˆTaskExecutorï¼‰æ¥å®ç°å¤šçº¿ç¨‹å’Œå¹¶[m
[31m-å‘ç¼–ç¨‹ã€‚ä½¿ç”¨ThreadPoolTaskExecutorå¯å®ç°ä¸€ä¸ªåŸºäºçº¿ç¨‹æ± [m
[31m-çš„TaskExecutorã€‚è€Œå®é™…å¼€å‘ä¸­ä»»åŠ¡ä¸€èˆ¬æ˜¯éé˜»ç¢çš„ï¼Œå³å¼‚æ­¥[m
[31m-çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨é…ç½®ç±»ä¸­é€šè¿‡@EnableAsyncå¼€å¯å¯¹å¼‚æ­¥ä»»[m
[31m-åŠ¡çš„æ”¯æŒï¼Œå¹¶é€šè¿‡åœ¨å®é™…æ‰§è¡Œçš„Beançš„æ–¹æ³•ä¸­ä½¿ç”¨@Asyncæ³¨[m
[31m-è§£æ¥å£°æ˜å…¶æ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ã€‚[m
[31m-[m
[31m-3.2.2ã€€ç¤ºä¾‹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰é…ç½®ç±»ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch3.taskexecutor;[m
[31m-[m
[31m-       import java.util.concurrent.Executor;[m
[31m-[m
[31m-       import org.springframework.aop.interceptor.AsyncUncaughtExceptionHandle[m
[31m-       import org.springframework.context.annotation.ComponentScan;[m
[31m-       import org.springframework.context.annotation.Configuration;[m
[31m-       import org.springframework.scheduling.annotation.AsyncConfigurer;[m
[31m-       import org.springframework.scheduling.annotation.EnableAsync;[m
[31m-       import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor[m
[31m-       @Configuration[m
[31m-       @ComponentScan("com.wisely.highlight_spring4.ch3.taskexecutor")[m
[31m-       @EnableAsync //1[m
[31m-       public class TaskExecutorConfig implements AsyncConfigurer{//2[m
[31m-[m
[31m-              @Override[m
[31m-              public Executor getAsyncExecutor() {//2[m
[31m-                       ThreadPoolTaskExecutor taskExecutor = new ThreadPoolTaskExecut[m
[31m-                             taskExecutor.setCorePoolSize(5);[m
[31m-                             taskExecutor.setMaxPoolSize(10);[m
[31m-                             taskExecutor.setQueueCapacity(25);[m
[31m-                             taskExecutor.initialize();[m
[31m-                             return taskExecutor;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandl[m
[31m-[m
[31m-                      return null;[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ åˆ©ç”¨@EnableAsyncæ³¨è§£å¼€å¯å¼‚æ­¥ä»»åŠ¡æ”¯æŒã€‚[m
[31m-[m
[31m-     â‘¡é…ç½®ç±»å®ç°AsyncConfigureræ¥å£å¹¶é‡å†™getAsyncExecutor[m
[31m-æ–¹æ³•ï¼Œå¹¶è¿”å›ä¸€ä¸ªThreadPoolTaskExecutorï¼Œè¿™æ ·æˆ‘ä»¬å°±è·å¾—[m
[31m-äº†ä¸€ä¸ªåŸºäºçº¿ç¨‹æ± TaskExecutorã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰ä»»åŠ¡æ‰§è¡Œç±»ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch3.taskexecutor;[m
[31m-[m
[31m-       import org.springframework.scheduling.annotation.Async;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-       @Service[m
[31m-       public class AsyncTaskService {[m
[31m-[m
[31m-              @Async //1[m
[31m-              public void executeAsyncTask(Integer i){[m
[31m-[m
[31m-                      System.out.println("æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡: "+i);[m
[31m-              }[m
[31m-[m
[31m-              @Async[m
[31m-              public void executeAsyncTaskPlus(Integer i){[m
[31m-[m
[31m-                      System.out.println("æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡+1: "+(i+1));[m
[31m-              }[m
[31m-}[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é€šè¿‡@Asyncæ³¨è§£è¡¨æ˜è¯¥æ–¹æ³•æ˜¯ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå¦‚æœæ³¨è§£[m
[31m-åœ¨ç±»çº§åˆ«ï¼Œåˆ™è¡¨æ˜è¯¥ç±»æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œè€Œè¿™é‡Œçš„æ–¹[m
[31m-æ³•è‡ªåŠ¨è¢«æ³¨å…¥ä½¿ç”¨ThreadPoolTaskExecutorä½œä¸ºTaskExecutorã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰è¿è¡Œã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch3.taskexecutor;[m
[31m-[m
[31m-import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-[m
[31m-public class Main {[m
[31m-[m
[31m-   public static void main(String[] args) {[m
[31m-            AnnotationConfigApplicationContext context =[m
[31m-                                new AnnotationConfigApplicationContext(TaskExecutor[m
[31m-[m
[31m-          AsyncTaskService asyncTaskService = context.getBean(AsyncTaskS[m
[31m-[m
[31m-          for(int i =0 ;i<10;i++){[m
[31m-                 asyncTaskService.executeAsyncTask(i);[m
[31m-                 asyncTaskService.executeAsyncTaskPlus(i);[m
[31m-[m
[31m-               }[m
[31m-               context.close();[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ç»“æœæ˜¯å¹¶å‘æ‰§è¡Œè€Œä¸æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œå¦‚å›¾3-2æ‰€ç¤ºã€‚[m
[31m-å›¾3-2ã€€è¿è¡Œç»“æœ[m
[31m-3.3ã€€è®¡åˆ’ä»»åŠ¡[m
[31m-[m
[31m-3.3.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     ä»Spring 3.1å¼€å§‹ï¼Œè®¡åˆ’ä»»åŠ¡åœ¨Springä¸­çš„å®ç°å˜å¾—å¼‚å¸¸çš„[m
[31m-ç®€å•ã€‚é¦–å…ˆé€šè¿‡åœ¨é…ç½®ç±»æ³¨è§£@EnableSchedulingæ¥å¼€å¯å¯¹è®¡[m
[31m-åˆ’ä»»åŠ¡çš„æ”¯æŒï¼Œç„¶ååœ¨è¦æ‰§è¡Œè®¡åˆ’ä»»åŠ¡çš„æ–¹æ³•ä¸Šæ³¨è§£[m
[31m-@Scheduledï¼Œå£°æ˜è¿™æ˜¯ä¸€ä¸ªè®¡åˆ’ä»»åŠ¡ã€‚[m
[31m-[m
[31m-     Springé€šè¿‡@Scheduledæ”¯æŒå¤šç§ç±»å‹çš„è®¡åˆ’ä»»åŠ¡ï¼ŒåŒ…å«[m
[31m-cronã€fixDelayã€fixRateç­‰ã€‚[m
[31m-[m
[31m-3.3.2ã€€ç¤ºä¾‹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰è®¡åˆ’ä»»åŠ¡æ‰§è¡Œç±»ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch3.taskscheduler;[m
[31m-       import java.text.SimpleDateFormat;[m
[31m-       import java.util.Date;[m
[31m-       import org.springframework.scheduling.annotation.Scheduled;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-       @Service[m
[31m-       public class ScheduledTaskService {[m
[31m-[m
[31m-                  private static final SimpleDateFormat dateFormat = new SimpleDate[m
[31m-                  @Scheduled(fixedRate = 5000) //1[m
[31m-                  public void reportCurrentTime() {[m
[31m-[m
[31m-                                                            System.out.println("æ¯éš”äº”ç§’æ‰§è¡Œä¸€[m
[31m-       æ¬¡ " + dateFormat.format(new Date()));[m
[31m-                    }[m
[31m-[m
[31m-                  @Scheduled(cron = "0 28 11 ? * *" ) //2[m
[31m-                  public void fixTimeExecution(){[m
[31m-[m
[31m-                                                                     System.out.println("åœ¨æŒ‡å®šæ—¶[m
[31m-       é—´ " + dateFormat.format(new Date())+"æ‰§è¡Œ");[m
[31m-[m
[31m-                  }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é€šè¿‡@Scheduledå£°æ˜è¯¥æ–¹æ³•æ˜¯è®¡åˆ’ä»»åŠ¡ï¼Œä½¿ç”¨fixedRate[m
[31m-å±æ€§æ¯éš”å›ºå®šæ—¶é—´æ‰§è¡Œã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨cronå±æ€§å¯æŒ‰ç…§æŒ‡å®šæ—¶é—´æ‰§è¡Œï¼Œæœ¬ä¾‹æŒ‡çš„æ˜¯æ¯å¤©11[m
[31m-ç‚¹28åˆ†æ‰§è¡Œï¼›cronæ˜¯UNIXå’Œç±»UNIXï¼ˆLinuxï¼‰ç³»ç»Ÿä¸‹çš„å®šæ—¶[m
[31m-ä»»åŠ¡ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰é…ç½®ç±»ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch3.taskscheduler;[m
[31m-[m
[31m-       import org.springframework.context.annotation.ComponentScan;[m
[31m-       import org.springframework.context.annotation.Configuration;[m
[31m-       import org.springframework.scheduling.annotation.EnableScheduling;[m
[31m-[m
[31m-       @Configuration[m
[31m-       @ComponentScan("com.wisely.highlight_spring4.ch3.taskscheduler")[m
[31m-       @EnableScheduling //1[m
[31m-       public class TaskSchedulerConfig {[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-â‘ é€šè¿‡@EnableSchedulingæ³¨è§£å¼€å¯å¯¹è®¡åˆ’ä»»åŠ¡çš„æ”¯æŒã€‚[m
[31m-ï¼ˆ3ï¼‰è¿è¡Œã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch3.taskscheduler;[m
[31m-import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-public class Main {[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-                AnnotationConfigApplicationContext context =[m
[31m-                                    new AnnotationConfigApplicationContext(TaskSchedule[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ç»“æœå¦‚å›¾3-3æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾3-3ã€€è¿è¡Œç»“æœ[m
[31m-3.4ã€€æ¡ä»¶æ³¨è§£@Conditional[m
[31m-[m
[31m-3.4.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     åœ¨2.4èŠ‚å­¦åˆ°ï¼Œé€šè¿‡æ´»åŠ¨çš„profileï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä¸åŒçš„[m
[31m-Beanã€‚Spring 4æä¾›äº†ä¸€ä¸ªæ›´é€šç”¨çš„åŸºäºæ¡ä»¶çš„Beançš„åˆ›å»ºï¼Œ[m
[31m-å³ä½¿ç”¨@Conditionalæ³¨è§£ã€‚[m
[31m-[m
[31m-     @Conditionalæ ¹æ®æ»¡è¶³æŸä¸€ä¸ªç‰¹å®šæ¡ä»¶åˆ›å»ºä¸€ä¸ªç‰¹å®šçš„[m
[31m-Beanã€‚æ¯”æ–¹è¯´ï¼Œå½“æŸä¸€ä¸ªjaråŒ…åœ¨ä¸€ä¸ªç±»è·¯å¾„ä¸‹çš„æ—¶å€™ï¼Œè‡ªåŠ¨é…[m
[31m-ç½®ä¸€ä¸ªæˆ–å¤šä¸ªBeanï¼›æˆ–è€…åªæœ‰æŸä¸ªBeanè¢«åˆ›å»ºæ‰ä¼šåˆ›å»ºå¦å¤–ä¸€[m
[31m-ä¸ªBeanã€‚æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯æ ¹æ®ç‰¹å®šæ¡ä»¶æ¥æ§åˆ¶Beançš„åˆ›å»ºè¡Œ[m
[31m-ä¸ºï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§è¿›è¡Œä¸€äº›è‡ªåŠ¨çš„é…ç½®ã€‚[m
[31m-[m
[31m-     åœ¨Spring Bootä¸­å°†ä¼šå¤§é‡åº”ç”¨åˆ°æ¡ä»¶æ³¨è§£ï¼Œæ›´å¤šå†…å®¹è§æœ¬[m
[31m-ä¹¦6.1èŠ‚ã€‚[m
[31m-[m
[31m-     ä¸‹é¢çš„ç¤ºä¾‹å°†ä»¥ä¸åŒçš„æ“ä½œç³»ç»Ÿä½œä¸ºæ¡ä»¶ï¼Œæˆ‘ä»¬å°†é€šè¿‡å®[m
[31m-ç°Conditionæ¥å£ï¼Œå¹¶é‡å†™å…¶matchesæ–¹æ³•æ¥æ„é€ åˆ¤æ–­æ¡ä»¶ã€‚è‹¥[m
[31m-åœ¨Windowsç³»ç»Ÿä¸‹è¿è¡Œç¨‹åºï¼Œåˆ™è¾“å‡ºåˆ—è¡¨å‘½ä»¤ä¸ºdirï¼›è‹¥åœ¨[m
[31m-Linuxæ“ä½œç³»ç»Ÿä¸‹è¿è¡Œç¨‹åºï¼Œåˆ™è¾“å‡ºåˆ—è¡¨å‘½ä»¤ä¸ºlsã€‚[m
[31m-[m
[31m-3.4.2ã€€ç¤ºä¾‹[m
[31m-[m
[31m-     1.åˆ¤æ–­æ¡ä»¶å®šä¹‰[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰åˆ¤å®šWindowsçš„æ¡ä»¶ã€‚[m
[31m-package com.wisely.highlight_spring4.ch3.conditional;[m
[31m-[m
[31m-import org.springframework.context.annotation.Condition;[m
[31m-import org.springframework.context.annotation.ConditionContext;[m
[31m-import org.springframework.core.type.AnnotatedTypeMetadata;[m
[31m-[m
[31m-public class WindowsCondition implements Condition {[m
[31m-[m
[31m-       public boolean matches(ConditionContext context,[m
[31m-                     AnnotatedTypeMetadata metadata) {[m
[31m-[m
[31m-              return context.getEnvironment().getProperty("os.name").contains[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ2ï¼‰åˆ¤å®šLinuxçš„æ¡ä»¶ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch3.conditional;[m
[31m-[m
[31m-import org.springframework.context.annotation.Condition;[m
[31m-import org.springframework.context.annotation.ConditionContext;[m
[31m-import org.springframework.core.type.AnnotatedTypeMetadata;[m
[31m-[m
[31m-public class LinuxCondition implements Condition {[m
[31m-[m
[31m-       public boolean matches(ConditionContext context,[m
[31m-                     AnnotatedTypeMetadata metadata) {[m
[31m-[m
[31m-              return context.getEnvironment().getProperty("os.name").contains[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-2.ä¸åŒç³»ç»Ÿä¸‹Beançš„ç±»[m
[31m-[m
[31m-ï¼ˆ1ï¼‰æ¥å£ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch3.conditional;[m
[31m-[m
[31m-public interface ListService {[m
[31m-       public String showListCmd();[m
[31m-[m
[31m-}[m
[31m-ï¼ˆ2ï¼‰Windowsä¸‹æ‰€è¦åˆ›å»ºçš„Beançš„ç±»ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch3.conditional;[m
[31m-[m
[31m-public class WindowsListService implements ListService {[m
[31m-[m
[31m-       @Override[m
[31m-       public String showListCmd() {[m
[31m-[m
[31m-              return "dir";[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ3ï¼‰Linuxä¸‹æ‰€è¦åˆ›å»ºçš„Beançš„ç±»ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch3.conditional;[m
[31m-[m
[31m-public class LinuxListService implements ListService{[m
[31m-[m
[31m-       @Override[m
[31m-       public String showListCmd() {[m
[31m-[m
[31m-              return "ls";[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-3.é…ç½®ç±»[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch3.conditional;[m
[31m-[m
[31m-import org.springframework.context.annotation.Bean;[m
[31m-import org.springframework.context.annotation.Conditional;[m
[31m-import org.springframework.context.annotation.Configuration;[m
[31m-[m
[31m-@Configuration[m
[31m-public class ConditionConifg {[m
[31m-[m
[31m-       @Bean[m
[31m-       @Conditional(WindowsCondition.class) //1[m
[31m-       public ListService windowsListService() {[m
[31m-[m
[31m-              return new WindowsListService();[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              @Conditional(LinuxCondition.class) //2[m
[31m-              public ListService linuxListService() {[m
[31m-[m
[31m-                      return new LinuxListService();[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é€šè¿‡@Conditionalæ³¨è§£ï¼Œç¬¦åˆWindowsæ¡ä»¶åˆ™å®ä¾‹åŒ–[m
[31m-windowsListServiceã€‚[m
[31m-[m
[31m-     â‘¡é€šè¿‡@Conditionalæ³¨è§£ï¼Œç¬¦åˆLinuxæ¡ä»¶åˆ™å®ä¾‹åŒ–[m
[31m-linuxListServiceã€‚[m
[31m-[m
[31m-     4.è¿è¡Œ[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch3.conditional;[m
[31m-[m
[31m-       import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-[m
[31m-       public class Main {[m
[31m-[m
[31m-              public static void main(String[] args) {[m
[31m-                      AnnotationConfigApplicationContext context =[m
[31m-                                    new AnnotationConfigApplicationContext(ConditionConifg.[m
[31m-[m
[31m-                      ListService listService = context.getBean(ListService.class);[m
[31m-[m
[31m-                      System.out.println(context.getEnvironment().getProperty("os.nam[m
[31m-                                    + "ç³»ç»Ÿä¸‹çš„åˆ—è¡¨å‘½ä»¤ä¸º: "[m
[31m-                                    + listService.showListCmd());[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ç»“æœå¦‚å›¾3-4å’Œå›¾3-5æ‰€ç¤ºã€‚[m
[31m-å›¾3-4ã€€Windowsä¸‹åˆ—è¡¨å‘½ä»¤[m
[31m-  å›¾3-5ã€€Linuxä¸‹åˆ—è¡¨å‘½ä»¤[m
[31m-3.5ã€€ç»„åˆæ³¨è§£ä¸å…ƒæ³¨è§£[m
[31m-[m
[31m-3.5.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     ä»Spring 2å¼€å§‹ï¼Œä¸ºäº†å“åº”JDK 1.5æ¨å‡ºçš„æ³¨è§£åŠŸèƒ½ï¼Œ[m
[31m-Springå¼€å§‹å¤§é‡åŠ å…¥æ³¨è§£æ¥æ›¿ä»£xmlé…ç½®ã€‚Springçš„æ³¨è§£ä¸»è¦ç”¨[m
[31m-æ¥é…ç½®æ³¨å…¥Beanï¼Œåˆ‡é¢ç›¸å…³é…ç½®ï¼ˆ@Transactionalï¼‰ã€‚éšç€æ³¨[m
[31m-è§£çš„å¤§é‡ä½¿ç”¨ï¼Œå°¤å…¶ç›¸åŒçš„å¤šä¸ªæ³¨è§£ç”¨åˆ°å„ä¸ªç±»ä¸­ï¼Œä¼šç›¸å½“å•°[m
[31m-å—¦ã€‚è¿™å°±æ˜¯æ‰€è°“çš„æ¨¡æ¿ä»£ç ï¼Œæ˜¯Springè®¾è®¡åŸåˆ™ä¸­è¦æ¶ˆé™¤çš„ä»£[m
[31m-ç ã€‚[m
[31m-[m
[31m-     æ‰€è°“å…ƒæ³¨è§£å…¶å®å°±æ˜¯å¯ä»¥æ³¨è§£åˆ°åˆ«çš„æ³¨è§£ä¸Šçš„æ³¨è§£ï¼Œè¢«æ³¨[m
[31m-è§£çš„æ³¨è§£ç§°ä¹‹ä¸ºç»„åˆæ³¨è§£ã€æ˜¯å¯èƒ½æœ‰ç‚¹æ‹—å£ï¼Œä½“ä¼šå«ä¹‰æœ€é‡[m
[31m-è¦ï¼‰ï¼Œç»„åˆæ³¨è§£å…·å¤‡å…ƒæ³¨è§£çš„åŠŸèƒ½ã€‚Springçš„å¾ˆå¤šæ³¨è§£éƒ½å¯ä»¥[m
[31m-ä½œä¸ºå…ƒæ³¨è§£ï¼Œè€Œä¸”Springæœ¬èº«å·²ç»æœ‰å¾ˆå¤šç»„åˆæ³¨è§£ï¼Œå¦‚[m
[31m-@Configurationå°±æ˜¯ä¸€ä¸ªç»„åˆ@Componentæ³¨è§£ï¼Œè¡¨æ˜è¿™ä¸ªç±»å…¶[m
[31m-å®ä¹Ÿæ˜¯ä¸€ä¸ªBeanã€‚[m
[31m-[m
[31m-     æˆ‘ä»¬å‰é¢çš„ç« èŠ‚é‡Œå¤§é‡ä½¿ç”¨@Configurationå’Œ[m
[31m-@ComponentScanæ³¨è§£åˆ°é…ç½®ç±»ä¸Šï¼Œå¦‚æœä½ è·Ÿç€æœ¬ä¹¦ä¸€ç›´åœ¨æ•²[m
[31m-ä»£ç çš„è¯æ˜¯ä¸æ˜¯è§‰å¾—å·²ç»æœ‰ç‚¹éº»çƒ¦äº†å‘¢ï¼Ÿä¸‹é¢æˆ‘å°†è¿™ä¸¤ä¸ªå…ƒæ³¨[m
[31m-è§£ç»„æˆä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€å†™ä¸€ä¸ªæ³¨è§£å°±å¯ä»¥è¡¨ç¤ºä¸¤[m
[31m-ä¸ªæ³¨è§£ã€‚[m
[31m-[m
[31m-3.5.2ã€€ç¤ºä¾‹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰ç¤ºä¾‹ç»„åˆæ³¨è§£ã€‚[m
[31m-package com.wisely.highlight_spring4.ch3.annotation;[m
[31m-[m
[31m-import java.lang.annotation.Documented;[m
[31m-import java.lang.annotation.ElementType;[m
[31m-import java.lang.annotation.Retention;[m
[31m-import java.lang.annotation.RetentionPolicy;[m
[31m-import java.lang.annotation.Target;[m
[31m-[m
[31m-import org.springframework.context.annotation.ComponentScan;[m
[31m-import org.springframework.context.annotation.Configuration;[m
[31m-[m
[31m-@Target(ElementType.TYPE)[m
[31m-@Retention(RetentionPolicy.RUNTIME)[m
[31m-@Documented[m
[31m-@Configuration //1[m
[31m-@ComponentScan //2[m
[31m-public @interface WiselyConfiguration {[m
[31m-[m
[31m-       String[] value() default {}; //3[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ ç»„åˆ@Configurationå…ƒæ³¨è§£ã€‚[m
[31m-[m
[31m-â‘¡ç»„åˆ@ComponentScanå…ƒæ³¨è§£ã€‚[m
[31m-[m
[31m-â‘¢è¦†ç›–valueå‚æ•°ã€‚[m
[31m-[m
[31m-ï¼ˆ2ï¼‰æ¼”ç¤ºæœåŠ¡Beanã€‚[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch3.annotation;[m
[31m-[m
[31m-import org.springframework.stereotype.Service;[m
[31m-[m
[31m-@Service[m
[31m-public class DemoService {[m
[31m-[m
[31m-       public void outputResult(){[m
[31m-              System.out.println("ä»ç»„åˆæ³¨è§£é…ç½®ç…§æ ·è·å¾—çš„bean");[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰æ–°çš„é…ç½®ç±»ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch3.annotation;[m
[31m-       @WiselyConfiguration("com.wisely.highlight_spring4.ch3.annotation")//1[m
[31m-       public class DemoConfig {[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ ä½¿ç”¨@WiselyConfigurationç»„åˆæ³¨è§£æ›¿ä»£@Configuration[m
[31m-å’Œ@ComponentScanã€‚[m
[31m-     ï¼ˆ4ï¼‰è¿è¡Œã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch3.annotation;[m
[31m-       import org.springframework.context.annotation.AnnotationConfigApplicati[m
[31m-       public class Main {[m
[31m-[m
[31m-              public static void main(String[] args) {[m
[31m-                      AnnotationConfigApplicationContext context =[m
[31m-                                    new AnnotationConfigApplicationContext(DemoConfig.class[m
[31m-                      DemoService demoService = context.getBean(DemoService.class);[m
[31m-                      demoService.outputResult();[m
[31m-                      context.close();[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-ç»“æœå¦‚å›¾3-6æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾3-6ã€€è¿è¡Œç»“æœ[m
[31m-3.6ã€€@Enable*æ³¨è§£çš„å·¥ä½œåŸç†[m
[31m-[m
[31m-     åœ¨æœ¬ç« çš„ç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬é€šè¿‡ï¼š[m
[31m-[m
[31m-     @EnableAspectJAutoProxyå¼€å¯å¯¹AspectJè‡ªåŠ¨ä»£ç†çš„æ”¯[m
[31m-æŒã€‚[m
[31m-[m
[31m-     @EnableAsyncå¼€å¯å¼‚æ­¥æ–¹æ³•çš„æ”¯æŒã€‚[m
[31m-[m
[31m-     @EnableSchedulingå¼€å¯è®¡åˆ’ä»»åŠ¡çš„æ”¯æŒã€‚[m
[31m-[m
[31m-     åœ¨ç¬¬äºŒéƒ¨åˆ†æˆ‘ä»¬é€šè¿‡ï¼š[m
[31m-[m
[31m-     @EnableWebMvcå¼€å¯Web MVCçš„é…ç½®æ”¯æŒã€‚[m
[31m-[m
[31m-     åœ¨ç¬¬ä¸‰éƒ¨åˆ†æˆ‘ä»¬é€šè¿‡ï¼š[m
[31m-[m
[31m-     @EnableConfigurationPropertieså¼€å¯å¯¹[m
[31m-@ConfigurationPropertiesæ³¨è§£é…ç½®Beançš„æ”¯æŒã€‚[m
[31m-[m
[31m-     @EnableJpaRepositorieså¼€å¯å¯¹Spring Data JPA Repositoryçš„[m
[31m-æ”¯æŒã€‚[m
[31m-[m
[31m-     @EnableTransactionManagementå¼€å¯æ³¨è§£å¼äº‹åŠ¡çš„æ”¯æŒã€‚[m
[31m-[m
[31m-     @EnableCachingå¼€å¯æ³¨è§£å¼çš„ç¼“å­˜æ”¯æŒã€‚[m
[31m-[m
[31m-     é€šè¿‡ç®€å•çš„@Enable*æ¥å¼€å¯ä¸€é¡¹åŠŸèƒ½çš„æ”¯æŒï¼Œä»è€Œé¿å…è‡ª[m
[31m-å·±é…ç½®å¤§é‡çš„ä»£ç ï¼Œå¤§å¤§é™ä½ä½¿ç”¨éš¾åº¦ã€‚é‚£ä¹ˆè¿™ä¸ªç¥å¥‡çš„åŠŸèƒ½[m
[31m-çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥ç ”ç©¶ä¸€ä¸‹ã€‚[m
[31m-     é€šè¿‡è§‚å¯Ÿè¿™äº›@Enable*æ³¨è§£çš„æºç ï¼Œæˆ‘ä»¬å‘ç°æ‰€æœ‰çš„æ³¨è§£[m
[31m-éƒ½æœ‰ä¸€ä¸ª@Importæ³¨è§£ï¼Œ@Importæ˜¯ç”¨æ¥å¯¼å…¥é…ç½®ç±»çš„ï¼Œè¿™ä¹Ÿ[m
[31m-å°±æ„å‘³ç€è¿™äº›è‡ªåŠ¨å¼€å¯çš„å®ç°å…¶å®æ˜¯å¯¼å…¥äº†ä¸€äº›è‡ªåŠ¨é…ç½®çš„[m
[31m-Beanã€‚è¿™äº›å¯¼å…¥çš„é…ç½®æ–¹å¼ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ç±»å‹ã€‚[m
[31m-[m
[31m-3.6.1ã€€ç¬¬ä¸€ç±»ï¼šç›´æ¥å¯¼å…¥é…ç½®ç±»[m
[31m-[m
[31m-       @Target(ElementType.TYPE)[m
[31m-       @Retention(RetentionPolicy.RUNTIME)[m
[31m-       @Import(SchedulingConfiguration.class)[m
[31m-       @Documented[m
[31m-       public @interface EnableScheduling {[m
[31m-       }[m
[31m-[m
[31m-     ç›´æ¥å¯¼å…¥é…ç½®ç±»SchedulingConfigurationï¼Œè¿™ä¸ªç±»æ³¨è§£äº†[m
[31m-@Configurationï¼Œä¸”æ³¨å†Œäº†ä¸€ä¸ªscheduledAnnotationProcessorçš„[m
[31m-Beanï¼Œæºç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       @Role(BeanDefinition.ROLE_INFRASTRUCTURE)[m
[31m-       public class SchedulingConfiguration {[m
[31m-[m
[31m-              @Bean(name = TaskManagementConfigUtils.SCHEDULED_ANNOTATION_PROCESS[m
[31m-              @Role(BeanDefinition.ROLE_INFRASTRUCTURE)[m
[31m-              public ScheduledAnnotationBeanPostProcessor scheduledAnnotationProc[m
[31m-[m
[31m-                      return new ScheduledAnnotationBeanPostProcessor();[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-3.6.2ã€€ç¬¬äºŒç±»ï¼šä¾æ®æ¡ä»¶é€‰æ‹©é…ç½®ç±»[m
[31m-       @Target(ElementType.TYPE)[m
[31m-       @Retention(RetentionPolicy.RUNTIME)[m
[31m-       @Documented[m
[31m-       @Import(AsyncConfigurationSelector.class)[m
[31m-       public @interface EnableAsync {[m
[31m-       Class<? extends Annotation> annotation() default Annotation.class;[m
[31m-[m
[31m-              boolean proxyTargetClass() default false;[m
[31m-              AdviceMode mode() default AdviceMode.PROXY;[m
[31m-              int order() default Ordered.LOWEST_PRECEDENCE;[m
[31m-       }[m
[31m-[m
[31m-     AsyncConfigurationSelectoré€šè¿‡æ¡ä»¶æ¥é€‰æ‹©éœ€è¦å¯¼å…¥çš„é…[m
[31m-ç½®ç±»ï¼ŒAsyncConfigurationSelectorçš„æ ¹æ¥å£ä¸ºImportSelectorï¼Œ[m
[31m-è¿™ä¸ªæ¥å£éœ€é‡å†™selectImportsæ–¹æ³•ï¼Œåœ¨æ­¤æ–¹æ³•å†…è¿›è¡Œäº‹å…ˆæ¡ä»¶[m
[31m-åˆ¤æ–­ã€‚æ­¤ä¾‹ä¸­ï¼Œè‹¥adviceModeä¸ºPORXYï¼Œåˆ™è¿”å›[m
[31m-ProxyAsyncConfigurationè¿™ä¸ªé…ç½®ç±»ï¼›è‹¥activeModeä¸º[m
[31m-ASPECTJï¼Œåˆ™è¿”å›AspectJAsyncConfigurationé…ç½®ç±»ï¼Œæºç å¦‚[m
[31m-ä¸‹ï¼š[m
[31m-[m
[31m-       public class AsyncConfigurationSelector extends AdviceModeImportSelecto[m
[31m-[m
[31m-              private static final String ASYNC_EXECUTION_ASPECT_CONFIGURATION_CL[m
[31m-                             "org.springframework.scheduling.aspectj.AspectJAsyncConfigu[m
[31m-[m
[31m-              @Override[m
[31m-              public String[] selectImports(AdviceMode adviceMode) {[m
[31m-[m
[31m-                      switch (adviceMode) {[m
[31m-                             case PROXY:[m
[31m-                                    return new String[] { ProxyAsyncConfiguration.class.get[m
[31m-                             case ASPECTJ:[m
[31m-                                    return new String[] { ASYNC_EXECUTION_ASPECT_CONFIGURAT[m
[31m-                             default:[m
[31m-                                    return null;[m
[31m-[m
[31m-                      }[m
[31m-              }[m
[31m-       }[m
[31m-3.6.3ã€€ç¬¬ä¸‰ç±»ï¼šåŠ¨æ€æ³¨å†ŒBean[m
[31m-[m
[31m-       @Target(ElementType.TYPE)[m
[31m-       @Retention(RetentionPolicy.RUNTIME)[m
[31m-       @Documented[m
[31m-       @Import(AspectJAutoProxyRegistrar.class)[m
[31m-       public @interface EnableAspectJAutoProxy {[m
[31m-[m
[31m-              boolean proxyTargetClass() default false;[m
[31m-       }[m
[31m-[m
[31m-     AspectJAutoProxyRegistrarå®ç°äº†[m
[31m-ImportBeanDefinitionRegistraræ¥å£ï¼ŒImportBean[m
[31m-DefinitionRegistrarçš„ä½œç”¨æ˜¯åœ¨è¿è¡Œæ—¶è‡ªåŠ¨æ·»åŠ Beanåˆ°å·²æœ‰çš„é…[m
[31m-ç½®ç±»ï¼Œé€šè¿‡é‡å†™æ–¹æ³•ï¼š[m
[31m-[m
[31m-       registerBeanDefinitions(AnnotationMetadata importingClassMetadata,[m
[31m-[m
[31m-     å…¶ä¸­ï¼ŒAnnotationMetadataå‚æ•°ç”¨æ¥è·å¾—å½“å‰é…ç½®ç±»ä¸Šçš„æ³¨[m
[31m-è§£ï¼›BeanDefinitionRegistryå‚æ•°ç”¨æ¥æ³¨å†ŒBeanã€‚æºç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       class AspectJAutoProxyRegistrar implements ImportBeanDefinitionRegistra[m
[31m-              @Override[m
[31m-              public void registerBeanDefinitions([m
[31m-                             AnnotationMetadata importingClassMetadata, BeanDefinitionRe[m
[31m-[m
[31m-                      AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNeces[m
[31m-[m
[31m-                      AnnotationAttributes enableAJAutoProxy =[m
[31m-                                    AnnotationConfigUtils.attributesFor(importingClassMetad[m
[31m-[m
[31m-                      if (enableAJAutoProxy.getBoolean("proxyTargetClass")) {[m
[31m-                             AopConfigUtils.forceAutoProxyCreatorToUseClassProxying(regi[m
[31m-[m
[31m-                      }[m
[31m-              }[m
[31m-}[m
[31m-3.7ã€€æµ‹è¯•[m
[31m-[m
[31m-3.7.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     æµ‹è¯•æ˜¯å¼€å‘å·¥ä½œä¸­ä¸å¯ç¼ºå°‘çš„éƒ¨åˆ†ã€‚å•å…ƒæµ‹è¯•åªé’ˆå¯¹å½“å‰[m
[31m-å¼€å‘çš„ç±»å’Œæ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥ç®€å•é€šè¿‡æ¨¡æ‹Ÿä¾èµ–æ¥å®ç°ï¼Œå¯¹[m
[31m-è¿è¡Œç¯å¢ƒæ²¡æœ‰ä¾èµ–ï¼›ä½†æ˜¯ä»…ä»…è¿›è¡Œå•å…ƒæµ‹è¯•æ˜¯ä¸å¤Ÿçš„ï¼Œå®ƒåªèƒ½[m
[31m-éªŒè¯å½“å‰ç±»æˆ–æ–¹æ³•èƒ½å¦æ­£å¸¸å·¥ä½œï¼Œè€Œæˆ‘ä»¬æƒ³è¦çŸ¥é“ç³»ç»Ÿçš„å„ä¸ª[m
[31m-éƒ¨åˆ†ç»„åˆåœ¨ä¸€èµ·æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œï¼Œè¿™å°±æ˜¯é›†æˆæµ‹è¯•å­˜åœ¨çš„æ„[m
[31m-ä¹‰ã€‚[m
[31m-[m
[31m-     é›†æˆæµ‹è¯•ä¸€èˆ¬éœ€è¦æ¥è‡ªä¸åŒå±‚çš„ä¸åŒå¯¹è±¡çš„äº¤äº’ï¼Œå¦‚æ•°æ®[m
[31m-åº“ã€ç½‘ç»œè¿æ¥ã€IoCå®¹å™¨ç­‰ã€‚å…¶å®æˆ‘ä»¬ä¹Ÿç»å¸¸é€šè¿‡è¿è¡Œç¨‹åºï¼Œ[m
[31m-ç„¶åé€šè¿‡è‡ªå·±æ“ä½œæ¥å®Œæˆç±»ä¼¼äºé›†æˆæµ‹è¯•çš„æµç¨‹ã€‚é›†æˆæµ‹è¯•ä¸º[m
[31m-æˆ‘ä»¬æä¾›äº†ä¸€ç§æ— é¡»éƒ¨ç½²æˆ–è¿è¡Œç¨‹åºæ¥å®ŒæˆéªŒè¯ç³»ç»Ÿå„éƒ¨åˆ†æ˜¯[m
[31m-å¦èƒ½æ­£å¸¸ååŒå·¥ä½œçš„èƒ½åŠ›ã€‚[m
[31m-[m
[31m-     Springé€šè¿‡Spring TestContex Frameworkå¯¹é›†æˆæµ‹è¯•æä¾›é¡¶[m
[31m-çº§æ”¯æŒã€‚å®ƒä¸ä¾èµ–äºç‰¹å®šçš„æµ‹è¯•æ¡†æ¶ï¼Œæ—¢å¯ä½¿ç”¨Junitï¼Œä¹Ÿå¯ä½¿[m
[31m-ç”¨TestNGã€‚[m
[31m-[m
[31m-     åŸºäºMavenæ„å»ºçš„é¡¹ç›®ç»“æ„é»˜è®¤æœ‰å…³äºæµ‹è¯•çš„ç›®å½•ï¼š[m
[31m-src/test/javaï¼ˆæµ‹è¯•ä»£ç ï¼‰ã€src/test/resourcesï¼ˆæµ‹è¯•èµ„æºï¼‰ï¼ŒåŒº[m
[31m-åˆ«äºsrc/main/javaï¼ˆé¡¹ç›®æºç ï¼‰ã€src/main/resourcesï¼ˆé¡¹ç›®èµ„[m
[31m-æºï¼‰ã€‚[m
[31m-[m
[31m-Springæä¾›äº†ä¸€ä¸ªSpringJUnit4ClassRunnerç±»ï¼Œå®ƒæä¾›äº†[m
[31m-[m
[31m-Spring    TestContext  Frameworkçš„åŠŸèƒ½ã€‚é€šè¿‡[m
[31m-[m
[31m-@ContextConfigurationæ¥é…ç½®Application  Contextï¼Œé€šè¿‡[m
[31m-@ActiveProfilesç¡®å®šæ´»åŠ¨çš„profileã€‚[m
[31m-[m
[31m-     åœ¨ä½¿ç”¨äº†Springæµ‹è¯•åï¼Œæˆ‘ä»¬å‰é¢çš„ä¾‹å­çš„â€œè¿è¡Œâ€éƒ¨åˆ†éƒ½[m
[31m-å¯ä»¥ç”¨Springæµ‹è¯•æ¥æ£€éªŒåŠŸèƒ½èƒ½å¦æ­£å¸¸è¿ä½œã€‚[m
[31m-[m
[31m-     é›†æˆæµ‹è¯•æ¶‰åŠç¨‹åºä¸­çš„å„ä¸ªåˆ†å±‚ï¼Œæœ¬èŠ‚åªå¯¹ç®€å•é…ç½®çš„[m
[31m-Application Contextå’Œåœ¨æµ‹è¯•ä¸­æ³¨å…¥Beanåšæ¼”ç¤ºï¼Œåœ¨æœ¬ä¹¦ç¬¬äºŒ[m
[31m-éƒ¨åˆ†å’Œç¬¬ä¸‰éƒ¨åˆ†ä¼šå¯¹Springæµ‹è¯•åšæ›´å¤šçš„è®²è¿°ã€‚[m
[31m-[m
[31m-3.7.2ã€€ç¤ºä¾‹[m
[31m-[m
[31m-     1.å‡†å¤‡[m
[31m-[m
[31m-     å¢åŠ Springæµ‹è¯•çš„ä¾èµ–åŒ…åˆ°Mavenï¼š[m
[31m-[m
[31m-                    <!-- Spring test æ”¯æŒ -->[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework</groupId>[m
[31m-                             <artifactId>spring-test</artifactId>[m
[31m-                             <version>${spring-framework.version}</version>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>junit</groupId>[m
[31m-                             <artifactId>junit</artifactId>[m
[31m-                             <version>4.11</version>[m
[31m-                      </dependency>[m
[31m-[m
[31m-     2.ä¸šåŠ¡ä»£ç [m
[31m-[m
[31m-     åœ¨src/main/javaä¸‹çš„æºç ï¼š[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch3.fortest;[m
[31m-[m
[31m-       public class TestBean {[m
[31m-       private String content;[m
[31m-[m
[31m-       public TestBean(String content) {[m
[31m-              super();[m
[31m-              this.content = content;[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       public String getContent() {[m
[31m-              return content;[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       public void setContent(String content) {[m
[31m-              this.content = content;[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-3.é…ç½®ç±»[m
[31m-[m
[31m-åœ¨src/main/javaä¸‹çš„æºç ï¼š[m
[31m-[m
[31m-package com.wisely.highlight_spring4.ch3.fortest;[m
[31m-[m
[31m-import org.springframework.context.annotation.Bean;[m
[31m-import org.springframework.context.annotation.Configuration;[m
[31m-import org.springframework.context.annotation.Profile;[m
[31m-@Configuration[m
[31m-public class TestConfig {[m
[31m-[m
[31m-       @Bean[m
[31m-       @Profile("dev")[m
[31m-       public TestBean devTestBean() {[m
[31m-[m
[31m-              return new TestBean("from development profile");[m
[31m-       }[m
[31m-[m
[31m-       @Bean[m
[31m-       @Profile("prod")[m
[31m-       public TestBean prodTestBean() {[m
[31m-[m
[31m-              return new TestBean("from production profile");[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-     4.æµ‹è¯•[m
[31m-[m
[31m-     åœ¨src/test/javaä¸‹çš„æºç ï¼š[m
[31m-[m
[31m-       package com.wisely.highlight_spring4.ch3.fortest;[m
[31m-[m
[31m-       import org.junit.Assert;[m
[31m-       import org.junit.Test;[m
[31m-       import org.junit.runner.RunWith;[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.test.context.ActiveProfiles;[m
[31m-       import org.springframework.test.context.ContextConfiguration;[m
[31m-       import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;[m
[31m-[m
[31m-       @RunWith(SpringJUnit4ClassRunner.class) //1[m
[31m-       @ContextConfiguration(classes = {TestConfig.class}) //2[m
[31m-       @ActiveProfiles("prod") //3[m
[31m-       public class DemoBeanIntegrationTests {[m
[31m-[m
[31m-              @Autowired //4[m
[31m-              private TestBean testBean;[m
[31m-[m
[31m-              @Test //5[m
[31m-              public void prodBeanShouldInject(){[m
[31m-[m
[31m-                      String expected = "from production profile";[m
[31m-                      String actual = testBean.getContent();[m
[31m-                      Assert.assertEquals(expected, actual);[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ SpringJUnit4ClassRunneråœ¨JUnitç¯å¢ƒä¸‹æä¾›Spring[m
[31m-TestContext Frameworkçš„åŠŸèƒ½ã€‚[m
[31m-[m
[31m-     â‘¡@ContextConfigurationç”¨æ¥åŠ è½½é…ç½®[m
[31m-ApplicationContextï¼Œå…¶ä¸­classeså±æ€§ç”¨æ¥åŠ è½½é…ç½®ç±»ã€‚[m
[31m-[m
[31m-     â‘¢@ActiveProfilesç”¨æ¥å£°æ˜æ´»åŠ¨çš„profileã€‚[m
[31m-     â‘£å¯ä½¿ç”¨æ™®é€šçš„@Autowiredæ³¨å…¥Beanã€‚[m
[31m-     â‘¤æµ‹è¯•ä»£ç ï¼Œé€šè¿‡JUnitçš„Assertæ¥æ ¡éªŒç»“æœæ˜¯å¦å’Œé¢„æœŸä¸€[m
[31m-è‡´ã€‚[m
[31m-     ç»“æœå¦‚å›¾3-7æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                    å›¾3-7ã€€æµ‹è¯•ç»“æœ[m
[31m-[m
[31m-     å°†@ActiveProfilesï¼ˆâ€œprodâ€ï¼‰æ”¹ä¸º[m
[31m-@ActiveProfilesï¼ˆâ€œdevâ€ï¼‰ï¼Œæ¼”ç¤ºæµ‹è¯•ä¸èƒ½é€šè¿‡çš„æƒ…æ™¯ï¼Œå¦‚å›¾3-[m
[31m-8æ‰€ç¤ºã€‚[m
[31m-å›¾3-8ã€€æ¼”ç¤ºæµ‹è¯•ä¸èƒ½é€šè¿‡çš„æƒ…æ™¯[m
[31m-    ç¬¬äºŒéƒ¨åˆ†ã€€ç‚¹ç›Spring MVC 4.x[m
[31m-[m
[31m-ç¬¬4ç« ã€€Spring MVCåŸºç¡€[m
[31m-[m
[31m-     ä¹Ÿè®¸ä½ è¿˜åœ¨é—®ä¸ºä»€ä¹ˆè¦ç”¨Spring MVCï¼ŒStruts 2.xä¸æ‰æ˜¯ä¸»[m
[31m-æµå—ï¼Ÿçœ‹SSHçš„æ¦‚å¿µå¤šç«ï¼å…¶å®å¾ˆå¤šåˆå­¦è€…æ··æ·†äº†ä¸€ä¸ªæ¦‚å¿µï¼Œ[m
[31m-SSHå®é™…ä¸ŠæŒ‡çš„æ˜¯Struts 1.x+Spring+Hibernateï¼Œè¿™ä¸ªæ¦‚å¿µå·²ç»[m
[31m-æœ‰åå‡ å¹´çš„å†å²äº†ã€‚åœ¨Struts 1.xçš„æ—¶ä»£ï¼ŒStruts 1.xæ˜¯å½“ä¹‹æ— æ„§[m
[31m-çš„MVCæ¡†æ¶çš„éœ¸ä¸»ï¼Œä½†æ˜¯åœ¨æ–°çš„MVCæ¡†æ¶æ¶Œç°çš„æ—¶ä»£ï¼Œå½¢å¼[m
[31m-å·²ç»å®Œå…¨ä¸æ˜¯è¿™æ ·çš„äº†ï¼ŒStruts 2.xå€ŸåŠ©äº†Struts 1.xçš„å¥½åå£°ï¼Œ[m
[31m-è®©å›½å†…å¼€å‘è€…è®¤ä¸ºStruts 2.xæ˜¯éœ¸ä¸»ç»§ä»»è€…ï¼ˆå…¶å®ä¸¤è€…åœ¨æŠ€æœ¯ä¸Š[m
[31m-æ— ä»»ä½•å…³ç³»ï¼‰ï¼Œå¯¼è‡´å›½å†…ç¨‹åºå‘˜å¤§å¤šæ•°å­¦ä¹ åŸºäºStruts 2.xçš„æ¡†[m
[31m-æ¶ï¼Œåˆä¸€ä¸ªè²Œä¼¼å¾ˆç«çš„æ¦‚å¿µå‡ºæ¥äº†S2SHï¼ˆStruts[m
[31m-2.x+Spring+Hibernateï¼‰æ•´åˆå¼€å‘ã€‚[m
[31m-[m
[31m-     ä¸€èµ·çœ‹çœ‹ä¸–ç•ŒèŒƒå›´å†…åˆ°åº•æ˜¯ä»€ä¹ˆçŠ¶å†µå§ï¼Œè¯·çœ‹ä¸‹é¢çš„è°ƒæŸ¥[m
[31m-ç»Ÿè®¡ã€‚[m
[31m-[m
[31m-     Zeroturnaroundï¼ˆçŸ¥åçƒ­éƒ¨ç½²è½¯ä»¶JRebelå‚å•†ï¼‰ç»Ÿè®¡å¦‚å›¾4-1[m
[31m-æ‰€ç¤ºã€‚[m
[31m-                                å›¾4-1ã€€JRbelå‚å•†ç»Ÿè®¡[m
[31m-[m
[31m-     ä»å›¾4-1å¯ä»¥çœ‹å‡ºï¼ŒSpring MVCçš„å¸‚åœºå æœ‰ç‡æ˜¯40%ï¼Œè€Œ[m
[31m-Struts 2åªæœ‰å¯æ€œçš„6%ï¼Œç«Ÿç„¶åªæ¯”éª¨ç°çº§çš„Struts 1é«˜é‚£ä¹ˆä¸€ç‚¹[m
[31m-ç‚¹ã€‚[m
[31m-[m
[31m-     vitalflux.comå¯¹2014â€”2015å¹´åº¦10ä½³Webæ¡†æ¶æ’åã€‚[m
[31m-     å‰10åæ²¡æœ‰Struts 2çš„èº«å½±ï¼Œå‰äº”åä¸ºï¼š[m
[31m-[m
[31m-     1.Spring MVC[m
[31m-[m
[31m-     2.Grails[m
[31m-[m
[31m-     3.Play[m
[31m-[m
[31m-     4.Spring Boot[m
[31m-[m
[31m-     5.Vaadin[m
[31m-     è¯´äº†è¿™ä¹ˆå¤šï¼Œä¸è¿‡æ˜¯ä¸ºäº†å¤§å®¶æ›´æœ‰ä¿¡å¿ƒåœ°å­¦ä¹ Spring[m
[31m-MVCï¼ŒSpring MVCæ˜¯ç›®å‰Java Webæ¡†æ¶å½“ä¹‹æ— æ„§çš„éœ¸ä¸»ã€‚[m
[31m-4.1ã€€Spring MVCæ¦‚è¿°[m
[31m-[m
[31m-     è¯´åˆ°Spring MVCï¼Œä¸å¾—ä¸å…ˆæ¥è°ˆè°ˆä»€ä¹ˆæ˜¯MVCï¼Œå®ƒå’Œä¸‰[m
[31m-å±‚æ¶æ„æ˜¯ä»€ä¹ˆå…³ç³»ã€‚å¯èƒ½å¾ˆå¤šè¯»è€…éƒ½ä¼šæŠ¢ç­”ï¼š[m
[31m-[m
[31m-     MVCï¼šModel+View+Controllerï¼ˆæ•°æ®æ¨¡å‹+è§†å›¾+æ§åˆ¶[m
[31m-å™¨ï¼‰ã€‚[m
[31m-[m
[31m-     ä¸‰å±‚æ¶æ„ï¼š Presentation tier+Application tier+Data tierï¼ˆå±•[m
[31m-ç°å±‚+åº”ç”¨å±‚+æ•°æ®è®¿é—®å±‚ï¼‰ã€‚[m
[31m-[m
[31m-     é‚£MVCå’Œä¸‰å±‚æ¶æ„æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿåœ¨æˆ‘é¢è¯•ç¨‹åºå‘˜çš„æ—¶[m
[31m-å€™ï¼Œç»å¸¸ä¼šæœ‰é¢è¯•è€…å‘Šè¯‰æˆ‘ï¼šMVCçš„Må°±æ˜¯æ•°æ®è®¿é—®å±‚ã€Vå°±[m
[31m-æ˜¯å±•ç°å±‚ã€Cå°±æ˜¯åº”ç”¨å±‚ã€‚æ€ä¹ˆæ ·ï¼Ÿå¬ä¸Šå»æ˜¯ä¸æ˜¯å¥½åƒå¾ˆæœ‰é“[m
[31m-ç†ï¼Ÿ[m
[31m-[m
[31m-     ä½†æ˜¯å®é™…ä¸ŠMVCåªå­˜åœ¨ä¸‰å±‚æ¶æ„çš„å±•ç°å±‚ï¼ŒMå®é™…ä¸Šæ˜¯æ•°[m
[31m-æ®æ¨¡å‹ï¼Œæ˜¯åŒ…å«æ•°æ®çš„å¯¹è±¡ã€‚åœ¨Spring MVCé‡Œï¼Œæœ‰ä¸€ä¸ªä¸“é—¨[m
[31m-çš„ç±»å«Modelï¼Œç”¨æ¥å’ŒVä¹‹é—´çš„æ•°æ®äº¤äº’ã€ä¼ å€¼ï¼›VæŒ‡çš„æ˜¯è§†å›¾[m
[31m-é¡µé¢ï¼ŒåŒ…å«JSPã€freeMarkerã€Velocityã€Thymeleafã€Tileç­‰ï¼›C[m
[31m-å½“ç„¶å°±æ˜¯æ§åˆ¶å™¨ï¼ˆSpring MVCçš„æ³¨è§£@Controllerçš„ç±»ï¼‰ã€‚[m
[31m-[m
[31m-     åœ¨æœ¬ä¹¦æˆ‘å¾ˆæŠ±æ­‰åœ°å‘Šè¯‰å¤§å®¶ï¼Œæœ¬ä¹¦å°†ä¸ä¼šä»‹ç»å¤ªå¤šViewå±‚[m
[31m-çš„çŸ¥è¯†ï¼Œåªä¼šç®€å•åœ°ä½¿ç”¨JSPå’Œjstlä½œä¸ºæ¼”ç¤ºï¼Œå› ä¸ºSpring MVC[m
[31m-æ”¯æŒçš„æ¨¡æ¿å¼•æ“å¤ªå¤šäº†ï¼Œæˆ‘ä»¬ä¼šåœ¨7.1èŠ‚ä¸“é—¨ä»‹ç»Spring Bootæ¨[m
[31m-èä½¿ç”¨çš„æ¨¡æ¿å¼•æ“ï¼Œæœ¬ç« å…³æ³¨Spring MVCåœ¨å®é™…å¼€å‘ä¸­çš„å„[m
[31m-ç§é…ç½®ã€‚[m
[31m-[m
[31m-     è€Œä¸‰å±‚æ¶æ„æ˜¯æ•´ä¸ªåº”ç”¨çš„æ¶æ„ï¼Œæ˜¯ç”±Springæ¡†æ¶è´Ÿè´£ç®¡ç†[m
[31m-çš„ã€‚ä¸€èˆ¬é¡¹ç›®ç»“æ„ä¸­éƒ½æœ‰Serviceå±‚ã€DAOå±‚ï¼Œè¿™ä¸¤ä¸ªåé¦ˆåœ¨[m
[31m-åº”ç”¨å±‚å’Œæ•°æ®è®¿é—®å±‚ã€‚[m
[31m-[m
[31m-     å¼„æ¸…MVCå’Œä¸‰å±‚æ¶æ„çš„å…³ç³»å¯¹æˆ‘ä»¬ç†è§£Spring MVCå’Œè¿›[m
[31m-è¡ŒWebå¼€å‘è‡³å…³é‡è¦ã€‚[m
[31m-[m
[31m-     Spring MVCä½¿æˆ‘ä»¬å¯ä»¥ç®€å•åœ°å¼€å‘çµæ´»ä¸”æ¾è€¦åˆçš„Webé¡¹[m
[31m-ç›®ï¼Œæœ¬ç« æˆ‘ä»¬å°†å…³æ³¨ä¸åŸºäºæ³¨è§£å’ŒJavaé…ç½®çš„é›¶é…ç½®ï¼ˆæ— xml[m
[31m-é…ç½®ï¼‰çš„Spring MVCå¼€å‘ã€‚[m
[31m-4.2ã€€Spring MVCé¡¹ç›®å¿«é€Ÿæ­å»º[m
[31m-[m
[31m-4.2.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     Spring MVCæä¾›äº†ä¸€ä¸ªDispatcherServletæ¥å¼€å‘Webåº”ç”¨ã€‚[m
[31m-åœ¨Servlet 2.5åŠä»¥ä¸‹çš„æ—¶å€™åªè¦åœ¨web.xmlä¸‹é…ç½®<servlet>å…ƒç´ [m
[31m-å³å¯ã€‚ä½†æˆ‘ä»¬åœ¨æœ¬èŠ‚å°†ä½¿ç”¨Servlet 3.0+æ— web.xmlçš„é…ç½®æ–¹[m
[31m-å¼ï¼Œåœ¨Spring MVCé‡Œå®ç°WebApplicationInitializeræ¥å£ä¾¿å¯å®[m
[31m-ç°ç­‰åŒäºweb.xmlçš„é…ç½®ã€‚[m
[31m-[m
[31m-     ä¸‹é¢æˆ‘ä»¬å°†åŸºäºMavenæ­å»ºé›¶é…ç½®çš„Spring MVCåŸå‹é¡¹[m
[31m-ç›®ï¼Œå¼€å‘å·¥å…·ç›¸å…³çš„å†…å®¹è¿™é‡Œå°†ä¸å†æåŠã€‚[m
[31m-[m
[31m-4.2.2ã€€ç¤ºä¾‹[m
[31m-[m
[31m-     1.æ„å»ºMavené¡¹ç›®[m
[31m-[m
[31m-     pom.xmlå†…å®¹ï¼š[m
[31m-[m
[31m-       <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://ww[m
[31m-       instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://[m
[31m-       4.0.0.xsd">[m
[31m-[m
[31m-           <modelVersion>4.0.0</modelVersion>[m
[31m-           <groupId>com.wisely</groupId>[m
[31m-           <artifactId>highlight_springmvc4</artifactId>[m
[31m-           <version>0.0.1-SNAPSHOT</version>[m
[31m-           <packaging>war</packaging>[m
[31m-[m
[31m-             <properties>[m
[31m-                      <!-- Generic properties -->[m
[31m-                      <java.version>1.7</java.version>[m
[31m-                                                <project.build.sourceEncoding>UTF-[m
[31m-8</project.build.sourceEncoding>[m
[31m-[m
[31m-                                         <project.reporting.outputEncoding>UTF-[m
[31m-8</project.reporting.outputEncoding>[m
[31m-[m
[31m-              <!-- Web -->[m
[31m-              <jsp.version>2.2</jsp.version>[m
[31m-              <jstl.version>1.2</jstl.version>[m
[31m-              <servlet.version>3.1.0</servlet.version>[m
[31m-              <!-- Spring -->[m
[31m-[m
[31m-                       <spring-framework.version>4.1.5.RELEASE</spring-[m
[31m-framework.version>[m
[31m-[m
[31m-              <!-- Logging -->[m
[31m-              <logback.version>1.0.13</logback.version>[m
[31m-              <slf4j.version>1.7.5</slf4j.version>[m
[31m-       </properties>[m
[31m-[m
[31m-       <dependencies>[m
[31m-              <dependency>[m
[31m-                     <groupId>javax</groupId>[m
[31m-                     <artifactId>javaee-web-api</artifactId>[m
[31m-                     <version>7.0</version>[m
[31m-                     <scope>provided</scope>[m
[31m-              </dependency>[m
[31m-[m
[31m-              <!-- Spring MVC -->[m
[31m-              <dependency>[m
[31m-[m
[31m-                     <groupId>org.springframework</groupId>[m
[31m-                     <artifactId>spring-webmvc</artifactId>[m
[31m-                     <version>${spring-framework.version}</version>[m
[31m-              </dependency>[m
[31m-[m
[31m-              <!-- å…¶ä»–Webä¾èµ– -->[m
[31m-              <dependency>[m
[31m-[m
[31m-                     <groupId>javax.servlet</groupId>[m
[31m-                     <artifactId>jstl</artifactId>[m
[31m-                     <version>${jstl.version}</version>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>javax.servlet</groupId>[m
[31m-                     <artifactId>javax.servlet-api</artifactId>[m
[31m-                     <version>${servlet.version}</version>[m
[31m-                     <scope>provided</scope>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>javax.servlet.jsp</groupId>[m
[31m-                     <artifactId>jsp-api</artifactId>[m
[31m-                     <version>${jsp.version}</version>[m
[31m-                     <scope>provided</scope>[m
[31m-              </dependency>[m
[31m-[m
[31m-              <!-- Spring and Transactions -->[m
[31m-              <dependency>[m
[31m-[m
[31m-                     <groupId>org.springframework</groupId>[m
[31m-                     <artifactId>spring-tx</artifactId>[m
[31m-                     <version>${spring-framework.version}</version>[m
[31m-              </dependency>[m
[31m-[m
[31m-              <!-- ä½¿ç”¨SLF4Jå’ŒLogBackä½œä¸ºæ—¥å¿— -->[m
[31m-              <dependency>[m
[31m-[m
[31m-                     <groupId>org.slf4j</groupId>[m
[31m-                     <artifactId>slf4j-api</artifactId>[m
[31m-                     <version>${slf4j.version}</version>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>log4j</groupId>[m
[31m-                     <artifactId>log4j</artifactId>[m
[31m-                     <version>1.2.16</version>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>org.slf4j</groupId>[m
[31m-                     <artifactId>jcl-over-slf4j</artifactId>[m
[31m-                     <version>${slf4j.version}</version>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>ch.qos.logback</groupId>[m
[31m-                     <artifactId>logback-classic</artifactId>[m
[31m-                     <version>${logback.version}</version>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>ch.qos.logback</groupId>[m
[31m-                     <artifactId>logback-core</artifactId>[m
[31m-                     <version>${logback.version}</version>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>ch.qos.logback</groupId>[m
[31m-                     <artifactId>logback-access</artifactId>[m
[31m-                     <version>${logback.version}</version>[m
[31m-              </dependency>[m
[31m-          </dependencies>[m
[31m-[m
[31m-                <build>[m
[31m-              <plugins>[m
[31m-[m
[31m-                   <plugin>[m
[31m-                             <groupId>org.apache.maven.plugins</groupId>[m
[31m-                                                             <artifactId>maven-compiler-[m
[31m-[m
[31m-plugin</artifactId>[m
[31m-                                    <version>2.3.2</version>[m
[31m-                                    <configuration>[m
[31m-[m
[31m-                                           <source>${java.version}</source>[m
[31m-                                           <target>${java.version}</target>[m
[31m-                                    </configuration>[m
[31m-                             </plugin>[m
[31m-                             <plugin>[m
[31m-                                    <groupId>org.apache.maven.plugins</groupId>[m
[31m-                                    <artifactId>maven-war-plugin</artifactId>[m
[31m-                                    <version>2.3</version>[m
[31m-                                    <configuration>[m
[31m-                                           <failOnMissingWebXml>false</failOnMissingWebXml>[m
[31m-                                    </configuration>[m
[31m-                             </plugin>[m
[31m-                      </plugins>[m
[31m-              </build>[m
[31m-       </project>[m
[31m-[m
[31m-     2.æ—¥å¿—é…ç½®[m
[31m-[m
[31m-     åœ¨src/main/resourcesç›®å½•ä¸‹ï¼Œæ–°å»ºlogback.xmlç”¨æ¥é…ç½®æ—¥[m
[31m-å¿—ï¼Œå†…å®¹å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       <?xml version="1.0" encoding="UTF-8"?>[m
[31m-       <configuration scan="true" scanPeriod="1 seconds">[m
[31m-[m
[31m-              <contextListener class="ch.qos.logback.classic.jul.LevelChangePropa[m
[31m-                      <resetJUL>true</resetJUL>[m
[31m-[m
[31m-              </contextListener>[m
[31m-[m
[31m-              <jmxConfigurator/>[m
[31m-              <appender name="console" class="ch.qos.logback.core.ConsoleAppender[m
[31m-[m
[31m-                      <encoder>[m
[31m-                             <pattern>logbak: %d{HH:mm:ss.SSS} %logger{36} - %msg%n</pat[m
[31m-[m
[31m-                      </encoder>[m
[31m-              </appender>[m
[31m-[m
[31m-                  <logger name="org.springframework.web" level="DEBUG"/> <!-[m
[31m-       - 1 -->[m
[31m-[m
[31m-              <root level="info">[m
[31m-                      <appender-ref ref="console"/>[m
[31m-[m
[31m-              </root>[m
[31m-       </configuration>[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ å°†org.springframework.webåŒ…ä¸‹çš„ç±»çš„æ—¥å¿—çº§åˆ«è®¾ç½®ä¸º[m
[31m-DEBUGï¼Œæˆ‘ä»¬å¼€å‘Spring MVCç»å¸¸å‡ºç°å’Œå‚æ•°ç±»å‹ç›¸å…³çš„[m
[31m-4XXé”™è¯¯ï¼Œè®¾ç½®æ­¤é¡¹æˆ‘ä»¬ä¼šçœ‹åˆ°æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚[m
[31m-[m
[31m-     3.æ¼”ç¤ºé¡µé¢[m
[31m-[m
[31m-     åœ¨src/main/resourcesä¸‹å»ºç«‹viewsç›®å½•ï¼Œå¹¶åœ¨æ­¤ç›®å½•ä¸‹æ–°å»º[m
[31m-index.jspï¼Œå†…å®¹å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-<%@ page language="java" contentType="text/html; charset=UTF-[m
[31m-[m
[31m-8"[m
[31m-[m
[31m-    pageEncoding="UTF-8"%>[m
[31m-[m
[31m-<!DOCTYPE   html                      PUBLIC  "-[m
[31m-[m
[31m-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loos[m
[31m-[m
[31m-<html>[m
[31m-[m
[31m-<head>[m
[31m-[m
[31m-<meta                                 http-equiv="Content-[m
[31m-[m
[31m-Type" content="text/html; charset=UTF-8">[m
[31m-[m
[31m-<title>Insert title here</title>[m
[31m-[m
[31m-</head>[m
[31m-[m
[31m-<body>[m
[31m-[m
[31m-    <pre>[m
[31m-[m
[31m-         Welcome to Spring MVC world[m
[31m-[m
[31m-    </pre>[m
[31m-[m
[31m-</body>[m
[31m-[m
[31m-</html>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     æ­¤å¤„ä¹Ÿè®¸è¯»è€…ä¼šå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆé¡µé¢ä¸æ”¾åœ¨Mavenæ ‡å‡†çš„[m
[31m-src/main/webapp/WEB-INFä¸‹ï¼Œæ­¤å¤„è¿™æ ·å»ºçš„ä¸»è¦ç›®çš„æ˜¯è®©å¤§[m
[31m-å®¶ç†Ÿæ‚‰Spring Bootçš„é¡µé¢ä¹ æƒ¯çš„æ”¾ç½®æ–¹å¼ï¼ŒSpring Bootçš„é¡µé¢[m
[31m-å°±æ”¾ç½®åœ¨src/main/resourcesä¸‹ã€‚[m
[31m-[m
[31m-     4.Spring MVCé…ç½®[m
[31m-       package com.wisely.highlight_springmvc4;[m
[31m-[m
[31m-       import org.springframework.context.annotation.ComponentScan;[m
[31m-       import org.springframework.context.annotation.Configuration;[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableWebMvc[m
[31m-       @ComponentScan("com.wisely.highlight_springmvc4")[m
[31m-       public class MyMvcConfig{[m
[31m-[m
[31m-              @Bean[m
[31m-              public InternalResourceViewResolver viewResolver(){[m
[31m-[m
[31m-                      InternalResourceViewResolver viewResolver = new InternalResourc[m
[31m-                      viewResolver.setPrefix("/WEB-INF/classes/views/");[m
[31m-                      viewResolver.setSuffix(".jsp");[m
[31m-                      viewResolver.setViewClass(JstlView.class);[m
[31m-                      return viewResolver;[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     æ­¤å¤„æ— ä»»ä½•ç‰¹åˆ«ï¼Œåªæ˜¯ä¸€ä¸ªæ™®é€šçš„Springé…ç½®ç±»ã€‚è¿™é‡Œæˆ‘[m
[31m-ä»¬é…ç½®äº†ä¸€ä¸ªJSPçš„ViewResolverï¼Œç”¨æ¥æ˜ å°„è·¯å¾„å’Œå®é™…é¡µé¢[m
[31m-çš„ä½ç½®ï¼Œå…¶ä¸­ï¼Œ@EnableWebMvcæ³¨è§£ä¼šå¼€å¯ä¸€äº›é»˜è®¤é…ç½®ï¼Œ[m
[31m-å¦‚ä¸€äº›ViewResolveræˆ–è€…MessageConverterç­‰ã€‚[m
[31m-[m
[31m-     åœ¨æ­¤å¤„è¦ç‰¹åˆ«è§£é‡Šä¸€ä¸‹Spring MVCçš„ViewResolverï¼Œè¿™æ˜¯[m
[31m-Spring MVCè§†å›¾ï¼ˆJSPä¸‹å°±æ˜¯htmlï¼‰æ¸²æŸ“çš„æ ¸å¿ƒæœºåˆ¶ï¼›Spring[m
[31m-MVCé‡Œæœ‰ä¸€ä¸ªæ¥å£å«åšViewResolverï¼ˆæˆ‘ä»¬çš„ViewResolveréƒ½[m
[31m-å®ç°è¯¥æ¥å£ï¼‰ï¼Œå®ç°è¿™ä¸ªæ¥å£è¦é‡å†™æ–¹æ³•[m
[31m-resolveViewNameï¼ˆï¼‰ï¼Œè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼æ˜¯æ¥å£Viewï¼Œè€Œ[m
[31m-Viewçš„èŒè´£å°±æ˜¯ä½¿ç”¨modelã€requestã€responseå¯¹è±¡ï¼Œå¹¶å°†æ¸²æŸ“[m
[31m-çš„è§†å›¾ï¼ˆä¸ä¸€å®šæ˜¯htmlï¼Œå¯èƒ½æ˜¯jsonã€xmlã€pdfï¼‰è¿”å›ç»™æµè§ˆ[m
[31m-å™¨ã€‚åœ¨4.5.2èŠ‚æˆ‘ä»¬ä¼šä»‹ç»æ›´å¤šå…³äºViewResolverçš„å†…å®¹ã€‚[m
[31m-[m
[31m-     å¯èƒ½è¯»è€…å¯¹è·¯å¾„å‰ç¼€é…ç½®ä¸º/WEB-INF/classes/views/æœ‰äº›å¥‡[m
[31m-æ€ªï¼Œæ€ä¹ˆå’Œæˆ‘å¼€å‘çš„ç›®å½•ä¸ä¸€è‡´ï¼Ÿå› ä¸ºçœ‹åˆ°çš„é¡µé¢æ•ˆæœæ˜¯è¿è¡Œ[m
[31m-[m
[31m-æ—¶è€Œä¸æ˜¯å¼€å‘æ—¶çš„ä»£ç ï¼Œè¿è¡Œæ—¶ä»£ç ä¼šå°†æˆ‘ä»¬çš„é¡µé¢è‡ªåŠ¨ç¼–è¯‘[m
[31m-[m
[31m-åˆ°/WEB-INF/classes/views/ä¸‹ï¼Œå›¾4-2æ˜¯è¿è¡Œæ—¶çš„ç›®å½•ç»“æ„ï¼Œè¿™[m
[31m-æ ·æˆ‘ä»¬å°±èƒ½ç†è§£å‰ç¼€ä¸ºä»€ä¹ˆå†™æˆè¿™æ ·ï¼Œåœ¨Spring Bootä¸­ï¼Œæˆ‘ä»¬[m
[31m-å°†ä½¿ç”¨Thymeleafä½œä¸ºæ¨¡æ¿ï¼Œå› è€Œä¸éœ€è¦è¿™æ ·çš„é…ç½®ã€‚[m
[31m-[m
[31m-         å›¾4-2ã€€è¿è¡Œæ—¶çš„ç›®å½•ç»“æ„[m
[31m-[m
[31m-5.Webé…ç½®[m
[31m-[m
[31m-package com.wisely.highlight_springmvc4;[m
[31m-[m
[31m-import javax.servlet.ServletContext;[m
[31m-import javax.servlet.ServletException;[m
[31m-import javax.servlet.ServletRegistration.Dynamic;[m
[31m-[m
[31m-import org.springframework.web.WebApplicationInitializer;[m
[31m-import org.springframework.web.context.support.AnnotationConfigWebAppli[m
[31m-import org.springframework.web.servlet.DispatcherServlet;[m
[31m-[m
[31m-public class WebInitializer implements WebApplicationInitializer {//1[m
[31m-[m
[31m-       @Override[m
[31m-       public void onStartup(ServletContext servletContext)[m
[31m-[m
[31m-                     throws ServletException {[m
[31m-              AnnotationConfigWebApplicationContext ctx = new AnnotationConfi[m
[31m-              ctx.register(MyMvcConfig.class);[m
[31m-              ctx.setServletContext(servletContext); //2[m
[31m-[m
[31m-              Dynamic servlet = servletContext.addServlet("dispatcher", new D[m
[31m-              servlet.addMapping("/");[m
[31m-              servlet.setLoadOnStartup(1);[m
[31m-[m
[31m-       }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ WebApplicationInitializeræ˜¯Springæä¾›ç”¨æ¥é…ç½®Servlet[m
[31m-3.0+é…ç½®çš„æ¥å£ï¼Œä»è€Œå®ç°äº†æ›¿ä»£web.xmlçš„ä½ç½®ã€‚å®ç°æ­¤æ¥[m
[31m-å£å°†ä¼šè‡ªåŠ¨è¢«SpringServletContainerInitializerï¼ˆç”¨æ¥å¯åŠ¨[m
[31m-Servlet 3.0å®¹å™¨ï¼‰è·å–åˆ°ã€‚[m
[31m-[m
[31m-     â‘¡æ–°å»ºWebApplicationContextï¼Œæ³¨å†Œé…ç½®ç±»ï¼Œå¹¶å°†å…¶å’Œå½“[m
[31m-å‰servletContextå…³è”ã€‚[m
[31m-[m
[31m-     â‘¢æ³¨å†ŒSpring MVCçš„DispatcherServletã€‚[m
[31m-     6.ç®€å•æ§åˆ¶å™¨[m
[31m-[m
[31m-       package com.wisely.highlight_springmvc4.web;[m
[31m-       import org.springframework.stereotype.Controller;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.ResponseBody;[m
[31m-       @Controller//1[m
[31m-       public class HelloController {[m
[31m-[m
[31m-              @RequestMapping("/index")//2[m
[31m-              public String hello(){[m
[31m-[m
[31m-                      return "index"; //3[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ åˆ©ç”¨@Controlleræ³¨è§£å£°æ˜æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ã€‚[m
[31m-     â‘¡åˆ©ç”¨@RequestMappingé…ç½®URLå’Œæ–¹æ³•ä¹‹é—´çš„æ˜ å°„ã€‚[m
[31m-     â‘¢é€šè¿‡ä¸Šé¢ViewResolverçš„Beané…ç½®ï¼Œè¿”å›å€¼ä¸ºindexï¼Œè¯´[m
[31m-æ˜æˆ‘ä»¬çš„é¡µé¢æ”¾ç½®çš„è·¯å¾„ä¸º/WEB-INF/classes/views/index.jspã€‚[m
[31m-     7.è¿è¡Œ[m
[31m-     å°†ç¨‹åºéƒ¨ç½²åˆ°Tomcatä¸­ï¼Œå¯åŠ¨Tomcatï¼Œå¹¶è®¿é—®[m
[31m-http://localhostï¼š8080/highlight_springmvc4/indexï¼Œå¦‚å›¾4-3æ‰€[m
[31m-ç¤ºã€‚[m
[31m-[m
[31m-                            å›¾4-3ã€€å°†ç¨‹åºéƒ¨ç½²åˆ°Tomcat[m
[31m-4.3ã€€Spring MVCçš„å¸¸ç”¨æ³¨è§£[m
[31m-[m
[31m-4.3.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     Spring MVCå¸¸ç”¨ä»¥ä¸‹å‡ ä¸ªæ³¨è§£ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰@Controller[m
[31m-[m
[31m-     @Controlleræ³¨è§£åœ¨ç±»ä¸Šï¼Œè¡¨æ˜è¿™ä¸ªç±»æ˜¯Spring MVCé‡Œçš„[m
[31m-Controllerï¼Œå°†å…¶å£°æ˜ä¸ºSpringçš„ä¸€ä¸ªBeanï¼ŒDispatcher Servlet[m
[31m-ä¼šè‡ªåŠ¨æ‰«ææ³¨è§£äº†æ­¤æ³¨è§£çš„ç±»ï¼ˆè¿™é‡Œå’Œæˆ‘ä»¬åœ¨1.3.3èŠ‚æ¼”ç¤ºç”¨æ³¨[m
[31m-è§£ä½œä¸ºæ‹¦æˆªæ–¹å¼çš„ä¾‹å­åŸç†ç±»ä¼¼ï¼‰ï¼Œå¹¶å°†Webè¯·æ±‚æ˜ å°„åˆ°æ³¨è§£[m
[31m-äº†@RequestMappingçš„æ–¹æ³•ä¸Šã€‚è¿™é‡Œç‰¹åˆ«æŒ‡å‡ºï¼Œåœ¨å£°æ˜æ™®é€š[m
[31m-Beançš„æ—¶å€™ï¼Œä½¿ç”¨@Componentã€@Serviceã€@Repositoryå’Œ[m
[31m-@Controlleræ˜¯ç­‰åŒçš„ï¼Œå› ä¸º@Serviceã€@Repositoryã€[m
[31m-@Controlleréƒ½ç»„åˆäº†@Compomentå…ƒæ³¨è§£ï¼›ä½†åœ¨Spring MVCå£°[m
[31m-æ˜æ§åˆ¶å™¨Beançš„æ—¶å€™ï¼Œåªèƒ½ä½¿ç”¨@Controllerã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰@RequestMapping[m
[31m-[m
[31m-     @RequestMappingæ³¨è§£æ˜¯ç”¨æ¥æ˜ å°„Webè¯·æ±‚ï¼ˆè®¿é—®è·¯å¾„å’Œ[m
[31m-å‚æ•°ï¼‰ã€å¤„ç†ç±»å’Œæ–¹æ³•çš„ã€‚@RequestMappingå¯æ³¨è§£åœ¨ç±»æˆ–æ–¹[m
[31m-æ³•ä¸Šã€‚æ³¨è§£åœ¨æ–¹æ³•ä¸Šçš„@RequestMappingè·¯å¾„ä¼šç»§æ‰¿æ³¨è§£åœ¨ç±»[m
[31m-ä¸Šçš„è·¯å¾„ï¼Œ@RequestMappingæ”¯æŒServletçš„requestå’Œresponseä½œ[m
[31m-ä¸ºå‚æ•°ï¼Œä¹Ÿæ”¯æŒå¯¹requestå’Œresponseçš„åª’ä½“ç±»å‹è¿›è¡Œé…ç½®ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰@ResponseBody[m
[31m-[m
[31m-     @ResponseBodyæ”¯æŒå°†è¿”å›å€¼æ”¾åœ¨responseä½“å†…ï¼Œè€Œä¸æ˜¯[m
[31m-è¿”å›ä¸€ä¸ªé¡µé¢ã€‚æˆ‘ä»¬åœ¨å¾ˆå¤šåŸºäºAjaxçš„ç¨‹åºçš„æ—¶å€™ï¼Œå¯ä»¥ä»¥æ­¤[m
[31m-æ³¨è§£è¿”å›æ•°æ®è€Œä¸æ˜¯é¡µé¢ï¼›æ­¤æ³¨è§£å¯æ”¾ç½®åœ¨è¿”å›å€¼å‰æˆ–è€…æ–¹æ³•[m
[31m-ä¸Šã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰@RequestBody[m
[31m-[m
[31m-     @RequestBodyå…è®¸requestçš„å‚æ•°åœ¨requestä½“ä¸­ï¼Œè€Œä¸æ˜¯åœ¨[m
[31m-ç›´æ¥é“¾æ¥åœ¨åœ°å€åé¢ã€‚æ­¤æ³¨è§£æ”¾ç½®åœ¨å‚æ•°å‰ã€‚[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰@PathVariable[m
[31m-[m
[31m-     @PathVariableç”¨æ¥æ¥æ”¶è·¯å¾„å‚æ•°ï¼Œå¦‚/news/001ï¼Œå¯æ¥æ”¶[m
[31m-001ä½œä¸ºå‚æ•°ï¼Œæ­¤æ³¨è§£æ”¾ç½®åœ¨å‚æ•°å‰ã€‚[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰@RestController[m
[31m-[m
[31m-     @RestControlleræ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œç»„åˆäº†@Controllerå’Œ[m
[31m-@ResponseBodyï¼Œè¿™å°±æ„å‘³ç€å½“ä½ åªå¼€å‘ä¸€ä¸ªå’Œé¡µé¢äº¤äº’æ•°æ®[m
[31m-çš„æ§åˆ¶çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨æ­¤æ³¨è§£ã€‚è‹¥æ²¡æœ‰æ­¤æ³¨è§£ï¼Œè¦æƒ³å®ç°ä¸Š[m
[31m-è¿°åŠŸèƒ½ï¼Œåˆ™éœ€è‡ªå·±åœ¨ä»£ç ä¸­åŠ @Controllerå’Œ@ResponseBodyä¸¤[m
[31m-ä¸ªæ³¨è§£ã€‚[m
[31m-[m
[31m-     ä¸‹é¢çš„ç¤ºä¾‹å°†æ¼”ç¤ºè¿™å‡ ä¸ªæ³¨è§£çš„ä½¿ç”¨ã€‚[m
[31m-[m
[31m-4.3.2ã€€ç¤ºä¾‹[m
[31m-[m
[31m-     1.ä¼ å€¼ç±»[m
[31m-[m
[31m-     æ·»åŠ jacksonåŠç›¸å…³ä¾èµ–ï¼Œè·å¾—å¯¹è±¡å’Œjsonæˆ–xmlä¹‹é—´çš„è½¬[m
[31m-æ¢ï¼š[m
[31m-[m
[31m-       <!--å¯¹jsonå’Œxmlæ ¼å¼çš„æ”¯æŒ -->[m
[31m-                      <dependency>[m
[31m-                             <groupId>com.fasterxml.jackson.dataformat</groupId>[m
[31m-                             <artifactId>jackson-dataformat-xml</artifactId>[m
[31m-                             <version>2.5.3</version>[m
[31m-                      </dependency>[m
[31m-[m
[31m-     è¿™é‡Œç‰¹åˆ«æŒ‡å‡ºï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å…¶å®ä¸»è¦æ”¯æŒjsonæ•°[m
[31m-æ®ï¼Œæ²¡å¿…è¦åŒæ—¶æ”¯æŒjsonå’Œxmlï¼Œå› ä¸ºjsonæ¯”xmlæ›´ç®€æ´ã€‚ç”±äº[m
[31m-JavaScriptçš„å¹¿æ³›ä½¿ç”¨ï¼Œjsonæˆä¸ºæœ€æ¨èçš„æ ¼å¼ï¼Œåœ¨è¿™ç§æƒ…å†µ[m
[31m-ä¸‹ï¼Œæˆ‘ä»¬çš„ä¾èµ–åŒ…å¦‚ä¸‹ï¼ˆä¸Šé¢çš„ä¾èµ–åŒ…å«ä¸‹é¢çš„ä¾èµ–ï¼‰ï¼š[m
[31m-[m
[31m-       <dependency>[m
[31m-              <groupId>com.fasterxml.jackson.core</groupId>[m
[31m-              <artifactId>jackson-databind</artifactId>[m
[31m-              <version>2.5.3</version>[m
[31m-[m
[31m-       </dependency>[m
[31m-[m
[31m-     æ­¤ç±»ç”¨æ¥æ¼”ç¤ºè·å–requestå¯¹è±¡å‚æ•°å’Œè¿”å›æ­¤å¯¹è±¡åˆ°[m
[31m-responseï¼š[m
[31m-[m
[31m-       package com.wisely.highlight_springmvc4.domain;[m
[31m-[m
[31m-       public class DemoObj {[m
[31m-              private Long id;[m
[31m-              private String name;[m
[31m-[m
[31m-              public DemoObj() { // 1[m
[31m-                      super();[m
[31m-[m
[31m-              }[m
[31m-              public DemoObj(Long id, String name) {[m
[31m-[m
[31m-                      super();[m
[31m-                      this.id = id;[m
[31m-                      this.name = name;[m
[31m-              }[m
[31m-              public Long getId() {[m
[31m-                      return id;[m
[31m-              }[m
[31m-              public void setId(Long id) {[m
[31m-              this.id = id;[m
[31m-       }[m
[31m-       public String getName() {[m
[31m-[m
[31m-              return name;[m
[31m-       }[m
[31m-       public void setName(String name) {[m
[31m-[m
[31m-              this.name = name;[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ jacksonå¯¹å¯¹è±¡å’Œjsonåšè½¬æ¢æ—¶ä¸€å®šéœ€è¦æ­¤ç©ºæ„é€ ã€‚[m
[31m-[m
[31m-2.æ³¨è§£æ¼”ç¤ºæ§åˆ¶å™¨[m
[31m-[m
[31m-package com.wisely.highlight_springmvc4.web.ch4_3;[m
[31m-[m
[31m-import javax.servlet.http.HttpServletRequest;[m
[31m-[m
[31m-import org.springframework.stereotype.Controller;[m
[31m-import org.springframework.web.bind.annotation.PathVariable;[m
[31m-import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-import org.springframework.web.bind.annotation.ResponseBody;[m
[31m-[m
[31m-import com.wisely.highlight_springmvc4.domain.DemoObj;[m
[31m-[m
[31m-@Controller // 1[m
[31m-@RequestMapping("/anno") //2[m
[31m-public class DemoAnnoController {[m
[31m-[m
[31m-              @RequestMapping(produces = "text/plain;charset=UTF-[m
[31m-8") // 3[m
[31m-[m
[31m-       public @ResponseBody String index(HttpServletRequest request) { //[m
[31m-              return "url:" + request.getRequestURL() + " can access";[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       @RequestMapping(value = "/pathvar/{str}", produces = "text/plain;ch[m
[31m-8")// 5[m
[31m-[m
[31m-       public @ResponseBody String demoPathVar(@PathVariable String str,[m
[31m-                     HttpServletRequest request) {[m
[31m-[m
[31m-              return "url:" + request.getRequestURL() + " can access,str: " +[m
[31m-              }[m
[31m-[m
[31m-              @RequestMapping(value = "/requestParam", produces = "text/plain;cha[m
[31m-       8") //6[m
[31m-[m
[31m-              public @ResponseBody String passRequestParam(Long id,[m
[31m-                             HttpServletRequest request) {[m
[31m-[m
[31m-                      return "url:" + request.getRequestURL() + " can access,id: " +[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @RequestMapping(value = "/obj", produces = "application/json;charse[m
[31m-       8")//7[m
[31m-[m
[31m-              @ResponseBody //8[m
[31m-              public String passObj(DemoObj obj, HttpServletRequest request) {[m
[31m-[m
[31m-                       return "url:" + request.getRequestURL()[m
[31m-                                           + " can access, obj id: " + obj.getId()+" obj name:[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @RequestMapping(value = { "/name1", "/name2" }, produces = "text/pl[m
[31m-       8")//9[m
[31m-[m
[31m-              public @ResponseBody String remove(HttpServletRequest request) {[m
[31m-[m
[31m-                      return "url:" + request.getRequestURL() + " can access";[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ @Controlleræ³¨è§£å£°æ˜æ­¤ç±»æ˜¯ä¸€ä¸ªæ§åˆ¶å™¨ã€‚[m
[31m-[m
[31m-     â‘¡@RequestMappingï¼ˆâ€œ/annoâ€ï¼‰æ˜ å°„æ­¤ç±»çš„è®¿é—®è·¯å¾„[m
[31m-æ˜¯/annoã€‚[m
[31m-[m
[31m-     â‘¢æ­¤æ–¹æ³•æœªæ ‡æ³¨è·¯å¾„ï¼Œå› æ­¤ä½¿ç”¨ç±»çº§åˆ«çš„è·¯å¾„/annoï¼›[m
[31m-produceså¯å®šåˆ¶è¿”å›çš„responseçš„åª’ä½“ç±»å‹å’Œå­—ç¬¦é›†ï¼Œæˆ–éœ€è¿”å›[m
[31m-å€¼æ˜¯jsonå¯¹è±¡ï¼Œåˆ™è®¾ç½®produces=â€œapplication/jsonï¼›[m
[31m-charset=UTF-8â€ï¼Œåœ¨åé¢çš„ç« èŠ‚æˆ‘ä»¬ä¼šæ¼”ç¤ºæ­¤é¡¹ç‰¹æ€§ã€‚[m
[31m-     â‘£æ¼”ç¤ºå¯æ¥å—HttpServletRequestä½œä¸ºå‚æ•°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ¥[m
[31m-å—HttpServletReponseä½œä¸ºå‚æ•°ã€‚æ­¤å¤„çš„@ReponseBodyç”¨åœ¨è¿”[m
[31m-å›å€¼å‰é¢ã€‚[m
[31m-[m
[31m-     â‘¤æ¼”ç¤ºæ¥å—è·¯å¾„å‚æ•°ï¼Œå¹¶åœ¨æ–¹æ³•å‚æ•°å‰ç»“åˆ@PathVariable[m
[31m-ä½¿ç”¨ï¼Œè®¿é—®è·¯å¾„ä¸º/anno/pathvar/xxã€‚[m
[31m-[m
[31m-     â‘¥æ¼”ç¤ºå¸¸è§„çš„requestå‚æ•°è·å–ï¼Œè®¿é—®è·¯å¾„[m
[31m-ä¸º/anno/requestParamï¼Ÿid=1ã€‚[m
[31m-[m
[31m-     â‘¦æ¼”ç¤ºè§£é‡Šå‚æ•°åˆ°å¯¹è±¡ï¼Œè®¿é—®è·¯å¾„ä¸º/anno/objï¼Ÿ[m
[31m-id=1&name=xxã€‚[m
[31m-[m
[31m-     â‘§@ReponseBodyä¹Ÿå¯ä»¥ç”¨åœ¨æ–¹æ³•ä¸Šã€‚[m
[31m-[m
[31m-     â‘¨æ¼”ç¤ºæ˜ å°„ä¸åŒçš„è·¯å¾„åˆ°ç›¸åŒçš„æ–¹æ³•ï¼Œè®¿é—®è·¯å¾„[m
[31m-ä¸º/anno/name1æˆ–/anno/name2ã€‚[m
[31m-[m
[31m-     3.@RestControlleræ¼”ç¤º[m
[31m-[m
[31m-       package com.wisely.highlight_springmvc4.web.ch4_3;[m
[31m-[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-       import com.wisely.highlight_springmvc4.domain.DemoObj;[m
[31m-[m
[31m-       @RestController //1[m
[31m-       @RequestMapping("/rest")[m
[31m-       public class DemoRestController {[m
[31m-[m
[31m-                              @RequestMapping(value = "/getjson",produces=[m
[31m-       {"application/json;charset=UTF-8"}) //2[m
[31m-[m
[31m-              public DemoObj getjson (DemoObj obj){[m
[31m-                      return new DemoObj(obj.getId()+1, obj.getName()+"yy");//3[m
[31m-[m
[31m-              }[m
[31m-                               @RequestMapping(value = "/getxml",produces=[m
[31m-[m
[31m-       {"application/xml;charset=UTF-8"})//4[m
[31m-              public DemoObj getxml(DemoObj obj){[m
[31m-                      return new DemoObj(obj.getId()+1, obj.getName()+"yy");//5[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ ä½¿ç”¨@RestControllerï¼Œå£°æ˜æ˜¯æ§åˆ¶å™¨ï¼Œå¹¶ä¸”è¿”å›æ•°æ®æ—¶[m
[31m-ä¸éœ€è¦@ResponseBodyã€‚[m
[31m-     â‘¡è¿”å›æ•°æ®çš„åª’ä½“ç±»å‹ä¸ºjsonã€‚[m
[31m-     â‘¢ç›´æ¥è¿”å›å¯¹è±¡ï¼Œå¯¹è±¡ä¼šè‡ªåŠ¨è½¬æ¢æˆjsonã€‚[m
[31m-     â‘£è¿”å›æ•°æ®çš„åª’ä½“ç±»å‹ä¸ºxmlã€‚[m
[31m-     â‘¤ç›´æ¥è¿”å›å¯¹è±¡ï¼Œå¯¹è±¡ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºxmlã€‚[m
[31m-     ç»“æœå¦‚å›¾4-4å’Œå›¾4-5æ‰€ç¤ºã€‚[m
[31m-[m
[31m-  å›¾4-4ã€€è®¿é—®http://localhostï¼š8080/highlight_springmvc4/rest/getjsonï¼Ÿ[m
[31m-                                     id=1&name=xx[m
[31m-[m
[31m-   å›¾4-5ã€€è®¿é—®http://localhostï¼š8080/highlight_springmvc4/rest/getxmlï¼Ÿ[m
[31m-                                     id=1&name=xx[m
[31m-4.4ã€€Spring MVCåŸºæœ¬é…ç½®[m
[31m-[m
[31m-Spring  MVCçš„å®šåˆ¶é…ç½®éœ€è¦æˆ‘ä»¬çš„é…ç½®ç±»ç»§æ‰¿ä¸€ä¸ª[m
[31m-[m
[31m-WebMvcConfigurerAdapterç±»ï¼Œå¹¶åœ¨æ­¤ç±»ä½¿ç”¨@EnableWebMvc[m
[31m-[m
[31m-æ³¨è§£ï¼Œæ¥å¼€å¯å¯¹Spring MVCçš„é…ç½®æ”¯æŒï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é‡[m
[31m-[m
[31m-å†™è¿™ä¸ªç±»çš„æ–¹æ³•ï¼Œå®Œæˆæˆ‘ä»¬çš„å¸¸ç”¨é…ç½®ã€‚[m
[31m-[m
[31m-     æˆ‘ä»¬å°†å‰é¢çš„MyMvcConfigé…ç½®ç±»ç»§æ‰¿[m
[31m-WebMvcConfigurerAdapterï¼Œæœ¬ç« è‹¥ä¸åšç‰¹åˆ«è¯´æ˜ï¼Œåˆ™å…³äºé…[m
[31m-ç½®çš„ç›¸å…³å†…å®¹éƒ½åœ¨MyMvcConfigé‡Œç¼–å†™ã€‚[m
[31m-[m
[31m-4.4.1ã€€é™æ€èµ„æºæ˜ å°„[m
[31m-[m
[31m-     1.ç‚¹ç›[m
[31m-[m
[31m-     ç¨‹åºçš„é™æ€æ–‡ä»¶ï¼ˆjsã€cssã€å›¾ç‰‡ï¼‰ç­‰éœ€è¦ç›´æ¥è®¿é—®ï¼Œè¿™æ—¶[m
[31m-æˆ‘ä»¬å¯ä»¥åœ¨é…ç½®é‡Œé‡å†™addResourceHandlersæ–¹æ³•æ¥å®ç°ã€‚[m
[31m-[m
[31m-     2.ç¤ºä¾‹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ·»åŠ é™æ€èµ„æº[m
[31m-[m
[31m-     åŒä¸Šï¼Œæˆ‘ä»¬åœ¨src/main/resourcesä¸‹å»ºç«‹assets/jsç›®å½•ï¼Œå¹¶å¤[m
[31m-åˆ¶ä¸€ä¸ªjquery.jsæ”¾ç½®åœ¨æ­¤ç›®å½•ä¸‹ï¼Œå¦‚å›¾4-6æ‰€ç¤ºã€‚[m
[31m-          å›¾4-6ã€€å¤åˆ¶ä¸€ä¸ªjquery.jsæ”¾ç½®åœ¨assetsl.jsç›®å½•ä¸‹[m
[31m-[m
[31m-é…ç½®ä»£ç ï¼š[m
[31m-[m
[31m-package com.wisely.highlight_springmvc4;[m
[31m-[m
[31m-import org.springframework.context.annotation.Bean;[m
[31m-import org.springframework.context.annotation.ComponentScan;[m
[31m-import org.springframework.context.annotation.Configuration;[m
[31m-import org.springframework.web.servlet.config.annotation.EnableWebMvc;[m
[31m-import org.springframework.web.servlet.config.annotation.ResourceHandle[m
[31m-import org.springframework.web.servlet.config.annotation.WebMvcConfigur[m
[31m-import org.springframework.web.servlet.view.InternalResourceViewResolve[m
[31m-import org.springframework.web.servlet.view.JstlView;[m
[31m-[m
[31m-@Configuration[m
[31m-@EnableWebMvc//1[m
[31m-@ComponentScan("com.wisely.highlight_springmvc4")[m
[31m-public class MyMvcConfig extends WebMvcConfigurerAdapter{//2[m
[31m-[m
[31m-       @Bean[m
[31m-       public InternalResourceViewResolver viewResolver(){[m
[31m-[m
[31m-              InternalResourceViewResolver viewResolver =[m
[31m-                             new InternalResourceViewResolver();[m
[31m-[m
[31m-              viewResolver.setPrefix("/WEB-INF/classes/views/");[m
[31m-              viewResolver.setSuffix(".jsp");[m
[31m-              viewResolver.setViewClass(JstlView.class);[m
[31m-              return viewResolver;[m
[31m-       }[m
[31m-              @Override[m
[31m-              public void addResourceHandlers(ResourceHandlerRegistry registry) {[m
[31m-[m
[31m-                      registry.addResourceHandler("/assets/**").addResourceLocations([m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ @EnableWebMvcå¼€å¯SpringMVCæ”¯æŒï¼Œè‹¥æ— æ­¤å¥ï¼Œé‡å†™[m
[31m-WebMvcConfigurerAdapteræ–¹æ³•æ— æ•ˆã€‚[m
[31m-[m
[31m-     â‘¡ç»§æ‰¿WebMvcConfigurerAdapterç±»ï¼Œé‡å†™å…¶æ–¹æ³•å¯å¯¹[m
[31m-Spring MVCè¿›è¡Œé…ç½®ã€‚[m
[31m-[m
[31m-     â‘¢addResourceLocationsæŒ‡çš„æ˜¯æ–‡ä»¶æ”¾ç½®çš„ç›®å½•ï¼Œ[m
[31m-addResourceHandleræŒ‡çš„æ˜¯å¯¹å¤–æš´éœ²çš„è®¿é—®è·¯å¾„ã€‚[m
[31m-[m
[31m-4.4.2ã€€æ‹¦æˆªå™¨é…ç½®[m
[31m-[m
[31m-     1.ç‚¹ç›[m
[31m-     æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰å®ç°å¯¹æ¯ä¸€ä¸ªè¯·æ±‚å¤„ç†å‰åè¿›è¡Œç›¸å…³[m
[31m-çš„ä¸šåŠ¡å¤„ç†ï¼Œç±»ä¼¼äºServletçš„Filterã€‚[m
[31m-     å¯è®©æ™®é€šçš„Beanå®ç°HanlderInterceptoræ¥å£æˆ–è€…ç»§æ‰¿[m
[31m-HandlerInterceptorAdapterç±»æ¥å®ç°è‡ªå®šä¹‰æ‹¦æˆªå™¨ã€‚[m
[31m-     é€šè¿‡é‡å†™WebMvcConfigurerAdapterçš„addInterceptorsæ–¹æ³•[m
[31m-æ¥æ³¨å†Œè‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ï¼Œæœ¬èŠ‚æ¼”ç¤ºä¸€ä¸ªç®€å•çš„æ‹¦æˆªå™¨çš„å¼€å‘å’Œ[m
[31m-é…ç½®ï¼Œä¸šåŠ¡å«ä¹‰ä¸ºè®¡ç®—æ¯ä¸€æ¬¡è¯·æ±‚çš„å¤„ç†æ—¶é—´ã€‚[m
[31m-2.ç¤ºä¾‹[m
[31m-[m
[31m-ï¼ˆ1ï¼‰ç¤ºä¾‹æ‹¦æˆªå™¨ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_springmvc4.interceptor;[m
[31m-[m
[31m-import javax.servlet.http.HttpServletRequest;[m
[31m-import javax.servlet.http.HttpServletResponse;[m
[31m-[m
[31m-import org.springframework.web.servlet.ModelAndView;[m
[31m-import org.springframework.web.servlet.handler.HandlerInterceptorAdapte[m
[31m-[m
[31m-public class DemoInterceptor extends HandlerInterceptorAdapter {//1[m
[31m-[m
[31m-       @Override[m
[31m-       public boolean preHandle(HttpServletRequest request, //2[m
[31m-[m
[31m-                     HttpServletResponse response, Object handler) throws Except[m
[31m-              long startTime = System.currentTimeMillis();[m
[31m-              request.setAttribute("startTime", startTime);[m
[31m-              return true;[m
[31m-       }[m
[31m-[m
[31m-       @Override[m
[31m-       public void postHandle(HttpServletRequest request, //3[m
[31m-[m
[31m-                     HttpServletResponse response, Object handler,[m
[31m-                     ModelAndView modelAndView) throws Exception {[m
[31m-              long startTime = (Long) request.getAttribute("startTime");[m
[31m-              request.removeAttribute("startTime");[m
[31m-              long endTime = System.currentTimeMillis();[m
[31m-[m
[31m-                                                  System.out.println("æœ¬æ¬¡è¯·æ±‚å¤„ç†æ—¶é—´[m
[31m-ä¸º:" + new Long(endTime - startTime)+"ms");[m
[31m-[m
[31m-              request.setAttribute("handlingTime", endTime - startTime);[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ ç»§æ‰¿HandlerInterceptorAdapterç±»æ¥å®ç°è‡ªå®šä¹‰æ‹¦æˆªå™¨ã€‚[m
[31m-[m
[31m-â‘¡é‡å†™preHandleæ–¹æ³•ï¼Œåœ¨è¯·æ±‚å‘ç”Ÿå‰æ‰§è¡Œã€‚[m
[31m-     â‘¢é‡å†™postHandleæ–¹æ³•ï¼Œåœ¨è¯·æ±‚å®Œæˆåæ‰§è¡Œã€‚[m
[31m-     ï¼ˆ2ï¼‰é…ç½®ã€‚[m
[31m-[m
[31m-              @Bean //1[m
[31m-              public DemoInterceptor demoInterceptor(){[m
[31m-[m
[31m-                      return new DemoInterceptor();[m
[31m-              }[m
[31m-              @Override[m
[31m-              public void addInterceptors(InterceptorRegistry registry) {//2[m
[31m-              registry.addInterceptor(demoInterceptor());[m
[31m-              }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ é…ç½®æ‹¦æˆªå™¨çš„Beanã€‚[m
[31m-     â‘¡é‡å†™addInterceptorsæ–¹æ³•ï¼Œæ³¨å†Œæ‹¦æˆªå™¨ã€‚[m
[31m-     ï¼ˆ3ï¼‰è¿è¡Œã€‚åœ¨æµè§ˆå™¨è®¿é—®ä»»æ„è·¯å¾„ï¼Œå¦‚http://localhostï¼š[m
[31m-8080/highlight_springmvc4/indexï¼ŒæŸ¥çœ‹æ§åˆ¶å°å¦‚å›¾4-7æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                     å›¾4-7ã€€æ§åˆ¶å°[m
[31m-4.4.3ã€€@ControllerAdvice[m
[31m-[m
[31m-     1.ç‚¹ç›[m
[31m-[m
[31m-     é€šè¿‡@ControllerAdviceï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹äºæ§åˆ¶å™¨çš„å…¨å±€é…[m
[31m-ç½®æ”¾ç½®åœ¨åŒä¸€ä¸ªä½ç½®ï¼Œæ³¨è§£äº†@Controllerçš„ç±»çš„æ–¹æ³•å¯ä½¿ç”¨[m
[31m-@ExceptionHandlerã€@InitBinderã€@ModelAttributeæ³¨è§£åˆ°æ–¹[m
[31m-æ³•ä¸Šï¼Œè¿™å¯¹æ‰€æœ‰æ³¨è§£äº†@RequestMappingçš„æ§åˆ¶å™¨å†…çš„æ–¹æ³•æœ‰[m
[31m-æ•ˆã€‚[m
[31m-[m
[31m-     @ExceptionHandlerï¼šç”¨äºå…¨å±€å¤„ç†æ§åˆ¶å™¨é‡Œçš„å¼‚å¸¸ã€‚[m
[31m-[m
[31m-     @InitBinderï¼šç”¨æ¥è®¾ç½®WebDataBinderï¼ŒWebDataBinderç”¨[m
[31m-æ¥è‡ªåŠ¨ç»‘å®šå‰å°è¯·æ±‚å‚æ•°åˆ°Modelä¸­ã€‚[m
[31m-[m
[31m-     @ModelAttributeï¼š@ModelAttributeæœ¬æ¥çš„ä½œç”¨æ˜¯ç»‘å®šé”®å€¼[m
[31m-å¯¹åˆ°Modelé‡Œï¼Œæ­¤å¤„æ˜¯è®©å…¨å±€çš„@RequestMappingéƒ½èƒ½è·å¾—åœ¨[m
[31m-æ­¤å¤„è®¾ç½®çš„é”®å€¼å¯¹ã€‚[m
[31m-[m
[31m-     æœ¬èŠ‚å°†æ¼”ç¤ºä½¿ç”¨@ExceptionHandlerå¤„ç†å…¨å±€å¼‚å¸¸ï¼Œæ›´äººæ€§[m
[31m-åŒ–çš„å°†å¼‚å¸¸è¾“å‡ºç»™ç”¨æˆ·ã€‚[m
[31m-[m
[31m-     2.ç¤ºä¾‹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰å®šåˆ¶ControllerAdviceã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_springmvc4.advice;[m
[31m-[m
[31m-       import org.springframework.ui.Model;[m
[31m-       import org.springframework.web.bind.WebDataBinder;[m
[31m-       import org.springframework.web.bind.annotation.ControllerAdvice;[m
[31m-       import org.springframework.web.bind.annotation.ExceptionHandler;[m
[31m-       import org.springframework.web.bind.annotation.InitBinder;[m
[31m-       import org.springframework.web.bind.annotation.ModelAttribute;[m
[31m-       import org.springframework.web.context.request.WebRequest;[m
[31m-import org.springframework.web.servlet.ModelAndView;[m
[31m-[m
[31m-@ControllerAdvice //1[m
[31m-public class ExceptionHandlerAdvice {[m
[31m-[m
[31m-    @ExceptionHandler(value = Exception.class) //2[m
[31m-[m
[31m-    public ModelAndView exception(Exception exception, WebRequest reque[m
[31m-[m
[31m-       ModelAndView modelAndView = new ModelAndView("error");// error[m
[31m-[m
[31m-é¡µé¢[m
[31m-[m
[31m-       modelAndView.addObject("errorMessage", exception.getMessage());[m
[31m-[m
[31m-       return modelAndView;[m
[31m-[m
[31m-    }[m
[31m-[m
[31m-    @ModelAttribute //3[m
[31m-[m
[31m-    public void addAttributes(Model model) {[m
[31m-           model.addAttribute("msg", "é¢å¤–ä¿¡æ¯"); //3[m
[31m-[m
[31m-    }[m
[31m-[m
[31m-       @InitBinder //4[m
[31m-       public void initBinder(WebDataBinder webDataBinder) {[m
[31m-[m
[31m-              webDataBinder.setDisallowedFields("id"); //5[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ @ControllerAdviceå£°æ˜ä¸€ä¸ªæ§åˆ¶å™¨å»ºè¨€ï¼Œ[m
[31m-@ControllerAdviceç»„åˆäº†@Componentæ³¨è§£ï¼Œæ‰€ä»¥è‡ªåŠ¨æ³¨å†Œä¸º[m
[31m-Springçš„Beanã€‚[m
[31m-[m
[31m-     â‘¡@ExceptionHandleråœ¨æ­¤å¤„å®šä¹‰å…¨å±€å¤„ç†ï¼Œé€šè¿‡[m
[31m-@ExceptionHandlerçš„valueå±æ€§å¯è¿‡æ»¤æ‹¦æˆªçš„æ¡ä»¶ï¼Œåœ¨æ­¤å¤„æˆ‘[m
[31m-ä»¬å¯ä»¥çœ‹å‡ºæˆ‘ä»¬æ‹¦æˆªæ‰€æœ‰çš„Exceptionã€‚[m
[31m-[m
[31m-     â‘¢æ­¤å¤„ä½¿ç”¨@ModelAttributeæ³¨è§£å°†é”®å€¼å¯¹æ·»åŠ åˆ°å…¨å±€ï¼Œæ‰€[m
[31m-æœ‰æ³¨è§£çš„@RequestMappingçš„æ–¹æ³•å¯è·å¾—æ­¤é”®å€¼å¯¹ã€‚[m
[31m-[m
[31m-     â‘£é€šè¿‡@InitBinderæ³¨è§£å®šåˆ¶WebDataBinderã€‚[m
[31m-     â‘¤æ­¤å¤„æ¼”ç¤ºå¿½ç•¥requestå‚æ•°çš„idï¼Œæ›´å¤šå…³äºWebDataBinder[m
[31m-çš„é…ç½®ï¼Œè¯·å‚è€ƒWebDataBinderçš„APIæ–‡æ¡£ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰æ¼”ç¤ºæ§åˆ¶å™¨ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_springmvc4.web.ch4_4;[m
[31m-[m
[31m-       import org.springframework.stereotype.Controller;[m
[31m-       import org.springframework.web.bind.annotation.ModelAttribute;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-[m
[31m-       import com.wisely.highlight_springmvc4.domain.DemoObj;[m
[31m-[m
[31m-       @Controller[m
[31m-       public class AdviceController {[m
[31m-[m
[31m-              @RequestMapping("/advice")[m
[31m-              public String getSomething(@ModelAttribute("msg") String msg,DemoOb[m
[31m-       {//1[m
[31m-[m
[31m-                           throw new IllegalArgumentException("éå¸¸æŠ±æ­‰ï¼Œå‚æ•°æœ‰[m
[31m-       è¯¯/"+"æ¥è‡ª@ModelAttribute:"+ msg);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-ï¼ˆ3ï¼‰å¼‚å¸¸å±•ç¤ºé¡µé¢ã€‚[m
[31m-åœ¨src/main/resources/viewsä¸‹ï¼Œæ–°å»ºerror.jspï¼Œå†…å®¹å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>[m
[31m-[m
[31m-<%@ page language="java" contentType="text/html; charset=UTF-[m
[31m-[m
[31m-8"[m
[31m-[m
[31m-    pageEncoding="UTF-8"%>[m
[31m-[m
[31m-<!DOCTYPE  html                        PUBLIC  "-[m
[31m-[m
[31m-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loos[m
[31m-[m
[31m-<html>[m
[31m-[m
[31m-<head>[m
[31m-[m
[31m-<meta                                  http-equiv="Content-[m
[31m-[m
[31m-Type" content="text/html; charset=UTF-8">[m
[31m-[m
[31m-<title>@ControllerAdvice Demo</title>[m
[31m-       </head>[m
[31m-       <body>[m
[31m-[m
[31m-              ${errorMessage}[m
[31m-       </body>[m
[31m-       </html>[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰è¿è¡Œã€‚[m
[31m-     è®¿é—®http://localhostï¼š8080/highlight_springmvc4/adviceï¼Ÿ[m
[31m-id=1&name=xxã€‚[m
[31m-     è°ƒè¯•æŸ¥çœ‹DemoObjï¼Œidè¢«è¿‡æ»¤æ‰äº†ï¼Œä¸”è·å¾—äº†[m
[31m-@ModelAttributeçš„msgä¿¡æ¯ï¼Œå¦‚å›¾4-8æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                    å›¾4-8ã€€é¡µé¢æ•ˆæœ[m
[31m-[m
[31m-     é¡µé¢æ•ˆæœå¦‚å›¾4-9æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                    å›¾4-9ã€€é¡µé¢æ•ˆæœ[m
[31m-[m
[31m-4.4.4ã€€å…¶ä»–é…ç½®[m
[31m-[m
[31m-     1.å¿«æ·çš„ViewController[m
[31m-     åœ¨4.2.2èŠ‚æˆ‘ä»¬é…ç½®é¡µé¢è½¬å‘çš„æ—¶å€™ä½¿ç”¨çš„ä»£ç å¦‚ä¸‹ï¼š[m
[31m-              @RequestMapping("/index")//2[m
[31m-              public String hello(){[m
[31m-[m
[31m-                      return "index"; //3[m
[31m-              }[m
[31m-[m
[31m-     æ­¤å¤„æ— ä»»ä½•ä¸šåŠ¡å¤„ç†ï¼Œåªæ˜¯ç®€å•çš„é¡µé¢è½¬å‘ï¼Œå†™äº†è‡³å°‘ä¸‰[m
[31m-è¡Œæœ‰æ•ˆä»£ç ï¼›åœ¨å®é™…å¼€å‘ä¸­ä¼šæ¶‰åŠå¤§é‡è¿™æ ·çš„é¡µé¢è½¬å‘ï¼Œè‹¥éƒ½[m
[31m-è¿™æ ·å†™ä¼šå¾ˆéº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨é…ç½®ä¸­é‡å†™[m
[31m-addViewControllersæ¥ç®€åŒ–é…ç½®ï¼š[m
[31m-[m
[31m-       @Override[m
[31m-              public void addViewControllers(ViewControllerRegistry registry) {[m
[31m-                      registry.addViewController("/index").setViewName("/index");[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     è¿™æ ·å®ç°çš„ä»£ç æ›´ç®€æ´ï¼Œç®¡ç†æ›´é›†ä¸­ã€‚[m
[31m-     2.è·¯å¾„åŒ¹é…å‚æ•°é…ç½®[m
[31m-     åœ¨Spring MVCä¸­ï¼Œè·¯å¾„å‚æ•°å¦‚æœå¸¦â€œ.â€çš„è¯ï¼Œâ€œ.â€åé¢çš„å€¼[m
[31m-å°†è¢«å¿½ç•¥ï¼Œä¾‹å¦‚ï¼Œè®¿é—®http://localhostï¼š[m
[31m-8080/highlight_springmvc4/anno/pathvar/xx.yyï¼Œæ­¤æ—¶â€œ.â€åé¢çš„[m
[31m-yyè¢«å¿½ç•¥ï¼Œå¦‚å›¾4-10æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾4-10ã€€å¿½ç•¥â€œ.â€åé¢çš„yy[m
[31m-[m
[31m-     é€šè¿‡é‡å†™configurePathMatchæ–¹æ³•å¯ä¸å¿½ç•¥â€œ.â€åé¢çš„å‚æ•°ï¼Œ[m
[31m-ä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-              @Override[m
[31m-              public void configurePathMatch(PathMatchConfigurer configurer) {[m
[31m-                configurer.setUseSuffixPatternMatch(false);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-     è¿™æ—¶å†è®¿é—®http://localhostï¼š[m
[31m-8080/highlight_springmvc4/anno/pathvar/xx.yyï¼Œå°±å¯ä»¥æ¥[m
[31m-å—â€œ.â€åé¢çš„yyäº†ï¼Œå¦‚å›¾4-11æ‰€ç¤ºã€‚[m
[31m-[m
[31m-        å›¾4-11ã€€æ¥å—â€œ.â€åé¢yy[m
[31m-[m
[31m-3.æ›´å¤šé…ç½®[m
[31m-[m
[31m-     æ›´å¤šé…ç½®è¯·æŸ¥çœ‹WebMvcConfigurerAdapterç±»çš„APIã€‚å› å…¶[m
[31m-æ˜¯WebMvcConfigureræ¥å£çš„å®ç°ï¼Œæ‰€ä»¥WebMvcConfigurerçš„[m
[31m-APIå†…çš„æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨æ¥é…ç½®MVCã€‚ä¸‹é¢æˆ‘ä»¬åˆ—å‡ºäº†[m
[31m-WebMvcConfigurerAdapterå’ŒWebMvcConfigurerçš„æºç ã€‚[m
[31m-[m
[31m-4.WebMvcConfigurerAdapter[m
[31m-[m
[31m-public abstract class WebMvcConfigurerAdapter implements WebMvcConfigur[m
[31m-       @Override[m
[31m-       public void addFormatters(FormatterRegistry registry) {[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void configureMessageConverters(List<HttpMessageConverter<?[m
[31m-[m
[31m->> converters) {[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void extendMessageConverters(List<HttpMessageConverter<?[m
[31m-[m
[31m->> converters) {[m
[31m-       }[m
[31m-       @Override[m
[31m-       public Validator getValidator() {[m
[31m-              return null;[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void configureContentNegotiation(ContentNegotiationConfigure[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void configureAsyncSupport(AsyncSupportConfigurer configurer[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void configurePathMatch(PathMatchConfigurer configurer) {[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void addArgumentResolvers(List<HandlerMethodArgumentResolver[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void addReturnValueHandlers(List<HandlerMethodReturnValueHan[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void configureHandlerExceptionResolvers(List<HandlerExceptio[m
[31m-       }[m
[31m-       @Override[m
[31m-       public MessageCodesResolver getMessageCodesResolver() {[m
[31m-[m
[31m-              return null;[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void addInterceptors(InterceptorRegistry registry) {[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void addViewControllers(ViewControllerRegistry registry) {[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void configureViewResolvers(ViewResolverRegistry registry) {[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void addResourceHandlers(ResourceHandlerRegistry registry) {[m
[31m-       }[m
[31m-       @Override[m
[31m-       public void configureDefaultServletHandling(DefaultServletHandlerCo[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-5.WebMvcConfigurer[m
[31m-[m
[31m-public interface WebMvcConfigurer {[m
[31m-       void addFormatters(FormatterRegistry registry);[m
[31m-       void configureMessageConverters(List<HttpMessageConverter<?[m
[31m->> converters);[m
[31m-        void extendMessageConverters(List<HttpMessageConverter<?[m
[31m->> converters);[m
[31m-       Validator getValidator();[m
[31m-       void configureContentNegotiation(ContentNegotiationConfigurer confi[m
[31m-       void configureAsyncSupport(AsyncSupportConfigurer configurer);[m
[31m-       void configurePathMatch(PathMatchConfigurer configurer);[m
[31m-       void addArgumentResolvers(List<HandlerMethodArgumentResolver> argum[m
[31m-[m
[31m-       void addReturnValueHandlers(List<HandlerMethodReturnValueHandler> r[m
[31m-       void configureHandlerExceptionResolvers(List<HandlerExceptionResolv[m
[31m-       void addInterceptors(InterceptorRegistry registry);[m
[31m-       MessageCodesResolver getMessageCodesResolver();[m
[31m-       void addViewControllers(ViewControllerRegistry registry);[m
[31m-       void configureViewResolvers(ViewResolverRegistry registry);[m
[31m-       void addResourceHandlers(ResourceHandlerRegistry registry);[m
[31m-       void configureDefaultServletHandling(DefaultServletHandlerConfigure[m
[31m-[m
[31m-}[m
[31m-4.5ã€€Spring MVCçš„é«˜çº§é…ç½®[m
[31m-[m
[31m-4.5.1ã€€æ–‡ä»¶ä¸Šä¼ é…ç½®[m
[31m-[m
[31m-     1.ç‚¹ç›[m
[31m-[m
[31m-     æ–‡ä»¶ä¸Šä¼ æ˜¯ä¸€ä¸ªé¡¹ç›®é‡Œç»å¸¸è¦ç”¨çš„åŠŸèƒ½ï¼ŒSpring MVCé€šè¿‡[m
[31m-é…ç½®ä¸€ä¸ªMultipartResolveræ¥ä¸Šä¼ æ–‡ä»¶ã€‚[m
[31m-[m
[31m-     åœ¨Springçš„æ§åˆ¶å™¨ä¸­ï¼Œé€šè¿‡MultipartFile fileæ¥æ¥æ”¶æ–‡ä»¶ï¼Œ[m
[31m-é€šè¿‡MultipartFile[]filesæ¥æ”¶å¤šä¸ªæ–‡ä»¶ä¸Šä¼ ã€‚[m
[31m-[m
[31m-     2.ç¤ºä¾‹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ·»åŠ æ–‡ä»¶ä¸Šä¼ ä¾èµ–ã€‚[m
[31m-[m
[31m-                      <!-- file upload -->[m
[31m-                      <dependency>[m
[31m-[m
[31m-                             <groupId>commons-fileupload</groupId>[m
[31m-                             <artifactId>commons-fileupload</artifactId>[m
[31m-                             <version>1.3.1</version>[m
[31m-                      </dependency>[m
[31m-                      <!-- éå¿…éœ€ï¼Œå¯ç®€åŒ–I/Oæ“ä½œ -->[m
[31m-                      <dependency>[m
[31m-                             <groupId>commons-io</groupId>[m
[31m-                             <artifactId>commons-io</artifactId>[m
[31m-                             <version>2.3</version>[m
[31m-                      </dependency>[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰ä¸Šä¼ é¡µé¢ã€‚åœ¨src/main/resources/viewsä¸‹æ–°å»º[m
[31m-upload.jspã€‚[m
[31m-<%@ page language="java" contentType="text/html; charset=UTF-[m
[31m-[m
[31m-8"[m
[31m-[m
[31m-    pageEncoding="UTF-8"%>[m
[31m-[m
[31m-<!DOCTYPE  html             PUBLIC                     "-[m
[31m-[m
[31m-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loos[m
[31m-[m
[31m-<html>[m
[31m-[m
[31m-<head>[m
[31m-[m
[31m-<meta                       http-equiv="Content-[m
[31m-[m
[31m-Type" content="text/html; charset=UTF-8">[m
[31m-[m
[31m-<title>upload page</title>[m
[31m-[m
[31m-</head>[m
[31m-<body>[m
[31m-[m
[31m-<div class="upload">[m
[31m-                    <form action="upload" enctype="multipart/form-[m
[31m-[m
[31m-data" method="post">[m
[31m-              <input type="file" name="file"/><br/>[m
[31m-              <input type="submit" value="ä¸Šä¼ ">[m
[31m-[m
[31m-       </form>[m
[31m-</div>[m
[31m-[m
[31m-</body>[m
[31m-</html>[m
[31m-[m
[31m-ï¼ˆ3ï¼‰æ·»åŠ è½¬å‘åˆ°uploadé¡µé¢çš„ViewControllerã€‚[m
[31m-[m
[31m-       @Override[m
[31m-       public void addViewControllers(ViewControllerRegistry registry) {[m
[31m-[m
[31m-              registry.addViewController("/index").setViewName("/index");[m
[31m-              registry.addViewController("/toUpload").setViewName("/upload");[m
[31m-       }[m
[31m-[m
[31m-ï¼ˆ4ï¼‰MultipartResolveré…ç½®ã€‚[m
[31m-[m
[31m-@Bean[m
[31m-       public MultipartResolver multipartResolver() {[m
[31m-              CommonsMultipartResolver multipartResolver =[m
[31m-new CommonsMultipartResolver();[m
[31m-[m
[31m-              multipartResolver.setMaxUploadSize(1000000);[m
[31m-              return multipartResolver;[m
[31m-       }[m
[31m-[m
[31m-ï¼ˆ5ï¼‰æ§åˆ¶å™¨ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_springmvc4.web.ch4_5;[m
[31m-[m
[31m-import java.io.File;[m
[31m-import java.io.IOException;[m
[31m-[m
[31m-import org.apache.commons.io.FileUtils;[m
[31m-import org.springframework.stereotype.Controller;[m
[31m-import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-import org.springframework.web.bind.annotation.RequestMethod;[m
[31m-import org.springframework.web.bind.annotation.ResponseBody;[m
[31m-import org.springframework.web.multipart.MultipartFile;[m
[31m-[m
[31m-@Controller[m
[31m-public class UploadController {[m
[31m-[m
[31m-       @RequestMapping(value = "/upload",method = RequestMethod.POST)[m
[31m-       public @ResponseBody String upload(MultipartFile file) {//1[m
[31m-[m
[31m-                     try {[m
[31m-                             FileUtils.writeByteArrayToFile(new File("e:/upload/"+fi[m
[31m-                                           file.getBytes()); //2[m
[31m-                             return "ok";[m
[31m-[m
[31m-                     } catch (IOException e) {[m
[31m-                             e.printStackTrace();[m
[31m-                             return "wrong";[m
[31m-[m
[31m-                     }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-     â‘ ä½¿ç”¨MultipartFile fileæ¥å—ä¸Šä¼ çš„æ–‡ä»¶ã€‚[m
[31m-     â‘¡ä½¿ç”¨FileUtils.writeByteArrayToFileå¿«é€Ÿå†™æ–‡ä»¶åˆ°ç£ç›˜ã€‚[m
[31m-     ï¼ˆ6ï¼‰è¿è¡Œã€‚è®¿é—®http://localhostï¼š[m
[31m-8080/highlight_springmvc4/toUploadï¼Œå¦‚å›¾4-12æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                      å›¾4-12ã€€è®¿é—®[m
[31m-[m
[31m-     å•å‡»â€œä¸Šä¼ â€æŒ‰é’®åï¼ŒæŸ¥çœ‹eï¼š\uploadæ–‡ä»¶å¤¹ï¼Œå¦‚å›¾4-13æ‰€[m
[31m-ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾4-13ã€€æŸ¥çœ‹uploadæ–‡ä»¶å¤¹[m
[31m-[m
[31m-4.5.2ã€€è‡ªå®šä¹‰HttpMessageConverter[m
[31m-[m
[31m-     1.ç‚¹ç›[m
[31m-     HttpMessageConverteræ˜¯ç”¨æ¥å¤„ç†requestå’Œresponseé‡Œçš„æ•°[m
[31m-æ®çš„ã€‚Springä¸ºæˆ‘ä»¬å†…ç½®äº†å¤§é‡çš„HttpMessageConverterï¼Œä¾‹[m
[31m-å¦‚ï¼ŒMappingJackson2HttpMessageConverterã€[m
[31m-[m
[31m-StringHttpMessage  Converterç­‰ã€‚æœ¬èŠ‚å°†æ¼”ç¤ºè‡ªå®šä¹‰çš„[m
[31m-[m
[31m-HttpMessageConverterï¼Œå¹¶æ³¨å†Œè¿™ä¸ªHttpMessageConverteråˆ°[m
[31m-[m
[31m-Spring MVCã€‚[m
[31m-[m
[31m-2.ç¤ºä¾‹[m
[31m-[m
[31m-ï¼ˆ1ï¼‰è‡ªå®šä¹‰HttpMessageConverterã€‚[m
[31m-[m
[31m-package com.wisely.highlight_springmvc4.messageconverter;[m
[31m-[m
[31m-import java.io.IOException;[m
[31m-import java.nio.charset.Charset;[m
[31m-[m
[31m-import org.springframework.http.HttpInputMessage;[m
[31m-import org.springframework.http.HttpOutputMessage;[m
[31m-import org.springframework.http.MediaType;[m
[31m-import org.springframework.http.converter.AbstractHttpMessageConverter;[m
[31m-import org.springframework.http.converter.HttpMessageNotReadableExcepti[m
[31m-import org.springframework.http.converter.HttpMessageNotWritableExcepti[m
[31m-import org.springframework.util.StreamUtils;[m
[31m-[m
[31m-import com.wisely.highlight_springmvc4.domain.DemoObj;[m
[31m-[m
[31m-public class MyMessageConverter extends AbstractHttpMessageConverter<De[m
[31m-[m
[31m-       public MyMessageConverter() {                                    "x-[m
[31m-                                    super(new MediaType("application",[m
[31m-[m
[31m-wisely",Charset.forName("UTF-8")));//2[m
[31m-       }[m
[31m-[m
[31m-/**[m
[31m- *3[m
[31m- */[m
[31m-[m
[31m-@Override[m
[31m-protected DemoObj readInternal(Class<? extends DemoObj> clazz,[m
[31m-[m
[31m-              HttpInputMessage inputMessage) throws IOException,[m
[31m-              HttpMessageNotReadableException {[m
[31m-       String temp = StreamUtils.copyToString(inputMessage.getBody(),[m
[31m-[m
[31m-      Charset.forName("UTF-8"));[m
[31m-      String[] tempArr = temp.split("-");[m
[31m-                      return new DemoObj(new Long(tempArr[0]), tempArr[1]);[m
[31m-              }[m
[31m-[m
[31m-              /**[m
[31m-                *4[m
[31m-                */[m
[31m-[m
[31m-              @Override[m
[31m-              protected boolean supports(Class<?> clazz) {[m
[31m-[m
[31m-                      return DemoObj.class.isAssignableFrom(clazz);[m
[31m-              }[m
[31m-[m
[31m-              /**[m
[31m-                *5[m
[31m-                */[m
[31m-[m
[31m-              @Override[m
[31m-              protected void writeInternal(DemoObj obj, HttpOutputMessage outputM[m
[31m-[m
[31m-                             throws IOException, HttpMessageNotWritableException {[m
[31m-                      String out = "hello:" + obj.getId() + "-"[m
[31m-[m
[31m-                                    + obj.getName();[m
[31m-                      outputMessage.getBody().write(out.getBytes());[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ç»§æ‰¿AbstractHttpMessageConverteræ¥å£æ¥å®ç°è‡ªå®šä¹‰çš„[m
[31m-HttpMessageConverterã€‚[m
[31m-[m
[31m-     â‘¡æ–°å»ºä¸€ä¸ªæˆ‘ä»¬è‡ªå®šä¹‰çš„åª’ä½“ç±»å‹application/x-wiselyã€‚[m
[31m-[m
[31m-     â‘¢é‡å†™readIntenalæ–¹æ³•ï¼Œå¤„ç†è¯·æ±‚çš„æ•°æ®ã€‚ä»£ç è¡¨æ˜æˆ‘ä»¬[m
[31m-å¤„ç†ç”±â€œ-â€éš”å¼€çš„æ•°æ®ï¼Œå¹¶è½¬æˆDemoObjçš„å¯¹è±¡ã€‚[m
[31m-[m
[31m-     â‘£è¡¨æ˜æœ¬HttpMessageConverteråªå¤„ç†DemoObjè¿™ä¸ªç±»ã€‚[m
[31m-[m
[31m-     â‘¤é‡å†™writeInternalï¼Œå¤„ç†å¦‚ä½•è¾“å‡ºæ•°æ®åˆ°responseã€‚æ­¤ä¾‹[m
[31m-ä¸­ï¼Œæˆ‘ä»¬åœ¨åŸæ ·è¾“å‡ºå‰é¢åŠ ä¸Šâ€œhelloï¼šâ€ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰é…ç½®ã€‚åœ¨addViewControllersä¸­æ·»åŠ viewControlleræ˜ [m
[31m-å°„é¡µé¢è®¿é—®æ¼”ç¤ºé¡µé¢ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       registry.addViewController("/converter").setViewName("/converter");[m
[31m-[m
[31m-     é…ç½®è‡ªå®šä¹‰çš„HttpMessageConverterçš„Beanï¼Œåœ¨Spring[m
[31m-MVCé‡Œæ³¨å†ŒHttpMessageConverteræœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š[m
[31m-[m
[31m-     configureMessageConvertersï¼šé‡è½½ä¼šè¦†ç›–æ‰Spring MVCé»˜[m
[31m-     è®¤æ³¨å†Œçš„å¤šä¸ªHttpMessageConverterã€‚[m
[31m-     extendMessageConvertersï¼šä»…æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„[m
[31m-     HttpMessageConverterï¼Œä¸è¦†ç›–é»˜è®¤æ³¨å†Œçš„[m
[31m-     HttpMessageConverterã€‚[m
[31m-     æ‰€ä»¥åœ¨æ­¤ä¾‹ä¸­æˆ‘ä»¬é‡å†™extendMessageConvertersï¼š[m
[31m-[m
[31m-              @Override[m
[31m-              public void extendMessageConverters(List<HttpMessageConverter<?[m
[31m-       >> converters) {[m
[31m-[m
[31m-                      converters.add(converter());[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              public MyMessageConverter converter(){[m
[31m-[m
[31m-                      return new MyMessageConverter();[m
[31m-              }[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰æ¼”ç¤ºæ§åˆ¶å™¨ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_springmvc4.web.ch4_5;[m
[31m-[m
[31m-       import org.springframework.stereotype.Controller;[m
[31m-       import org.springframework.web.bind.annotation.RequestBody;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-import org.springframework.web.bind.annotation.ResponseBody;[m
[31m-[m
[31m-import com.wisely.highlight_springmvc4.domain.DemoObj;[m
[31m-[m
[31m-@Controller[m
[31m-public class ConverterController {[m
[31m-[m
[31m-       @RequestMapping(value = "/convert", produces = { "application/x-[m
[31m-wisely" }) //1[m
[31m-[m
[31m-       public @ResponseBody DemoObj convert(@RequestBody DemoObj demoObj)[m
[31m-[m
[31m-              return demoObj;[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ æŒ‡å®šè¿”å›çš„åª’ä½“ç±»å‹ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„åª’ä½“ç±»å‹[m
[31m-application/x-wiselyã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰æ¼”ç¤ºé¡µé¢ã€‚åœ¨src/main/resourcesä¸‹æ–°å»ºconventer.jspï¼š[m
[31m-[m
[31m-<%@ page language="java" contentType="text/html; charset=UTF-[m
[31m-[m
[31m-8"[m
[31m-[m
[31m-    pageEncoding="UTF-8"%>[m
[31m-[m
[31m-<!DOCTYPE            html         PUBLIC            "-[m
[31m-[m
[31m-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loos[m
[31m-[m
[31m-<html>[m
[31m-[m
[31m-<head>[m
[31m-[m
[31m-<meta                                     http-equiv="Content-[m
[31m-[m
[31m-Type" content="text/html; charset=UTF-8">[m
[31m-[m
[31m-<title>HttpMessageConverter Demo</title>[m
[31m-[m
[31m-</head>[m
[31m-[m
[31m-<body>[m
[31m-[m
[31m-                            <div           id="resp"></div>[m
[31m-[m
[31m-<input type="button" onclick="req();" value="è¯·æ±‚"/>[m
[31m-[m
[31m-<script src="assets/js/jquery.js" type="text/javascript">[m
[31m-[m
[31m-</script>[m
[31m-[m
[31m-<script>[m
[31m-[m
[31m-    function req(){[m
[31m-                      $.ajax({[m
[31m-                             url: "convert",[m
[31m-                             data: "1-wangyunfei", //1[m
[31m-                             type:"POST",[m
[31m-                             contentType:"application/x-wisely", //2[m
[31m-                             success: function(data){[m
[31m-                                    $("#resp").html(data);[m
[31m-                             }[m
[31m-[m
[31m-                      });[m
[31m-              }[m
[31m-[m
[31m-       </script>[m
[31m-       </body>[m
[31m-       </html>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ æ³¨æ„è¿™é‡Œçš„æ•°æ®æ ¼å¼ï¼Œåå°å¤„ç†æŒ‰æ­¤æ ¼å¼å¤„ç†ï¼Œç”¨â€œ-â€éš”[m
[31m-å¼€ã€‚[m
[31m-[m
[31m-     â‘¡contentTypeè®¾ç½®çš„åª’ä½“ç±»å‹æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„[m
[31m-application/x-wiselyã€‚[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰è¿è¡Œã€‚è®¿é—®http://localhostï¼š[m
[31m-8080/highlight_springmvc4/converterï¼Œå¦‚å›¾4-14æ‰€ç¤ºã€‚[m
[31m-[m
[31m-    å›¾4-14ã€€è®¿é—®http://localhostï¼š8080/highlight_springmvc4/converter[m
[31m-[m
[31m-     å•å‡»â€œè¯·æ±‚â€æŒ‰é’®ï¼Œåšå¦‚ä¸‹è§‚å¯Ÿã€‚[m
[31m-[m
[31m-     è¯·æ±‚ç±»å‹å¦‚å›¾4-15æ‰€ç¤ºã€‚[m
[31m-                                   å›¾4-15ã€€è¯·æ±‚ç±»å‹[m
[31m-[m
[31m-     åå°è·å¾—æˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®æ ¼å¼ï¼Œå¦‚å›¾4-16æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾4-16ã€€è‡ªå®šä¹‰çš„æ•°æ®æ ¼å¼[m
[31m-[m
[31m-     é¡µé¢æ•ˆæœå¦‚å›¾4-17æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾4-17ã€€é¡µé¢æ•ˆæœ[m
[31m-[m
[31m-4.5.3ã€€æœåŠ¡å™¨ç«¯æ¨é€æŠ€æœ¯[m
[31m-[m
[31m-     æœåŠ¡ç«¯æ¨é€æŠ€æœ¯åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­è¾ƒä¸ºå¸¸ç”¨ï¼Œå¯èƒ½æ—©æœŸå¾ˆ[m
[31m-å¤šäººçš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨Ajaxå‘æœåŠ¡å™¨è½®è¯¢æ¶ˆæ¯ï¼Œä½¿æµè§ˆå™¨å°½å¯[m
[31m-èƒ½ç¬¬ä¸€æ—¶é—´è·å¾—æœåŠ¡ç«¯çš„æ¶ˆæ¯ï¼Œå› ä¸ºè¿™ç§æ–¹å¼çš„è½®è¯¢é¢‘ç‡ä¸å¥½[m
[31m-æ§åˆ¶ï¼Œæ‰€ä»¥å¤§å¤§å¢åŠ äº†æœåŠ¡ç«¯çš„å‹åŠ›ã€‚[m
[31m-[m
[31m-     æœ¬èŠ‚æ‰€æœ‰çš„æœåŠ¡å™¨ç«¯æ¨é€çš„æ–¹æ¡ˆéƒ½æ˜¯åŸºäºï¼šå½“å®¢æˆ·ç«¯å‘æœ[m
[31m-åŠ¡ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¼šæŠ“ä½è¿™ä¸ªè¯·æ±‚ä¸æ”¾ï¼Œç­‰æœ‰æ•°æ®æ›´æ–°çš„[m
[31m-æ—¶å€™æ‰è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå½“å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå†å‘æœåŠ¡ç«¯å‘[m
[31m-é€è¯·æ±‚ï¼Œå‘¨è€Œå¤å§‹ã€‚è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯å‡å°‘äº†æœåŠ¡å™¨çš„è¯·æ±‚æ•°[m
[31m-é‡ï¼Œå¤§å¤§å‡å°‘äº†æœåŠ¡å™¨çš„å‹åŠ›ã€‚[m
[31m-[m
[31m-     é™¤äº†æœåŠ¡å™¨ç«¯æ¨é€æŠ€æœ¯ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¦å¤–çš„åŒå‘é€šä¿¡çš„[m
[31m-æŠ€æœ¯â€”â€”WebSocketï¼Œæˆ‘ä»¬å°†åœ¨æœ¬ä¹¦ç¬¬ä¸‰éƒ¨åˆ†å®æˆ˜Spring Boot[m
[31m-ä¸­æ¼”ç¤ºã€‚[m
[31m-[m
[31m-     æœ¬èŠ‚å°†æä¾›åŸºäºSSEï¼ˆServer Send EventæœåŠ¡ç«¯å‘é€äº‹ä»¶ï¼‰[m
[31m-çš„æœåŠ¡å™¨ç«¯æ¨é€å’ŒåŸºäºServlet 3.0+çš„å¼‚æ­¥æ–¹æ³•ç‰¹æ€§ï¼Œå…¶ä¸­ç¬¬ä¸€[m
[31m-ç§æ–¹å¼éœ€è¦æ–°å¼æµè§ˆå™¨çš„æ”¯æŒï¼Œç¬¬äºŒç§æ–¹å¼æ˜¯è·¨æµè§ˆå™¨çš„ã€‚[m
[31m-[m
[31m-     1.SSE[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ¼”ç¤ºæ§åˆ¶å™¨ã€‚[m
[31m-[m
[31m-       package com.wisely.highlight_springmvc4.web.ch4_5;[m
[31m-[m
[31m-       import java.util.Random;[m
[31m-[m
[31m-       import org.springframework.stereotype.Controller;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.ResponseBody;[m
[31m-[m
[31m-       @Controller[m
[31m-       public class SseController {[m
[31m-[m
[31m-                         @RequestMapping(value="/push",produces="text/event-[m
[31m-       stream") //1[m
[31m-[m
[31m-              public @ResponseBody String push(){[m
[31m-                       Random r = new Random();[m
[31m-[m
[31m-                      try {[m
[31m-                             Thread.sleep(5000);[m
[31m-              } catch (InterruptedException e) {[m
[31m-[m
[31m-                             e.printStackTrace();[m
[31m-              }[m
[31m-              return "data:Testing 1,2,3" + r.nextInt() +"\n\n";[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨è¾“å‡ºçš„åª’ä½“ç±»å‹ä¸ºtext/event-streamï¼Œè¿™[m
[31m-æ˜¯æœåŠ¡å™¨ç«¯SSEçš„æ”¯æŒï¼Œæœ¬ä¾‹æ¼”ç¤ºæ¯5ç§’é’Ÿå‘æµè§ˆå™¨æ¨é€éšæœº[m
[31m-æ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰æ¼”ç¤ºé¡µé¢ã€‚åœ¨src/main/resources/viewsä¸‹æ–°å»ºsse.jspï¼š[m
[31m-[m
[31m-<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>[m
[31m-[m
[31m-<%@ page language="java" contentType="text/html; charset=UTF-[m
[31m-[m
[31m-8"[m
[31m-[m
[31m-    pageEncoding="UTF-8"%>[m
[31m-[m
[31m-<!DOCTYPE  html                  PUBLIC                           "-[m
[31m-[m
[31m-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loos[m
[31m-[m
[31m-<html>[m
[31m-[m
[31m-<head>[m
[31m-[m
[31m-<meta                            http-equiv="Content-[m
[31m-[m
[31m-Type" content="text/html; charset=UTF-8">[m
[31m-[m
[31m-<title>SSE Demo</title>[m
[31m-[m
[31m-</head>[m
[31m-<body>[m
[31m-[m
[31m-<div id="msgFrompPush"></div>[m
[31m-[m
[31m-<script    type="text/javascript"                 src="[m
[31m-[m
[31m-<c:url value="assets/js/jquery.js" />"></script>[m
[31m-[m
[31m-<script type="text/javascript">[m
[31m-[m
[31m-if (!!window.EventSource) { //1[m
[31m-          var source = new EventSource('push');[m
[31m-                    s='';[m
[31m-                    source.addEventListener('message', function(e) {//2[m
[31m-[m
[31m-                           s+=e.data+"<br/>";[m
[31m-                           $("#msgFrompPush").html(s);[m
[31m-[m
[31m-                    });[m
[31m-[m
[31m-                    source.addEventListener('open', function(e) {[m
[31m-                             console.log("è¿æ¥æ‰“å¼€.");[m
[31m-[m
[31m-                    }, false);[m
[31m-[m
[31m-                    source.addEventListener('error', function(e) {[m
[31m-                             if (e.readyState == EventSource.CLOSED) {[m
[31m-                                  console.log("è¿æ¥å…³é—­");[m
[31m-                             } else {[m
[31m-                                    console.log(e.readyState);[m
[31m-                             }[m
[31m-[m
[31m-                    }, false);[m
[31m-              } else {[m
[31m-[m
[31m-                             console.log("ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒSSE");[m
[31m-              }[m
[31m-       </script>[m
[31m-       </body>[m
[31m-       </html>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ EventSourceå¯¹è±¡åªæœ‰æ–°å¼çš„æµè§ˆå™¨æ‰æœ‰ï¼ˆChromeã€[m
[31m-Firefoxï¼‰ç­‰ï¼ŒEventSourceæ˜¯SSEçš„å®¢æˆ·ç«¯ï¼›[m
[31m-[m
[31m-     â‘¡æ·»åŠ SSEå®¢æˆ·ç«¯ç›‘å¬ï¼Œåœ¨æ­¤è·å¾—æœåŠ¡å™¨ç«¯æ¨é€çš„æ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰é…ç½®ã€‚[m
[31m-[m
[31m-     æ·»åŠ è½¬å‘sse.jspé¡µé¢çš„æ˜ å°„ï¼š[m
[31m-[m
[31m-       registry.addViewController("/sse").setViewName("/sse");[m
[31m-     ï¼ˆ4ï¼‰è¿è¡Œã€‚è®¿é—®http://localhostï¼š[m
[31m-8080/highlight_springmvc4/sseï¼Œå¦‚å›¾4-18æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾4-18ã€€è¿è¡Œæ•ˆæœ[m
[31m-[m
[31m-     2.Servlet 3.0+å¼‚æ­¥æ–¹æ³•å¤„ç†[m
[31m-     ï¼ˆ1ï¼‰å¼€å¯å¼‚æ­¥æ–¹æ³•æ”¯æŒï¼š[m
[31m-[m
[31m-              Dynamic servlet = servletContext.addServlet("dispatcher", new Dispa[m
[31m-                      servlet.addMapping("/");[m
[31m-                      servlet.setLoadOnStartup(1);[m
[31m-                      servlet.setAsyncSupported(true);//1[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ æ­¤å¥å¼€å¯å¼‚æ­¥æ–¹æ³•æ”¯æŒã€‚[m
[31m-     ï¼ˆ2ï¼‰æ¼”ç¤ºæ§åˆ¶å™¨ï¼š[m
[31m-[m
[31m-       package com.wisely.highlight_springmvc4.web.ch4_5;[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.stereotype.Controller;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.ResponseBody;[m
[31m-       import org.springframework.web.context.request.async.DeferredResult;[m
[31m-[m
[31m-       import com.wisely.highlight_springmvc4.service.PushService;[m
[31m-[m
[31m-       @Controller[m
[31m-       public class AysncController {[m
[31m-[m
[31m-              @Autowired[m
[31m-              PushService pushService; //1[m
[31m-[m
[31m-              @RequestMapping("/defer")[m
[31m-              @ResponseBody[m
[31m-              public DeferredResult<String> deferredCall() { //2[m
[31m-[m
[31m-                      return pushService.getAsyncUpdate();[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     å¼‚æ­¥ä»»åŠ¡çš„å®ç°æ˜¯é€šè¿‡æ§åˆ¶å™¨ä»å¦å¤–ä¸€ä¸ªçº¿ç¨‹è¿”å›ä¸€ä¸ª[m
[31m-DeferredResultï¼Œè¿™é‡Œçš„DeferredResultæ˜¯ä»pushServiceä¸­è·å¾—[m
[31m-çš„ã€‚[m
[31m-[m
[31m-     â‘ å®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶æ›´æ–°DeferredResultã€‚[m
[31m-[m
[31m-     â‘¡è¿”å›ç»™å®¢æˆ·ç«¯DeferredResultã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰å®šæ—¶ä»»åŠ¡ï¼š[m
[31m-[m
[31m-       package com.wisely.highlight_springmvc4.service;[m
[31m-[m
[31m-       import org.springframework.scheduling.annotation.Scheduled;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-       import org.springframework.web.context.request.async.DeferredResult;[m
[31m-[m
[31m-       @Service[m
[31m-       public class PushService {[m
[31m-[m
[31m-              private DeferredResult<String> deferredResult; //1[m
[31m-       public DeferredResult<String> getAsyncUpdate() {//1[m
[31m-              deferredResult = new DeferredResult<String>();[m
[31m-              return deferredResult;[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       @Scheduled(fixedDelay = 5000)[m
[31m-       public void refresh() {//1[m
[31m-[m
[31m-              if (deferredResult != null) {[m
[31m-                     deferredResult.setResult(new Long(System.currentTimeMillis([m
[31m-                                    .toString());[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ åœ¨PushServiceé‡Œäº§ç”ŸDeferredResultç»™æ§åˆ¶å™¨ä½¿ç”¨ï¼Œé€šè¿‡[m
[31m-@Scheduledæ³¨è§£çš„æ–¹æ³•å®šæ—¶æ›´æ–°DeferredResultã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰æ¼”ç¤ºé¡µé¢[m
[31m-[m
[31m-     åœ¨src/main/resources/viewsä¸‹æ–°å»ºasync.jspï¼š[m
[31m-[m
[31m-<%@ page language="java" contentType="text/html; charset=UTF-[m
[31m-[m
[31m-8"[m
[31m-[m
[31m-    pageEncoding="UTF-8"%>[m
[31m-[m
[31m-<!DOCTYPE  html                       PUBLIC  "-[m
[31m-[m
[31m-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loos[m
[31m-[m
[31m-<html>[m
[31m-[m
[31m-<head>[m
[31m-[m
[31m-<meta                                 http-equiv="Content-[m
[31m-[m
[31m-Type" content="text/html; charset=UTF-8">[m
[31m-[m
[31m-<title>servlet async support</title>[m
[31m-[m
[31m-</head>                          src="assets/js/jquery.js">[m
[31m-<body>[m
[31m-<script type="text/javascript"[m
[31m-</script>[m
[31m-<script type="text/javascript">[m
[31m-              deferred();//1[m
[31m-[m
[31m-              function deferred(){[m
[31m-                      $.get('defer',function(data){[m
[31m-                             console.log(data); //2[m
[31m-                             deferred(); //3[m
[31m-                      });[m
[31m-[m
[31m-              }[m
[31m-       </script>[m
[31m-       </body>[m
[31m-       </html>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     æ­¤å¤„çš„ä»£ç ä½¿ç”¨çš„æ˜¯jQueryçš„Ajaxè¯·æ±‚ï¼Œæ‰€ä»¥æ²¡æœ‰æµè§ˆå™¨[m
[31m-å…¼å®¹æ€§é—®é¢˜ã€‚[m
[31m-[m
[31m-     â‘ é¡µé¢æ‰“å¼€å°±å‘åå°å‘é€è¯·æ±‚ã€‚[m
[31m-[m
[31m-     â‘¡åœ¨æ§åˆ¶å°è¾“å‡ºæœåŠ¡ç«¯æ¨é€çš„æ•°æ®ã€‚[m
[31m-[m
[31m-     â‘¢ä¸€æ¬¡è¯·æ±‚å®Œæˆåå†å‘åå°å‘é€è¯·æ±‚ã€‚[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰é…ç½®ã€‚[m
[31m-[m
[31m-     åœ¨MyMvcConfigä¸Šå¼€å§‹è®¡åˆ’ä»»åŠ¡çš„æ”¯æŒï¼Œä½¿ç”¨[m
[31m-@EnableSchedulingï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableWebMvc[m
[31m-       @EnableScheduling[m
[31m-       @ComponentScan("com.wisely.highlight_springmvc4")[m
[31m-       public class MyMvcConfig extends WebMvcConfigurerAdapter{[m
[31m-[m
[31m-       }[m
[31m-     æ·»åŠ viewControllerï¼š[m
[31m-[m
[31m-       registry.addViewController("/async").setViewName("/async");[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰è¿è¡Œã€‚è®¿é—®http://localhostï¼š[m
[31m-8080/highlight_springmvc4/asyncï¼Œå¦‚å›¾4-19æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾4-19ã€€è¿è¡Œæ•ˆæœ[m
[31m-[m
[31m-     æ§åˆ¶å°è¾“å‡ºå¦‚å›¾4-20æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                 å›¾4-20ã€€æ§åˆ¶å°è¾“å‡º[m
[31m-4.6ã€€Spring MVCçš„æµ‹è¯•[m
[31m-[m
[31m-4.6.1ã€€ç‚¹ç›[m
[31m-[m
[31m-     æµ‹è¯•æ˜¯ä¿è¯è½¯ä»¶è´¨é‡çš„å…³é”®ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨â€œç¬¬ä¸€éƒ¨åˆ†ç‚¹ç›[m
[31m-Spring 4.xâ€ã€â€œç¬¬äºŒéƒ¨åˆ†ç‚¹ç›Spring MVC 4.xâ€å’Œâ€œç¬¬ä¸‰éƒ¨åˆ†å®æˆ˜[m
[31m-Spring Bootâ€ä¸­éƒ½å°†ä¼šæœ‰æµ‹è¯•ç›¸å…³çš„å†…å®¹ã€‚[m
[31m-[m
[31m-     åœ¨ç¬¬ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬åªè°ˆäº†ç®€å•çš„æµ‹è¯•ã€‚åœ¨æœ¬èŠ‚ï¼Œæˆ‘ä»¬è¦è¿›[m
[31m-è¡Œä¸€äº›å’ŒSpring MVCç›¸å…³çš„æµ‹è¯•ï¼Œä¸»è¦æ¶‰åŠæ§åˆ¶å™¨çš„æµ‹è¯•ã€‚[m
[31m-[m
[31m-     ä¸ºäº†æµ‹è¯•Webé¡¹ç›®é€šå¸¸ä¸éœ€è¦å¯åŠ¨é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›[m
[31m-Servletç›¸å…³çš„æ¨¡æ‹Ÿå¯¹è±¡ï¼Œæ¯”å¦‚ï¼šMockMVCã€[m
[31m-MockHttpServletRequestã€MockHttpServletResponseã€[m
[31m-MockHttpSessionç­‰ã€‚[m
[31m-[m
[31m-     åœ¨Springé‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨@WebAppConfigurationæŒ‡å®šåŠ è½½çš„[m
[31m-ApplicationContextæ˜¯ä¸€ä¸ªWebApplicationContextã€‚[m
[31m-[m
[31m-å¯èƒ½è®¸å¤šäººï¼ŒåŒ…æ‹¬æˆ‘è‡ªå·±ä»¥å‰ä¹Ÿè§‰å¾—æµ‹è¯•æœ‰ä»€ä¹ˆç”¨ï¼Œè‡ªå·±[m
[31m-[m
[31m-å¯åŠ¨ä¸€ä¸‹ï¼Œç‚¹ç‚¹å¼„å¼„ï¼Œå°±åƒæˆ‘ä»¬å‰é¢çš„ä¾‹å­ä¸ä¹Ÿéƒ½æ˜¯è¿™æ ·æµ‹è¯•[m
[31m-[m
[31m-çš„å—ï¼Ÿå…¶å®åœ¨ç°å®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ˜¯å…ˆæœ‰éœ€æ±‚çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å…ˆçŸ¥[m
[31m-[m
[31m-é“æˆ‘ä»¬æƒ³è¦çš„æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œç„¶åæŒ‰ç…§æˆ‘ä»¬æƒ³è¦çš„æ ·å­å»å¼€å‘ã€‚[m
[31m-[m
[31m-åœ¨è¿™é‡Œæˆ‘ä¹Ÿè¦å¼•å…¥ä¸€ä¸ªæ¦‚å¿µå«æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTest  Driven[m
[31m-[m
[31m-Developmentï¼ŒTDDï¼‰ï¼Œæˆ‘ä»¬ï¼ˆè®¾è®¡äººå‘˜ï¼‰æŒ‰ç…§éœ€æ±‚å…ˆå†™ä¸€ä¸ª[m
[31m-[m
[31m-è‡ªå·±é¢„æœŸç»“æœçš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹åˆšå¼€å§‹è‚¯å®šæ˜¯å¤±è´¥çš„[m
[31m-[m
[31m-æµ‹è¯•ï¼Œéšç€ä¸æ–­çš„ç¼–ç å’Œé‡æ„ï¼Œæœ€ç»ˆè®©æµ‹è¯•ç”¨ä¾‹é€šè¿‡æµ‹è¯•ï¼Œè¿™[m
[31m-[m
[31m-æ ·æ‰èƒ½ä¿è¯è½¯ä»¶çš„è´¨é‡å’Œå¯æ§æ€§ã€‚[m
[31m-åœ¨ä¸‹é¢çš„ç¤ºä¾‹é‡Œæˆ‘ä»¬å€ŸåŠ©JUnitå’ŒSpring     TestContext[m
[31m-[m
[31m-frameworkï¼Œåˆ†åˆ«æ¼”ç¤ºå¯¹æ™®é€šé¡µé¢è½¬å‘å½¢æ§åˆ¶å™¨å’Œ[m
[31m-[m
[31m-RestControllerè¿›è¡Œæµ‹è¯•ã€‚[m
[31m-[m
[31m-4.6.2ã€€ç¤ºä¾‹[m
[31m-[m
[31m-ï¼ˆ1ï¼‰æµ‹è¯•ä¾èµ–ï¼š[m
[31m-[m
[31m-<dependency>[m
[31m-                     <groupId>org.springframework</groupId>[m
[31m-                     <artifactId>spring-test</artifactId>[m
[31m-                     <version>${spring-framework.version}</version>[m
[31m-                     <scope>test</scope>[m
[31m-[m
[31m-              </dependency>[m
[31m-[m
[31m-              <dependency>[m
[31m-                     <groupId>junit</groupId>[m
[31m-                     <artifactId>junit</artifactId>[m
[31m-                     <version>4.11</version>[m
[31m-                     <scope>test</scope>[m
[31m-[m
[31m-              </dependency>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     è¿™é‡Œ<scope>test</scope>è¯´æ˜è¿™äº›åŒ…çš„å­˜æ´»æ˜¯åœ¨testå‘¨æœŸï¼Œ[m
[31m-ä¹Ÿå°±æ„å‘³ç€å‘å¸ƒæ—¶æˆ‘ä»¬å°†ä¸åŒ…å«è¿™äº›jaråŒ…ã€‚[m
[31m-     ï¼ˆ2ï¼‰æ¼”ç¤ºæœåŠ¡ï¼š[m
[31m-[m
[31m-       package com.wisely.highlight_springmvc4.service;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-       @Service[m
[31m-       public class DemoService {[m
[31m-       public String saySomething(){[m
[31m-              return "hello";[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ3ï¼‰æµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨src/test/javaä¸‹ï¼š[m
[31m-[m
[31m-package com.wisely.highlight_springmvc4.web.ch4_6;[m
[31m-[m
[31m-import static org.springframework.test.web.servlet.request.MockMvcReque[m
[31m-import static org.springframework.test.web.servlet.result.MockMvcResult[m
[31m-import static org.springframework.test.web.servlet.result.MockMvcResult[m
[31m-import static org.springframework.test.web.servlet.result.MockMvcResult[m
[31m-import static org.springframework.test.web.servlet.result.MockMvcResult[m
[31m-import static org.springframework.test.web.servlet.result.MockMvcResult[m
[31m-[m
[31m-import org.junit.Before;[m
[31m-import org.junit.Test;[m
[31m-import org.junit.runner.RunWith;[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.mock.web.MockHttpServletRequest;[m
[31m-import org.springframework.mock.web.MockHttpSession;[m
[31m-import org.springframework.test.context.ContextConfiguration;[m
[31m-import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;[m
[31m-import org.springframework.test.context.web.WebAppConfiguration;[m
[31m-import org.springframework.test.web.servlet.MockMvc;[m
[31m-import org.springframework.test.web.servlet.setup.MockMvcBuilders;[m
[31m-import org.springframework.web.context.WebApplicationContext;[m
[31m-[m
[31m-import com.wisely.highlight_springmvc4.MyMvcConfig;[m
[31m-import com.wisely.highlight_springmvc4.service.DemoService;[m
[31m-[m
[31m-@RunWith(SpringJUnit4ClassRunner.class)[m
[31m-@ContextConfiguration(classes = {MyMvcConfig.class})[m
[31m-@WebAppConfiguration("src/main/resources") //1[m
[31m-public class TestControllerIntegrationTests {[m
[31m-[m
[31m-       private MockMvc mockMvc; //2[m
[31m-[m
[31m-       @Autowired[m
[31m-       private DemoService demoService;//3[m
[31m-              @Autowired[m
[31m-              WebApplicationContext wac; //4[m
[31m-[m
[31m-              @Autowired[m
[31m-              MockHttpSession session; //5[m
[31m-[m
[31m-              @Autowired[m
[31m-              MockHttpServletRequest request; //6[m
[31m-[m
[31m-              @Before //7[m
[31m-              public void setup() {[m
[31m-              this.mockMvc =[m
[31m-[m
[31m-                               MockMvcBuilders.webAppContextSetup(this.wac).build(); //2[m
[31m-              }[m
[31m-[m
[31m-              @Test[m
[31m-              public void testNormalController() throws Exception{[m
[31m-[m
[31m-                      mockMvc.perform(get("/normal")) //8[m
[31m-                                    .andExpect(status().isOk())//9[m
[31m-                                    .andExpect(view().name("page"))//10[m
[31m-                                                               .andExpect(forwardedUrl("/WEB-[m
[31m-[m
[31m-       INF/classes/views/page.jsp"))//11[m
[31m-                                    .andExpect(model().attribute("msg", demoService.saySome[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @Test[m
[31m-              public void testRestController() throws Exception{[m
[31m-[m
[31m-                      mockMvc.perform(get("/testRest")) //13[m
[31m-                      .andExpect(status().isOk())[m
[31m-[m
[31m-                       .andExpect(content().contentType("text/plain;charset=UTF-[m
[31m-       8"))//14[m
[31m-[m
[31m-                      .andExpect(content().string(demoService.saySomething()));//15[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ @WebAppConfigurationæ³¨è§£åœ¨ç±»ä¸Šï¼Œç”¨æ¥å£°æ˜åŠ è½½çš„[m
[31m-ApplicationContexæ˜¯ä¸€ä¸ªWebApplicationContextã€‚å®ƒçš„å±æ€§æŒ‡[m
[31m-å®šçš„æ˜¯Webèµ„æºçš„ä½ç½®ï¼Œé»˜è®¤ä¸ºsrc/main/webappï¼Œæœ¬ä¾‹ä¿®æ”¹ä¸º[m
[31m-src/main/resourcesã€‚[m
[31m-[m
[31m-     â‘¡MockMvc-æ¨¡æ‹ŸMVCå¯¹è±¡ï¼Œé€šè¿‡[m
[31m-MockMvcBuilders.webAppContextSetupï¼ˆthis.wacï¼‰.buildï¼ˆï¼‰[m
[31m-åˆå§‹åŒ–ã€‚[m
[31m-[m
[31m-     â‘¢å¯ä»¥åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­æ³¨å…¥Springçš„Beanã€‚[m
[31m-[m
[31m-     â‘£å¯æ³¨å…¥WebApplicationContextã€‚[m
[31m-[m
[31m-     â‘¤å¯æ³¨å…¥æ¨¡æ‹Ÿçš„http sessionï¼Œæ­¤å¤„ä»…ä½œæ¼”ç¤ºï¼Œæ²¡æœ‰ä½¿ç”¨ã€‚[m
[31m-[m
[31m-     â‘¥å¯æ³¨å…¥æ¨¡æ‹Ÿçš„http requestï¼Œæ­¤å¤„ä»…ä½œæ¼”ç¤ºï¼Œæ²¡æœ‰ä½¿ç”¨ã€‚[m
[31m-[m
[31m-     â‘¦@Beforeåœ¨æµ‹è¯•å¼€å§‹å‰è¿›è¡Œçš„åˆå§‹åŒ–å·¥ä½œã€‚[m
[31m-[m
[31m-     â‘§æ¨¡æ‹Ÿå‘/normalè¿›è¡Œgetè¯·æ±‚ã€‚[m
[31m-[m
[31m-     â‘¨é¢„æœŸæ§åˆ¶è¿”å›çŠ¶æ€ä¸º200ã€‚[m
[31m-[m
[31m-     â‘©é¢„æœŸviewçš„åç§°ä¸ºpageã€‚[m
[31m-[m
[31m-     â‘ªé¢„æœŸé¡µé¢è½¬å‘çš„çœŸæ­£è·¯å¾„ä¸º/WEB-[m
[31m-INF/classes/views/page.jspã€‚[m
[31m-[m
[31m-     â‘«é¢„æœŸmodelé‡Œçš„å€¼æ˜¯demoService.saySomethingï¼ˆï¼‰è¿”å›[m
[31m-å€¼helloã€‚[m
[31m-[m
[31m-     â‘¬æ¨¡æ‹Ÿå‘/testRestè¿›è¡Œgetè¯·æ±‚ã€‚[m
[31m-[m
[31m-     â‘­é¢„æœŸè¿”å›å€¼çš„åª’ä½“ç±»å‹ä¸ºtext/plainï¼›charset=UTF-8ã€‚[m
[31m-[m
[31m-     â‘®é¢„æœŸè¿”å›å€¼çš„å†…å®¹ä¸ºdemoService.saySomethingï¼ˆï¼‰è¿”å›[m
[31m-å€¼helloã€‚[m
[31m-æ­¤æ—¶è¿è¡Œè¯¥æµ‹è¯•æ•ˆæœå¦‚å›¾4-21æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾4-21ã€€æµ‹è¯•æ•ˆæœ[m
[31m-[m
[31m-ï¼ˆ4ï¼‰ç¼–å†™æ™®é€šæ§åˆ¶å™¨ã€‚[m
[31m-[m
[31m-package com.wisely.highlight_springmvc4.web.ch4_6;[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.stereotype.Controller;[m
[31m-import org.springframework.ui.Model;[m
[31m-import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-import com.wisely.highlight_springmvc4.service.DemoService;[m
[31m-@Controller[m
[31m-public class NormalController {[m
[31m-[m
[31m-       @Autowired[m
[31m-       DemoService demoService;[m
[31m-[m
[31m-       @RequestMapping("/normal")[m
[31m-       public String testPage(Model model){[m
[31m-[m
[31m-              model.addAttribute("msg", demoService.saySomething());[m
[31m-              return "page";[m
[31m-       }[m
[31m-}[m
[31m-     ï¼ˆ5ï¼‰ç¼–å†™æ™®é€šæ§åˆ¶å™¨çš„æ¼”ç¤ºé¡µé¢ï¼Œåœ¨[m
[31m-src/main/resources/viewsä¸‹æ–°å»ºpage.jspï¼š[m
[31m-[m
[31m-<%@ page language="java" contentType="text/html; charset=UTF-[m
[31m-[m
[31m-8"[m
[31m-[m
[31m-    pageEncoding="UTF-8"%>[m
[31m-[m
[31m-<!DOCTYPE   html                      PUBLIC  "-[m
[31m-[m
[31m-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loos[m
[31m-[m
[31m-<html>[m
[31m-[m
[31m-<head>[m
[31m-[m
[31m-<meta                                 http-equiv="Content-[m
[31m-[m
[31m-Type" content="text/html; charset=UTF-8">[m
[31m-[m
[31m-<title>Test page</title>[m
[31m-[m
[31m-</head>[m
[31m-[m
[31m-<body>[m
[31m-[m
[31m-    <pre>[m
[31m-[m
[31m-         Welcome to Spring MVC world[m
[31m-[m
[31m-    </pre>[m
[31m-[m
[31m-</body>[m
[31m-[m
[31m-</html>[m
[31m-[m
[31m-ï¼ˆ6ï¼‰ç¼–å†™RestControlleræ§åˆ¶å™¨ï¼š[m
[31m-[m
[31m-package com.wisely.highlight_springmvc4.web.ch4_6;[m
[31m-[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-import org.springframework.web.bind.annotation.ResponseBody;[m
[31m-import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-import com.wisely.highlight_springmvc4.service.DemoService;[m
[31m-[m
[31m-@RestController[m
[31m-public class MyRestController {[m
[31m-[m
[31m-       @Autowired[m
[31m-       DemoService demoService;[m
[31m-[m
[31m-       @RequestMapping(value = "/testRest" ,produces="text/plain;charset=U[m
[31m-8")[m
[31m-[m
[31m-       public @ResponseBody String testRest(){[m
[31m-              return demoService.saySomething();[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ7ï¼‰è¿è¡Œæµ‹è¯•ï¼Œæ•ˆæœåŠ å›¾4-22æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾4-22ã€€æµ‹è¯•æ•ˆæœ[m
[31m-       ç¬¬ä¸‰éƒ¨åˆ†ã€€å®æˆ˜Spring Boot[m
[31m-[m
[31m-ç¬¬5ç« ã€€Spring BootåŸºç¡€[m
[31m-[m
[31m-5.1ã€€Spring Bootæ¦‚è¿°[m
[31m-[m
[31m-5.1.1ã€€ä»€ä¹ˆæ˜¯Spring Boot[m
[31m-[m
[31m-     éšç€åŠ¨æ€è¯­è¨€çš„æµè¡Œï¼ˆRubyã€Groovyã€Scalaã€[m
[31m-Node.jsï¼‰ï¼ŒJavaçš„å¼€å‘æ˜¾å¾—æ ¼å¤–çš„ç¬¨é‡ï¼šç¹å¤šçš„é…ç½®ã€ä½ä¸‹çš„[m
[31m-å¼€å‘æ•ˆç‡ã€å¤æ‚çš„éƒ¨ç½²æµç¨‹ä»¥åŠç¬¬ä¸‰æ–¹æŠ€æœ¯é›†æˆéš¾åº¦å¤§ã€‚[m
[31m-[m
[31m-     åœ¨ä¸Šè¿°ç¯å¢ƒä¸‹ï¼ŒSpring Bootåº”è¿è€Œç”Ÿã€‚å®ƒä½¿ç”¨â€œä¹ æƒ¯ä¼˜äºé…[m
[31m-ç½®â€ï¼ˆé¡¹ç›®ä¸­å­˜åœ¨å¤§é‡çš„é…ç½®ï¼Œæ­¤å¤–è¿˜å†…ç½®ä¸€ä¸ªä¹ æƒ¯æ€§çš„é…[m
[31m-ç½®ï¼Œè®©ä½ æ— é¡»æ‰‹åŠ¨è¿›è¡Œé…ç½®ï¼‰çš„ç†å¿µè®©ä½ çš„é¡¹ç›®å¿«é€Ÿè¿è¡Œèµ·[m
[31m-æ¥ã€‚ä½¿ç”¨Spring Bootå¾ˆå®¹æ˜“åˆ›å»ºä¸€ä¸ªç‹¬ç«‹è¿è¡Œï¼ˆè¿è¡Œjarï¼Œå†…åµŒ[m
[31m-Servletå®¹å™¨ï¼‰ã€å‡†ç”Ÿäº§çº§åˆ«çš„åŸºäºSpringæ¡†æ¶çš„é¡¹ç›®ï¼Œä½¿ç”¨[m
[31m-Spring Bootä½ å¯ä»¥ä¸ç”¨æˆ–è€…åªéœ€è¦å¾ˆå°‘çš„Springé…ç½®ã€‚[m
[31m-[m
[31m-5.1.2ã€€Spring Bootæ ¸å¿ƒåŠŸèƒ½[m
[31m-[m
[31m-     1.ç‹¬ç«‹è¿è¡Œçš„Springé¡¹ç›®[m
[31m-     Spring Bootå¯ä»¥ä»¥jaråŒ…çš„å½¢å¼ç‹¬ç«‹è¿è¡Œï¼Œè¿è¡Œä¸€ä¸ªSpring[m
[31m-Booté¡¹ç›®åªéœ€é€šè¿‡javaâ€“jar xx.jaræ¥è¿è¡Œã€‚[m
[31m-[m
[31m-     2.å†…åµŒServletå®¹å™¨[m
[31m-     Spring Bootå¯é€‰æ‹©å†…åµŒTomcatã€Jettyæˆ–è€…Undertowï¼Œè¿™æ ·[m
[31m-æˆ‘ä»¬æ— é¡»ä»¥waråŒ…å½¢å¼éƒ¨ç½²é¡¹ç›®ã€‚[m
[31m-     3.æä¾›starterç®€åŒ–Mavené…ç½®[m
[31m-     Springæä¾›äº†ä¸€ç³»åˆ—çš„starter pomæ¥ç®€åŒ–Mavençš„ä¾èµ–åŠ [m
[31m-è½½ï¼Œä¾‹å¦‚ï¼Œå½“ä½ ä½¿ç”¨äº†spring-boot-starter-webæ—¶ï¼Œä¼šè‡ªåŠ¨åŠ å…¥[m
[31m-å¦‚å›¾5-1æ‰€ç¤ºçš„ä¾èµ–åŒ…ã€‚[m
[31m-[m
[31m-                              å›¾5-1ã€€è‡ªåŠ¨åŠ å…¥çš„ä¾èµ–åŒ…[m
[31m-[m
[31m-     4.è‡ªåŠ¨é…ç½®Spring[m
[31m-     Spring Bootä¼šæ ¹æ®åœ¨ç±»è·¯å¾„ä¸­çš„jaråŒ…ã€ç±»ï¼Œä¸ºjaråŒ…é‡Œçš„ç±»[m
[31m-è‡ªåŠ¨é…ç½®Beanï¼Œè¿™æ ·ä¼šæå¤§åœ°å‡å°‘æˆ‘ä»¬è¦ä½¿ç”¨çš„é…ç½®ã€‚å½“ç„¶ï¼Œ[m
[31m-Spring Bootåªæ˜¯è€ƒè™‘äº†å¤§å¤šæ•°çš„å¼€å‘åœºæ™¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„åœº[m
[31m-æ™¯ï¼Œè‹¥åœ¨å®é™…å¼€å‘ä¸­æˆ‘ä»¬éœ€è¦è‡ªåŠ¨é…ç½®Beanï¼Œè€ŒSpring Bootæ²¡[m
[31m-æœ‰æä¾›æ”¯æŒï¼Œåˆ™å¯ä»¥è‡ªå®šä¹‰è‡ªåŠ¨é…ç½®ï¼ˆè§6.5èŠ‚ï¼‰ã€‚[m
[31m-     5.å‡†ç”Ÿäº§çš„åº”ç”¨ç›‘æ§[m
[31m-     Spring Bootæä¾›åŸºäºhttpã€sshã€telnetå¯¹è¿è¡Œæ—¶çš„é¡¹ç›®è¿›è¡Œ[m
[31m-ç›‘æ§ï¼ˆè§ç¬¬10ç« ï¼‰ã€‚[m
[31m-     6.æ— ä»£ç ç”Ÿæˆå’Œxmlé…ç½®[m
[31m-     Spring Bootçš„ç¥å¥‡çš„ä¸æ˜¯å€ŸåŠ©äºä»£ç ç”Ÿæˆæ¥å®ç°çš„ï¼Œè€Œæ˜¯[m
[31m-é€šè¿‡æ¡ä»¶æ³¨è§£æ¥å®ç°çš„ï¼Œè¿™æ˜¯Spring 4.xæä¾›çš„æ–°ç‰¹æ€§ï¼Œåœ¨3.5[m
[31m-èŠ‚æœ‰è¿‡ç®€å•çš„æ¼”ç¤ºï¼Œæœ¬ç« å°†ç”¨å¤§é‡çš„ç¯‡å¹…è®²è§£Spring Bootå®ç°[m
[31m-çš„æ ¸å¿ƒæŠ€æœ¯ã€‚[m
[31m-[m
[31m-     Spring 4.xæå€¡ä½¿ç”¨Javaé…ç½®å’Œæ³¨è§£é…ç½®ç»„åˆï¼Œè€ŒSpring[m
[31m-Bootä¸éœ€è¦ä»»ä½•xmlé…ç½®å³å¯å®ç°Springçš„æ‰€æœ‰é…ç½®ã€‚[m
[31m-[m
[31m-5.1.3ã€€Spring Bootçš„ä¼˜ç¼ºç‚¹[m
[31m-[m
[31m-     ä¼˜ç‚¹[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰å¿«é€Ÿæ„å»ºé¡¹ç›®ï¼›[m
[31m-     ï¼ˆ2ï¼‰å¯¹ä¸»æµå¼€å‘æ¡†æ¶çš„æ— é…ç½®é›†æˆï¼›[m
[31m-     ï¼ˆ3ï¼‰é¡¹ç›®å¯ç‹¬ç«‹è¿è¡Œï¼Œæ— é¡»å¤–éƒ¨ä¾èµ–Servletå®¹å™¨ï¼›[m
[31m-     ï¼ˆ4ï¼‰æä¾›è¿è¡Œæ—¶çš„åº”ç”¨ç›‘æ§ï¼›[m
[31m-     ï¼ˆ5ï¼‰æå¤§åœ°æé«˜äº†å¼€å‘ã€éƒ¨ç½²æ•ˆç‡ï¼›[m
[31m-     ï¼ˆ6ï¼‰ä¸äº‘è®¡ç®—çš„å¤©ç„¶é›†æˆã€‚[m
[31m-     ç¼ºç‚¹[m
[31m-     ï¼ˆ1ï¼‰ä¹¦ç±æ–‡æ¡£è¾ƒå°‘ä¸”ä¸å¤Ÿæ·±å…¥ï¼Œè¿™æ˜¯ç›´æ¥ä¿ƒä½¿æˆ‘å†™è¿™æœ¬[m
[31m-ä¹¦çš„åŸå› ï¼›[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰å¦‚æœä½ ä¸è®¤åŒSpringæ¡†æ¶ï¼Œè¿™ä¹Ÿè®¸æ˜¯å®ƒçš„ç¼ºç‚¹ï¼Œä½†å»º[m
[31m-è®®ä½ ä¸€å®šè¦ä½¿ç”¨Springæ¡†æ¶ã€‚[m
[31m-[m
[31m-5.1.4ã€€å…³äºæœ¬ä¹¦çš„Spring Bootç‰ˆæœ¬[m
[31m-[m
[31m-åœ¨æˆ‘å†™è¿™æœ¬ä¹¦çš„æ—¶å€™ï¼ŒSpring          Bootçš„æœ€æ–°æ­£å¼ç‰ˆæ˜¯[m
[31m-[m
[31m-1.2.4.RELEASEã€‚Spring Boot 1.3.1.M2é‡Œç¨‹ç¢‘ç‰ˆæœ¬å·²ç»å‘å¸ƒã€‚[m
[31m-[m
[31m-     Spring Boot 1.3.1.xæä¾›äº†å¤§é‡æ–°ç‰¹æ€§ï¼Œæœ€ä»¤äººç©ç›®çš„æ˜¯æ·»[m
[31m-åŠ äº†spring-boot-devtoolsæ¥è¿›è¡Œå¼€å‘çƒ­éƒ¨ç½²ï¼Œæœ¬ä¹¦å°†ä»¥Spring[m
[31m-Boot 1.3.0ç‰ˆæœ¬ä½œä¸ºæ¼”ç¤ºè®²è§£ç‰ˆæœ¬ã€‚[m
[31m-5.2ã€€Spring Bootå¿«é€Ÿæ­å»º[m
[31m-[m
[31m-5.2.1ã€€http://start.spring.io[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨åœ°å€æ ä¸­è¾“å…¥http://start.spring.ioï¼Œå¦‚[m
[31m-å›¾5-2æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                 å›¾5-2ã€€æ‰“å¼€Spring.io[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼Œå¦‚å›¾5-3æ‰€ç¤ºã€‚[m
[31m-                                 å›¾5-3ã€€å¡«å†™é¡¹ç›®ä¿¡æ¯[m
[31m-[m
[31m-     å†…å®¹è§£é‡Š[m
[31m-[m
[31m-     â‘ æˆ‘ä»¬åœ¨æ­¤ä»¥Mavenä½œä¸ºé¡¹ç›®æ„å»ºæ–¹å¼ï¼ŒSpring Bootè¿˜æ”¯[m
[31m-æŒä»¥Gradleä½œä¸ºé¡¹ç›®æ„å»ºå·¥å…·ï¼›[m
[31m-[m
[31m-     â‘¡éƒ¨ç½²å½¢å¼ä»¥jaråŒ…å½¢å¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¼ ç»Ÿçš„waråŒ…å½¢[m
[31m-å¼ï¼Œæˆ‘ä»¬å°†åœ¨10.2.2èŠ‚è¿›è¡Œè®²è§£ï¼›[m
[31m-[m
[31m-     â‘¢Javaç‰ˆæœ¬æˆ‘ä»¬é€‰ç”¨1.8ï¼ŒSpring Bootæœ€ä½è¦æ±‚ä¸º1.6ï¼Œå’Œ[m
[31m-Springæ¡†æ¶4.xçš„æœ€ä½è¦æ±‚ä¸€è‡´ï¼›[m
[31m-[m
[31m-     â‘£Spring bootè¿˜æ”¯æŒä»¥Groovyè¯­è¨€å¼€å‘ï¼Œè€ƒè™‘åˆ°æœ¬ä¹¦çš„å—[m
[31m-ä¼—ï¼Œæœ¬ä¹¦ä»¥Javaä½œä¸ºå¼€å‘è¯­è¨€ï¼›[m
[31m-[m
[31m-     â‘¤æŒ‰ç…§5.1.4èŠ‚çš„é˜è¿°ï¼Œé€‰æ‹©Spring Bootç‰ˆæœ¬ä¸º1.3.0é‡Œç¨‹ç¢‘[m
[31m-ç‰ˆæœ¬ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰é€‰æ‹©é¡¹ç›®é€‰ç”¨çš„æŠ€æœ¯ï¼ˆå³starter pomï¼‰ï¼Œå¦‚å›¾5-4æ‰€[m
[31m-ç¤ºã€‚[m
[31m-[m
[31m-                            å›¾5-4ã€€é€‰æ‹©é¡¹ç›®é€‰ç”¨çš„æŠ€æœ¯[m
[31m-[m
[31m-     å†…å®¹è§£é‡Š[m
[31m-     è¿™é‡Œå¤‡é€‰çš„æ¯ä¸€é¡¹æŠ€æœ¯éƒ½æ˜¯Spring bootçš„starter pomï¼Œä¾‹å¦‚[m
[31m-æˆ‘ä»¬é€‰ä¸­çš„Webï¼Œå°±æ˜¯åœ¨Mavené‡Œä¾èµ–spring-boot-starter-webã€‚[m
[31m-     å½“è¿™äº›æŠ€æœ¯çš„starter pomè¢«é€‰ä¸­åï¼Œä¸è¿™é¡¹æŠ€æœ¯ç›¸å…³çš„[m
[31m-Springçš„Beanå°†ä¼šè¢«è‡ªåŠ¨é…ç½®ï¼Œæˆ‘ä»¬å°†åœ¨ç¬¬ä¸‰éƒ¨åˆ†è®²è¿°å¸¸ç”¨çš„[m
[31m-starter pomã€‚[m
[31m-     ï¼ˆ4ï¼‰ä¸‹è½½ä»£ç ï¼Œå¦‚å›¾5-5æ‰€ç¤ºã€‚[m
[31m-                                    å›¾5-5ã€€ä¸‹è½½ä»£ç [m
[31m-[m
[31m-     å†…å®¹è§£é‡Š[m
[31m-[m
[31m-     æ­¤å¤„ç”Ÿæˆçš„æ˜¯ä¸€ä¸ªç®€å•çš„åŸºäºMavençš„é¡¹ç›®ï¼Œæ— ä»»ä½•ç‰¹[m
[31m-åˆ«ï¼Œå¯å°†è¿™ä¸ªé¡¹ç›®å¯¼å…¥åˆ°ä½ å¸¸ç”¨çš„å¼€å‘å·¥å…·ä¸­ï¼ˆè§é™„å½•[m
[31m-A.2ã€‚ï¼‰[m
[31m-[m
[31m-5.2.2ã€€Spring Tool Suite[m
[31m-[m
[31m-     å¯¹äºä¹ æƒ¯äºEclipseå¼€å‘é¡¹ç›®çš„è¯»è€…ï¼Œä½¿ç”¨STSæ¥æ„å»ºSpring[m
[31m-Bootä¹Ÿååˆ†ç®€å•ã€‚[m
[31m-ï¼ˆ1ï¼‰æ–°å»ºSpring Starter Projectï¼Œå¦‚å›¾5-6æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                    å›¾5-6ã€€æ–°å»ºSpring Starter Project[m
[31m-[m
[31m-ï¼ˆ2ï¼‰å¡«å†™é¡¹ç›®ä¿¡æ¯å’Œé€‰æ‹©æŠ€æœ¯ï¼Œå¦‚å›¾5-7æ‰€ç¤ºã€‚[m
[31m-                   å›¾5-7ã€€å¡«å†™é¡¹ç›®ä¿¡æ¯å’Œé€‰æ‹©æŠ€æœ¯[m
[31m-[m
[31m-ï¼ˆ3ï¼‰é¡¹ç›®ç»“æ„å¦‚å›¾5-8æ‰€ç¤ºã€‚[m
[31m-                              å›¾5-8ã€€é¡¹ç›®ç»“æ„[m
[31m-[m
[31m-ï¼ˆ4ï¼‰ä¾èµ–æ ‘å¦‚å›¾5-9æ‰€ç¤ºã€‚[m
[31m-                                     å›¾5-9ã€€ä¾èµ–æ ‘[m
[31m-[m
[31m-5.2.3ã€€IntelliJ IDEA[m
[31m-[m
[31m-     IntelliJ IDEAæ˜¯æˆ‘æ¯”è¾ƒæ¨å´‡çš„å¼€å‘å·¥å…·ï¼Œå¯¹æ–°æŠ€æœ¯æœ‰ç¬¬ä¸€[m
[31m-æ—¶é—´çš„æ”¯æŒï¼›ä½¿ç”¨IntelliJ IDEA 14.1ç‰ˆæœ¬å¯ç›´æ¥æ–°å»ºSpring[m
[31m-Booté¡¹ç›®ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ–°å»ºSpring Initializré¡¹ç›®ï¼Œå¦‚å›¾5-10æ‰€ç¤ºã€‚[m
[31m-                   å›¾5-10ã€€æ–°å»ºSpring Initializré¡¹ç›®[m
[31m-[m
[31m-ï¼ˆ2ï¼‰å¡«å†™é¡¹ç›®ä¿¡æ¯ï¼Œå¦‚å›¾5-11æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                          å›¾5-11ã€€å¡«å†™é¡¹ç›®ä¿¡æ¯[m
[31m-[m
[31m-ï¼ˆ3ï¼‰é€‰æ‹©é¡¹ç›®ä½¿ç”¨æŠ€æœ¯ï¼Œå¦‚å›¾5-12æ‰€ç¤ºã€‚[m
[31m-                       å›¾5-12ã€€é€‰æ‹©é¡¹ç›®ä½¿ç”¨æŠ€æœ¯[m
[31m-[m
[31m-ï¼ˆ4ï¼‰å¡«å†™é¡¹ç›®åç§°ï¼Œå¦‚å›¾5-13æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                          å›¾5-13ã€€å¡«å†™é¡¹ç›®åç§°[m
[31m-[m
[31m-ï¼ˆ5ï¼‰å°†é¡¹ç›®è®¾ç½®ä¸ºMavené¡¹ç›®ï¼Œå¦‚å›¾5-14æ‰€ç¤ºã€‚[m
[31m-                             å›¾5-14ã€€è®¾ç½®ä¸ºMavené¡¹ç›®[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰é¡¹ç›®ç»“æ„åŠä¾èµ–æ ‘å¦‚å›¾5-15æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾5-15ã€€é¡¹ç›®ç»“æ„åŠä¾èµ–æ ‘[m
[31m-[m
[31m-5.2.4ã€€Spring Boot CLI[m
[31m-[m
[31m-     Spring Boot CLIæ˜¯Spring Bootæä¾›çš„æ§åˆ¶å°å‘½ä»¤å·¥å…·ã€‚[m
[31m-     1.ä¸‹è½½Spring Boot CLI[m
[31m-     Spring Boot 1.3.0.M1çš„ä¸‹è½½åœ°å€æ˜¯ï¼š[m
[31m-     http://repo.spring.io/release/org/springframework/boot/spring-[m
[31m-boot-cli/1.3.0.RELEASE/spring-boot-cli-1.3.0.RELEASE-bin.zip[m
[31m-     2.è§£å‹å¹¶é…ç½®åˆ°ç¯å¢ƒå˜é‡[m
[31m-     è§£å‹åå°†CLIçš„binç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡çš„Pathä¸­ï¼Œè¿™æ ·æˆ‘[m
[31m-ä»¬å°±å¯ä»¥åœ¨æ§åˆ¶å°ç›´æ¥è°ƒç”¨Spring Boot CLIäº†ï¼Œå¦‚å›¾5-16æ‰€[m
[31m-ç¤ºã€‚[m
[31m-                  å›¾5-16ã€€å°†binç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡çš„Pathä¸­[m
[31m-[m
[31m-     3.ä½¿ç”¨å‘½ä»¤åˆå§‹åŒ–é¡¹ç›®[m
[31m-[m
[31m-     è¦æƒ³å®ç°ä¸Šé¢å‡ ä¸ªä¾‹å­çš„æ•ˆæœï¼Œéœ€åœ¨æ§åˆ¶å°è¾“å…¥ä»¥ä¸‹å‘½[m
[31m-ä»¤ï¼š[m
[31m-[m
[31m-spring  init  --build=maven  --java-version=1.8  --[m
[31m-[m
[31m-dependencies=web --packaging=jar --boot-version=1.3.0.M1 --[m
[31m-[m
[31m-groupId=com.wisely --artifactId=ch5_2_4[m
[31m-[m
[31m-è¿è¡Œæ•ˆæœå¦‚å›¾5-17æ‰€ç¤ºã€‚[m
[31m-[m
[31m-              å›¾5-17ã€€è¿è¡Œæ•ˆæœ[m
[31m-[m
[31m-4.é¡¹ç›®ç»“æ„[m
[31m-     ä»å›¾5-18åŒæ ·å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„Mavené¡¹ç›®ã€‚[m
[31m-[m
[31m-                                   å›¾5-18ã€€é¡¹ç›®ç»“æ„[m
[31m-[m
[31m-5.2.5ã€€Mavenæ‰‹å·¥æ„å»º[m
[31m-[m
[31m-     å‰é¢æˆ‘è®²è¿°äº†ç”¨ä¸åŒçš„æ–¹å¼æ„å»ºSpring Booté¡¹ç›®ï¼Œä½†äº‹å®[m
[31m-ä¸Šå»ºç«‹çš„åªæ˜¯ä¸€ä¸ªMavené¡¹ç›®ï¼Œå¦‚æœä¸å€ŸåŠ©ä¸Šé¢çš„æ–¹å¼ï¼Œæˆ‘ä»¬[m
[31m-åº”å¦‚ä½•æ„å»ºSpring Booté¡¹ç›®å‘¢ï¼Ÿ[m
[31m-[m
[31m-     1.Mavené¡¹ç›®æ„å»º[m
[31m-     æˆ‘ä»¬å¯ä»¥ç”¨ä»»æ„å¼€å‘å·¥å…·æ–°å»ºç©ºçš„Mavené¡¹ç›®ï¼Œåœ¨1.2èŠ‚å·²[m
[31m-ç»åšäº†è¾ƒä¸ºè¯¦ç»†çš„è®²è§£ã€‚[m
[31m-     2.ä¿®æ”¹pom.xml[m
[31m-     ï¼ˆ1ï¼‰æ·»åŠ Spring Bootçš„çˆ¶çº§ä¾èµ–ï¼Œè¿™æ ·å½“å‰çš„é¡¹ç›®å°±æ˜¯[m
[31m-Spring Booté¡¹ç›®äº†ã€‚spring-boot-starter-parentæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„[m
[31m-starterï¼Œå®ƒç”¨æ¥æä¾›ç›¸å…³çš„Mavené»˜è®¤ä¾èµ–ï¼Œä½¿ç”¨å®ƒä¹‹åï¼Œå¸¸[m
[31m-ç”¨çš„åŒ…ä¾èµ–å¯ä»¥çœå»versionæ ‡ç­¾ï¼Œå…³äºSpring Bootæä¾›äº†å“ªäº›[m
[31m-jaråŒ…çš„ä¾èµ–ï¼Œå¯æŸ¥çœ‹Cï¼š\Users\ç”¨æˆ·[m
[31m-\.m2\repository\org\springframework\boot\spring-boot-[m
[31m-dependencies\1.3.0.M1\spring-boot-dependencies-1.3.0.M1.pomæ–‡[m
[31m-ä»¶ä¸­çš„å£°æ˜ã€‚[m
[31m-              <parent>[m
[31m-                      <groupId>org.springframework.boot</groupId>[m
[31m-                      <artifactId>spring-boot-starter-parent</artifactId>[m
[31m-                      <version>1.3.0.M1</version>[m
[31m-                      <relativePath/>[m
[31m-[m
[31m-              </parent>[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰åœ¨dependenciesæ·»åŠ Webæ”¯æŒçš„starter pomï¼Œè¿™æ ·å°±æ·»[m
[31m-åŠ äº†Webçš„ä¾èµ–ã€‚[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       web</artifactId>[m
[31m-                      </dependency>[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰æ·»åŠ Spring Bootçš„ç¼–è¯‘æ’ä»¶ã€‚[m
[31m-[m
[31m-       <build>[m
[31m-                      <plugins>[m
[31m-                             <plugin>[m
[31m-                                    <groupId>org.springframework.boot</groupId>[m
[31m-                                                               <artifactId>spring-boot-maven-[m
[31m-[m
[31m-       plugin</artifactId>[m
[31m-                             </plugin>[m
[31m-[m
[31m-                      </plugins>[m
[31m-       </build>[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é‡Œç¨‹ç¢‘ç‰ˆçš„Spring Bootï¼Œè‹¥ä½¿ç”¨çš„[m
[31m-æ˜¯æ­£å¼ç‰ˆåˆ™ä¸éœ€è¦ä¸‹é¢çš„é…ç½®ã€‚[m
[31m-[m
[31m-       <repositories>[m
[31m-                      <repository>[m
[31m-                             <id>spring-snapshots</id>[m
[31m-                             <name>Spring Snapshots</name>[m
[31m-                             <url>https://repo.spring.io/snapshot</url>[m
[31m-                             <snapshots>[m
[31m-[m
[31m-                                    <enabled>true</enabled>[m
[31m-                             </snapshots>[m
[31m-                      </repository>[m
[31m-                      <repository>[m
[31m-                             <id>spring-milestones</id>[m
[31m-                             <name>Spring Milestones</name>[m
[31m-                             <url>https://repo.spring.io/milestone</url>[m
[31m-                             <snapshots>[m
[31m-[m
[31m-                                    <enabled>false</enabled>[m
[31m-                             </snapshots>[m
[31m-                      </repository>[m
[31m-              </repositories>[m
[31m-              <pluginRepositories>[m
[31m-                      <pluginRepository>[m
[31m-                             <id>spring-snapshots</id>[m
[31m-                             <name>Spring Snapshots</name>[m
[31m-                             <url>https://repo.spring.io/snapshot</url>[m
[31m-                             <snapshots>[m
[31m-[m
[31m-                                    <enabled>true</enabled>[m
[31m-                             </snapshots>[m
[31m-                      </pluginRepository>[m
[31m-                      <pluginRepository>[m
[31m-                             <id>spring-milestones</id>[m
[31m-                             <name>Spring Milestones</name>[m
[31m-                             <url>https://repo.spring.io/milestone</url>[m
[31m-                             <snapshots>[m
[31m-[m
[31m-                                    <enabled>false</enabled>[m
[31m-                             </snapshots>[m
[31m-                      </pluginRepository>[m
[31m-              </pluginRepositories>[m
[31m-[m
[31m-5.2.6ã€€ç®€å•æ¼”ç¤º[m
[31m-[m
[31m-     1.æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     ä½¿ç”¨ä¸Šè¿°æ–¹æ³•æ–°å»ºSpring Booté¡¹ç›®åï¼Œç”Ÿæˆçš„é¡¹ç›®çš„æ ¹åŒ…[m
[31m-ç›®å½•ä¸‹ä¼šæœ‰ä¸€ä¸ªartifactId+Applicationå‘½åè§„åˆ™çš„å…¥å£ç±»ã€‚å¦‚å›¾[m
[31m-5-19æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                    å›¾5-19ã€€å…¥å£ç±»[m
[31m-[m
[31m-     2.æ·»åŠ æµ‹è¯•æ§åˆ¶å™¨[m
[31m-     ä¸ºäº†æ¼”ç¤ºç®€å•ï¼Œæˆ‘ä»¬ä¸å†æ–°å»ºæ§åˆ¶å™¨ç±»ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å…¥å£[m
[31m-ç±»ä¸­ç¼–å†™ä»£ç ã€‚[m
[31m-[m
[31m-       package com.wisely.ch5_2_2;[m
[31m-       import org.springframework.boot.SpringApplication;[m
[31m-       import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-       @RestController[m
[31m-       @SpringBootApplication //1[m
[31m-       public class Ch522Application {[m
[31m-[m
[31m-                @RequestMapping("/")[m
[31m-                      String index() {[m
[31m-                             return "Hello Spring Boot";[m
[31m-                      }[m
[31m-[m
[31m-              public static void main(String[] args) { //2[m
[31m-                      SpringApplication.run(Ch522Application.class, args);[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ @SpringBootApplication[m
[31m-     @SpringBootApplicationæ˜¯Spring Booté¡¹ç›®çš„æ ¸å¿ƒæ³¨è§£ï¼Œä¸»[m
[31m-è¦ç›®çš„æ˜¯å¼€å¯è‡ªåŠ¨é…ç½®ã€‚æˆ‘ä»¬å°†åœ¨6.1.2èŠ‚ä¸­åšæ›´è¯¦ç»†çš„è®²è§£ã€‚[m
[31m-[m
[31m-     â‘¡mainæ–¹æ³•[m
[31m-     è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Javaåº”ç”¨çš„mainæ–¹æ³•ï¼Œä¸»è¦ä½œç”¨æ˜¯ä½œä¸ºé¡¹[m
[31m-ç›®å¯åŠ¨çš„å…¥å£ã€‚æˆ‘ä»¬å°†åœ¨6.1.1èŠ‚åšæ›´è¯¦ç»†çš„è®²è§£ã€‚[m
[31m-     3.è¿è¡Œæ•ˆæœ[m
[31m-     æˆ‘ä»¬å¯ä»¥é€šè¿‡Mavenå‘½ä»¤ï¼Œè¿è¡Œé¡¹ç›®ã€‚[m
[31m-[m
[31m-       mvn spring-boot:run[m
[31m-[m
[31m-     æˆ–å•å‡»Ch522Applicationå³é”®ï¼Œåœ¨å³é”®èœå•ä¸­é€‰æ‹©ä»¥Spring[m
[31m-Boot APPæˆ–Java Applicationè¿è¡Œé¡¹ç›®ï¼Œå¦‚å›¾5-20æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾5-20ã€€å³é”®èœå•[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8080ï¼Œç»“æœå¦‚å›¾5-21æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾5-21ã€€è¿è¡Œç»“æœ[m
[31m-ç¬¬6ç« ã€€Spring Bootæ ¸å¿ƒ[m
[31m-[m
[31m-6.1ã€€åŸºæœ¬é…ç½®[m
[31m-[m
[31m-6.1.1ã€€å…¥å£ç±»å’Œ@SpringBootApplication[m
[31m-[m
[31m-     Spring Booté€šå¸¸æœ‰ä¸€ä¸ªåä¸º*Applicationçš„å…¥å£ç±»ï¼Œå…¥å£ç±»[m
[31m-é‡Œæœ‰ä¸€ä¸ªmainæ–¹æ³•ï¼Œè¿™ä¸ªmainæ–¹æ³•å…¶å®å°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„Javaåº”[m
[31m-ç”¨çš„å…¥å£æ–¹æ³•ã€‚åœ¨mainæ–¹æ³•ä¸­ä½¿ç”¨[m
[31m-SpringApplication.runï¼ˆCh522Application.classï¼Œargsï¼‰ï¼Œå¯åŠ¨[m
[31m-Spring Bootåº”ç”¨é¡¹ç›®ã€‚[m
[31m-[m
[31m-     @SpringBootApplicationæ˜¯Spring Bootçš„æ ¸å¿ƒæ³¨è§£ï¼Œå®ƒæ˜¯ä¸€[m
[31m-ä¸ªç»„åˆæ³¨è§£ï¼Œæºç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       @Target(ElementType.TYPE)[m
[31m-       @Retention(RetentionPolicy.RUNTIME)[m
[31m-       @Documented[m
[31m-       @Inherited[m
[31m-       @Configuration[m
[31m-       @EnableAutoConfiguration[m
[31m-       @ComponentScan[m
[31m-       public @interface SpringBootApplication {[m
[31m-[m
[31m-              Class<?>[] exclude() default {};[m
[31m-              String[] excludeName() default {};[m
[31m-       }[m
[31m-[m
[31m-     @SpringBootApplicationæ³¨è§£ä¸»è¦ç»„åˆäº†@Configurationã€[m
[31m-@EnableAutoConfigurationã€@ComponentScanï¼›è‹¥ä¸ä½¿ç”¨[m
[31m-@SpringBootApplicationæ³¨è§£ï¼Œåˆ™å¯ä»¥åœ¨å…¥å£ç±»ä¸Šç›´æ¥ä½¿ç”¨[m
[31m-@Configurationã€@EnableAutoConfigurationã€[m
[31m-@ComponentScanã€‚[m
[31m-[m
[31m-     å…¶ä¸­ï¼Œ@EnableAutoConfigurationè®©Spring Bootæ ¹æ®ç±»è·¯å¾„[m
[31m-ä¸­çš„jaråŒ…ä¾èµ–ä¸ºå½“å‰é¡¹ç›®è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚[m
[31m-[m
[31m-     ä¾‹å¦‚ï¼Œæ·»åŠ äº†spring-boot-starter-webä¾èµ–ï¼Œä¼šè‡ªåŠ¨æ·»åŠ [m
[31m-Tomcatå’ŒSpring MVCçš„ä¾èµ–ï¼Œé‚£ä¹ˆSpring Bootä¼šå¯¹Tomcatå’Œ[m
[31m-Spring MVCè¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚[m
[31m-[m
[31m-     åˆå¦‚ï¼Œæ·»åŠ äº†spring-boot-starter-data-jpaä¾èµ–ï¼ŒSpring Boot[m
[31m-ä¼šè‡ªåŠ¨è¿›è¡ŒJPAç›¸å…³çš„é…ç½®ã€‚[m
[31m-[m
[31m-     Spring Bootä¼šè‡ªåŠ¨æ‰«æ@SpringBootApplicationæ‰€åœ¨ç±»çš„åŒ[m
[31m-çº§åŒ…ï¼ˆå¦‚com.wisely.ch5_2_2ï¼‰ä»¥åŠä¸‹çº§åŒ…é‡Œçš„Beanï¼ˆè‹¥ä¸ºJPA[m
[31m-é¡¹ç›®è¿˜å¯ä»¥æ‰«ææ ‡æ³¨@Entityçš„å®ä½“ç±»ï¼‰ã€‚å»ºè®®å…¥å£ç±»æ”¾ç½®çš„[m
[31m-ä½ç½®åœ¨groupId+arctifactIDç»„åˆçš„åŒ…åä¸‹ã€‚[m
[31m-[m
[31m-6.1.2ã€€å…³é—­ç‰¹å®šçš„è‡ªåŠ¨é…ç½®[m
[31m-[m
[31m-     é€šè¿‡ä¸Šé¢çš„@SpringBootApplicationçš„æºç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ[m
[31m-å…³é—­ç‰¹å®šçš„è‡ªåŠ¨é…ç½®åº”è¯¥ä½¿ç”¨@SpringBootApplicationæ³¨è§£çš„[m
[31m-excludeå‚æ•°ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-@SpringBootApplication(exclude        =[m
[31m-{DataSourceAutoConfiguration.class})[m
[31m-6.1.3ã€€å®šåˆ¶Banner[m
[31m-[m
[31m-     1.ä¿®æ”¹Banner[m
[31m-     ï¼ˆ1ï¼‰åœ¨Spring Bootå¯åŠ¨çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªé»˜è®¤å¯åŠ¨å›¾æ¡ˆï¼Œå¦‚[m
[31m-å›¾6-1æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                 å›¾6-1ã€€é»˜è®¤å¯åŠ¨å›¾æ¡ˆ[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰æˆ‘ä»¬åœ¨src/main/resourcesä¸‹æ–°å»ºä¸€ä¸ªbanner.txtã€‚[m
[31m-     ï¼ˆ3ï¼‰é€šè¿‡http://patorjk.com/software/taagç½‘ç«™ç”Ÿæˆå­—ç¬¦ï¼Œå¦‚[m
[31m-æ•²å…¥çš„ä¸ºâ€œWISELYâ€ï¼Œå°†ç½‘ç«™ç”Ÿæˆçš„å­—ç¬¦å¤åˆ¶åˆ°banner.txtä¸­ã€‚[m
[31m-     ï¼ˆ4ï¼‰è¿™æ—¶å†å¯åŠ¨ç¨‹åºï¼Œå›¾æ¡ˆå°†å˜ä¸ºå¦‚å›¾6-2æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                 å›¾6-2ã€€æ”¹å˜åçš„å›¾æ¡ˆ[m
[31m-[m
[31m-     2.å…³é—­banner[m
[31m-     ï¼ˆ1ï¼‰mainé‡Œçš„å†…å®¹ä¿®æ”¹ä¸ºï¼š[m
[31m-       SpringApplication app = new SpringApplication(Ch522Application.class);[m
[31m-       app.setShowBanner(false);[m
[31m-       app.run(args);[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰æˆ–ä½¿ç”¨fluent APIä¿®æ”¹ä¸ºï¼š[m
[31m-[m
[31m-       new SpringApplicationBuilder(Ch522Application.class)[m
[31m-                                    .showBanner(false)[m
[31m-                                    .run(args);[m
[31m-[m
[31m-6.1.4ã€€Spring Bootçš„é…ç½®æ–‡ä»¶[m
[31m-[m
[31m-     Spring Bootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶application.properties[m
[31m-æˆ–application.ymlï¼Œæ”¾ç½®åœ¨src/main/resourcesç›®å½•æˆ–è€…ç±»è·¯å¾„[m
[31m-çš„/configä¸‹ã€‚[m
[31m-[m
[31m-     Spring Bootä¸ä»…æ”¯æŒå¸¸è§„çš„propertiesé…ç½®æ–‡ä»¶ï¼Œè¿˜æ”¯æŒ[m
[31m-yamlè¯­è¨€çš„é…ç½®æ–‡ä»¶ã€‚yamlæ˜¯ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„è¯­è¨€ï¼Œåœ¨é…ç½®æ•°[m
[31m-æ®çš„æ—¶å€™å…·æœ‰é¢å‘å¯¹è±¡çš„ç‰¹å¾ã€‚[m
[31m-[m
[31m-     Spring Bootçš„å…¨å±€é…ç½®æ–‡ä»¶çš„ä½œç”¨æ˜¯å¯¹ä¸€äº›é»˜è®¤é…ç½®çš„é…[m
[31m-ç½®å€¼è¿›è¡Œä¿®æ”¹ã€‚[m
[31m-[m
[31m-     1.ç®€å•ç¤ºä¾‹[m
[31m-     å°†Tomcatçš„é»˜è®¤ç«¯å£å·8080ä¿®æ”¹ä¸º9090ï¼Œå¹¶å°†é»˜è®¤çš„è®¿é—®[m
[31m-è·¯å¾„â€œ/â€ä¿®æ”¹ä¸ºâ€œ/hellobootâ€ã€‚[m
[31m-     å¯ä»¥åœ¨application.propertiesä¸­æ·»åŠ ï¼š[m
[31m-       server.port=9090[m
[31m-       server.context-path=/helloboot[m
[31m-[m
[31m-     æˆ–åœ¨application.ymlä¸­æ·»åŠ ï¼š[m
[31m-[m
[31m-       server:[m
[31m-           port: 9090[m
[31m-           contextPath: /helloboot[m
[31m-[m
[31m-     ä»ä¸Šé¢çš„é…ç½®å¯ä»¥çœ‹å‡ºï¼Œåœ¨Spring Bootä¸­ï¼Œcontext-pathã€[m
[31m-contextPathæˆ–è€…CONTEXT_PATHå½¢å¼å…¶å®æ˜¯é€šç”¨çš„ã€‚å¹¶ä¸”ï¼Œ[m
[31m-yamlçš„é…ç½®æ›´ç®€æ´æ¸…æ™°ã€‚ç›®å‰STS 3.7.0å·²å¼€å§‹æ”¯æŒyamlè¯­è¨€é…[m
[31m-ç½®ï¼Œè€ŒIntelliJ IDEAåˆ™åªå¯¹Spring Bootçš„propertiesé…ç½®æä¾›äº†[m
[31m-è‡ªåŠ¨æç¤ºçš„åŠŸèƒ½ï¼Œä¸”@PropertySourceæ³¨è§£ä¹Ÿä¸æ”¯æŒåŠ è½½yaml[m
[31m-æ–‡ä»¶ã€‚åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¹ æƒ¯äºç”¨propertiesæ–‡ä»¶æ¥é…ç½®ï¼Œæ‰€[m
[31m-ä»¥ç›®å‰æ¨èä½¿ç”¨propertiesè¿›è¡Œé…ç½®ã€‚[m
[31m-[m
[31m-     åœ¨é™„å½•A.3ä¸­æœ‰Spring Bootå¸¸ç”¨é…ç½®çš„åˆ—è¡¨ã€‚[m
[31m-[m
[31m-6.1.5ã€€starter pom[m
[31m-[m
[31m-     Spring Bootä¸ºæˆ‘ä»¬æä¾›äº†ç®€åŒ–ä¼ä¸šçº§å¼€å‘ç»å¤§å¤šæ•°åœºæ™¯çš„[m
[31m-starter pomï¼Œåªè¦ä½¿ç”¨äº†åº”ç”¨åœºæ™¯æ‰€éœ€è¦çš„starter pomï¼Œç›¸å…³çš„[m
[31m-æŠ€æœ¯é…ç½®å°†ä¼šæ¶ˆé™¤ï¼Œå°±å¯ä»¥å¾—åˆ°Spring Bootä¸ºæˆ‘ä»¬æä¾›çš„è‡ªåŠ¨[m
[31m-é…ç½®çš„Beanã€‚[m
[31m-1.å®˜æ–¹starter pom[m
[31m-Spring Bootå®˜æ–¹æä¾›äº†å¦‚è¡¨6-1æ‰€ç¤ºçš„starter pomã€‚[m
[31m-[m
[31m-                     è¡¨6-1ã€€å®˜æ–¹æä¾›çš„starter pom[m
[31m-     2.ç¬¬ä¸‰æ–¹starter pom[m
[31m-     é™¤å®˜æ–¹çš„starter pomå¤–ï¼Œè¿˜æœ‰ç¬¬ä¸‰æ–¹ä¸ºSpring Bootæ‰€å†™çš„[m
[31m-starter pomï¼Œå¦‚è¡¨6-2æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                          è¡¨6-2ã€€ç¬¬ä¸‰æ–¹æ‰€å†™çš„starter pom[m
[31m-[m
[31m-6.1.6ã€€ä½¿ç”¨xmlé…ç½®[m
[31m-[m
[31m-     Spring Bootæå€¡é›¶é…ç½®ï¼Œå³æ— xmlé…ç½®ï¼Œä½†æ˜¯åœ¨å®é™…é¡¹ç›®[m
[31m-ä¸­ï¼Œå¯èƒ½æœ‰ä¸€äº›ç‰¹æ®Šè¦æ±‚ä½ å¿…é¡»ä½¿ç”¨xmlé…ç½®ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥[m
[31m-é€šè¿‡Springæä¾›çš„@ImportResourceæ¥åŠ è½½xmlé…ç½®ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       @ImportResource({"classpath:some-[m
[31m-       context.xml","classpath:another-context.xml"})[m
[31m-6.2ã€€å¤–éƒ¨é…ç½®[m
[31m-[m
[31m-     Spring Bootå…è®¸ä½¿ç”¨propertiesæ–‡ä»¶ã€yamlæ–‡ä»¶æˆ–è€…å‘½ä»¤è¡Œ[m
[31m-å‚æ•°ä½œä¸ºå¤–éƒ¨é…ç½®ã€‚[m
[31m-[m
[31m-6.2.1ã€€å‘½ä»¤è¡Œå‚æ•°é…ç½®[m
[31m-[m
[31m-     Spring Bootå¯ä»¥æ˜¯åŸºäºjaråŒ…è¿è¡Œçš„ï¼Œæ‰“æˆjaråŒ…çš„ç¨‹åºå¯ä»¥[m
[31m-ç›´æ¥é€šè¿‡ä¸‹é¢å‘½ä»¤è¿è¡Œï¼š[m
[31m-[m
[31m-       java â€“jar xx.jar[m
[31m-[m
[31m-     å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹Tomcatç«¯å£å·ï¼š[m
[31m-[m
[31m-       java â€“jar xx.jar --server.port=9090[m
[31m-[m
[31m-6.2.2ã€€å¸¸è§„å±æ€§é…ç½®[m
[31m-[m
[31m-     åœ¨2.2èŠ‚æˆ‘ä»¬è®²è¿°äº†åœ¨å¸¸è§„Springç¯å¢ƒä¸‹ï¼Œæ³¨å…¥propertiesæ–‡[m
[31m-ä»¶é‡Œçš„å€¼çš„æ–¹å¼ï¼Œé€šè¿‡@PropertySourceæŒ‡æ˜propertiesæ–‡ä»¶çš„[m
[31m-ä½ç½®ï¼Œç„¶åé€šè¿‡@Valueæ³¨å…¥å€¼ã€‚åœ¨Spring Booté‡Œï¼Œæˆ‘ä»¬åªéœ€[m
[31m-åœ¨application.propertieså®šä¹‰å±æ€§ï¼Œç›´æ¥ä½¿ç”¨@Valueæ³¨å…¥å³å¯ã€‚[m
[31m-1.å®æˆ˜[m
[31m-åœ¨ä¸Šä¾‹çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œå¦‚ä¸‹çš„ä¿®æ”¹ã€‚[m
[31m-[m
[31m-ï¼ˆ1ï¼‰application.propertieså¢åŠ å±æ€§ï¼š[m
[31m-[m
[31m-book.author=wangyunfei[m
[31m-book.name[m
[31m-[m
[31m-=spring boot[m
[31m-[m
[31m-ï¼ˆ2ï¼‰ä¿®æ”¹å…¥å£ç±»ï¼š[m
[31m-[m
[31m-package com.wisely.ch5_2_2;[m
[31m-[m
[31m-import org.springframework.beans.factory.annotation.Value;[m
[31m-import org.springframework.boot.SpringApplication;[m
[31m-import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-@RestController[m
[31m-@SpringBootApplication[m
[31m-public class Ch522Application {[m
[31m-[m
[31m-         @Value("${book.author}")[m
[31m-         private String bookAuthor;[m
[31m-         @Value("${book.name}")[m
[31m-         private String bookName;[m
[31m-[m
[31m-         @RequestMapping("/")[m
[31m-              String index() {[m
[31m-                     return "book name is:"+bookName+" and book author is:" + bo[m
[31m-              }[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-              SpringApplication.run(Ch522Application.class, args);[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰è¿è¡Œï¼Œè®¿é—®http://localhostï¼š9090/helloboot/ï¼Œæ•ˆæœå¦‚[m
[31m-å›¾6-3æ‰€ç¤ºã€‚[m
[31m-[m
[31m-        å›¾6-3ã€€è¿è¡Œæ•ˆæœ[m
[31m-[m
[31m-6.2.3ã€€ç±»å‹å®‰å…¨çš„é…ç½®ï¼ˆåŸºäºpropertiesï¼‰[m
[31m-[m
[31m-     ä¸Šä¾‹ä¸­ä½¿ç”¨@Valueæ³¨å…¥æ¯ä¸ªé…ç½®åœ¨å®é™…é¡¹ç›®ä¸­ä¼šæ˜¾å¾—æ ¼å¤–[m
[31m-éº»çƒ¦ï¼Œå› ä¸ºæˆ‘ä»¬çš„é…ç½®é€šå¸¸ä¼šæ˜¯è®¸å¤šä¸ªï¼Œè‹¥ä½¿ç”¨ä¸Šä¾‹çš„æ–¹å¼åˆ™[m
[31m-[m
[31m-è¦ä½¿ç”¨@Valueæ³¨å…¥å¾ˆå¤šæ¬¡ã€‚[m
[31m-[m
[31m-Spring  Bootè¿˜æä¾›äº†åŸºäºç±»å‹å®‰å…¨çš„é…ç½®æ–¹å¼ï¼Œé€šè¿‡[m
[31m-[m
[31m-@ConfigurationPropertieså°†propertieså±æ€§å’Œä¸€ä¸ªBeanåŠå…¶å±æ€§[m
[31m-[m
[31m-å…³è”ï¼Œä»è€Œå®ç°ç±»å‹å®‰å…¨çš„é…ç½®ã€‚[m
[31m-[m
[31m-1.å®æˆ˜[m
[31m-[m
[31m-ï¼ˆ1ï¼‰æ–°å»ºSpring Booté¡¹ç›®ï¼Œå¦‚å›¾6-4æ‰€ç¤ºã€‚[m
[31m-                      å›¾6-4ã€€æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-ï¼ˆ2ï¼‰æ·»åŠ é…ç½®ï¼Œå³åœ¨application.propertiesä¸Šæ·»åŠ ï¼š[m
[31m-[m
[31m-author.name=wyf[m
[31m-author.age[m
[31m-[m
[31m-=32[m
[31m-     å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ–°å»ºä¸€ä¸ªpropertiesæ–‡ä»¶ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬[m
[31m-åœ¨@ConfigurationPropertiesçš„å±æ€§locationsé‡ŒæŒ‡å®špropertiesçš„[m
[31m-ä½ç½®ï¼Œä¸”éœ€è¦åœ¨å…¥å£ç±»ä¸Šé…ç½®ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰ç±»å‹å®‰å…¨çš„Beanï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       package com.wisely.ch6_2_3.config;[m
[31m-[m
[31m-       import org.springframework.boot.context.properties.ConfigurationPropert[m
[31m-[m
[31m-       @Component[m
[31m-       @ConfigurationProperties(prefix = "author") //1[m
[31m-       public class AuthorSettings {[m
[31m-[m
[31m-              private String name;[m
[31m-              private Long age;[m
[31m-[m
[31m-              public String getName() {[m
[31m-                      return name;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              public void setName(String name) {[m
[31m-                      this.name = name;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              public Long getAge() {[m
[31m-                      return age;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              public void setAge(Long age) {[m
[31m-                      this.age = age;[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é€šè¿‡@ConfigurationPropertiesåŠ è½½propertiesæ–‡ä»¶å†…çš„é…[m
[31m-ç½®ï¼Œé€šè¿‡prefixå±æ€§æŒ‡å®špropertiesçš„é…ç½®çš„å‰ç¼€ï¼Œé€šè¿‡locations[m
[31m-æŒ‡å®špropertiesæ–‡ä»¶çš„ä½ç½®ï¼Œä¾‹å¦‚ï¼š[m
[31m-       @ConfigurationProperties(prefix = "author",locations = {"classpath:conf[m
[31m-[m
[31m-     æœ¬ä¾‹ä¸éœ€è¦é…ç½®locationsã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰æ£€éªŒä»£ç ï¼š[m
[31m-[m
[31m-       package com.wisely.ch6_2_3;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.boot.SpringApplication;[m
[31m-       import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-       import com.wisely.ch6_2_3.config.AuthorSettings;[m
[31m-       @RestController[m
[31m-       @SpringBootApplication[m
[31m-       public class Ch623Application {[m
[31m-[m
[31m-              @Autowired[m
[31m-              private AuthorSettings authorSettings; //1[m
[31m-[m
[31m-              @RequestMapping("/")[m
[31m-              public String index(){[m
[31m-[m
[31m-                      return "author name is "+ authorSettings.getName()+" and author[m
[31m-              }[m
[31m-[m
[31m-              public static void main(String[] args) {[m
[31m-                      SpringApplication.run(Ch623Application.class, args);[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ å¯ä»¥ç”¨@Autowiredç›´æ¥æ³¨å…¥è¯¥é…ç½®ã€‚[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰è¿è¡Œï¼Œè®¿é—®ï¼šhttp://localhostï¼š8080/ï¼Œæ•ˆæœå¦‚å›¾6-5æ‰€[m
[31m-ç¤ºã€‚[m
[31m-å›¾6-5ã€€è¿è¡Œæ•ˆæœ[m
[31m-6.3ã€€æ—¥å¿—é…ç½®[m
[31m-[m
[31m-     Spring Bootæ”¯æŒJava Util Loggingã€Log4Jã€Log4J2å’Œ[m
[31m-Logbackä½œä¸ºæ—¥å¿—æ¡†æ¶ï¼Œæ— è®ºä½¿ç”¨å“ªç§æ—¥å¿—æ¡†æ¶ï¼ŒSpring Boot[m
[31m-å·²ä¸ºå½“å‰ä½¿ç”¨æ—¥å¿—æ¡†æ¶çš„æ§åˆ¶å°è¾“å‡ºåŠæ–‡ä»¶è¾“å‡ºåšå¥½äº†é…ç½®ï¼Œ[m
[31m-å¯å¯¹æ¯”4.2.2èŠ‚ä¸­æ²¡æœ‰Spring Bootæ—¶æ—¥å¿—é…ç½®çš„æ–¹å¼ã€‚[m
[31m-[m
[31m-     é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Bootä½¿ç”¨Logbackä½œä¸ºæ—¥å¿—æ¡†æ¶ã€‚[m
[31m-     é…ç½®æ—¥å¿—çº§åˆ«ï¼š[m
[31m-[m
[31m-       logging.file=D:/mylog[m
[31m-[m
[31m-       /log.log[m
[31m-[m
[31m-     é…ç½®æ—¥å¿—æ–‡ä»¶ï¼Œæ ¼å¼ä¸ºlogging.level.åŒ…å=çº§åˆ«ï¼š[m
[31m-[m
[31m-       logging.level.org.springframework.web= DEBUG[m
[31m-6.4ã€€Profileé…ç½®[m
[31m-[m
[31m-     Profileæ˜¯Springç”¨æ¥é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒå¯¹ä¸åŒçš„é…ç½®æä¾›æ”¯æŒ[m
[31m-çš„ï¼Œå…¨å±€Profileé…ç½®ä½¿ç”¨application-{profile}.propertiesï¼ˆå¦‚[m
[31m-application-prod.propertiesï¼‰ã€‚[m
[31m-[m
[31m-     é€šè¿‡åœ¨application.propertiesä¸­è®¾ç½®[m
[31m-spring.profiles.active=prodæ¥æŒ‡å®šæ´»åŠ¨çš„Profileã€‚[m
[31m-[m
[31m-     ä¸‹é¢å°†åšä¸€ä¸ªæœ€ç®€å•çš„æ¼”ç¤ºï¼Œå¦‚æˆ‘ä»¬åˆ†ä¸ºç”Ÿäº§ï¼ˆprodï¼‰å’Œ[m
[31m-å¼€å‘ï¼ˆdevï¼‰ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒä¸‹ç«¯å£å·ä¸º80ï¼Œå¼€å‘ç¯å¢ƒä¸‹ç«¯å£[m
[31m-ä¸º8888ã€‚[m
[31m-[m
[31m-å®æˆ˜[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ–°å»ºSpring Booté¡¹ç›®ï¼Œå¦‚å›¾6-6æ‰€ç¤ºã€‚[m
[31m-                      å›¾6-6ã€€æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-ï¼ˆ2ï¼‰ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒä¸‹çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š[m
[31m-application-prod.propertiesï¼š[m
[31m-[m
[31m-server.port=80[m
[31m-[m
[31m-application-dev.propertiesï¼š[m
[31m-server.port=8888[m
[31m-[m
[31m-æ­¤æ—¶ç›®å½•ç»“æ„å¦‚å›¾6-7æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾6-7ã€€ç›®å½•ç»“æ„[m
[31m-[m
[31m-ï¼ˆ3ï¼‰è¿è¡Œã€‚[m
[31m-application.propertieså¢åŠ ï¼š[m
[31m-[m
[31m-spring.profiles.active=dev[m
[31m-[m
[31m-å¯åŠ¨ç¨‹åºç»“æœä¸ºï¼š[m
[31m-ä¿®æ”¹application.propertiesï¼š[m
[31m-[m
[31m-spring.profiles.active=prod[m
[31m-6.5ã€€Spring Bootè¿è¡ŒåŸç†[m
[31m-[m
[31m-     åœ¨å‰é¢å‡ ä¸ªç« èŠ‚ï¼Œæˆ‘ä»¬è§è¯†äº†Spring Bootä¸ºæˆ‘ä»¬åšçš„è‡ªåŠ¨[m
[31m-é…ç½®ï¼Œä¸ºäº†è®©å¤§å®¶å¿«é€Ÿé¢†ç•¥Spring Bootçš„é­…åŠ›ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬èŠ‚[m
[31m-å…ˆé€šè¿‡åˆ†æSpring Bootçš„è¿è¡ŒåŸç†åï¼Œæ ¹æ®å·²æŒæ¡çš„çŸ¥è¯†è‡ªå®š[m
[31m-ä¹‰ä¸€ä¸ªstarter pomã€‚[m
[31m-[m
[31m-     åœ¨3.5ç« ä¸­æˆ‘ä»¬äº†è§£åˆ°Spring 4.xæä¾›äº†åŸºäºæ¡ä»¶æ¥é…ç½®[m
[31m-Beançš„èƒ½åŠ›ï¼Œå…¶å®Spring Bootçš„ç¥å¥‡çš„å®ç°ä¹Ÿæ˜¯åŸºäºè¿™ä¸€åŸç†[m
[31m-çš„ã€‚[m
[31m-[m
[31m-     æœ¬èŠ‚è™½ç„¶æ²¡æœ‰æ‘†åœ¨ä¹¦çš„æ˜¾è‘—ä½ç½®ï¼Œä½†æ˜¯æœ¬èŠ‚çš„å†…å®¹æ˜¯ç†è§£[m
[31m-[m
[31m-Spring Bootè¿ä½œåŸç†çš„å…³é”®ã€‚æˆ‘ä»¬å¯ä»¥å€ŸåŠ©è¿™ä¸€ç‰¹æ€§æ¥ç†è§£[m
[31m-Spring Bootè¿è¡Œè‡ªåŠ¨é…ç½®çš„åŸç†ï¼Œå¹¶å®ç°è‡ªå·±çš„è‡ªåŠ¨é…ç½®ã€‚[m
[31m-[m
[31m-Spring  Bootå…³äºè‡ªåŠ¨é…ç½®çš„æºç åœ¨spring-boot-[m
[31m-[m
[31m-autoconfigure-1.3.0.x.jarå†…ï¼Œä¸»è¦åŒ…å«äº†å¦‚å›¾6-8æ‰€ç¤ºçš„é…ç½®ã€‚[m
[31m-                                  å›¾6-8ã€€åŒ…å«çš„é…ç½®[m
[31m-[m
[31m-     è‹¥æƒ³çŸ¥é“Spring Bootä¸ºæˆ‘ä»¬åšäº†å“ªäº›è‡ªåŠ¨é…ç½®ï¼Œå¯ä»¥æŸ¥çœ‹[m
[31m-è¿™é‡Œçš„æºç ã€‚[m
[31m-[m
[31m-     å¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰ç§æ–¹å¼æŸ¥çœ‹å½“å‰é¡¹ç›®ä¸­å·²å¯ç”¨å’Œæœªå¯ç”¨çš„[m
[31m-è‡ªåŠ¨é…ç½®çš„æŠ¥å‘Šã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰è¿è¡Œjaræ—¶å¢åŠ --debugå‚æ•°ï¼š[m
[31m-java -jar xx.jar --debug[m
[31m-[m
[31m-ï¼ˆ2ï¼‰åœ¨application.propertiesä¸­è®¾ç½®å±æ€§ï¼š[m
[31m-[m
[31m-debug=true[m
[31m-[m
[31m-ï¼ˆ3ï¼‰åœ¨STSä¸­è®¾ç½®ï¼Œå¦‚å›¾6-9æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                           å›¾6-9ã€€åœ¨STSä¸­è®¾ç½®[m
[31m-æ­¤æ—¶å¯åŠ¨ï¼Œå¯åœ¨æ§åˆ¶å°è¾“å‡ºã€‚å·²å¯ç”¨çš„è‡ªåŠ¨é…ç½®ä¸ºï¼š[m
[31m-[m
[31m-æœªå¯ç”¨çš„è‡ªåŠ¨é…ç½®ä¸ºï¼š[m
[31m-[m
[31m-6.5.1ã€€è¿ä½œåŸç†[m
[31m-[m
[31m-å…³äºSpring    Bootçš„è¿ä½œåŸç†ï¼Œæˆ‘ä»¬è¿˜æ˜¯å›å½’åˆ°[m
[31m-[m
[31m-@SpringBootApplicationæ³¨è§£ä¸Šæ¥ï¼Œè¿™ä¸ªæ³¨è§£æ˜¯ä¸€ä¸ªç»„åˆæ³¨[m
[31m-[m
[31m-è§£ï¼Œå®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯ç”±@EnableAutoConfigurationæ³¨è§£æä¾›[m
[31m-[m
[31m-çš„ã€‚[m
[31m-[m
[31m-ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹@EnableAutoConfigurationæ³¨è§£çš„æºç ï¼š[m
[31m-[m
[31m-@Target(ElementType.TYPE)[m
[31m-@Retention(RetentionPolicy.RUNTIME)[m
[31m-@Documented[m
[31m-@Inherited[m
[31m-@Import({ EnableAutoConfigurationImportSelector.class,[m
[31m-[m
[31m-              AutoConfigurationPackages.Registrar.class })[m
[31m-public @interface EnableAutoConfiguration {[m
[31m-[m
[31m-       Class<?>[] exclude() default {};[m
[31m-       String[] excludeName() default {};[m
[31m-       }[m
[31m-[m
[31m-     è¿™é‡Œçš„å…³é”®åŠŸèƒ½æ˜¯@Importæ³¨è§£å¯¼å…¥çš„é…ç½®åŠŸèƒ½ï¼Œ[m
[31m-EnableAutoConfigurationImportSelectorä½¿ç”¨[m
[31m-SpringFactoriesLoader.loadFactoryNamesæ–¹æ³•æ¥æ‰«æå…·æœ‰META-[m
[31m-INF/spring.factoriesæ–‡ä»¶çš„jaråŒ…ï¼Œè€Œæˆ‘ä»¬çš„spring-boot-[m
[31m-autoconfigure-1.3.0.x.jaré‡Œå°±æœ‰ä¸€ä¸ªspring.factoriesæ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶[m
[31m-ä¸­å£°æ˜äº†æœ‰å“ªäº›è‡ªåŠ¨é…ç½®ï¼Œå¦‚å›¾6-10æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾6-10ã€€è‡ªåŠ¨é…ç½®[m
[31m-[m
[31m-6.5.2ã€€æ ¸å¿ƒæ³¨è§£[m
[31m-[m
[31m-     æ‰“å¼€ä¸Šé¢ä»»æ„ä¸€ä¸ªAutoConfigurationæ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½æœ‰ä¸‹é¢[m
[31m-çš„æ¡ä»¶æ³¨è§£ï¼Œåœ¨spring-boot-autoconfigure-1.3.0.x.jarçš„[m
[31m-org.springframwork.boot.autoconfigure.conditionåŒ…ä¸‹ï¼Œæ¡ä»¶æ³¨è§£[m
[31m-å¦‚ä¸‹ã€‚[m
[31m-     @ConditionalOnBeanï¼šå½“å®¹å™¨é‡Œæœ‰æŒ‡å®šçš„Beançš„æ¡ä»¶ä¸‹ã€‚[m
[31m-[m
[31m-     @ConditionalOnClassï¼šå½“ç±»è·¯å¾„ä¸‹æœ‰æŒ‡å®šçš„ç±»çš„æ¡ä»¶ä¸‹ã€‚[m
[31m-[m
[31m-     @ConditionalOnExpressionï¼šåŸºäºSpELè¡¨è¾¾å¼ä½œä¸ºåˆ¤æ–­æ¡[m
[31m-ä»¶ã€‚[m
[31m-[m
[31m-     @ConditionalOnJavaï¼šåŸºäºJVMç‰ˆæœ¬ä½œä¸ºåˆ¤æ–­æ¡ä»¶ã€‚[m
[31m-[m
[31m-     @ConditionalOnJndiï¼šåœ¨JNDIå­˜åœ¨çš„æ¡ä»¶ä¸‹æŸ¥æ‰¾æŒ‡å®šçš„ä½[m
[31m-ç½®ã€‚[m
[31m-[m
[31m-     @ConditionalOnMissingBeanï¼šå½“å®¹å™¨é‡Œæ²¡æœ‰æŒ‡å®šBeançš„æƒ…[m
[31m-å†µä¸‹ã€‚[m
[31m-[m
[31m-     @ConditionalOnMissingClassï¼šå½“ç±»è·¯å¾„ä¸‹æ²¡æœ‰æŒ‡å®šçš„ç±»çš„[m
[31m-æ¡ä»¶ä¸‹ã€‚[m
[31m-[m
[31m-     @ConditionalOnNotWebApplicationï¼šå½“å‰é¡¹ç›®ä¸æ˜¯Webé¡¹[m
[31m-ç›®çš„æ¡ä»¶ä¸‹ã€‚[m
[31m-[m
[31m-     @ConditionalOnPropertyï¼šæŒ‡å®šçš„å±æ€§æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼ã€‚[m
[31m-[m
[31m-     @ConditionalOnResourceï¼šç±»è·¯å¾„æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼ã€‚[m
[31m-[m
[31m-     @ConditionalOnSingleCandidateï¼šå½“æŒ‡å®šBeanåœ¨å®¹å™¨ä¸­åª[m
[31m-æœ‰ä¸€ä¸ªï¼Œæˆ–è€…è™½ç„¶æœ‰å¤šä¸ªä½†æ˜¯æŒ‡å®šé¦–é€‰çš„Beanã€‚[m
[31m-[m
[31m-     @ConditionalOnWebApplicationï¼šå½“å‰é¡¹ç›®æ˜¯Webé¡¹ç›®çš„æ¡[m
[31m-ä»¶ä¸‹ã€‚[m
[31m-[m
[31m-     è¿™äº›æ³¨è§£éƒ½æ˜¯ç»„åˆäº†@Conditionalå…ƒæ³¨è§£ï¼Œåªæ˜¯ä½¿ç”¨äº†ä¸[m
[31m-åŒçš„æ¡ä»¶ï¼ˆConditionï¼‰ï¼Œæˆ‘ä»¬åœ¨3.5èŠ‚å·²åšè¿‡é˜è¿°å®šä¹‰ä¸€ä¸ªæ ¹[m
[31m-æ®æ¡ä»¶åˆ›å»ºä¸åŒBeançš„æ¼”ç¤ºã€‚[m
[31m-     ä¸‹é¢æˆ‘ä»¬ç”¨åœ¨3.5èŠ‚å­¦è¿‡çš„çŸ¥è¯†ç®€å•åˆ†æä¸€ä¸‹[m
[31m-@ConditionalOnWebApplicationæ³¨è§£ã€‚[m
[31m-[m
[31m-       package org.springframework.boot.autoconfigure.condition;[m
[31m-[m
[31m-       import java.lang.annotation.Documented;[m
[31m-       import java.lang.annotation.ElementType;[m
[31m-       import java.lang.annotation.Retention;[m
[31m-       import java.lang.annotation.RetentionPolicy;[m
[31m-       import java.lang.annotation.Target;[m
[31m-[m
[31m-       import org.springframework.context.annotation.Conditional;[m
[31m-       @Target({ ElementType.TYPE, ElementType.METHOD })[m
[31m-       @Retention(RetentionPolicy.RUNTIME)[m
[31m-       @Documented[m
[31m-       @Conditional(OnWebApplicationCondition.class)[m
[31m-       public @interface ConditionalOnWebApplication {[m
[31m-       }[m
[31m-[m
[31m-     ä»æºç å¯ä»¥çœ‹å‡ºï¼Œæ­¤æ³¨è§£ä½¿ç”¨çš„æ¡ä»¶æ˜¯[m
[31m-OnWebApplicationConditionï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªæ¡ä»¶æ˜¯å¦‚ä½•æ„[m
[31m-é€ çš„ï¼š[m
[31m-[m
[31m-       package org.springframework.boot.autoconfigure.condition;[m
[31m-[m
[31m-       import org.springframework.context.annotation.Condition;[m
[31m-       import org.springframework.context.annotation.ConditionContext;[m
[31m-       import org.springframework.core.Ordered;[m
[31m-       import org.springframework.core.annotation.Order;[m
[31m-       import org.springframework.core.type.AnnotatedTypeMetadata;[m
[31m-       import org.springframework.util.ClassUtils;[m
[31m-       import org.springframework.util.ObjectUtils;[m
[31m-       import org.springframework.web.context.WebApplicationContext;[m
[31m-       import org.springframework.web.context.support.StandardServletEnvironme[m
[31m-[m
[31m-       @Order(Ordered.HIGHEST_PRECEDENCE + 20)[m
[31m-       class OnWebApplicationCondition extends SpringBootCondition {[m
[31m-[m
[31m-              private static final String WEB_CONTEXT_CLASS = "org.springframewor[m
[31m-                             + "support.GenericWebApplicationContext";[m
[31m-       @Override[m
[31m-       public ConditionOutcome getMatchOutcome(ConditionContext context,[m
[31m-[m
[31m-                     AnnotatedTypeMetadata metadata) {[m
[31m-              boolean webApplicationRequired = metadata[m
[31m-[m
[31m-                             .isAnnotated(ConditionalOnWebApplication.class.getName([m
[31m-              ConditionOutcome webApplication = isWebApplication(context, met[m
[31m-[m
[31m-              if (webApplicationRequired && !webApplication.isMatch()) {[m
[31m-                     return ConditionOutcome.noMatch(webApplication.getMessage()[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              if (!webApplicationRequired && webApplication.isMatch()) {[m
[31m-                     return ConditionOutcome.noMatch(webApplication.getMessage()[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              return ConditionOutcome.match(webApplication.getMessage());[m
[31m-       }[m
[31m-[m
[31m-       private ConditionOutcome isWebApplication(ConditionContext context,[m
[31m-                     AnnotatedTypeMetadata metadata) {[m
[31m-[m
[31m-              if (!ClassUtils.isPresent(WEB_CONTEXT_CLASS, context.getClassLo[m
[31m-                     return ConditionOutcome.noMatch("web application classes no[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              if (context.getBeanFactory() != null) {[m
[31m-                     String[] scopes = context.getBeanFactory().getRegisteredSco[m
[31m-                     if (ObjectUtils.containsElement(scopes, "session")) {[m
[31m-                             return ConditionOutcome.match("found web application 's[m
[31m-                     }[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              if (context.getEnvironment() instanceof StandardServletEnvironm[m
[31m-                     return ConditionOutcome[m
[31m-                                    .match("found web application StandardServletEnviro[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              if (context.getResourceLoader() instanceof WebApplicationContex[m
[31m-                     return ConditionOutcome.match("found web application WebApp[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              return ConditionOutcome.noMatch("not a web application");[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-     ä»isWebApplicationæ–¹æ³•å¯ä»¥çœ‹å‡ºï¼Œåˆ¤æ–­æ¡ä»¶æ˜¯ï¼š[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰GenericWebApplicationContextæ˜¯å¦åœ¨ç±»è·¯å¾„ä¸­ï¼›[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰å®¹å™¨é‡Œæ˜¯å¦æœ‰åä¸ºsessionçš„scopeï¼›[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰å½“å‰å®¹å™¨çš„Enviromentæ˜¯å¦ä¸º[m
[31m-StandardServletEnvironmentï¼›[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰å½“å‰çš„ResourceLoaderæ˜¯å¦ä¸º[m
[31m-WebApplicationContextï¼ˆResourceLoaderæ˜¯ApplicationContext[m
[31m-çš„é¡¶çº§æ¥å£ä¹‹ä¸€ï¼‰ï¼›[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰æˆ‘ä»¬éœ€è¦æ„é€ ConditionOutcomeç±»çš„å¯¹è±¡æ¥å¸®åŠ©æˆ‘[m
[31m-ä»¬ï¼Œæœ€ç»ˆé€šè¿‡ConditionOutcome.isMatchæ–¹æ³•è¿”å›å¸ƒå°”å€¼æ¥ç¡®å®š[m
[31m-æ¡ä»¶ã€‚[m
[31m-[m
[31m-6.5.3ã€€å®ä¾‹åˆ†æ[m
[31m-[m
[31m-     åœ¨äº†è§£äº†Spring Bootçš„è¿ä½œåŸç†å’Œä¸»è¦çš„æ¡ä»¶æ³¨è§£åï¼Œç°[m
[31m-åœ¨æ¥åˆ†æä¸€ä¸ªç®€å•çš„Spring Bootå†…ç½®çš„è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼šhttpçš„[m
[31m-ç¼–ç é…ç½®ã€‚[m
[31m-[m
[31m-     æˆ‘ä»¬åœ¨å¸¸è§„é¡¹ç›®ä¸­é…ç½®httpç¼–ç çš„æ—¶å€™æ˜¯åœ¨web.xmlé‡Œé…ç½®[m
[31m-ä¸€ä¸ªfilterï¼Œå¦‚ï¼š[m
[31m-[m
[31m-       <filter>[m
[31m-           <filter-name>encodingFilter</filter-name>[m
[31m-                                                                                                       <filter-[m
[31m-[m
[31m-       class>org.springframework.web.filter.CharacterEncodingFilter[m
[31m-           </filter-class>[m
[31m-           <init-param>[m
[31m-             <param-name>encoding</param-name>[m
[31m-             <param-value>UTF-8</param-value>[m
[31m-           </init-param>[m
[31m-           <init-param>[m
[31m-[m
[31m-             <param-name>forceEncoding</param-name>[m
[31m-             <param-value>true</param-value>[m
[31m-           </init-param>[m
[31m-         </filter>[m
[31m-[m
[31m-     è‡ªåŠ¨é…ç½®è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰èƒ½é…ç½®CharacterEncodingFilterè¿™ä¸ªBeanï¼›[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰èƒ½é…ç½®encodingå’ŒforceEncodingè¿™ä¸¤ä¸ªå‚æ•°ã€‚[m
[31m-[m
[31m-     1.é…ç½®å‚æ•°[m
[31m-[m
[31m-     åœ¨6.2.3èŠ‚æˆ‘ä»¬è®²è¿°äº†ç±»å‹å®‰å…¨çš„é…ç½®ï¼ŒSpring Bootçš„è‡ªåŠ¨[m
[31m-é…ç½®ä¹Ÿæ˜¯åŸºäºè¿™ä¸€ç‚¹å®ç°çš„ï¼Œè¿™é‡Œçš„é…ç½®ç±»å¯ä»¥åœ¨[m
[31m-application.propertiesä¸­ç›´æ¥è®¾ç½®ï¼Œæºç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       @ConfigurationProperties(prefix = "spring.http.encoding")//1[m
[31m-       public class HttpEncodingProperties {[m
[31m-[m
[31m-              public static final Charset DEFAULT_CHARSET = Charset.forName("UTF-[m
[31m-       8");//2[m
[31m-[m
[31m-              private Charset charset = DEFAULT_CHARSET; //2[m
[31m-[m
[31m-              private boolean force = true; //3[m
[31m-[m
[31m-              public Charset getCharset() {[m
[31m-                      return this.charset;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              public void setCharset(Charset charset) {[m
[31m-                      this.charset = charset;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              public boolean isForce() {[m
[31m-                      return this.force;[m
[31m-[m
[31m-              }[m
[31m-              public void setForce(boolean force) {[m
[31m-                      this.force = force;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ åœ¨application.propertiesé…ç½®çš„æ—¶å€™å‰ç¼€æ˜¯[m
[31m-spring.http.encodingï¼›[m
[31m-[m
[31m-     â‘¡é»˜è®¤ç¼–ç æ–¹å¼ä¸ºUTF-8ï¼Œè‹¥ä¿®æ”¹å¯ä½¿ç”¨[m
[31m-spring.http.encoding.charset=ç¼–ç ï¼›[m
[31m-[m
[31m-     â‘¢è®¾ç½®forceEncodingï¼Œé»˜è®¤ä¸ºtrueï¼Œè‹¥ä¿®æ”¹å¯ä½¿ç”¨[m
[31m-spring.http.encoding.force=falseã€‚[m
[31m-[m
[31m-     2.é…ç½®Bean[m
[31m-[m
[31m-     é€šè¿‡è°ƒç”¨ä¸Šè¿°é…ç½®ï¼Œå¹¶æ ¹æ®æ¡ä»¶é…ç½®[m
[31m-CharacterEncodingFilterçš„Beanï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æºç ï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableConfigurationProperties(HttpEncodingProperties.class) //1[m
[31m-       @ConditionalOnClass(CharacterEncodingFilter.class) //2[m
[31m-       @ConditionalOnProperty(prefix = "spring.http.encoding", value = "enable[m
[31m-       public class HttpEncodingAutoConfiguration {[m
[31m-[m
[31m-              @Autowired[m
[31m-              private HttpEncodingProperties httpEncodingProperties; //[m
[31m-       ï¼“[m
[31m-[m
[31m-              @Bean//4[m
[31m-              @ConditionalOnMissingBean(CharacterEncodingFilter.class) //5[m
[31m-              public CharacterEncodingFilter characterEncodingFilter() {[m
[31m-[m
[31m-                      CharacterEncodingFilter filter = new OrderedCharacterEncodingFi[m
[31m-                      filter.setEncoding(this.httpEncodingProperties.getCharset().nam[m
[31m-                      filter.setForceEncoding(this.httpEncodingProperties.isForce());[m
[31m-                      return filter;[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ å¼€å¯å±æ€§æ³¨å…¥ï¼Œé€šè¿‡@EnableConfigurationPropertieså£°[m
[31m-æ˜ï¼Œä½¿ç”¨@Autowiredæ³¨å…¥ï¼›[m
[31m-[m
[31m-     â‘¡å½“CharacterEncodingFilteråœ¨ç±»è·¯å¾„çš„æ¡ä»¶ä¸‹ï¼›[m
[31m-[m
[31m-     â‘¢å½“è®¾ç½®spring.http.encoding=enabledçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰[m
[31m-è®¾ç½®åˆ™é»˜è®¤ä¸ºtrueï¼Œå³æ¡ä»¶ç¬¦åˆï¼›[m
[31m-[m
[31m-     â‘£åƒä½¿ç”¨Javaé…ç½®çš„æ–¹å¼é…ç½®CharacterEncodingFilterè¿™ä¸ª[m
[31m-Beanï¼›[m
[31m-[m
[31m-     â‘¤å½“å®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªBeançš„æ—¶å€™æ–°å»ºBeanã€‚[m
[31m-[m
[31m-6.5.4ã€€å®æˆ˜[m
[31m-[m
[31m-     çœ‹å®Œå‰é¢å‡ èŠ‚çš„è®²è¿°ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—Spring Bootçš„è‡ªåŠ¨é…ç½®[m
[31m-å…¶å®å¾ˆç®€å•ï¼Œæ˜¯ä¸æ˜¯è·ƒè·ƒæ¬²è¯•åœ°æƒ³è®©è‡ªå·±çš„é¡¹ç›®ä¹Ÿå…·å¤‡è¿™æ ·çš„[m
[31m-åŠŸèƒ½ã€‚å…¶å®æˆ‘ä»¬å®Œå…¨å¯ä»¥ä»¿ç…§ä¸Šé¢httpç¼–ç é…ç½®çš„ä¾‹å­è‡ªå·±å†™[m
[31m-ä¸€ä¸ªè‡ªåŠ¨é…ç½®ï¼Œä¸è¿‡è¿™é‡Œå†åšçš„å½»åº•ç‚¹ï¼Œæˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ª[m
[31m-starter pomï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¸ä»…æœ‰è‡ªåŠ¨é…ç½®çš„åŠŸèƒ½ï¼Œè€Œä¸”å…·æœ‰[m
[31m-æ›´é€šç”¨çš„è€¦åˆåº¦æ›´ä½çš„é…ç½®ã€‚[m
[31m-[m
[31m-     ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œåœ¨è¿™é‡Œä¸¾ä¸€ä¸ªç®€å•çš„å®æˆ˜ä¾‹å­ï¼ŒåŒ…å«å½“æŸ[m
[31m-ä¸ªç±»å­˜åœ¨çš„æ—¶å€™ï¼Œè‡ªåŠ¨é…ç½®è¿™ä¸ªç±»çš„Beanï¼Œå¹¶å¯å°†Beançš„å±æ€§[m
[31m-åœ¨application.propertiesä¸­é…ç½®ã€‚[m
[31m-     ï¼ˆ1ï¼‰æ–°å»ºstarterçš„Mavené¡¹ç›®ï¼Œå¦‚å›¾6-11æ‰€ç¤ºã€‚[m
[31m-å›¾6-11ã€€æ–°å»ºstarterçš„Mavené¡¹ç›®[m
[31m-åœ¨pom.xmlä¸­ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://ww[m
[31m-instance"[m
[31m-[m
[31m-   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.ap[m
[31m-4.0.0.xsd">[m
[31m-[m
[31m-   <modelVersion>4.0.0</modelVersion>[m
[31m-[m
[31m-   <groupId>com.wisely</groupId>[m
[31m-   <artifactId>spring-boot-starter-hello</artifactId>[m
[31m-   <version>0.0.1-SNAPSHOT</version>[m
[31m-   <packaging>jar</packaging>[m
[31m-[m
[31m-   <name>spring-boot-starter-hello</name>[m
[31m-   <url>http://maven.apache.org</url>[m
[31m-[m
[31m-   <properties>[m
[31m-                                                <project.build.sourceEncoding>UTF-[m
[31m-[m
[31m-8</project.build.sourceEncoding>[m
[31m-   </properties>[m
[31m-[m
[31m-   <dependencies>[m
[31m-       <dependency>[m
[31m-              <groupId>org.springframework.boot</groupId>[m
[31m-              <artifactId>spring-boot-autoconfigure</artifactId>[m
[31m-              <version>1.3.0.M1</version>[m
[31m-       </dependency>[m
[31m-       <dependency>[m
[31m-          <groupId>junit</groupId>[m
[31m-          <artifactId>junit</artifactId>[m
[31m-          <version>3.8.1</version>[m
[31m-          <scope>test</scope>[m
[31m-       </dependency>[m
[31m-[m
[31m-   </dependencies>[m
[31m-   <!-- ä½¿ç”¨Spring Bootæ­£å¼ç‰ˆæ—¶ï¼Œæ— é¡»ä¸‹åˆ—é…ç½® -->[m
[31m-   <repositories>[m
[31m-[m
[31m-              <repository>[m
[31m-                     <id>spring-snapshots</id>[m
[31m-                     <name>Spring Snapshots</name>[m
[31m-                     <url>https://repo.spring.io/snapshot</url>[m
[31m-                     <snapshots>[m
[31m-                             <enabled>true</enabled>[m
[31m-                     </snapshots>[m
[31m-[m
[31m-              </repository>[m
[31m-              <repository>[m
[31m-[m
[31m-                     <id>spring-milestones</id>[m
[31m-                     <name>Spring Milestones</name>[m
[31m-                     <url>https://repo.spring.io/milestone</url>[m
[31m-                     <snapshots>[m
[31m-[m
[31m-                             <enabled>false</enabled>[m
[31m-                     </snapshots>[m
[31m-              </repository>[m
[31m-       </repositories>[m
[31m-       <pluginRepositories>[m
[31m-              <pluginRepository>[m
[31m-                     <id>spring-snapshots</id>[m
[31m-                     <name>Spring Snapshots</name>[m
[31m-                     <url>https://repo.spring.io/snapshot</url>[m
[31m-                     <snapshots>[m
[31m-[m
[31m-                             <enabled>true</enabled>[m
[31m-                     </snapshots>[m
[31m-              </pluginRepository>[m
[31m-              <pluginRepository>[m
[31m-                     <id>spring-milestones</id>[m
[31m-                     <name>Spring Milestones</name>[m
[31m-                     <url>https://repo.spring.io/milestone</url>[m
[31m-                     <snapshots>[m
[31m-[m
[31m-                             <enabled>false</enabled>[m
[31m-                     </snapshots>[m
[31m-              </pluginRepository>[m
[31m-       </pluginRepositories>[m
[31m-</project>[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-åœ¨æ­¤å¤„å¢åŠ Spring Bootè‡ªèº«çš„è‡ªåŠ¨é…ç½®ä½œä¸ºä¾èµ–ã€‚[m
[31m-[m
[31m-ï¼ˆ2ï¼‰å±æ€§é…ç½®ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-package com.wisely.spring_boot_starter_hello;[m
[31m-[m
[31m-import org.springframework.boot.context.properties.ConfigurationPropert[m
[31m-[m
[31m-@ConfigurationProperties(prefix="hello")[m
[31m-public class HelloServiceProperties {[m
[31m-[m
[31m-       private static final String MSG = "world";[m
[31m-              private String msg = MSG;[m
[31m-              public String getMsg() {[m
[31m-[m
[31m-                      return msg;[m
[31m-              }[m
[31m-              public void setMsg(String msg) {[m
[31m-[m
[31m-                      this.msg = msg;[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     è¿™é‡Œé…ç½®ä¸6.2.3èŠ‚æ˜¯ä¸€æ ·çš„ï¼Œæ˜¯ç±»å‹å®‰å…¨çš„å±æ€§è·å–ã€‚åœ¨[m
[31m-application.propertiesä¸­é€šè¿‡hello.msg=æ¥è®¾ç½®ï¼Œè‹¥ä¸è®¾ç½®ï¼Œé»˜[m
[31m-è®¤ä¸ºhello.msg=worldã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰åˆ¤æ–­ä¾æ®ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       package com.wisely.spring_boot_starter_hello;[m
[31m-       public class HelloService {[m
[31m-[m
[31m-              private String msg;[m
[31m-[m
[31m-                public String sayHello(){[m
[31m-                       return "Hello" + msg;[m
[31m-[m
[31m-                }[m
[31m-[m
[31m-              public String getMsg() {[m
[31m-                      return msg;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              public void setMsg(String msg) {[m
[31m-                      this.msg = msg;[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     æœ¬ä¾‹æ ¹æ®æ­¤ç±»çš„å­˜åœ¨ä¸å¦æ¥åˆ›å»ºè¿™ä¸ªç±»çš„Beanï¼Œè¿™ä¸ªç±»å¯[m
[31m-ä»¥æ˜¯ç¬¬ä¸‰æ–¹ç±»åº“çš„ç±»ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰è‡ªåŠ¨é…ç½®ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       package com.wisely.spring_boot_starter_hello;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.boot.autoconfigure.condition.ConditionalOnCl[m
[31m-       import org.springframework.boot.autoconfigure.condition.ConditionalOnMi[m
[31m-       import org.springframework.boot.autoconfigure.condition.ConditionalOnPr[m
[31m-       import org.springframework.boot.context.properties.EnableConfigurationP[m
[31m-       import org.springframework.context.annotation.Bean;[m
[31m-       import org.springframework.context.annotation.Configuration;[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableConfigurationProperties(HelloServiceProperties.class)[m
[31m-       @ConditionalOnClass(HelloService.class)[m
[31m-       @ConditionalOnProperty(prefix = "hello", value = "enabled", matchIfMiss[m
[31m-       public class HelloServiceAutoConfiguration {[m
[31m-[m
[31m-              @Autowired[m
[31m-              private HelloServiceProperties helloServiceProperties;[m
[31m-[m
[31m-              @Bean[m
[31m-              @ConditionalOnMissingBean(HelloService.class)[m
[31m-              public HelloService helloService(){[m
[31m-[m
[31m-                      HelloService helloService = new HelloService();[m
[31m-                      helloService.setMsg(helloServiceProperties.getMsg());[m
[31m-                      return helloService;[m
[31m-              }[m
[31m-       }[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     æ ¹æ®HelloServicePropertiesæä¾›çš„å‚æ•°ï¼Œå¹¶é€šè¿‡[m
[31m-@ConditionalOnClassåˆ¤æ–­HelloServiceè¿™ä¸ªç±»åœ¨ç±»è·¯å¾„ä¸­æ˜¯å¦[m
[31m-å­˜åœ¨ï¼Œä¸”å½“å®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªBeançš„æƒ…å†µä¸‹è‡ªåŠ¨é…ç½®è¿™ä¸ªBeanã€‚[m
[31m-     ï¼ˆ5ï¼‰æ³¨å†Œé…ç½®ã€‚åœ¨6.5.1ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œè‹¥æƒ³è‡ªåŠ¨é…ç½®ç”Ÿ[m
[31m-æ•ˆï¼Œéœ€è¦æ³¨å†Œè‡ªåŠ¨é…ç½®ç±»ã€‚åœ¨src/main/resourcesä¸‹æ–°å»ºMETA-[m
[31m-INF/spring.factoriesï¼Œç»“æ„å¦‚å›¾6-12æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                      å›¾6-12ã€€ç»“æ„[m
[31m-[m
[31m-     åœ¨spring.factoriesä¸­å¡«å†™å¦‚ä¸‹å†…å®¹æ³¨å†Œï¼š[m
[31m-[m
[31m-       org.springframework.boot.autoconfigure.EnableAutoConfiguration=\[m
[31m-       com.wisely.spring_boot_starter_hello.HelloServiceAutoConfiguration[m
[31m-[m
[31m-     è‹¥æœ‰å¤šä¸ªè‡ªåŠ¨é…ç½®ï¼Œåˆ™ç”¨â€œï¼Œâ€éš”å¼€ï¼Œæ­¤å¤„â€œ\â€æ˜¯ä¸ºäº†æ¢è¡Œå[m
[31m-ä»ç„¶èƒ½è¯»åˆ°å±æ€§ã€‚[m
[31m-[m
[31m-     å¦å¤–ï¼Œè‹¥åœ¨æ­¤ä¾‹æ–°å»ºçš„é¡¹ç›®ä¸­æ— src/main/resourcesæ–‡ä»¶[m
[31m-å¤¹ï¼Œéœ€æ‰§è¡Œå¦‚å›¾6-13æ‰€ç¤ºæ“ä½œã€‚[m
[31m-[m
[31m-                      å›¾6-13ã€€è°ƒå‡ºsrc/maln/resourcesæ–‡ä»¶å¤¹[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰ä½¿ç”¨starterã€‚æ–°å»ºSpring Booté¡¹ç›®ï¼Œå¹¶å°†æˆ‘ä»¬çš„starter[m
[31m-ä½œä¸ºä¾èµ–ï¼Œå¦‚å›¾6-14æ‰€ç¤ºã€‚[m
[31m-                            å›¾6-14ã€€æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     åœ¨pom.xmlä¸­æ·»åŠ spring-boot-starter-helloçš„ä¾èµ–ï¼Œä»£ç å¦‚[m
[31m-ä¸‹ï¼š[m
[31m-[m
[31m-       <dependency>[m
[31m-                      <groupId>com.wisely</groupId>[m
[31m-                      <artifactId>spring-boot-starter-hello</artifactId>[m
[31m-                      <version>0.0.1-SNAPSHOT</version>[m
[31m-[m
[31m-       </dependency>[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥åœ¨Mavençš„ä¾èµ–é‡ŒæŸ¥çœ‹spring-boot-starter-helloï¼Œ[m
[31m-å¦‚å›¾6-15æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                       å›¾6-15ã€€æŸ¥çœ‹spring-Doot-starter-hello[m
[31m-[m
[31m-     åœ¨å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬å¼•å…¥çš„ä¾èµ–æ˜¯spring-boot-starter-helloè¿™[m
[31m-ä¸ªé¡¹ç›®ã€‚åœ¨starterç¨³å®šä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å°†spring-boot-starter-[m
[31m-helloé€šè¿‡â€œmvn installâ€å®‰è£…åˆ°æœ¬åœ°åº“ï¼Œæˆ–è€…å°†è¿™ä¸ªjaråŒ…å‘å¸ƒåˆ°[m
[31m-Mavenç§æœä¸Šã€‚[m
[31m-[m
[31m-     ç®€å•çš„è¿è¡Œç±»ä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       package com.wisely.ch6_5;[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.boot.SpringApplication;[m
[31m-       import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-       import com.wisely.spring_boot_starter_hello.HelloService;[m
[31m-       @RestController[m
[31m-       @SpringBootApplication[m
[31m-       public class Ch65Application {[m
[31m-[m
[31m-              @Autowired[m
[31m-              HelloService helloService;[m
[31m-              @RequestMapping("/")[m
[31m-              public String index(){[m
[31m-[m
[31m-                      return helloService.sayHello();[m
[31m-              }[m
[31m-              public static void main(String[] args) {[m
[31m-[m
[31m-                      SpringApplication.run(Ch65Application.class, args);[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     åœ¨ä»£ç ä¸­å¯ä»¥ç›´æ¥æ³¨å…¥HelloServiceçš„Beanï¼Œä½†åœ¨é¡¹ç›®ä¸­æˆ‘[m
[31m-ä»¬å¹¶æ²¡æœ‰é…ç½®è¿™ä¸ªBeanï¼Œè¿™æ˜¯é€šè¿‡è‡ªåŠ¨é…ç½®å®Œæˆçš„ã€‚[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8080ï¼Œæ•ˆæœå¦‚å›¾6-16æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                        å›¾6-16ã€€è®¿é—®http://local hostï¼š8080[m
[31m-[m
[31m-     è¿™æ—¶åœ¨application.propertiesä¸­é…ç½®msgçš„å†…å®¹ï¼š[m
[31m-[m
[31m-       hello.msg[m
[31m-[m
[31m-       = wangyunfei[m
[31m-     æ­¤æ—¶å†æ¬¡è®¿é—®http://localhostï¼š8080ï¼Œæ•ˆæœå¦‚å›¾6-17æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾6-17ã€€æŸ¥çœ‹æ•ˆæœ[m
[31m-[m
[31m-     åœ¨application.propertiesä¸­æ·»åŠ debugå±æ€§ï¼ŒæŸ¥çœ‹è‡ªåŠ¨é…ç½®æŠ¥[m
[31m-å‘Šï¼š[m
[31m-[m
[31m-       debug=true[m
[31m-[m
[31m-     æˆ‘ä»¬æ–°å¢çš„è‡ªåŠ¨é…ç½®æ˜¾ç¤ºåœ¨æ§åˆ¶å°çš„æŠ¥å‘Šä¸­ï¼Œå¦‚å›¾6-18æ‰€[m
[31m-ç¤ºã€‚[m
[31m-[m
[31m-                                 å›¾6-18ã€€æ§åˆ¶å°æŠ¥å‘Š[m
[31m-ç¬¬7ç« ã€€Spring Bootçš„Webå¼€å‘[m
[31m-[m
[31m-     Webå¼€å‘æ˜¯å¼€å‘ä¸­è‡³å…³é‡è¦çš„ä¸€éƒ¨åˆ†ï¼ŒWebå¼€å‘çš„æ ¸å¿ƒå†…[m
[31m-å®¹ä¸»è¦åŒ…æ‹¬å†…åµŒServletå®¹å™¨å’ŒSpring MVCã€‚[m
[31m-7.1ã€€Spring Bootçš„Webå¼€å‘æ”¯æŒ[m
[31m-[m
[31m-     Spring Bootæä¾›äº†spring-boot-starter-webä¸ºWebå¼€å‘äºˆä»¥æ”¯[m
[31m-æŒï¼Œspring-boot-starter-webä¸ºæˆ‘ä»¬æä¾›äº†åµŒå…¥çš„Tomcatä»¥åŠ[m
[31m-Spring MVCçš„ä¾èµ–ã€‚è€ŒWebç›¸å…³çš„è‡ªåŠ¨é…ç½®å­˜å‚¨åœ¨spring-boot-[m
[31m-autoconfigure.jarçš„org.springframework.boot.autoconfigure.web[m
[31m-ä¸‹ï¼Œå¦‚å›¾7-1æ‰€ç¤ºã€‚[m
[31m-                      å›¾7-1ã€€Webç›¸å…³çš„è‡ªåŠ¨é…ç½®[m
[31m-[m
[31m-ä»è¿™äº›æ–‡ä»¶åå¯ä»¥çœ‹å‡ºï¼š[m
[31m-[m
[31m-ServerPropertiesAutoConfigurationå’ŒServerPropertiesè‡ªåŠ¨é…[m
[31m-ç½®å†…åµŒServletå®¹å™¨ï¼›[m
[31m-HttpEncodingAutoConfigurationå’ŒHttpEncodingPropertiesç”¨[m
[31m-æ¥è‡ªåŠ¨é…ç½®httpçš„ç¼–ç ï¼›[m
[31m-MultipartAutoConfigurationå’ŒMultipartPropertiesç”¨æ¥è‡ªåŠ¨é…[m
[31m-ç½®ä¸Šä¼ æ–‡ä»¶çš„å±æ€§ï¼›[m
[31m-[m
[31m-JacksonHttpMessageConvertersConfigurationç”¨æ¥è‡ªåŠ¨é…ç½®[m
[31m-[m
[31m-mappingJackson2Http  MessageConverterå’Œ[m
[31m-[m
[31m-mappingJackson2XmlHttpMessage Converterï¼›[m
[31m-[m
[31m-WebMvcAutoConfigurationå’ŒWebMvcPropertiesé…ç½®Spring[m
[31m-[m
[31m-MVCã€‚[m
[31m-7.2ã€€Thymeleafæ¨¡æ¿å¼•æ“[m
[31m-[m
[31m-     æœ¬ä¹¦å‰é¢çš„å†…å®¹å¾ˆå°‘ç”¨åˆ°é¡µé¢æ¨¡æ¿å¼•æ“ç›¸å…³çš„å†…å®¹ï¼Œå¶å°”[m
[31m-ä½¿ç”¨äº†JSPé¡µé¢ï¼Œä½†æ˜¯å°½å¯èƒ½å°‘åœ°æ¶‰åŠJSPç›¸å…³çŸ¥è¯†ï¼Œè¿™æ˜¯å› ä¸º[m
[31m-JSPåœ¨å†…åµŒçš„Servletçš„å®¹å™¨ä¸Šè¿è¡Œæœ‰ä¸€äº›é—®é¢˜ï¼ˆå†…åµŒTomcatã€[m
[31m-Jettyä¸æ”¯æŒä»¥jarå½¢å¼è¿è¡ŒJSPï¼ŒUndertowä¸æ”¯æŒJSPï¼‰ã€‚[m
[31m-[m
[31m-     Spring Bootæä¾›äº†å¤§é‡æ¨¡æ¿å¼•æ“ï¼ŒåŒ…å«æ‹¬FreeMarkerã€[m
[31m-Groovyã€Thymeleafã€Velocityå’ŒMustacheï¼ŒSpring Bootä¸­æ¨è[m
[31m-ä½¿ç”¨Thymeleafä½œä¸ºæ¨¡æ¿å¼•æ“ï¼Œå› ä¸ºThymeleafæä¾›äº†å®Œç¾çš„[m
[31m-Spring MVCçš„æ”¯æŒã€‚[m
[31m-[m
[31m-7.2.1ã€€ThymeleafåŸºç¡€çŸ¥è¯†[m
[31m-[m
[31m-     Thymeleafæ˜¯ä¸€ä¸ªJavaç±»åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªxml/xhtml/html5çš„æ¨¡[m
[31m-æ¿å¼•æ“ï¼Œå¯ä»¥ä½œä¸ºMVCçš„Webåº”ç”¨çš„Viewå±‚ã€‚[m
[31m-[m
[31m-     Thymeleafè¿˜æä¾›äº†é¢å¤–çš„æ¨¡å—ä¸Spring MVCé›†æˆï¼Œæ‰€ä»¥[m
[31m-æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Thymeleafå®Œå…¨æ›¿ä»£JSPã€‚[m
[31m-[m
[31m-     ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºæ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨çš„Thymeleafç”¨æ³•ï¼Œæˆ‘ä»¬å°†æŠŠ[m
[31m-æœ¬èŠ‚çš„å†…å®¹åœ¨7.2.4èŠ‚è¿è¡Œæ¼”ç¤ºã€‚[m
[31m-[m
[31m-     1.å¼•å…¥Thymeleaf[m
[31m-[m
[31m-     ä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªåŸºæœ¬çš„Thymeleafæ¨¡æ¿é¡µé¢ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬[m
[31m-å¼•å…¥äº†Bootstrapï¼ˆä½œä¸ºæ ·å¼æ§åˆ¶ï¼‰å’ŒjQueryï¼ˆDOMæ“ä½œï¼‰ï¼Œå½“[m
[31m-ç„¶å®ƒä»¬ä¸æ˜¯å¿…éœ€çš„ï¼š[m
[31m-<html xmlns:th="http://www.thymeleaf.org"><!-- 1 -->[m
[31m-[m
[31m-<head>[m
[31m-[m
[31m-<meta content="text/html;charset=UTF-8"/>[m
[31m-[m
[31m-<link th:src="@{bootstrap/css/bootstrap.min.css}" rel="stylesheet"/[m
[31m-[m
[31m-- 2 -->[m
[31m-[m
[31m-         <link       th:src="@{bootstrap/css/bootstrap-[m
[31m-[m
[31m-theme.min.css}" rel="stylesheet"/><!-- 2 -->[m
[31m-[m
[31m-</head>[m
[31m-[m
[31m-<body>[m
[31m-[m
[31m-                     <script  th:src="@{jquery-[m
[31m-[m
[31m-1.10.2.min.js}" type="text/javascript"></script><!-- 2 -->[m
[31m-[m
[31m-         <script th:src="@{bootstrap/js/bootstrap.min.js}">[m
[31m-[m
[31m-</script><!-- 2 -->[m
[31m-[m
[31m-</body>[m
[31m-[m
[31m-</html>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é€šè¿‡xmlnsï¼šth=http://www.thymeleaf.orgå‘½åç©ºé—´ï¼Œå°†é•œ[m
[31m-å¤´é¡µé¢è½¬æ¢ä¸ºåŠ¨æ€çš„è§†å›¾ã€‚éœ€è¦è¿›è¡ŒåŠ¨æ€å¤„ç†çš„å…ƒç´ å°†ä½¿[m
[31m-ç”¨â€œthï¼šâ€ä¸ºå‰ç¼€ï¼›[m
[31m-[m
[31m-     â‘¡é€šè¿‡â€œ@{}â€å¼•ç”¨Webé™æ€èµ„æºï¼Œè¿™åœ¨JSPä¸‹æ˜¯ææ˜“å‡ºé”™[m
[31m-çš„ã€‚[m
[31m-[m
[31m-     2.è®¿é—®modelä¸­çš„æ•°æ®[m
[31m-[m
[31m-     é€šè¿‡â€œ${}â€è®¿é—®modelä¸­çš„å±æ€§ï¼Œè¿™å’ŒJSPæä¸ºç›¸ä¼¼ã€‚[m
[31m-[m
[31m-           <div class="panel panel-primary">[m
[31m-              <div class="panel-heading">[m
[31m-                      <h3 class="panel-title">è®¿é—®model</h3>[m
[31m-              </div>[m
[31m-              <div class="panel-body">[m
[31m-                      <span th:text="${singlePerson.name}"></span>[m
[31m-              </div>[m
[31m-[m
[31m-           </div>[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     ä½¿ç”¨<span thï¼štext="${singlePerson.name}"></span>è®¿é—®[m
[31m-modelä¸­çš„singlePersonçš„nameå±æ€§ã€‚æ³¨æ„ï¼šéœ€è¦å¤„ç†çš„åŠ¨æ€å†…[m
[31m-å®¹éœ€è¦åŠ ä¸Šâ€œthï¼šâ€å‰ç¼€ã€‚[m
[31m-[m
[31m-     3.modelä¸­çš„æ•°æ®è¿­ä»£[m
[31m-[m
[31m-     Thymeleafçš„è¿­ä»£å’ŒJSPçš„å†™æ³•ä¹Ÿå¾ˆç›¸ä¼¼ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-           <div class="panel panel-primary">[m
[31m-              <div class="panel-heading">[m
[31m-                      <h3 class="panel-title">åˆ—è¡¨</h3>[m
[31m-              </div>[m
[31m-              <div class="panel-body">[m
[31m-                      <ul class="list-group">[m
[31m-                                                                          <li class="list-group-[m
[31m-[m
[31m-       item" th:each="person:${people}">[m
[31m-                                    <span th:text="${person.name}"></span>[m
[31m-                                        <span th:text="${person.age}"></span>[m
[31m-[m
[31m-                             </li>[m
[31m-                      </ul>[m
[31m-              </div>[m
[31m-         </div>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     ä½¿ç”¨thï¼šeachæ¥åšå¾ªç¯è¿­ä»£ï¼ˆthï¼šeach="personï¼š[m
[31m-${people}"ï¼‰ï¼Œpersonä½œä¸ºè¿­ä»£å…ƒç´ æ¥ä½¿ç”¨ï¼Œç„¶ååƒä¸Šé¢ä¸€æ ·[m
[31m-è®¿é—®è¿­ä»£å…ƒç´ ä¸­çš„å±æ€§ã€‚[m
[31m-[m
[31m-     4.æ•°æ®åˆ¤æ–­[m
[31m-[m
[31m-     ä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-           <div th:if="${not #lists.isEmpty(people)}">[m
[31m-                  <div class="panel panel-primary">[m
[31m-                      <div class="panel-heading">[m
[31m-                             <h3 class="panel-title">åˆ—è¡¨</h3>[m
[31m-                      </div>[m
[31m-                      <div class="panel-body">[m
[31m-                             <ul class="list-group">[m
[31m-                                                                           <li class="list-group-[m
[31m-[m
[31m-       item" th:each="person:${people}">[m
[31m-                                           <span th:text="${person.name}"></span>[m
[31m-                                               <span th:text="${person.age}"></span>[m
[31m-[m
[31m-                                    </li>[m
[31m-                             </ul>[m
[31m-                      </div>[m
[31m-                </div>[m
[31m-         </div>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     é€šè¿‡${not#lists.isEmptyï¼ˆpeopleï¼‰}è¡¨è¾¾å¼åˆ¤æ–­peopleæ˜¯å¦[m
[31m-ä¸ºç©ºã€‚Thymeleafæ”¯æŒ>ã€<ã€>=ã€<===ã€ï¼= ä½œä¸ºæ¯”è¾ƒæ¡ä»¶ï¼Œ[m
[31m-åŒæ—¶ä¹Ÿæ”¯æŒå°†SpringELè¡¨è¾¾å¼è¯­è¨€ç”¨äºæ¡ä»¶ä¸­ã€‚[m
[31m-[m
[31m-     5.åœ¨JavaScriptä¸­è®¿é—®model[m
[31m-[m
[31m-     åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨JavaScriptè®¿é—®modelä¸­çš„å€¼ï¼Œ[m
[31m-åœ¨Thymeleafé‡Œå®ç°ä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       <script th:inline="javascript">[m
[31m-              var single = [[${singlePerson}]];[m
[31m-              console.log(single.name+"/"+single.age)[m
[31m-[m
[31m-       </script>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     é€šè¿‡thï¼šinline=â€œjavascriptâ€æ·»åŠ åˆ°scriptæ ‡ç­¾ï¼Œè¿™æ ·[m
[31m-     JavaScriptä»£ç å³å¯è®¿é—®modelä¸­çš„å±æ€§ï¼›[m
[31m-     é€šè¿‡â€œ[[${}]]â€æ ¼å¼è·å¾—å®é™…çš„å€¼ã€‚[m
[31m-[m
[31m-     è¿˜æœ‰ä¸€ç§æ˜¯éœ€è¦åœ¨htmlçš„ä»£ç é‡Œè®¿é—®modelä¸­çš„å±æ€§ï¼Œä¾‹[m
[31m-å¦‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆ—è¡¨åå•å‡»æ¯ä¸€è¡Œåé¢çš„æŒ‰é’®è·å¾—modelä¸­çš„[m
[31m-å€¼ï¼Œå¯åšå¦‚ä¸‹å¤„ç†ï¼š[m
[31m-[m
[31m-       <li class="list-group-item" th:each="person:${people}">[m
[31m-              <span th:text="${person.name}"></span>[m
[31m-[m
[31m-             <span th:text="${person.age}"></span>[m
[31m-             <button class="btn" th:onclick="'getName(\'' + ${person.name} + '\')[m
[31m-       è·å¾—åå­—</button>[m
[31m-       </li>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     æ³¨æ„æ ¼å¼thï¼š[m
[31m-onclick="'getNameï¼ˆ\''+${person.name}+'\'ï¼‰ï¼›'"ã€‚[m
[31m-[m
[31m-     6.å…¶ä»–çŸ¥è¯†[m
[31m-[m
[31m-     æ›´å¤šæ›´å®Œæ•´çš„Thymeleafçš„çŸ¥è¯†ï¼Œè¯·æŸ¥çœ‹[m
[31m-http://www.thymeleaf.orgçš„å®˜ç½‘ã€‚[m
[31m-[m
[31m-7.2.2ã€€ä¸Spring MVCé›†æˆ[m
[31m-[m
[31m-     åœ¨Spring MVCä¸­ï¼Œè‹¥æˆ‘ä»¬éœ€è¦é›†æˆä¸€ä¸ªæ¨¡æ¿å¼•æ“çš„è¯ï¼Œéœ€[m
[31m-è¦å®šä¹‰ViewResolverï¼Œè€ŒViewResolveréœ€è¦å®šä¹‰ä¸€ä¸ªViewï¼Œå¦‚[m
[31m-4.2.2èŠ‚ä¸­æˆ‘ä»¬ä¸ºJSPå®šä¹‰çš„ViewResolverçš„ä»£ç ï¼š[m
[31m-[m
[31m-       @Bean[m
[31m-              public InternalResourceViewResolver viewResolver(){[m
[31m-       InternalResourceViewResolver viewResolver = new InternalResourc[m
[31m-       viewResolver.setPrefix("/WEB-INF/classes/views/");[m
[31m-       viewResolver.setSuffix(".jsp");[m
[31m-       viewResolver.setViewClass(JstlView.class);[m
[31m-       return viewResolver;[m
[31m-}[m
[31m-[m
[31m-é€šè¿‡ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨JsltViewå®šä¹‰äº†ä¸€ä¸ª[m
[31m-[m
[31m-InternalResourceViewResolverï¼Œå› è€Œä½¿ç”¨Thymeleafä½œä¸ºæˆ‘ä»¬çš„[m
[31m-[m
[31m-æ¨¡æ¿å¼•æ“ä¹Ÿåº”è¯¥åšç±»ä¼¼çš„å®šä¹‰ã€‚åº†å¹¸çš„æ˜¯ï¼ŒThymeleafä¸ºæˆ‘ä»¬[m
[31m-[m
[31m-å®šä¹‰å¥½äº†org.thymeleaf.spring4.view.ThymeleafViewå’Œ[m
[31m-[m
[31m-org.thymeleaf.spring4.view.ThymeleafViewResolverï¼ˆé»˜è®¤ä½¿ç”¨[m
[31m-[m
[31m-ThymeleafViewä½œä¸ºViewï¼‰ã€‚Thymeleafç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª[m
[31m-[m
[31m-SpringTemplateEngineç±»ï¼Œç”¨æ¥é©±åŠ¨åœ¨Spring  MVCä¸‹ä½¿ç”¨[m
[31m-[m
[31m-Thymeleafæ¨¡æ¿å¼•æ“ï¼Œå¦å¤–è¿˜æä¾›äº†ä¸€ä¸ªTemplateResolverç”¨æ¥[m
[31m-[m
[31m-è®¾ç½®é€šç”¨çš„æ¨¡æ¿å¼•æ“ï¼ˆåŒ…å«å‰ç¼€ã€åç¼€ç­‰ï¼‰ï¼Œè¿™ä½¿æˆ‘ä»¬åœ¨[m
[31m-[m
[31m-Spring MVCä¸­é›†æˆThymeleafå¼•æ“å˜å¾—ååˆ†ç®€å•ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-@Bean[m
[31m-public TemplateResolver templateResolver(){[m
[31m-TemplateResolver templateResolver = new ServletContextTemplateResol[m
[31m-templateResolver.setPrefix("/WEB-INF/templates");[m
[31m-templateResolver.setSuffix(".html");[m
[31m-templateResolver.setTemplateMode("HTML5");[m
[31m-return templateResolver;[m
[31m-[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public SpringTemplateEngine templateEngine(){[m
[31m-SpringTemplateEngine templateEngine = new SpringTemplateEngine();[m
[31m-templateEngine.setTemplateResolver(templateResolver());[m
[31m-return templateEngine;[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public ThymeleafViewResolver thymeleafViewResolver(){[m
[31m-ThymeleafViewResolver thymeleafViewResolver = new ThymeleafViewReso[m
[31m-thymeleafViewResolver.setTemplateEngine(templateEngine());[m
[31m-       // thymeleafViewResolver.setViewClass(ThymeleafView.class);[m
[31m-              return thymeleafViewResolver;[m
[31m-              }[m
[31m-[m
[31m-7.2.3ã€€Spring Bootçš„Thymeleafæ”¯æŒ[m
[31m-[m
[31m-     åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬è®²è¿°äº†Thymeleafä¸Spring MVCé›†æˆçš„é…[m
[31m-ç½®ï¼Œè®²è¿°çš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£Spring MVCå’ŒThymeleaf[m
[31m-é›†æˆçš„åŸç†ã€‚ä½†åœ¨Spring Bootä¸­è¿™ä¸€åˆ‡éƒ½æ˜¯ä¸éœ€è¦çš„ï¼ŒSpring[m
[31m-Booté€šè¿‡org.springframework.boot.autoconfigure.thymeleafåŒ…å¯¹[m
[31m-Thymeleafè¿›è¡Œäº†è‡ªåŠ¨é…ç½®ï¼Œå¦‚å›¾7-2æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                  å›¾7-2ã€€thymeleafåŒ…[m
[31m-[m
[31m-     é€šè¿‡ThymeleafAutoConfigurationç±»å¯¹é›†æˆæ‰€éœ€è¦çš„Beanè¿›[m
[31m-è¡Œè‡ªåŠ¨é…ç½®ï¼ŒåŒ…æ‹¬templateResolverã€templateEngineå’Œ[m
[31m-thymeleafViewResolverçš„é…ç½®ã€‚[m
[31m-[m
[31m-     é€šè¿‡ThymeleafPropertiesæ¥é…ç½®Thymeleafï¼Œåœ¨[m
[31m-application.propertiesä¸­ï¼Œä»¥spring.thymeleafå¼€å¤´æ¥é…ç½®ï¼Œé€šè¿‡[m
[31m-æŸ¥çœ‹ThymeleafPropertiesçš„ä¸»è¦æºç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºå¦‚ä½•è®¾ç½®[m
[31m-å±æ€§ä»¥åŠé»˜è®¤é…ç½®ï¼š[m
[31m-[m
[31m-       @ConfigurationProperties("spring.thymeleaf")[m
[31m-       public class ThymeleafProperties {[m
[31m-[m
[31m-              public static final String DEFAULT_PREFIX = "classpath:/templates/"[m
[31m-public static final String DEFAULT_SUFFIX = ".html";[m
[31m-[m
[31m-       /**                                              Booté»˜è®¤æ¨¡æ¿ï¼Œé˜²æ­¢åœ¨[m
[31m-                                          *å‰ç¼€è®¾ç½®ï¼ŒSpring[m
[31m-[m
[31m-classpath:/templates/ ç›®å½•ä¸‹[m
[31m-[m
[31m-*/[m
[31m-[m
[31m-private String prefix = DEFAULT_PREFIX;[m
[31m-[m
[31m-/**[m
[31m- * åç¼€è®¾ç½®ï¼Œé»˜è®¤ä¸ºhtml[m
[31m-[m
[31m- */[m
[31m-[m
[31m-private String suffix = DEFAULT_SUFFIX;[m
[31m-[m
[31m-/**[m
[31m- * æ¨¡æ¿æ¨¡å¼è®¾ç½®ï¼Œé»˜è®¤ä¸ºHTML 5[m
[31m-[m
[31m- */[m
[31m-[m
[31m-private String mode = "HTML5";[m
[31m-[m
[31m-/**[m
[31m- * æ¨¡æ¿çš„ç¼–ç è®¾ç½®ï¼Œé»˜è®¤ä¸ºUTF-8[m
[31m-[m
[31m- */[m
[31m-[m
[31m-private String encoding = "UTF-8";[m
[31m-[m
[31m-/**[m
[31m- * æ¨¡æ¿çš„åª’ä½“ç±»å‹è®¾ç½®ï¼Œé»˜è®¤ä¸ºtext/html.[m
[31m-[m
[31m- */[m
[31m-[m
[31m-private String contentType = "text/html";[m
[31m-[m
[31m-       /**[m
[31m-         * æ˜¯å¦å¼€å¯æ¨¡æ¿ç¼“å­˜ï¼Œé»˜è®¤æ˜¯å¼€å¯ï¼Œå¼€å‘æ—¶è¯·å…³é—­[m
[31m-         */[m
[31m-[m
[31m-       private boolean cache = true;[m
[31m-       //â€¦.[m
[31m-}[m
[31m-[m
[31m-7.2.4ã€€å®æˆ˜[m
[31m-[m
[31m-     1.æ–°å»ºSpring Booté¡¹ç›®[m
[31m-     é€‰æ‹©Thymeleafä¾èµ–ï¼Œspring-boot-starter-thymeleafä¼šè‡ªåŠ¨åŒ…[m
[31m-å«spring-boot-starter-webï¼Œå¦‚å›¾7-3æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                            å›¾7-3ã€€æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     2.ç¤ºä¾‹JavaBean[m
[31m-     æ­¤ç±»ç”¨æ¥åœ¨æ¨¡æ¿é¡µé¢å±•ç¤ºæ•°æ®ç”¨ï¼ŒåŒ…å«nameå±æ€§å’Œageå±[m
[31m-æ€§ï¼š[m
[31m-[m
[31m-       package com.wisely;[m
[31m-       public class Person {[m
[31m-[m
[31m-              private String name;[m
[31m-              private Integer age;[m
[31m-              public Person() {[m
[31m-                      super();[m
[31m-[m
[31m-              }[m
[31m-              public Person(String name, Integer age) {[m
[31m-[m
[31m-                      super();[m
[31m-                      this.name = name;[m
[31m-                      this.age = age;[m
[31m-              }[m
[31m-              public String getName() {[m
[31m-                      return name;[m
[31m-              }[m
[31m-              public void setName(String name) {[m
[31m-                      this.name = name;[m
[31m-              }[m
[31m-              public Integer getAge() {[m
[31m-                      return age;[m
[31m-              }[m
[31m-              public void setAge(Integer age) {[m
[31m-                      this.age = age;[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     3.è„šæœ¬æ ·å¼é™æ€æ–‡ä»¶[m
[31m-[m
[31m-     æ ¹æ®é»˜è®¤åŸåˆ™ï¼Œè„šæœ¬æ ·å¼ã€å›¾ç‰‡ç­‰é™æ€æ–‡ä»¶åº”æ”¾ç½®åœ¨[m
[31m-src/main/resources/staticä¸‹ï¼Œè¿™é‡Œå¼•å…¥äº†Bootstrapå’ŒjQueryï¼Œç»“[m
[31m-æ„å¦‚å›¾7-4æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                    å›¾7-4ã€€æ–‡ä»¶ä½ç½®[m
[31m-[m
[31m-     4.æ¼”ç¤ºé¡µé¢[m
[31m-[m
[31m-     æ ¹æ®é»˜è®¤åŸåˆ™ï¼Œé¡µé¢åº”æ”¾ç½®åœ¨src/main/resources/templates[m
[31m-ä¸‹ã€‚åœ¨src/main/resources/templatesä¸‹æ–°å»ºindex.htmlï¼Œå¦‚å›¾7-5[m
[31m-æ‰€ç¤ºã€‚[m
[31m-[m
[31m-       å›¾7-5ã€€æ–°å»ºindex.html[m
[31m-[m
[31m-ä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-<html xmlns:th="http://www.thymeleaf.org">[m
[31m-   <head>[m
[31m-         <meta content="text/html;charset=UTF-8"/>[m
[31m-         <meta http-equiv="X-UA-Compatible" content="IE=edge"/>[m
[31m-                        <meta name="viewport" content="width=device-[m
[31m-[m
[31m-width, initial-scale=1"/>[m
[31m-       <link th:href="@{bootstrap/css/bootstrap.min.css}" rel="stylesheet"[m
[31m-                              <link th:href="@{bootstrap/css/bootstrap-[m
[31m-[m
[31m-theme.min.css}" rel="stylesheet"/>[m
[31m-   </head>[m
[31m-   <body>[m
[31m-[m
[31m-   <div class="panel panel-primary">[m
[31m-       <div class="panel-heading">[m
[31m-              <h3 class="panel-title">è®¿é—®model</h3>[m
[31m-       </div>[m
[31m-       <div class="panel-body">[m
[31m-              <span th:text="${singlePerson.name}"></span>[m
[31m-       </div>[m
[31m-[m
[31m-   </div>[m
[31m-[m
[31m-   <div th:if="${not #lists.isEmpty(people)}">[m
[31m-          <div class="panel panel-primary">[m
[31m-              <div class="panel-heading">[m
[31m-                     <h3 class="panel-title">åˆ—è¡¨</h3>[m
[31m-              </div>[m
[31m-              <div class="panel-body">[m
[31m-                     <ul class="list-group">[m
[31m-                                                                    <li class="list-group-[m
[31m-[m
[31m-item" th:each="person:${people}">[m
[31m-                                    <span th:text="${person.name}"></span>[m
[31m-[m
[31m-                                  <span th:text="${person.age}"></span>[m
[31m-                                  <button class="btn" th:onclick="'getName(\'' + ${per[m
[31m-è·å¾—åå­—</button>[m
[31m-                             </li>[m
[31m-                     </ul>[m
[31m-              </div>[m
[31m-         </div>[m
[31m- </div>[m
[31m-[m
[31m-                     <script                th:src="@{jquery-[m
[31m-[m
[31m-1.10.2.min.js}" type="text/javascript"></script><!-- 2 -->[m
[31m-[m
[31m-<script th:src="@{bootstrap/js/bootstrap.min.js}">[m
[31m-[m
[31m-</script><!-- 2 -->[m
[31m-[m
[31m-<script th:inline="javascript">[m
[31m-   var single = [[${singlePerson}]];[m
[31m-   console.log(single.name+"/"+single.age)[m
[31m-[m
[31m-   function getName(name){[m
[31m-          console.log(name);[m
[31m-[m
[31m-   }[m
[31m-</script>[m
[31m-[m
[31m- </body>[m
[31m-</html>[m
[31m-[m
[31m-5.æ•°æ®å‡†å¤‡[m
[31m-[m
[31m-ä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-package com.wisely;[m
[31m-[m
[31m-import java.util.ArrayList;[m
[31m-import java.util.List;[m
[31m-[m
[31m-import org.springframework.boot.SpringApplication;[m
[31m-import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-import org.springframework.stereotype.Controller;[m
[31m-import org.springframework.ui.Model;[m
[31m-import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-@Controller[m
[31m-@SpringBootApplication[m
[31m-public class Ch72Application {[m
[31m-[m
[31m-       @RequestMapping("/")[m
[31m-       public String index(Model model){[m
[31m-[m
[31m-              Person single = new Person("aa",11);[m
[31m-[m
[31m-              List<Person> people = new ArrayList<Person>();[m
[31m-              Person p1 = new Person("xx",11);[m
[31m-              Person p2 = new Person("yy",22);[m
[31m-              Person p3 = new Person("zz",33);[m
[31m-              people.add(p1);[m
[31m-              people.add(p2);[m
[31m-              people.add(p3);[m
[31m-[m
[31m-              model.addAttribute("singlePerson", single);[m
[31m-              model.addAttribute("people", people);[m
[31m-[m
[31m-              return "index";[m
[31m-       }[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-              SpringApplication.run(Ch72Application.class, args);[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-6.è¿è¡Œ[m
[31m-[m
[31m-è®¿é—®http://localhostï¼š8080ï¼Œæ•ˆæœå¦‚å›¾7-6æ‰€ç¤ºã€‚[m
[31m-[m
[31m-å•å‡»â€œè·å¾—åå­—â€é€‰é¡¹ï¼Œæ•ˆæœå¦‚å›¾7-7æ‰€ç¤ºã€‚[m
[31m-å›¾7-6ã€€è®¿é—®http://localhostï¼š8080[m
[31m-å›¾7-7ã€€å•å‡»è·å¾—åå­—[m
[31m-7.3ã€€Webç›¸å…³é…ç½®[m
[31m-[m
[31m-7.3.1ã€€Spring Bootæä¾›çš„è‡ªåŠ¨é…ç½®[m
[31m-[m
[31m-     é€šè¿‡æŸ¥çœ‹WebMvcAutoConfigurationåŠWebMvcPropertiesçš„[m
[31m-æºç ï¼Œå¯ä»¥å‘ç°Spring Bootä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹çš„è‡ªåŠ¨é…ç½®ã€‚[m
[31m-[m
[31m-1.è‡ªåŠ¨é…ç½®çš„ViewResolver[m
[31m-[m
[31m-ï¼ˆ1ï¼‰ContentNegotiatingViewResolver[m
[31m-[m
[31m-è¿™æ˜¯Spring  MVCæä¾›çš„ä¸€ä¸ªç‰¹æ®Šçš„ViewResolverï¼Œ[m
[31m-[m
[31m-ContentNegotiatingViewResolverä¸æ˜¯è‡ªå·±å¤„ç†Viewï¼Œè€Œæ˜¯ä»£ç†[m
[31m-[m
[31m-ç»™ä¸åŒçš„ViewResolveræ¥å¤„ç†ä¸åŒçš„Viewï¼Œæ‰€ä»¥å®ƒæœ‰æœ€é«˜çš„ä¼˜[m
[31m-[m
[31m-å…ˆçº§ã€‚[m
[31m-[m
[31m-ï¼ˆ2ï¼‰BeanNameViewResolver[m
[31m-[m
[31m-     åœ¨æ§åˆ¶å™¨ï¼ˆ@Controllerï¼‰ä¸­çš„ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼çš„å­—ç¬¦ä¸²[m
[31m-ï¼ˆè§†å›¾åï¼‰ä¼šæ ¹æ®BeanNameViewResolverå»æŸ¥æ‰¾Beançš„åç§°[m
[31m-ä¸ºè¿”å›å­—ç¬¦ä¸²çš„Viewæ¥æ¸²æŸ“è§†å›¾ã€‚æ˜¯ä¸æ˜¯ä¸å¥½ç†è§£ï¼Œä¸‹é¢ä¸¾[m
[31m-ä¸ªå°ä¾‹å­ã€‚[m
[31m-[m
[31m-å®šä¹‰BeanNameViewResolverçš„Beanï¼š[m
[31m-[m
[31m-@Bean[m
[31m-[m
[31m-       public BeanNameViewResolver beanNameViewResolver() {[m
[31m-              BeanNameViewResolver resolver = new BeanNameViewResolver();[m
[31m-              return resolver;[m
[31m-[m
[31m-       }[m
[31m-     å®šä¹‰ä¸€ä¸ªViewçš„Beanï¼Œåç§°ä¸ºjsonViewï¼š[m
[31m-[m
[31m-       @Bean[m
[31m-              public MappingJackson2JsonView jsonView(){[m
[31m-                      MappingJackson2JsonView jsonView = new MappingJackson2JsonView([m
[31m-                      return jsonView;[m
[31m-              }[m
[31m-[m
[31m-     åœ¨æ§åˆ¶å™¨ä¸­ï¼Œè¿”å›å€¼ä¸ºå­—ç¬¦ä¸²jsonViewï¼Œå®ƒä¼šæ‰¾Beançš„å[m
[31m-ç§°ä¸ºjsonViewçš„è§†å›¾æ¥æ¸²æŸ“ï¼š[m
[31m-[m
[31m-       @RequestMapping(value = "/json",produces=[m
[31m-       {MediaType.APPLICATION_JSON_VALUE})[m
[31m-[m
[31m-              public String json(Model model) {[m
[31m-                      Person single = new Person("aa",11);[m
[31m-                      model.addAttribute("single", single);[m
[31m-                      return "jsonView";[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰InternalResourceViewResolver[m
[31m-[m
[31m-     è¿™ä¸ªæ˜¯ä¸€ä¸ªæä¸ºå¸¸ç”¨çš„ViewResolverï¼Œä¸»è¦é€šè¿‡è®¾ç½®å‰[m
[31m-ç¼€ã€åç¼€ï¼Œä»¥åŠæ§åˆ¶å™¨ä¸­æ–¹æ³•æ¥è¿”å›è§†å›¾åçš„å­—ç¬¦ä¸²ï¼Œä»¥å¾—åˆ°[m
[31m-å®é™…é¡µé¢ï¼ŒSpring Bootçš„æºç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-                      @Bean[m
[31m-                      @ConditionalOnMissingBean(InternalResourceViewResolver.class)[m
[31m-                      public InternalResourceViewResolver defaultViewResolver() {[m
[31m-[m
[31m-                             InternalResourceViewResolver resolver = new InternalResourc[m
[31m-                             resolver.setPrefix(this.prefix);[m
[31m-                             resolver.setSuffix(this.suffix);[m
[31m-                             return resolver;[m
[31m-                      }[m
[31m-     2.è‡ªåŠ¨é…ç½®çš„é™æ€èµ„æº[m
[31m-[m
[31m-     åœ¨è‡ªåŠ¨é…ç½®ç±»çš„addResourceHandlersæ–¹æ³•ä¸­å®šä¹‰äº†ä»¥ä¸‹é™[m
[31m-æ€èµ„æºçš„è‡ªåŠ¨é…ç½®ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰ç±»è·¯å¾„æ–‡ä»¶[m
[31m-[m
[31m-     æŠŠç±»è·¯å¾„ä¸‹çš„/staticã€/publicã€/resourceså’Œ/META-[m
[31m-INF/resourcesæ–‡ä»¶å¤¹ä¸‹çš„é™æ€æ–‡ä»¶ç›´æ¥æ˜ å°„ä¸º/**ï¼Œå¯ä»¥é€šè¿‡[m
[31m-http://localhostï¼š8080/**æ¥è®¿é—®ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰webjar[m
[31m-[m
[31m-     ä½•è°“webjarï¼Œwebjarå°±æ˜¯å°†æˆ‘ä»¬å¸¸ç”¨çš„è„šæœ¬æ¡†æ¶å°è£…åœ¨jar[m
[31m-åŒ…ä¸­çš„jaråŒ…ï¼Œæ›´å¤šå…³äºwebjarçš„å†…å®¹è¯·è®¿é—®[m
[31m-http://www.webjars.orgç½‘ç«™ã€‚[m
[31m-[m
[31m-     æŠŠwebjarçš„/META-INF/resources/webjars/ä¸‹çš„é™æ€æ–‡ä»¶æ˜ [m
[31m-å°„ä¸º/webjar/**ï¼Œå¯ä»¥é€šè¿‡http://localhostï¼š8080/webjar/**æ¥è®¿[m
[31m-é—®ã€‚[m
[31m-[m
[31m-     3.è‡ªåŠ¨é…ç½®çš„Formatterå’ŒConverter[m
[31m-[m
[31m-     å…³äºè‡ªåŠ¨é…ç½®Formatterå’ŒConverterï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹[m
[31m-WebMvcAutoConfigurationç±»ä¸­çš„å®šä¹‰ï¼š[m
[31m-[m
[31m-              @Override[m
[31m-                      public void addFormatters(FormatterRegistry registry) {[m
[31m-                                                                           for (Converter<?, ?[m
[31m-[m
[31m-       > converter : getBeansOfType(Converter.class)){[m
[31m-                                    registry.addConverter(converter);[m
[31m-[m
[31m-                             }[m
[31m-[m
[31m-                             for (GenericConverter converter : getBeansOfType(GenericCon[m
[31m-                                    registry.addConverter(converter);[m
[31m-[m
[31m-                             }[m
[31m-                                                                            for (Formatter<?[m
[31m-> formatter : getBeansOfType(Formatter.class)) {[m
[31m-[m
[31m-                             registry.addFormatter(formatter);[m
[31m-                     }[m
[31m-              }[m
[31m-[m
[31m-              private <T> Collection<T> getBeansOfType(Class<T> type) {[m
[31m-                     return this.beanFactory.getBeansOfType(type).values();[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-     ä»ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œåªè¦æˆ‘ä»¬å®šä¹‰äº†Converterã€[m
[31m-GenericConverterå’ŒFormatteræ¥å£çš„å®ç°ç±»çš„Beanï¼Œè¿™äº›Bean[m
[31m-å°±ä¼šè‡ªåŠ¨æ³¨å†Œåˆ°Spring MVCä¸­ã€‚[m
[31m-[m
[31m-     4.è‡ªåŠ¨é…ç½®çš„HttpMessageConverters[m
[31m-[m
[31m-     åœ¨WebMvcAutoConfigurationä¸­ï¼Œæˆ‘ä»¬æ³¨å†Œäº†[m
[31m-messageConvertersï¼Œä»£ç å¦‚ä¸‹ï¼›[m
[31m-[m
[31m-       @Autowired[m
[31m-                      private HttpMessageConverters messageConverters;[m
[31m-[m
[31m-                      @Override[m
[31m-                      public void configureMessageConverters(List<HttpMessageConverte[m
[31m-       >> converters) {[m
[31m-[m
[31m-                             converters.addAll(this.messageConverters.getConverters());[m
[31m-                      }[m
[31m-[m
[31m-åœ¨è¿™é‡Œç›´æ¥æ³¨å…¥äº†HttpMessageConvertersçš„Beanï¼Œè€Œè¿™ä¸ª[m
[31m-[m
[31m-Beanæ˜¯åœ¨HttpMessageConvertersAutoConfigurationç±»ä¸­å®šä¹‰[m
[31m-[m
[31m-çš„ï¼Œæˆ‘ä»¬è‡ªåŠ¨æ³¨å†Œçš„HttpMessage Converteré™¤äº†Spring MVCé»˜[m
[31m-[m
[31m-è®¤çš„ByteArrayHttpMessageConverterã€StringHttpMessage[m
[31m-[m
[31m-Converterã€Resource  HttpMessageConverterã€[m
[31m-[m
[31m-SourceHttpMessageConverterã€AllEncompassing[m
[31m-[m
[31m-FormHttpMessageConverterå¤–ï¼Œåœ¨æˆ‘ä»¬çš„HttpMessageConverters[m
[31m-AutoConfigurationçš„è‡ªåŠ¨é…ç½®æ–‡ä»¶é‡Œè¿˜å¼•å…¥äº†[m
[31m-JacksonHttpMessageConverters Configurationå’ŒGsonHttpMessage[m
[31m-ConverterConfigurationï¼Œä½¿æˆ‘ä»¬è·å¾—äº†é¢å¤–çš„[m
[31m-HttpMessageConverterï¼š[m
[31m-[m
[31m-è‹¥jacksonçš„jaråŒ…åœ¨ç±»è·¯å¾„ä¸Šï¼Œåˆ™Spring                Booté€šè¿‡[m
[31m-[m
[31m-JacksonHttpMessage Converters Configurationå¢åŠ [m
[31m-[m
[31m-MappingJackson2HttpMessage Converterå’ŒMapping Jackson2[m
[31m-[m
[31m-XmlHttpMessageConverterï¼›[m
[31m-[m
[31m-è‹¥gsonçš„jaråŒ…åœ¨ç±»è·¯å¾„ä¸Šï¼Œåˆ™Spring                   Booté€šè¿‡[m
[31m-[m
[31m-GsonHttpMessageConverter    Configurationå¢åŠ [m
[31m-[m
[31m-GsonHttpMessageConverterã€‚[m
[31m-[m
[31m-åœ¨Spring                    Bootä¸­ï¼Œå¦‚æœè¦æ–°å¢è‡ªå®šä¹‰çš„[m
[31m-[m
[31m-HttpMessageConverterï¼Œåˆ™åªéœ€å®šä¹‰ä¸€ä¸ªä½ è‡ªå·±çš„[m
[31m-[m
[31m-HttpMessageConvertersçš„Beanï¼Œç„¶ååœ¨æ­¤Beanä¸­æ³¨å†Œè‡ªå®šä¹‰[m
[31m-[m
[31m-HttpMessageConverterå³å¯ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-   @Bean[m
[31m-       public HttpMessageConverters customConverters() {[m
[31m-                                                                      HttpMessageConverter<?[m
[31m-[m
[31m-> customConverter1= new CustomConverter1();[m
[31m-                                                                      HttpMessageConverter<?[m
[31m-[m
[31m-> customConverter2= new CustomConverter2();[m
[31m-              return new HttpMessageConverters(customConverter1, customConver[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-5.é™æ€é¦–é¡µçš„æ”¯æŒ[m
[31m-æŠŠé™æ€index.htmlæ–‡ä»¶æ”¾ç½®åœ¨å¦‚ä¸‹ç›®å½•ã€‚[m
[31m-[m
[31m-classpathï¼š/META-INF/resources/index.html[m
[31m-     classpathï¼š/resources/index.html[m
[31m-     classpathï¼š/static/index.html[m
[31m-     classpathï¼š/public/index.html[m
[31m-[m
[31m-     å½“æˆ‘ä»¬è®¿é—®åº”ç”¨æ ¹ç›®å½•http://localhostï¼š8080/æ—¶ï¼Œä¼šç›´æ¥æ˜ [m
[31m-å°„ã€‚[m
[31m-[m
[31m-7.3.2ã€€æ¥ç®¡Spring Bootçš„Webé…ç½®[m
[31m-[m
[31m-     å¦‚æœSpring Bootæä¾›çš„Spring MVCä¸ç¬¦åˆè¦æ±‚ï¼Œåˆ™å¯ä»¥é€š[m
[31m-è¿‡ä¸€ä¸ªé…ç½®ç±»ï¼ˆæ³¨è§£æœ‰@Configurationçš„ç±»ï¼‰åŠ ä¸Š[m
[31m-@EnableWebMvcæ³¨è§£æ¥å®ç°å®Œå…¨è‡ªå·±æ§åˆ¶çš„MVCé…ç½®ã€‚[m
[31m-[m
[31m-     å½“ç„¶ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼ŒSpring Bootçš„è‡ªåŠ¨é…ç½®æ˜¯ç¬¦åˆæˆ‘ä»¬å¤§[m
[31m-å¤šæ•°éœ€æ±‚çš„ã€‚åœ¨ä½ æ—¢éœ€è¦ä¿ç•™Spring Bootæä¾›çš„ä¾¿åˆ©ï¼Œåˆéœ€è¦[m
[31m-å¢åŠ è‡ªå·±çš„é¢å¤–çš„é…ç½®çš„æ—¶å€™ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªé…ç½®ç±»å¹¶ç»§æ‰¿[m
[31m-WebMvcConfigurerAdapterï¼Œæ— é¡»ä½¿ç”¨@EnableWebMvcæ³¨è§£ï¼Œ[m
[31m-ç„¶åæŒ‰ç…§ç¬¬4ç« è®²è§£çš„Spring MVCçš„é…ç½®æ–¹æ³•æ¥æ·»åŠ Spring[m
[31m-Bootä¸ºæˆ‘ä»¬æ‰€åšçš„å…¶ä»–é…ç½®ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       public class WebMvcConfig extends WebMvcConfigurerAdapter{[m
[31m-[m
[31m-                @Override[m
[31m-                    public void addViewControllers(ViewControllerRegistry registry)[m
[31m-                           registry.addViewController("/xx").setViewName("/xx");[m
[31m-                    }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     å€¼å¾—æŒ‡å‡ºçš„æ˜¯ï¼Œåœ¨è¿™é‡Œé‡å†™çš„addViewControllersæ–¹æ³•ï¼Œå¹¶[m
[31m-ä¸ä¼šè¦†ç›–WebMvcAutoConfigurationä¸­çš„[m
[31m-addViewControllersï¼ˆåœ¨æ­¤æ–¹æ³•ä¸­ï¼ŒSpring Bootå°†â€œ/â€æ˜ å°„è‡³[m
[31m-index.htmlï¼‰ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬è‡ªå·±çš„é…ç½®å’ŒSpring Bootçš„[m
[31m-è‡ªåŠ¨é…ç½®åŒæ—¶æœ‰æ•ˆï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬æ¨èæ·»åŠ è‡ªå·±çš„MVCé…ç½®çš„[m
[31m-æ–¹å¼ã€‚[m
[31m-[m
[31m-7.3.3ã€€æ³¨å†ŒServletã€Filterã€Listener[m
[31m-[m
[31m-     å½“ä½¿ç”¨åµŒå…¥å¼çš„Servletå®¹å™¨ï¼ˆTomcatã€Jettyç­‰ï¼‰æ—¶ï¼Œæˆ‘ä»¬[m
[31m-é€šè¿‡å°†Servletã€Filterå’ŒListenerå£°æ˜ä¸ºSpring Beanè€Œè¾¾åˆ°æ³¨å†Œ[m
[31m-çš„æ•ˆæœï¼›æˆ–è€…æ³¨å†ŒServletRegistrationBeanã€[m
[31m-FilterRegistrationBeanå’ŒServletListenerRegistrationBeançš„[m
[31m-Beanã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰ç›´æ¥æ³¨å†ŒBeanç¤ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-           @Bean[m
[31m-       public XxServlet xxServlet (){[m
[31m-[m
[31m-                      return new XxServlet();[m
[31m-              }[m
[31m-              @Bean[m
[31m-              public YyFilter yyFilter (){[m
[31m-[m
[31m-                      return new YyFilter();[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              public ZzListener zzListener (){[m
[31m-[m
[31m-                      return new ZzListener();[m
[31m-              }[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰é€šè¿‡RegistrationBeanç¤ºä¾‹ï¼š[m
[31m-[m
[31m-           @Bean[m
[31m-               public ServletRegistrationBean servletRegistrationBean()[m
[31m-[m
[31m-       {[m
[31m-                      return new ServletRegistrationBean(new XxServlet(),"/xx/*");[m
[31m-       }[m
[31m-       @Bean[m
[31m-       public FilterRegistrationBean filterRegistrationBean(){[m
[31m-[m
[31m-              FilterRegistrationBean registrationBean = new FilterRegistratio[m
[31m-              registrationBean.setFilter( new YyFilter());[m
[31m-              registrationBean.setOrder(2);[m
[31m-              return registrationBean;[m
[31m-       }[m
[31m-[m
[31m-       @Bean[m
[31m-       public ServletListenerRegistrationBean<ZzListener> zzListenerServle[m
[31m-{[m
[31m-[m
[31m-              return new ServletListenerRegistrationBean<ZzListener>[m
[31m-(new ZzListener());[m
[31m-[m
[31m-       }[m
[31m-7.4ã€€Tomcaté…ç½®[m
[31m-[m
[31m-     æœ¬èŠ‚è™½ç„¶å«Tomcaté…ç½®ï¼Œä½†å…¶å®æŒ‡çš„æ˜¯servletå®¹å™¨çš„é…[m
[31m-ç½®ï¼Œå› ä¸ºSpring Booté»˜è®¤å†…åµŒçš„Tomcatä¸ºservletå®¹å™¨ï¼Œæ‰€ä»¥æœ¬[m
[31m-èŠ‚åªè®²å¯¹Tomcaté…ç½®ï¼Œå…¶å®æœ¬èŠ‚çš„é…ç½®å¯¹Tomcatã€Jettyå’Œ[m
[31m-Undertowéƒ½æ˜¯é€šç”¨çš„ã€‚[m
[31m-[m
[31m-7.4.1ã€€é…ç½®Tomcat[m
[31m-[m
[31m-     å…³äºTomcatçš„æ‰€æœ‰å±æ€§éƒ½åœ¨[m
[31m-org.springframework.boot.autoconfigure.web.ServerPropertiesé…ç½®[m
[31m-ç±»ä¸­åšäº†å®šä¹‰ï¼Œæˆ‘ä»¬åªéœ€åœ¨application.propertiesé…ç½®å±æ€§åšé…[m
[31m-ç½®å³å¯ã€‚é€šç”¨çš„Servletå®¹å™¨é…ç½®éƒ½ä»¥â€œserverâ€ä½œä¸ºå‰ç¼€ï¼Œè€Œ[m
[31m-Tomcatç‰¹æœ‰é…ç½®éƒ½ä»¥â€œserver.tomcatâ€ä½œä¸ºå‰ç¼€ã€‚ä¸‹é¢ä¸¾ä¸€äº›å¸¸[m
[31m-ç”¨çš„ä¾‹å­ã€‚[m
[31m-[m
[31m-     é…ç½®Servletå®¹å™¨ï¼š[m
[31m-[m
[31m-       server.port= #é…ç½®ç¨‹åºç«¯å£ï¼Œé»˜è®¤ä¸º8080[m
[31m-       server.session-timeout= #ç”¨æˆ·ä¼šè¯sessionè¿‡æœŸæ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½[m
[31m-       server.context-path= #é…ç½®è®¿é—®è·¯å¾„ï¼Œé»˜è®¤ä¸º/[m
[31m-[m
[31m-     é…ç½®Tomcatï¼š[m
[31m-[m
[31m-       server.tomcat.uri-encoding = #é…ç½®Tomcatç¼–ç ï¼Œé»˜è®¤ä¸ºUTF-8[m
[31m-       server.tomcat.compression= # Tomcatæ˜¯å¦å¼€å¯å‹ç¼©ï¼Œé»˜è®¤ä¸ºå…³é—­off[m
[31m-     æ›´ä¸ºè¯¦ç»†çš„Servletå®¹å™¨é…ç½®åŠTomcaté…ç½®ï¼Œè¯·æŸ¥çœ‹é™„å½•A[m
[31m-ä¸­ä»¥â€œserverâ€å’Œâ€œserver.tomcatâ€ä¸ºå‰ç¼€çš„é…ç½®ã€‚[m
[31m-[m
[31m-7.4.2ã€€ä»£ç é…ç½®Tomcat[m
[31m-[m
[31m-å¦‚æœä½ éœ€è¦é€šè¿‡ä»£ç çš„æ–¹å¼é…ç½®servletå®¹å™¨ï¼Œåˆ™å¯ä»¥æ³¨å†Œ[m
[31m-[m
[31m-ä¸€ä¸ªå®ç°EmbeddedServletContainerCustomizeræ¥å£çš„Beanï¼›è‹¥[m
[31m-[m
[31m-æƒ³ç›´æ¥é…ç½®Tomcatã€Jettyã€Undertowï¼Œåˆ™å¯ä»¥ç›´æ¥å®šå®šä¹‰[m
[31m-[m
[31m-TomcatEmbeddedServletContainerFactoryã€[m
[31m-[m
[31m-JettyEmbeddedServletContainer             Factoryã€[m
[31m-[m
[31m-UndertowEmbeddedServletContainerFactoryã€‚[m
[31m-[m
[31m-1.é€šç”¨é…ç½®[m
[31m-[m
[31m-ï¼ˆ1ï¼‰æ–°å»ºç±»çš„é…ç½®ï¼š[m
[31m-[m
[31m-package com.wisely.ch7_4;[m
[31m-[m
[31m-import java.util.concurrent.TimeUnit;[m
[31m-[m
[31m-import org.springframework.boot.context.embedded.ConfigurableEmbeddedSe[m
[31m-import org.springframework.boot.context.embedded.EmbeddedServletContain[m
[31m-import org.springframework.boot.context.embedded.ErrorPage;[m
[31m-import org.springframework.http.HttpStatus;[m
[31m-import org.springframework.stereotype.Component;[m
[31m-[m
[31m-@Component[m
[31m-public class CustomServletContainer implements EmbeddedServletContainer[m
[31m-[m
[31m-       @Override[m
[31m-       public void customize(ConfigurableEmbeddedServletContainer containe[m
[31m-[m
[31m-              container.setPort(8888); //1[m
[31m-              container.addErrorPages(new ErrorPage(HttpStatus.NOT_FOUND, "/4[m
[31m-              container.setSessionTimeout(10,TimeUnit.MINUTES); //3[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-     ï¼ˆ2ï¼‰å½“å‰é…ç½®æ–‡ä»¶å†…é…ç½®ã€‚è‹¥è¦åœ¨å½“å‰å·²æœ‰çš„é…ç½®æ–‡ä»¶[m
[31m-å†…æ·»åŠ ç±»çš„Beançš„è¯ï¼Œåˆ™åœ¨Springé…ç½®ä¸­ï¼Œæ³¨æ„å½“å‰ç±»è¦å£°æ˜[m
[31m-ä¸ºstaticï¼š[m
[31m-[m
[31m-       @SpringBootApplication[m
[31m-       public class Ch74Application {[m
[31m-[m
[31m-              public static void main(String[] args) {[m
[31m-                      SpringApplication.run(Ch74Application.class, args);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @Component[m
[31m-              public static class CustomServletContainer implements EmbeddedServl[m
[31m-[m
[31m-                      @Override[m
[31m-                      public void customize(ConfigurableEmbeddedServletContainer cont[m
[31m-[m
[31m-                             container.setPort(8888); //1[m
[31m-                             container.addErrorPages(new ErrorPage(HttpStatus.NOT_FOUND,[m
[31m-                             container.setSessionTimeout(10,TimeUnit.MINUTES); //3[m
[31m-                      }[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     2.ç‰¹å®šé…ç½®[m
[31m-[m
[31m-     ä¸‹é¢ä»¥Tomcatä¸ºä¾‹ï¼ˆJettyä½¿ç”¨[m
[31m-JettyEmbeddedServletContainerFactoryï¼ŒUndertowä½¿ç”¨[m
[31m-UndertowEmbeddedServletContainerFactoryï¼‰ï¼š[m
[31m-[m
[31m-       @Bean[m
[31m-              public EmbeddedServletContainerFactory servletContainer() {[m
[31m-              TomcatEmbeddedServletContainerFactory factory = new TomcatEmbeddedS[m
[31m-[m
[31m-       factory.setPort(8888); //1[m
[31m-       factory.addErrorPages(new ErrorPage(HttpStatus.NOT_FOUND, "/404.html"))[m
[31m-[m
[31m-              factory.setSessionTimeout(10, TimeUnit.MINUTES); //3[m
[31m-              return factory;[m
[31m-       }[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     ä¸Šé¢ä¸¤ä¸ªä¾‹å­çš„ä»£ç éƒ½å®ç°äº†è¿™äº›åŠŸèƒ½ï¼š[m
[31m-     â‘ é…ç½®ç«¯å£å·ï¼›[m
[31m-     â‘¡é…ç½®é”™è¯¯é¡µé¢ï¼Œæ ¹æ®HttpStatusä¸­çš„é”™è¯¯çŠ¶æ€ä¿¡æ¯ï¼Œç›´æ¥[m
[31m-è½¬å‘é”™è¯¯é¡µé¢ï¼Œå…¶ä¸­404.htmlæ”¾ç½®åœ¨src/main/resources/staticä¸‹[m
[31m-å³å¯ï¼›[m
[31m-     â‘¢é…ç½®Servletå®¹å™¨ç”¨æˆ·ä¼šè¯ï¼ˆsessionï¼‰è¿‡æœŸæ—¶é—´ã€‚[m
[31m-[m
[31m-7.4.3ã€€æ›¿æ¢Tomcat[m
[31m-[m
[31m-     Spring Booté»˜è®¤ä½¿ç”¨Tomcatä½œä¸ºå†…åµŒServletå®¹å™¨ï¼ŒæŸ¥çœ‹[m
[31m-spring-boot-starter-webä¾èµ–ï¼Œå¦‚å›¾7-8æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                     å›¾7-8ã€€æŸ¥çœ‹Spring-boot-starter-webä¾èµ–[m
[31m-[m
[31m-     å¦‚æœè¦ä½¿ç”¨Jettyæˆ–è€…Undertowä¸ºsevvletå®¹å™¨ï¼Œåªéœ€ä¿®æ”¹[m
[31m-spring-boot-starter-webçš„ä¾èµ–å³å¯ã€‚[m
[31m-[m
[31m-     1.æ›¿æ¢ä¸ºJetty[m
[31m-     åœ¨pom.xmlä¸­ï¼Œå°†spring-boot-starter-webçš„ä¾èµ–ç”±spring-[m
[31m-boot-starter-tomcatæ›¿æ¢ä¸ºspring-boot-starter-Jettyï¼š[m
[31m-[m
[31m-              <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       web</artifactId>[m
[31m-                             <exclusions>[m
[31m-                                    <exclusion>[m
[31m-                                           <groupId>org.springframework.boot</groupId>[m
[31m-                                                            <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       tomcat</artifactId>[m
[31m-                                    </exclusion>[m
[31m-[m
[31m-                             </exclusions>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       jetty</artifactId>[m
[31m-                      </dependency>[m
[31m-[m
[31m-     æ­¤æ—¶å¯åŠ¨Spring Bootï¼Œæ§åˆ¶å°è¾“å‡ºæ•ˆæœå¦‚å›¾7-9æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                               å›¾7-9ã€€æ§åˆ¶å°è¾“å‡ºæ•ˆæœ[m
[31m-[m
[31m-     2.æ›¿æ¢ä¸ºUndertow[m
[31m-[m
[31m-     åœ¨pom.xmlä¸­ï¼Œå°†spring-boot-starter-webçš„ä¾èµ–ç”±spring-[m
[31m-boot-starter-tomcatæ›¿æ¢ä¸ºspring-boot-starter-undertowï¼š[m
[31m-[m
[31m-       <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       web</artifactId>[m
[31m-                             <exclusions>[m
[31m-                                    <exclusion>[m
[31m-                                           <groupId>org.springframework.boot</groupId>[m
[31m-                                                            <artifactId>spring-boot-starter-[m
[31m-       tomcat</artifactId>[m
[31m-[m
[31m-                                    </exclusion>[m
[31m-                             </exclusions>[m
[31m-                      </dependency>[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       undertow</artifactId>[m
[31m-              </dependency>[m
[31m-[m
[31m-     æ­¤æ—¶å¯åŠ¨Spring Bootï¼Œæ§åˆ¶å°è¾“å‡ºæ•ˆæœå¦‚å›¾7-10æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾7-10ã€€æ§åˆ¶å°è¾“å‡ºæ•ˆæœ[m
[31m-[m
[31m-7.4.4ã€€SSLé…ç½®[m
[31m-[m
[31m-     SSLçš„é…ç½®ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨å®é™…åº”ç”¨ä¸­ç»å¸¸é‡åˆ°çš„åœºæ™¯ã€‚[m
[31m-[m
[31m-     SSLï¼ˆSecure Sockets Layerï¼Œå®‰å…¨å¥—æ¥å±‚ï¼‰æ˜¯ä¸ºç½‘ç»œé€šä¿¡æ[m
[31m-ä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§çš„ä¸€ç§å®‰å…¨åè®®ï¼ŒSSLåœ¨ç½‘ç»œä¼ è¾“å±‚å¯¹ç½‘[m
[31m-ç»œè¿æ¥è¿›è¡ŒåŠ å¯†ã€‚SSLåè®®ä½äºTCP/IPåè®®ä¸å„ç§åº”ç”¨å±‚åè®®[m
[31m-ä¹‹é—´ï¼Œä¸ºæ•°æ®é€šä¿¡æä¾›å®‰å…¨æ”¯æŒã€‚SSLåè®®å¯åˆ†ä¸ºä¸¤å±‚ï¼šSSL[m
[31m-è®°å½•åè®®ï¼ˆSSL Record Protocolï¼‰ï¼Œå®ƒå»ºç«‹åœ¨å¯é çš„ä¼ è¾“åè®®[m
[31m-ï¼ˆå¦‚TCPï¼‰ä¹‹ä¸Šï¼Œä¸ºé«˜å±‚åè®®æä¾›æ•°æ®å°è£…ã€å‹ç¼©ã€åŠ å¯†ç­‰åŸº[m
[31m-æœ¬åŠŸèƒ½çš„æ”¯æŒã€‚SSLæ¡æ‰‹åè®®ï¼ˆSSL Handshake Protocolï¼‰ï¼Œå®ƒ[m
[31m-å»ºç«‹åœ¨SSLè®°å½•åè®®ä¹‹ä¸Šï¼Œç”¨äºåœ¨å®é™…æ•°æ®ä¼ è¾“å¼€å§‹å‰ï¼Œé€šä¿¡[m
[31m-åŒæ–¹è¿›è¡Œèº«ä»½è®¤è¯ã€åå•†åŠ å¯†ç®—æ³•ã€äº¤æ¢åŠ å¯†å¯†é’¥ç­‰ã€‚[m
[31m-[m
[31m-     è€Œåœ¨åŸºäºB/Sçš„Webåº”ç”¨ä¸­ï¼Œæ˜¯é€šè¿‡HTTPSæ¥å®ç°SSLçš„ã€‚[m
[31m-HTTPSæ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„HTTPé€šé“ï¼Œç®€å•è®²æ˜¯HTTPçš„å®‰å…¨[m
[31m-ç‰ˆï¼Œå³åœ¨HTTPä¸‹åŠ å…¥SSLå±‚ï¼ŒHTTPSçš„å®‰å…¨åŸºç¡€æ˜¯SSLã€‚[m
[31m-     å› ä¸ºSpring Bootç”¨çš„æ˜¯å†…åµŒçš„Tomcatï¼Œå› è€Œæˆ‘ä»¬åšSSLé…[m
[31m-[m
[31m-ç½®çš„æ—¶å€™éœ€è¦åšå¦‚ä¸‹çš„æ“ä½œã€‚[m
[31m-     1.ç”Ÿæˆè¯ä¹¦[m
[31m-     ä½¿ç”¨SSLé¦–å…ˆéœ€è¦ä¸€ä¸ªè¯ä¹¦ï¼Œè¿™ä¸ªè¯ä¹¦æ—¢å¯ä»¥æ˜¯è‡ªç­¾å[m
[31m-[m
[31m-çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»SSLè¯ä¹¦æˆæƒä¸­å¿ƒè·å¾—çš„ã€‚æœ¬ä¾‹ä¸ºäº†æ¼”ç¤ºæ–¹[m
[31m-ä¾¿ï¼Œæ¼”ç¤ºè‡ªæˆæƒè¯ä¹¦çš„ç”Ÿæˆã€‚[m
[31m-[m
[31m-     æ¯ä¸€ä¸ªJDKæˆ–è€…JREé‡Œéƒ½æœ‰ä¸€ä¸ªå·¥å…·å«keytoolï¼Œå®ƒæ˜¯ä¸€ä¸ª[m
[31m-è¯ä¹¦ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥ç”Ÿæˆè‡ªç­¾åçš„è¯ä¹¦ï¼Œå¦‚å›¾7-11æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                    å›¾7-11ã€€keytool[m
[31m-[m
[31m-     åœ¨é…ç½®äº†JAVA_HOMEï¼Œå¹¶å°†JAVA_HOMEçš„binç›®å½•åŠ å…¥[m
[31m-åˆ°Pathåï¼Œå³å¯åœ¨æ§åˆ¶å°è°ƒç”¨è¯¥å‘½ä»¤ï¼Œå¦‚å›¾7-12æ‰€ç¤ºã€‚[m
[31m-                           å›¾7-12ã€€å°†binç›®å½•åŠ å…¥åˆ°Path[m
[31m-[m
[31m-     åœ¨æ§åˆ¶å°è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œç„¶åæŒ‰ç…§æç¤ºæ“ä½œï¼Œå¦‚å›¾7-13æ‰€[m
[31m-ç¤ºã€‚[m
[31m-[m
[31m-       keytool â€“genkey -alias tomcat[m
[31m-[m
[31m-                                å›¾7-13ã€€æŒ‰ç…§æç¤ºæ“ä½œ[m
[31m-     è¿™æ—¶å€™æˆ‘ä»¬åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ª.keystoreæ–‡ä»¶ï¼Œè¿™å°±[m
[31m-æ˜¯æˆ‘ä»¬è¦ç”¨çš„è¯ä¹¦æ–‡ä»¶ï¼Œå¦‚å›¾7-14æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                 å›¾7-14ã€€keystoreæ–‡ä»¶[m
[31m-[m
[31m-     2.Spring Booté…ç½®SSL[m
[31m-     æ·»åŠ ä¸€ä¸ªindex.htmlåˆ°src/main/resources/staticä¸‹ï¼Œä½œä¸ºæµ‹[m
[31m-è¯•ã€‚[m
[31m-     å°†.keystoreæ–‡ä»¶å¤åˆ¶åˆ°é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œç„¶ååœ¨[m
[31m-application.propertiesä¸­åšå¦‚ä¸‹SSLçš„é…ç½®ï¼š[m
[31m-[m
[31m-       server.port = 8443[m
[31m-       server.ssl.key-store = .keystore[m
[31m-[m
[31m-       server.ssl.key-store-password= 111111[m
[31m-       server.ssl.keyStoreType= JKS[m
[31m-       server.ssl.keyAlias: tomcat[m
[31m-     æ­¤æ—¶å¯åŠ¨Spring Bootï¼Œæ§åˆ¶å°è¾“å‡ºæ•ˆæœå¦‚å›¾7-15æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾7-15ã€€æ§åˆ¶å°è¾“å‡ºæ•ˆæœ[m
[31m-[m
[31m-     æ­¤æ—¶è®¿é—®https://localhostï¼š8443ï¼Œæ•ˆæœå¦‚å›¾7-16æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                            å›¾7-16ã€€è®¿é—®localhostï¼š8443[m
[31m-[m
[31m-     3.httpè½¬å‘https[m
[31m-     å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åœ¨åœ°å€æ è¾“å…¥çš„æ˜¯httpï¼Œä½†æ˜¯ä¼šè‡ªåŠ¨è½¬å‘åˆ°[m
[31m-httpsï¼Œä¾‹å¦‚æˆ‘ä»¬è®¿é—®ç™¾åº¦çš„æ—¶å€™ï¼Œå¦‚å›¾7-17æ‰€ç¤ºã€‚[m
[31m-                              å›¾7-17ã€€httpè‡ªåŠ¨è½¬å‘https[m
[31m-[m
[31m-     è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€é…ç½®[m
[31m-TomcatEmbeddedServletContainerFactoryï¼Œå¹¶ä¸”æ·»åŠ Tomcatçš„[m
[31m-connectoræ¥å®ç°ã€‚[m
[31m-[m
[31m-     è¿™æ—¶æˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶é‡Œå¢åŠ å¦‚ä¸‹é…ç½®ï¼š[m
[31m-[m
[31m-       import org.apache.catalina.Context;[m
[31m-       import org.apache.catalina.connector.Connector;[m
[31m-       import org.apache.tomcat.util.descriptor.web.SecurityCollection;[m
[31m-       import org.apache.tomcat.util.descriptor.web.SecurityConstraint;[m
[31m-       import org.springframework.boot.SpringApplication;[m
[31m-       import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-       import org.springframework.boot.context.embedded.EmbeddedServletContain[m
[31m-       import org.springframework.boot.context.embedded.tomcat.TomcatEmbeddedS[m
[31m-       import org.springframework.context.annotation.Bean;[m
[31m-[m
[31m-       @SpringBootApplication[m
[31m-       public class Ch74Application {[m
[31m-[m
[31m-              public static void main(String[] args) {[m
[31m-                      SpringApplication.run(Ch74Application.class, args);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              public EmbeddedServletContainerFactory servletContainer() {[m
[31m-[m
[31m-                  TomcatEmbeddedServletContainerFactory tomcat = new TomcatEmbedded[m
[31m-                         @Override[m
[31m-                         protected void postProcessContext(Context context) {[m
[31m-                             SecurityConstraint securityConstraint = new SecurityConstra[m
[31m-                             securityConstraint.setUserConstraint("CONFIDENTIAL");[m
[31m-                             SecurityCollection collection = new SecurityCollection();[m
[31m-                             collection.addPattern("/*");[m
[31m-                             securityConstraint.addCollection(collection);[m
[31m-                             context.addConstraint(securityConstraint);[m
[31m-[m
[31m-                         }[m
[31m-                      };[m
[31m-[m
[31m-                  tomcat.addAdditionalTomcatConnectors(httpConnector());[m
[31m-                  return tomcat;[m
[31m-              }[m
[31m-              @Bean[m
[31m-              public Connector httpConnector() {[m
[31m-                  Connector connector = new Connector("org.apache.coyote.http11.Htt[m
[31m-                  connector.setScheme("http");[m
[31m-                  connector.setPort(8080);[m
[31m-                  connector.setSecure(false);[m
[31m-                  connector.setRedirectPort(8443);[m
[31m-                  return connector;[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     æ­¤æ—¶å¯åŠ¨Spring Bootï¼Œæ§åˆ¶å°è¾“å‡ºæ•ˆæœå¦‚å›¾7-18æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                               å›¾7-18ã€€å¯åŠ¨Spring Boot[m
[31m-[m
[31m-     æ­¤æ—¶æˆ‘ä»¬è®¿é—®ï¼šhttp://localhostï¼š8080ï¼Œä¼šè‡ªåŠ¨è½¬åˆ°[m
[31m-https://localhostï¼š8443ï¼Œå¦‚å›¾7-19æ‰€ç¤ºã€‚[m
[31m-å›¾7-19ã€€è‡ªåŠ¨è½¬åˆ°https://localhostï¼š8443[m
[31m-7.5ã€€Faviconé…ç½®[m
[31m-[m
[31m-7.5.1ã€€é»˜è®¤çš„Favicon[m
[31m-[m
[31m-     Spring Bootæä¾›äº†ä¸€ä¸ªé»˜è®¤çš„Faviconï¼Œæ¯æ¬¡è®¿é—®åº”ç”¨çš„æ—¶[m
[31m-å€™éƒ½èƒ½çœ‹åˆ°ï¼Œå¦‚å›¾7-20æ‰€ç¤ºã€‚[m
[31m-[m
[31m-7.5.2ã€€å…³é—­Favicon[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥åœ¨application.propertiesä¸­è®¾ç½®å…³é—­Faviconï¼Œé»˜è®¤[m
[31m-ä¸ºå¼€å¯ï¼Œå¦‚å›¾7-21æ‰€ç¤ºã€‚[m
[31m-[m
[31m-       spring.mvc.favicon.enabled=false[m
[31m-[m
[31m-                                å›¾7-20ã€€é»˜è®¤çš„Favicon[m
[31m-                                 å›¾7-21ã€€å…³é—­Favicon[m
[31m-[m
[31m-7.5.3ã€€è®¾ç½®è‡ªå·±çš„Favicon[m
[31m-[m
[31m-     è‹¥éœ€è¦è®¾ç½®è‡ªå·±çš„Faviconï¼Œåˆ™åªéœ€å°†è‡ªå·±çš„[m
[31m-favicon.icoï¼ˆæ–‡ä»¶åä¸èƒ½å˜åŠ¨ï¼‰æ–‡ä»¶æ”¾ç½®åœ¨ç±»è·¯å¾„æ ¹ç›®å½•ã€ç±»[m
[31m-è·¯å¾„META-INF/resources/ä¸‹ã€ç±»è·¯å¾„resources/ä¸‹ã€ç±»è·¯å¾„[m
[31m-static/ä¸‹æˆ–ç±»è·¯å¾„public/ä¸‹ã€‚è¿™é‡Œå°†favicon.icoæ”¾ç½®åœ¨[m
[31m-src/main/resources/staticä¸‹ï¼Œè¿è¡Œæ•ˆæœå¦‚å›¾7-22æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾7-22ã€€è¿è¡Œæ•ˆæœ[m
[31m-7.6ã€€WebSocket[m
[31m-[m
[31m-7.6.1ã€€ä»€ä¹ˆæ˜¯WebSocket[m
[31m-[m
[31m-     WebSocketä¸ºæµè§ˆå™¨å’ŒæœåŠ¡ç«¯æä¾›äº†åŒå·¥å¼‚æ­¥é€šä¿¡çš„åŠŸ[m
[31m-èƒ½ï¼Œå³æµè§ˆå™¨å¯ä»¥å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥å‘æµè§ˆå™¨[m
[31m-å‘é€æ¶ˆæ¯ã€‚WebSocketéœ€æµè§ˆå™¨çš„æ”¯æŒï¼Œå¦‚IE 10+ã€Chrome[m
[31m-13+ã€Firefox 6+ï¼Œè¿™å¯¹æˆ‘ä»¬ç°åœ¨çš„æµè§ˆå™¨æ¥è¯´éƒ½ä¸æ˜¯é—®é¢˜ã€‚[m
[31m-[m
[31m-     WebSocketæ˜¯é€šè¿‡ä¸€ä¸ªsocketæ¥å®ç°åŒå·¥å¼‚æ­¥é€šä¿¡èƒ½åŠ›çš„ã€‚[m
[31m-ä½†æ˜¯ç›´æ¥ä½¿ç”¨WebSocketï¼ˆæˆ–è€…SockJSï¼šWebSocketåè®®çš„æ¨¡[m
[31m-æ‹Ÿï¼Œå¢åŠ äº†å½“æµè§ˆå™¨ä¸æ”¯æŒWebSocketçš„æ—¶å€™çš„å…¼å®¹æ”¯æŒï¼‰å[m
[31m-è®®å¼€å‘ç¨‹åºæ˜¾å¾—ç‰¹åˆ«çƒ¦çï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å®ƒçš„å­åè®®STOMPï¼Œ[m
[31m-å®ƒæ˜¯ä¸€ä¸ªæ›´é«˜çº§åˆ«çš„åè®®ï¼ŒSTOMPåè®®ä½¿ç”¨ä¸€ä¸ªåŸºäºå¸§[m
[31m-ï¼ˆframeï¼‰çš„æ ¼å¼æ¥å®šä¹‰æ¶ˆæ¯ï¼Œä¸HTTPçš„requestå’Œresponseç±»[m
[31m-ä¼¼ï¼ˆå…·æœ‰ç±»ä¼¼äº@RequestMappingçš„@MessageMappingï¼‰ï¼Œæˆ‘[m
[31m-ä»¬ä¼šåœ¨åé¢å®æˆ˜å†…å®¹ä¸­è§‚å¯ŸSTOMPçš„å¸§ã€‚[m
[31m-[m
[31m-7.6.2ã€€Spring Bootæä¾›çš„è‡ªåŠ¨é…ç½®[m
[31m-[m
[31m-     Spring Bootå¯¹å†…åµŒçš„Tomcatï¼ˆ7æˆ–è€…8ï¼‰ã€Jetty9å’ŒUndertow[m
[31m-ä½¿ç”¨WebSocketæä¾›äº†æ”¯æŒã€‚é…ç½®æºç å­˜äº[m
[31m-org.springframework.boot.autoconfigure.websocketä¸‹ï¼Œå¦‚å›¾7-23[m
[31m-æ‰€ç¤ºã€‚[m
[31m-                                å›¾7-23ã€€æºç å­˜æ”¾ä½ç½®[m
[31m-[m
[31m-     Spring Bootä¸ºWebSocketæä¾›çš„stater pomæ˜¯spring-boot-[m
[31m-starter-websocketã€‚[m
[31m-[m
[31m-7.6.3ã€€å®æˆ˜[m
[31m-[m
[31m-     1.å‡†å¤‡[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œé€‰æ‹©Thymeleafå’ŒWebsocketä¾èµ–ï¼Œ[m
[31m-å¦‚å›¾7-24æ‰€ç¤ºã€‚[m
[31m-                       å›¾7-24ã€€é€‰æ‹©Thymeleafå’ŒWebsocket[m
[31m-[m
[31m-     2.å¹¿æ’­å¼[m
[31m-[m
[31m-     å¹¿æ’­å¼å³æœåŠ¡ç«¯æœ‰æ¶ˆæ¯æ—¶ï¼Œä¼šå°†æ¶ˆæ¯å‘é€ç»™æ‰€æœ‰è¿æ¥äº†å½“[m
[31m-å‰endpointçš„æµè§ˆå™¨ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰é…ç½®WebSocketï¼Œéœ€è¦åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨[m
[31m-@EnableWebSocketMessageBrokerå¼€å¯WebSocketæ”¯æŒï¼Œå¹¶é€š[m
[31m-è¿‡ç»§æ‰¿AbstractWebSocketMessageBrokerConfigurerç±»ï¼Œé‡å†™å…¶[m
[31m-æ–¹æ³•æ¥é…ç½®WebSocketã€‚[m
[31m-[m
[31m-     ä»£ç å¦‚ä¸‹ï¼š[m
[31m-       package com.wisely.ch7_6;[m
[31m-[m
[31m-       import org.springframework.context.annotation.Configuration;[m
[31m-       import org.springframework.messaging.simp.config.MessageBrokerRegistry;[m
[31m-       import org.springframework.web.socket.config.annotation.AbstractWebSock[m
[31m-       import org.springframework.web.socket.config.annotation.EnableWebSocket[m
[31m-       import org.springframework.web.socket.config.annotation.StompEndpointRe[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableWebSocketMessageBroker//1[m
[31m-       public class WebSocketConfig extends AbstractWebSocketMessageBrokerConf[m
[31m-[m
[31m-              @Override[m
[31m-              public void registerStompEndpoints(StompEndpointRegistry registry)[m
[31m-[m
[31m-                      registry.addEndpoint("/endpointWisely").withSockJS(); //3[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public void configureMessageBroker(MessageBrokerRegistry registry)[m
[31m-[m
[31m-                      registry.enableSimpleBroker("/topic"); //5[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é€šè¿‡@EnableWebSocketMessageBrokeræ³¨è§£å¼€å¯ä½¿ç”¨[m
[31m-STOMPåè®®æ¥ä¼ è¾“åŸºäºä»£ç†ï¼ˆmessage brokerï¼‰çš„æ¶ˆæ¯ï¼Œè¿™æ—¶[m
[31m-æ§åˆ¶å™¨æ”¯æŒä½¿ç”¨@MessageMappingï¼Œå°±åƒä½¿ç”¨[m
[31m-@RequestMappingä¸€æ ·ã€‚[m
[31m-[m
[31m-     â‘¡æ³¨å†ŒSTOMPåè®®çš„èŠ‚ç‚¹ï¼ˆendpointï¼‰ï¼Œå¹¶æ˜ å°„çš„æŒ‡å®šçš„[m
[31m-URLã€‚[m
[31m-[m
[31m-     â‘¢æ³¨å†Œä¸€ä¸ªSTOMPçš„endpointï¼Œå¹¶æŒ‡å®šä½¿ç”¨SockJSåè®®ã€‚[m
[31m-[m
[31m-     â‘£é…ç½®æ¶ˆæ¯ä»£ç†ï¼ˆMessage Brokerï¼‰ã€‚[m
[31m-[m
[31m-     â‘¤å¹¿æ’­å¼åº”é…ç½®ä¸€ä¸ª/topicæ¶ˆæ¯ä»£ç†ã€‚[m
[31m-ï¼ˆ2ï¼‰æµè§ˆå™¨å‘æœåŠ¡ç«¯å‘é€çš„æ¶ˆæ¯ç”¨æ­¤ç±»æ¥å—ï¼š[m
[31m-[m
[31m-package com.wisely.ch7_6.domain;[m
[31m-[m
[31m-public class WiselyMessage {[m
[31m-       private String name;[m
[31m-[m
[31m-       public String getName(){[m
[31m-              return name;[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ3ï¼‰æœåŠ¡ç«¯å‘æµè§ˆå™¨å‘é€çš„æ­¤ç±»çš„æ¶ˆæ¯ï¼š[m
[31m-[m
[31m-package com.wisely.ch7_6.domain;[m
[31m-[m
[31m-public class WiselyResponse {[m
[31m-       private String responseMessage;[m
[31m-       public WiselyResponse(String responseMessage){[m
[31m-              this.responseMessage = responseMessage;[m
[31m-       }[m
[31m-       public String getResponseMessage(){[m
[31m-              return responseMessage;[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ4ï¼‰æ¼”ç¤ºæ§åˆ¶å™¨ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-package com.wisely.ch7_6.web;[m
[31m-[m
[31m-import org.springframework.messaging.handler.annotation.MessageMapping;[m
[31m-import org.springframework.messaging.handler.annotation.SendTo;[m
[31m-import org.springframework.stereotype.Controller;[m
[31m-[m
[31m-import com.wisely.ch7_6.domain.WiselyMessage;[m
[31m-import com.wisely.ch7_6.domain.WiselyResponse;[m
[31m-[m
[31m-@Controller[m
[31m-public class WsController {[m
[31m-@MessageMapping("/welcome") //1[m
[31m-@SendTo("/topic/getResponse") //2[m
[31m-[m
[31m-       public WiselyResponse say(WiselyMessage message) throws Exception {[m
[31m-                     Thread.sleep(3000);[m
[31m-                     return new WiselyResponse("Welcome, " + message.getName() +[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ å½“æµè§ˆå™¨å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œé€šè¿‡@MessageMapping[m
[31m-æ˜ å°„/welcomeè¿™ä¸ªåœ°å€ï¼Œç±»ä¼¼äº@RequestMappingã€‚[m
[31m-[m
[31m-     â‘¡å½“æœåŠ¡ç«¯æœ‰æ¶ˆæ¯æ—¶ï¼Œä¼šå¯¹è®¢é˜…äº†@SendToä¸­çš„è·¯å¾„çš„æµ[m
[31m-è§ˆå™¨å‘é€æ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰æ·»åŠ è„šæœ¬ã€‚å°†stomp.min.jsï¼ˆSTOMPåè®®çš„å®¢æˆ·ç«¯è„š[m
[31m-æœ¬ï¼‰ã€sockjs.min.jsï¼ˆSockJSçš„å®¢æˆ·ç«¯è„šæœ¬ï¼‰ä»¥åŠjQueryæ”¾ç½®åœ¨[m
[31m-src/main/resources/staticä¸‹ã€‚è¯»è€…å¯åœ¨è¿™ä¸€ç« çš„æºç é‡Œæ‰¾åˆ°è¿™å‡ [m
[31m-ä¸ªè„šæœ¬ï¼Œæˆ–è€…è‡ªè¡Œä¸‹è½½ã€‚[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰æ¼”ç¤ºé¡µé¢ã€‚åœ¨src/main/resources/templatesä¸‹æ–°å»º[m
[31m-ws.htmlï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-<!DOCTYPE html>[m
[31m-[m
[31m-<html xmlns:th="http://www.thymeleaf.org">[m
[31m-[m
[31m-<head>[m
[31m-[m
[31m-       <meta charset="UTF-8" />[m
[31m-       <title>Spring Boot+WebSocket+å¹¿æ’­å¼</title>[m
[31m-[m
[31m-</head>[m
[31m-[m
[31m-<body onload="disconnect()">[m
[31m-[m
[31m-<noscript><h2  style="color:  #ff0000">è²Œä¼¼ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ[m
[31m-[m
[31m-websocket</h2></noscript>[m
[31m-[m
[31m-<div>[m
[31m-[m
[31m-<div>[m
[31m-[m
[31m-               <button id="connect" onclick="connect();">è¿æ¥[m
[31m-</button>[m
[31m-[m
[31m-              <button id="disconnect" disabled="disabled" onclick="disconnect[m
[31m-æ–­å¼€è¿æ¥</button>[m
[31m-[m
[31m-</div>[m
[31m-[m
[31m-<div id="conversationDiv">[m
[31m-[m
[31m-                                 <label>è¾“å…¥ä½ çš„åå­—</label>[m
[31m-[m
[31m-<input type="text" id="name" />[m
[31m-                      <button id="sendName" onclick="sendName();">å‘é€[m
[31m-[m
[31m-</button>[m
[31m-[m
[31m-        <p id="response"></p>[m
[31m-[m
[31m-</div>[m
[31m-[m
[31m-</div>[m
[31m-[m
[31m-<script th:src="@{sockjs.min.js}"></script>[m
[31m-[m
[31m-<script th:src="@{stomp.min.js}"></script>[m
[31m-[m
[31m-<script th:src="@{jquery.js}"></script>[m
[31m-[m
[31m-<script type="text/javascript">[m
[31m-[m
[31m-var stompClient = null;[m
[31m-[m
[31m-function setConnected(connected) {[m
[31m-       document.getElementById('connect').disabled = connected;[m
[31m-       document.getElementById('disconnect').disabled = !connected;[m
[31m-       document.getElementById('conversationDiv').style.visibility = c[m
[31m-       $('#response').html();[m
[31m-[m
[31m-}[m
[31m-[m
[31m-       function connect() {[m
[31m-              var socket = new SockJS('/endpointWisely'); //1[m
[31m-              stompClient = Stomp.over(socket); //2[m
[31m-              stompClient.connect({}, function(frame) { //3[m
[31m-                     setConnected(true);[m
[31m-                     console.log('Connected: ' + frame);[m
[31m-                     stompClient.subscribe('/topic/getResponse', function(respno[m
[31m-[m
[31m-{ //4[m
[31m-                             showResponse(JSON.parse(respnose.body).responseMessage)[m
[31m-[m
[31m-                     });[m
[31m-              });[m
[31m-       }[m
[31m-       function disconnect() {[m
[31m-              if (stompClient != null) {[m
[31m-[m
[31m-                     stompClient.disconnect();[m
[31m-              }[m
[31m-              setConnected(false);[m
[31m-              console.log("Disconnected");[m
[31m-       }[m
[31m-[m
[31m-function sendName() {[m
[31m-       var name = $('#name').val();[m
[31m-       //5[m
[31m-                      stompClient.send("/welcome", {}, JSON.stringify({ 'name': name[m
[31m-              }[m
[31m-[m
[31m-              function showResponse(message) {[m
[31m-                         var response = $("#response");[m
[31m-                         response.html(message);[m
[31m-[m
[31m-              }[m
[31m-       </script>[m
[31m-       </body>[m
[31m-       </html>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ è¿æ¥SockJSçš„endpointåç§°ä¸ºâ€œ/endpointWiselyâ€ã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨STOMPå­åè®®çš„WebSocketå®¢æˆ·ç«¯ã€‚[m
[31m-[m
[31m-     â‘¢è¿æ¥WebSocketæœåŠ¡ç«¯ã€‚[m
[31m-[m
[31m-     â‘£é€šè¿‡stompClient.subscribeè®¢é˜…/topic/getResponseç›®æ ‡[m
[31m-ï¼ˆdestinationï¼‰å‘é€çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªæ˜¯åœ¨æ§åˆ¶å™¨çš„@SendToä¸­å®š[m
[31m-ä¹‰çš„ã€‚[m
[31m-[m
[31m-     â‘¤é€šè¿‡stompClient.sendå‘/welcomeç›®æ ‡ï¼ˆdestinationï¼‰å‘é€[m
[31m-æ¶ˆæ¯ï¼Œè¿™ä¸ªæ˜¯åœ¨æ§åˆ¶å™¨çš„@MessageMappingä¸­å®šä¹‰çš„ã€‚[m
[31m-[m
[31m-     ï¼ˆ7ï¼‰é…ç½®viewControllerï¼Œä¸ºws.htmlæä¾›ä¾¿æ·çš„è·¯å¾„æ˜ [m
[31m-å°„ï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       public class WebMvcConfig extends WebMvcConfigurerAdapter{[m
[31m-[m
[31m-                @Override[m
[31m-                    public void addViewControllers(ViewControllerRegistry registry)[m
[31m-                           registry.addViewController("/ws").setViewName("/ws");[m
[31m-                    }[m
[31m-[m
[31m-       }[m
[31m-     ï¼ˆ8ï¼‰è¿è¡Œã€‚æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœæ˜¯ï¼šå½“ä¸€ä¸ªæµè§ˆå™¨å‘é€ä¸€ä¸ª[m
[31m-æ¶ˆæ¯åˆ°æœåŠ¡ç«¯æ—¶ï¼Œå…¶ä»–æµè§ˆå™¨ä¹Ÿèƒ½æ¥æ”¶åˆ°ä»æœåŠ¡ç«¯å‘é€æ¥çš„è¿™[m
[31m-ä¸ªæ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     å¼€å¯ä¸‰ä¸ªæµè§ˆå™¨çª—å£ï¼Œå¹¶è®¿é—®http://localhostï¼š8080/wsï¼Œåˆ†[m
[31m-åˆ«è¿æ¥æœåŠ¡å™¨ã€‚ç„¶ååœ¨ä¸€ä¸ªæµè§ˆå™¨ä¸­å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œå…¶ä»–æµè§ˆ[m
[31m-å™¨æ¥æ”¶æ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     è¿æ¥æœåŠ¡ç«¯ï¼Œå¦‚å›¾7-25æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                 å›¾7-25ã€€è¿æ¥æœåŠ¡å™¨[m
[31m-[m
[31m-     ä¸€ä¸ªæµè§ˆå™¨å‘é€æ¶ˆæ¯ï¼Œå¦‚å›¾7-26æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾7-26ã€€å‘é€æ¶ˆæ¯[m
[31m-[m
[31m-     æ‰€æœ‰æµè§ˆå™¨æ¥æ”¶æœåŠ¡ç«¯å‘é€çš„æ¶ˆæ¯ï¼Œå¦‚å›¾7-27æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                           å›¾7-27ã€€æ‰€æœ‰æµè§ˆå™¨æ¥æ”¶ä¿¡æ¯[m
[31m-[m
[31m-     æˆ‘ä»¬åœ¨Chromeæµè§ˆå™¨ï¼ˆåœ¨Chromeä¸‹æŒ‰F12è°ƒå‡ºï¼‰ä¸‹è§‚å¯Ÿä¸€[m
[31m-ä¸‹STOMPçš„å¸§ï¼Œå¦‚å›¾7-28æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾7-28ã€€è§‚å¯ŸSTOMPçš„å¸§[m
[31m-[m
[31m-     ä»ä¸Šè¿°æˆªå›¾å¯ä»¥è§‚å¯Ÿå¾—å‡ºï¼Œè¿æ¥æœåŠ¡ç«¯çš„æ ¼å¼ä¸ºï¼š[m
[31m-[m
[31m-       CONNECT[m
[31m-       accept-version:1.1,1.0[m
[31m-       heart-beat:10000,10000[m
[31m-[m
[31m-     è¿æ¥æˆåŠŸçš„è¿”å›ä¸ºï¼š[m
[31m-[m
[31m-       CONNECTED[m
[31m-       version:1.1[m
[31m-       heart-beat:0,0[m
[31m-[m
[31m-     è®¢é˜…ç›®æ ‡ï¼ˆdestinationï¼‰/topic/getResponseï¼š[m
[31m-[m
[31m-       SUBSCRIBE[m
[31m-       id:sub-0[m
[31m-       destination:/topic/getResponse[m
[31m-[m
[31m-     å‘ç›®æ ‡ï¼ˆdestinationï¼‰/welcomeå‘é€æ¶ˆæ¯çš„æ ¼å¼ä¸ºï¼š[m
[31m-[m
[31m-       SEND[m
[31m-       destination:/welcome[m
[31m-       content-length:14[m
[31m-       {\"name\":\"wyf\"}[m
[31m-     ä»ç›®æ ‡ï¼ˆdestinationï¼‰/topic/getResponseæ¥æ”¶çš„æ ¼å¼ä¸ºï¼š[m
[31m-[m
[31m-       MESSAGE[m
[31m-       destination:/topic/getResponse[m
[31m-       content-type:application/json;charset=UTF-8[m
[31m-       subscription:sub-0[m
[31m-       message-id:zxj4wyau-0[m
[31m-       content-length:35[m
[31m-       {\"responseMessage\":\"Welcome, wyf!\"}[m
[31m-[m
[31m-     3.ç‚¹å¯¹ç‚¹å¼[m
[31m-[m
[31m-     å¹¿æ’­å¼æœ‰è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œä½†æ˜¯å¹¿æ’­å¼ä¸èƒ½è§£å†³æˆ‘ä»¬ä¸€ä¸ª[m
[31m-å¸¸è§çš„åœºæ™¯ï¼Œå³æ¶ˆæ¯ç”±è°å‘é€ã€ç”±è°æ¥æ”¶çš„é—®é¢˜ã€‚[m
[31m-[m
[31m-     æœ¬ä¾‹ä¸­æ¼”ç¤ºäº†ä¸€ä¸ªç®€å•çš„èŠå¤©å®¤ç¨‹åºã€‚ä¾‹å­ä¸­åªæœ‰ä¸¤ä¸ªç”¨[m
[31m-æˆ·ï¼Œäº’ç›¸å‘é€æ¶ˆæ¯ç»™å½¼æ­¤ï¼Œå› éœ€è¦ç”¨æˆ·ç›¸å…³çš„å†…å®¹ï¼Œæ‰€ä»¥å…ˆåœ¨[m
[31m-è¿™é‡Œå¼•å…¥æœ€ç®€å•çš„Spring Securityç›¸å…³å†…å®¹ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ·»åŠ Spring Securityçš„starter pomï¼š[m
[31m-[m
[31m-       <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       security</artifactId>[m
[31m-                      </dependency>[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰Spring Securityçš„ç®€å•é…ç½®ã€‚è¿™é‡Œä¸å¯¹Spring Security[m
[31m-åšè¿‡å¤šè§£é‡Šï¼Œåªè§£é‡Šå¯¹æœ¬é¡¹ç›®æœ‰å¸®åŠ©çš„éƒ¨åˆ†ï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableWebSecurity[m
[31m-       public class WebSecurityConfig extends WebSecurityConfigurerAdapter{[m
[31m-[m
[31m-              @Override[m
[31m-              protected void configure(HttpSecurity http) throws Exception {[m
[31m-                      http[m
[31m-                                    .authorizeRequests()[m
[31m-                                    .antMatchers("/","/login").permitAll()//1[m
[31m-                                    .anyRequest().authenticated()[m
[31m-                                    .and()[m
[31m-                                    .formLogin()[m
[31m-                                    .loginPage("/login") //2[m
[31m-                                    .defaultSuccessUrl("/chat") //3[m
[31m-                                    .permitAll()[m
[31m-                                    .and()[m
[31m-                                    .logout()[m
[31m-                                    .permitAll();[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              //4[m
[31m-              @Override[m
[31m-              protected void configure(AuthenticationManagerBuilder auth) throws[m
[31m-[m
[31m-                       auth[m
[31m-                                    .inMemoryAuthentication()[m
[31m-                                    .withUser("wyf").password("wyf").roles("USER")[m
[31m-                                    .and()[m
[31m-                                    .withUser("wisely").password("wisely").roles("USER");[m
[31m-[m
[31m-              }[m
[31m-              //5[m
[31m-              @Override[m
[31m-              public void configure(WebSecurity web) throws Exception {[m
[31m-[m
[31m-                      web.ignoring().antMatchers("/resources/static/**");[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ è®¾ç½®Spring Securityå¯¹/å’Œ/â€œloginâ€è·¯å¾„ä¸æ‹¦æˆªã€‚[m
[31m-[m
[31m-     â‘¡è®¾ç½®Spring Securityçš„ç™»å½•é¡µé¢è®¿é—®çš„è·¯å¾„ä¸º/loginã€‚[m
[31m-[m
[31m-     â‘¢ç™»å½•æˆåŠŸåè½¬å‘/chatè·¯å¾„ã€‚[m
[31m-[m
[31m-     â‘£åœ¨å†…å­˜ä¸­åˆ†åˆ«é…ç½®ä¸¤ä¸ªç”¨æˆ·wyfå’Œwiselyï¼Œå¯†ç å’Œç”¨æˆ·å[m
[31m-ä¸€è‡´ï¼Œè§’è‰²æ˜¯USERã€‚[m
[31m-     â‘¤/resources/static/ç›®å½•ä¸‹çš„é™æ€èµ„æºï¼ŒSpring Securityä¸æ‹¦[m
[31m-æˆªã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰é…ç½®WebSocketï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableWebSocketMessageBroker[m
[31m-       public class WebSocketConfig extends AbstractWebSocketMessageBrokerConf[m
[31m-[m
[31m-              @Override[m
[31m-              public void registerStompEndpoints(StompEndpointRegistry registry)[m
[31m-[m
[31m-                      registry.addEndpoint("/endpointWisely").withSockJS();[m
[31m-                      registry.addEndpoint("/endpointChat").withSockJS();//1[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public void configureMessageBroker(MessageBrokerRegistry registry)[m
[31m-[m
[31m-                      registry.enableSimpleBroker("/queue","/topic"); //2[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ æ³¨å†Œä¸€ä¸ªåä¸º/endpointChatçš„endpointã€‚[m
[31m-[m
[31m-     â‘¡ç‚¹å¯¹ç‚¹å¼åº”å¢åŠ ä¸€ä¸ª/queueæ¶ˆæ¯ä»£ç†ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰æ§åˆ¶å™¨ã€‚åœ¨WsControllerå†…æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š[m
[31m-[m
[31m-              @Autowired[m
[31m-              private SimpMessagingTemplate messagingTemplate;//1[m
[31m-[m
[31m-              @MessageMapping("/chat")[m
[31m-              public void handleChat(Principal principal, String msg) { //2[m
[31m-[m
[31m-                      if (principal.getName().equals("wyf")) {//3[m
[31m-                             messagingTemplate.convertAndSendToUser("wisely",[m
[31m-                                           "/queue/notifications", principal.getName() + "-[m
[31m-send:"                                        + msg); //4[m
[31m-          } else {[m
[31m-send:"[m
[31m-       }         messagingTemplate.convertAndSendToUser("wyf",[m
[31m-                               "/queue/notifications", principal.getName() + "-[m
[31m-[m
[31m-                                              + msg);[m
[31m-          }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é€šè¿‡SimpMessagingTemplateå‘æµè§ˆå™¨å‘é€æ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     â‘¡åœ¨Spring MVCä¸­ï¼Œå¯ä»¥ç›´æ¥åœ¨å‚æ•°ä¸­è·å¾—principalï¼Œ[m
[31m-pincipleä¸­åŒ…å«å½“å‰ç”¨æˆ·çš„ä¿¡æ¯ã€‚[m
[31m-[m
[31m-     â‘¢è¿™é‡Œæ˜¯ä¸€æ®µç¡¬ç¼–ç ï¼Œå¦‚æœå‘é€äººæ˜¯wyfï¼Œåˆ™å‘é€ç»™[m
[31m-wiselyï¼›å¦‚æœå‘é€äººæ˜¯wiselyï¼Œåˆ™å‘é€ç»™wyfï¼Œè¯»è€…å¯ä»¥æ ¹æ®é¡¹[m
[31m-ç›®å®é™…éœ€è¦æ”¹å†™æ­¤å¤„ä»£ç ã€‚[m
[31m-[m
[31m-     â‘£é€šè¿‡messagingTemplate.convertAndSendToUserå‘ç”¨æˆ·å‘[m
[31m-é€æ¶ˆæ¯ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¥æ”¶æ¶ˆæ¯çš„ç”¨æˆ·ï¼Œç¬¬äºŒä¸ªæ˜¯æµè§ˆå™¨è®¢é˜…[m
[31m-çš„åœ°å€ï¼Œç¬¬ä¸‰ä¸ªæ˜¯æ¶ˆæ¯æœ¬èº«ã€‚[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰ç™»å½•é¡µé¢ã€‚åœ¨src/main/resources/templatesä¸‹æ–°å»º[m
[31m-login.htmlï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       <!DOCTYPE html>[m
[31m-       <html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymele[m
[31m-[m
[31m-                     xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-[m
[31m-       springsecurity3">[m
[31m-       <meta charset="UTF-8" />[m
[31m-       <head>[m
[31m-[m
[31m-              <title>ç™»å½•é¡µé¢</title>[m
[31m-       </head>[m
[31m-       <body>[m
[31m-<div th:if="${param.error}">[m
[31m-       æ— æ•ˆçš„è´¦å·å’Œå¯†ç [m
[31m-[m
[31m-</div>[m
[31m-[m
[31m-<div th:if="${param.logout}">[m
[31m-       ä½ å·²æ³¨é”€[m
[31m-[m
[31m-</div>[m
[31m-[m
[31m-<form th:action="@{/login}" method="post">[m
[31m-[m
[31m-                               <div><label>                 è´¦[m
[31m-[m
[31m-å· : <input type="text" name="username"/> </label></div>[m
[31m-[m
[31m-                               <div><label>                 å¯†[m
[31m-[m
[31m-ç : <input type="password" name="password"/> </label></div>[m
[31m-[m
[31m-<div><input type="submit" value="ç™»é™†"/></div>[m
[31m-[m
[31m-</form>[m
[31m-[m
[31m-</body>[m
[31m-[m
[31m-</html>[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰èŠå¤©é¡µé¢ã€‚åœ¨src/main/resources/templatesä¸‹æ–°å»º[m
[31m-chat.htmlï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       <!DOCTYPE html>[m
[31m-[m
[31m-       <html xmlns:th="http://www.thymeleaf.org">[m
[31m-       <meta charset="UTF-8" />[m
[31m-       <head>[m
[31m-[m
[31m-              <title>Home</title>[m
[31m-              <script th:src="@{sockjs.min.js}"></script>[m
[31m-              <script th:src="@{stomp.min.js}"></script>[m
[31m-              <script th:src="@{jquery.js}"></script>[m
[31m-       </head>[m
[31m-       <body>[m
[31m-       <p>[m
[31m-              èŠå¤©å®¤[m
[31m-       </p>[m
[31m-[m
[31m-       <form id="wiselyForm">[m
[31m-              <textarea rows="4" cols="60" name="text"></textarea>[m
[31m-              <input type="submit"/>[m
[31m-[m
[31m-       </form>[m
[31m-[m
[31m-       <script th:inline="javascript">[m
[31m-              $('#wiselyForm').submit(function(e){[m
[31m-                      e.preventDefault();[m
[31m-                      var text = $('#wiselyForm').find('textarea[name="text"]').val()[m
[31m-                      sendSpittle(text);[m
[31m-              });[m
[31m-[m
[31m-              var sock = new SockJS("/endpointChat"); //1[m
[31m-              var stomp = Stomp.over(sock);[m
[31m-              stomp.connect('guest', 'guest', function(frame) {[m
[31m-[m
[31m-                      stomp.subscribe("/user/queue/notifications", handleNotification[m
[31m-              });[m
[31m-[m
[31m-              function handleNotification(message) {[m
[31m-                                                                               $('#output').append("[m
[31m-[m
[31m-       <b>Received: " + message.body + "</b><br/>")[m
[31m-              }[m
[31m-[m
[31m-              function sendSpittle(text) {[m
[31m-                      stomp.send("/chat", {}, text);//3[m
[31m-[m
[31m-              }[m
[31m-              $('#stop').click(function() {sock.close()});[m
[31m-       </script>[m
[31m-[m
[31m-       <div id="output"></div>[m
[31m-       </body>[m
[31m-       </html>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ è¿æ¥endpointåç§°ä¸ºâ€œ/endpointChatâ€çš„endpointã€‚[m
[31m-[m
[31m-     â‘¡è®¢é˜…/user/queue/notificationså‘é€çš„æ¶ˆæ¯ï¼Œè¿™é‡Œä¸åœ¨æ§åˆ¶[m
[31m-å™¨çš„messagingTemplate.convertAndSendToUserä¸­å®šä¹‰çš„è®¢é˜…åœ°[m
[31m-å€ä¿æŒä¸€è‡´ã€‚è¿™é‡Œå¤šäº†ä¸€ä¸ª/userï¼Œå¹¶ä¸”è¿™ä¸ª/useræ˜¯å¿…é¡»çš„ï¼Œä½¿[m
[31m-ç”¨äº†/useræ‰ä¼šå‘é€æ¶ˆæ¯åˆ°æŒ‡å®šçš„ç”¨æˆ·ã€‚[m
[31m-[m
[31m-     ï¼ˆ7ï¼‰å¢åŠ é¡µé¢çš„viewControllerï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       publicclass WebMvcConfig extends WebMvcConfigurerAdapter{[m
[31m-[m
[31m-              @Override[m
[31m-              publicvoid addViewControllers(ViewControllerRegistry registry) {[m
[31m-              registry.addViewController("/ws").setViewName("/ws");[m
[31m-              registry.addViewController("/login").setViewName("/login");[m
[31m-              registry.addViewController("/chat").setViewName("/chat");[m
[31m-[m
[31m-                    }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ï¼ˆ8ï¼‰è¿è¡Œã€‚æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœæ˜¯ï¼šä¸¤ä¸ªç”¨æˆ·ç™»å½•ç³»ç»Ÿï¼Œå¯[m
[31m-ä»¥äº’å‘æ¶ˆæ¯ã€‚ä½†æ˜¯ä¸€ä¸ªæµè§ˆå™¨çš„ç”¨æˆ·ä¼šè¯sessionæ˜¯å…±äº«çš„ï¼Œæˆ‘[m
[31m-ä»¬å¯ä»¥åœ¨è°·æ­Œæµè§ˆå™¨è®¾ç½®ä¸¤ä¸ªç‹¬ç«‹çš„ç”¨æˆ·ï¼Œä»è€Œå®ç°ç”¨æˆ·ä¼šè¯[m
[31m-sessionéš”ç¦»ï¼Œå¦‚å›¾7-29æ‰€ç¤ºã€‚[m
[31m-[m
[31m-     ç°åœ¨åˆ†åˆ«åœ¨ä¸¤ä¸ªç”¨æˆ·ä¸‹çš„æµè§ˆå™¨è®¿é—®ï¼šhttp://localhostï¼š[m
[31m-8080/loginï¼Œå¹¶ç™»å½•ï¼Œå¦‚å›¾7-30æ‰€ç¤ºã€‚[m
[31m-[m
[31m-     wyfç”¨æˆ·å‘wiselyç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå¦‚å›¾7-31æ‰€ç¤ºã€‚[m
[31m-[m
[31m-     wiselyç”¨æˆ·å‘wyfç”¨æˆ·å‘é€æ¶ˆæ¯å¦‚å›¾7-32æ‰€ç¤ºã€‚[m
[31m-         å›¾7-29ã€€ä¸¤ä¸ªç‹¬ç«‹çš„ç”¨æˆ·[m
[31m-             å›¾7-30ã€€åˆ†åˆ«ç™»å½•[m
[31m-[m
[31m-å›¾7-31ã€€wyfç”¨æˆ·å‘wiselyç”¨æˆ·å‘é€æ¶ˆæ¯[m
[31m-å›¾7-32ã€€wiselyç”¨æˆ·å‘wyfç”¨æˆ·å‘é€æ¶ˆæ¯[m
[31m-7.7ã€€åŸºäºBootstrapå’ŒAngularJSçš„ç°ä»£Web[m
[31m-åº”ç”¨[m
[31m-[m
[31m-     ç°ä»£çš„B/Sç³»ç»Ÿè½¯ä»¶æœ‰ä¸‹é¢å‡ ä¸ªç‰¹è‰²ã€‚[m
[31m-[m
[31m-     1.å•é¡µé¢åº”ç”¨[m
[31m-[m
[31m-     å•é¡µé¢åº”ç”¨ï¼ˆsingle-page applicationï¼Œç®€ç§°SPAï¼‰æŒ‡çš„æ˜¯ä¸€[m
[31m-ç§ç±»ä¼¼äºåŸç”Ÿå®¢æˆ·ç«¯è½¯ä»¶çš„æ›´æµç•…çš„ç”¨æˆ·ä½“éªŒçš„é¡µé¢ã€‚åœ¨å•é¡µ[m
[31m-é¢åº”ç”¨ä¸­ï¼Œæ‰€æœ‰çš„èµ„æºï¼ˆHTMLã€JavaScriptã€CSSï¼‰éƒ½æ˜¯æŒ‰éœ€[m
[31m-åŠ¨æ€åŠ è½½åˆ°é¡µé¢ä¸Šçš„ï¼Œä¸”ä¸éœ€è¦æœåŠ¡ç«¯æ§åˆ¶é¡µé¢çš„è½¬å‘ã€‚[m
[31m-[m
[31m-     2.å“åº”å¼è®¾è®¡[m
[31m-[m
[31m-     å“åº”å¼è®¾è®¡ï¼ˆResponsive web designï¼Œç®€ç§°RWDï¼‰æŒ‡çš„æ˜¯[m
[31m-ä¸åŒçš„è®¾å¤‡ï¼ˆç”µè„‘ã€å¹³æ¿ã€æ‰‹æœºï¼‰è®¿é—®ç›¸åŒçš„é¡µé¢çš„æ—¶å€™ï¼Œå¾—[m
[31m-åˆ°ä¸åŒçš„é¡µé¢è§†å›¾ï¼Œè€Œå¾—åˆ°çš„è§†å›¾æ˜¯é€‚åº”å½“å‰å±å¹•çš„ã€‚å½“ç„¶å°±[m
[31m-ç®—åœ¨ç”µè„‘ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡æ‹–åŠ¨æµè§ˆå™¨çª—å£çš„å¤§å°ï¼Œä¹Ÿèƒ½å¾—åˆ°åˆé€‚[m
[31m-çš„è§†å›¾ã€‚[m
[31m-[m
[31m-     3.æ•°æ®å¯¼å‘[m
[31m-[m
[31m-     æ•°æ®å¯¼å‘æ˜¯å¯¹äºé¡µé¢å¯¼å‘è€Œè¨€çš„ï¼Œé¡µé¢ä¸Šçš„æ•°æ®è·å¾—æ˜¯é€š[m
[31m-è¿‡æ¶ˆè´¹åå°çš„RESTæœåŠ¡æ¥å®ç°çš„ï¼Œè€Œä¸æ˜¯é€šè¿‡æœåŠ¡å™¨æ¸²æŸ“çš„[m
[31m-åŠ¨æ€é¡µé¢ï¼ˆå¦‚JSPï¼‰æ¥å®ç°çš„ï¼Œä¸€èˆ¬æ•°æ®äº¤æ¢ä½¿ç”¨çš„æ ¼å¼æ˜¯[m
[31m-JSONã€‚[m
[31m-[m
[31m-     æœ¬èŠ‚å°†é’ˆå¯¹Bootstrapå’ŒAngularJSè¿›è¡Œå¿«é€Ÿå…¥é—¨å¼çš„å¼•å¯¼ï¼Œ[m
[31m-å¦‚éœ€æ·±å…¥å­¦ä¹ ï¼Œè¯·å‚è€ƒå®˜ç½‘æˆ–ç›¸å…³ä¸“é¢˜ä¹¦ç±ã€‚[m
[31m-7.7.1ã€€Bootstrap[m
[31m-[m
[31m-     1.ä»€ä¹ˆæ˜¯Bootstrap[m
[31m-     Bootstrapå®˜æ–¹å®šä¹‰ï¼šBootstrapæ˜¯å¼€å‘å“åº”å¼å’Œç§»åŠ¨ä¼˜å…ˆçš„[m
[31m-Webåº”ç”¨çš„æœ€æµè¡Œçš„HTMLã€CSSã€JavaScriptæ¡†æ¶ã€‚[m
[31m-     Boostrapå®ç°äº†åªä½¿ç”¨ä¸€å¥—ä»£ç å°±å¯ä»¥åœ¨ä¸åŒçš„è®¾å¤‡æ˜¾ç¤º[m
[31m-ä½ æƒ³è¦çš„è§†å›¾çš„åŠŸèƒ½ã€‚Bootstrapè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡ç¾è§‚çš„[m
[31m-HTMLå…ƒç´ å‰ç«¯ç»„ä»¶å’ŒjQueryæ’ä»¶ã€‚[m
[31m-     2.ä¸‹è½½å¹¶å¼•å…¥Bootstrap[m
[31m-     ä¸‹è½½åœ°å€ï¼šhttp://getbootstrap.com/getting-started/ï¼Œå¦‚å›¾7-[m
[31m-33æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾7-33ã€€ä¸‹è½½é¡µé¢[m
[31m-[m
[31m-     ä¸‹è½½çš„å‹ç¼©åŒ…çš„ç›®å½•ç»“æ„å¦‚å›¾7-34æ‰€ç¤ºã€‚[m
[31m-                             å›¾7-34ã€€ç›®å½•ç»“æ„[m
[31m-[m
[31m-æœ€ç®€å•çš„Bootstrapé¡µé¢æ¨¡æ¿å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-<!DOCTYPE html>[m
[31m-<html lang="zh-cn">[m
[31m-[m
[31m-   <head>[m
[31m-       <meta charset="utf-8">[m
[31m-       <meta http-equiv="X-UA-Compatible" content="IE=edge">[m
[31m-                      <meta name="viewport" content="width=device-[m
[31m-[m
[31m-width, initial-scale=1">[m
[31m-       <!-- ä¸Šé¢3ä¸ªmetaæ ‡ç­¾å¿…é¡»æ˜¯headçš„å¤´ä¸‰ä¸ªæ ‡ç­¾ï¼Œå…¶ä½™çš„headå†…æ ‡ç­¾åœ¨æ­¤[m
[31m-[m
[31m-3ä¸ªä¹‹å[m
[31m-The above 3 meta tags *must* come first in the head; any other head con[m
[31m-->[m
[31m-[m
[31m-       <title>BootstrapåŸºæœ¬æ¨¡æ¿</title>[m
[31m-       <!-- Bootstrapçš„CSS -->[m
[31m-       <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">[m
[31m-[m
[31m-       <!-- HTML5 shim[m
[31m-[m
[31m- and Respond.jsç”¨æ¥è®©IE 8æ”¯æŒHTML 5å…ƒç´ å’Œåª’ä½“æŸ¥è¯¢ -->[m
[31m-[m
[31m-       <!--[if lt IE 9]>[m
[31m-          <script src[m
[31m-[m
[31m-="js[m
[31m-       /html5shiv.min.js"></script>[m
[31m-                  <script src[m
[31m-[m
[31m-       ="js[m
[31m-[m
[31m-       /respond.min.js"></script>[m
[31m-              <![endif[m
[31m-[m
[31m-       ]-->[m
[31m-           </head>[m
[31m-           <body>[m
[31m-              <h1>ä½ å¥½, Bootstrap!</h1>[m
[31m-              <!-- jQueryæ˜¯Bootstrapè„šæœ¬æ’ä»¶å¿…éœ€çš„ -->[m
[31m-              <script src="js/jquery.min.js"></script>[m
[31m-              <!-- åŒ…å«æ‰€æœ‰ç¼–è¯‘çš„æ’ä»¶ -->[m
[31m-              <script src="bootstrap/js/bootstrap.min.js"></script>[m
[31m-           </body>[m
[31m-[m
[31m-       </html>[m
[31m-[m
[31m-     3.CSSæ”¯æŒ[m
[31m-     Bootstrapçš„CSSæ ·å¼ä¸ºåŸºç¡€çš„HTMLå…ƒç´ æä¾›äº†ç¾è§‚çš„æ ·[m
[31m-å¼ï¼Œæ­¤å¤–è¿˜æä¾›äº†ä¸€ä¸ªé«˜çº§çš„ç½‘æ ¼ç³»ç»Ÿç”¨æ¥åšé¡µé¢å¸ƒå±€ã€‚[m
[31m-     ï¼ˆ1ï¼‰å¸ƒå±€ç½‘æ ¼[m
[31m-     åœ¨Bootstrapé‡Œï¼Œè¡Œä½¿ç”¨çš„æ ·å¼ä¸ºrowï¼Œåˆ—ä½¿ç”¨col-md-æ•°[m
[31m-å­—ï¼Œæ­¤æ•°å­—èŒƒå›´ä¸º1ï½12ï¼Œæ‰€æœ‰åˆ—åŠ èµ·æ¥çš„å’Œä¹Ÿæ˜¯12ï¼Œä»£ç å¦‚[m
[31m-ä¸‹ï¼š[m
[31m-[m
[31m-              <div class="row">[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-                      <div class="col-md-1">.col-md-1</div>[m
[31m-[m
[31m-              </div>[m
[31m-              <div class="row">[m
[31m-[m
[31m-                      <div class="col-md-8">.col-md-8</div>[m
[31m-                      <div class="col-md-4">.col-md-4</div>[m
[31m-              </div>[m
[31m-              <div class="row">[m
[31m-                      <div class="col-md-4">.col-md-4</div>[m
[31m-                      <div class="col-md-4">.col-md-4</div>[m
[31m-                      <div class="col-md-4">.col-md-4</div>[m
[31m-              </div>[m
[31m-              <div class="row">[m
[31m-                      <div class="col-md-6">.col-md-6</div>[m
[31m-                      <div class="col-md-6">.col-md-6</div>[m
[31m-              </div>[m
[31m-[m
[31m-     å¸ƒå±€æ•ˆæœå¦‚å›¾7-35æ‰€ç¤ºã€‚[m
[31m-                                   å›¾7-35ã€€å¸ƒå±€æ•ˆæœ[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰htmlå…ƒç´ [m
[31m-[m
[31m-     Bootstrapä¸ºhtmlå…ƒç´ æä¾›äº†å¤§é‡çš„æ ·å¼ï¼Œå¦‚è¡¨å•å…ƒç´ ã€æŒ‰[m
[31m-é’®ã€å›¾æ ‡ç­‰ã€‚æ›´å¤šå†…å®¹è¯·æŸ¥çœ‹ï¼šhttp://getbootstrap.com/css/ã€‚[m
[31m-[m
[31m-     4.é¡µé¢ç»„ä»¶æ”¯æŒ[m
[31m-[m
[31m-     Bootstrapä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡çš„é¡µé¢ç»„ä»¶ï¼ŒåŒ…æ‹¬å­—ä½“å›¾æ ‡ã€[m
[31m-ä¸‹æ‹‰æ¡†ã€å¯¼èˆªæ¡ã€è¿›åº¦æ¡ã€ç¼©ç•¥å›¾ç­‰ï¼Œæ›´å¤šè¯·é˜…è¯»[m
[31m-http://getbootstrap.com/components/ã€‚[m
[31m-[m
[31m-     5.Javascriptæ”¯æŒ[m
[31m-[m
[31m-     Bootstrapä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡çš„JavaScriptæ’ä»¶ï¼ŒåŒ…å«æ¨¡å¼å¯¹[m
[31m-è¯æ¡†ã€æ ‡ç­¾é¡µã€æç¤ºã€è­¦å‘Šç­‰ï¼Œæ›´å¤šå†…å®¹è¯·æŸ¥çœ‹[m
[31m-http://getbootstrap.com/javascript/ã€‚[m
[31m-[m
[31m-7.7.2ã€€AngularJS[m
[31m-[m
[31m-     1.ä»€ä¹ˆæ˜¯AngularJS[m
[31m-[m
[31m-     AngularJSå®˜æ–¹å®šä¹‰ï¼šAngularJSæ˜¯HTMLå¼€å‘æœ¬åº”è¯¥çš„æ ·[m
[31m-å­ï¼Œå®ƒæ˜¯ç”¨æ¥è®¾è®¡å¼€å‘Webåº”ç”¨çš„ã€‚[m
[31m-[m
[31m-     AngularJSä½¿ç”¨å£°åå¼æ¨¡æ¿+æ•°æ®ç»‘å®šï¼ˆç±»ä¼¼äºJSPã€[m
[31m-Thymeleafï¼‰ã€MVWï¼ˆModel-View-Whateverï¼‰ã€[m
[31m-MVVMï¼ˆModel-View-ViewModelï¼‰ã€MVCï¼ˆModel-View-[m
[31m-Controllerï¼‰ã€ä¾èµ–æ³¨å…¥å’Œæµ‹è¯•ï¼Œä½†æ˜¯è¿™ä¸€åˆ‡çš„å®ç°å´åªå€ŸåŠ©çº¯[m
[31m-å®¢æˆ·ç«¯çš„JavaScriptã€‚[m
[31m-[m
[31m-     HTMLä¸€èˆ¬æ˜¯ç”¨æ¥å£°æ˜é™æ€é¡µé¢çš„ï¼Œä½†æ˜¯é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬[m
[31m-å¸Œæœ›é¡µé¢æ˜¯åŸºäºæ•°æ®åŠ¨æ€ç”Ÿæˆçš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¾ˆå¤šæœåŠ¡ç«¯æ¨¡æ¿[m
[31m-å¼•æ“å‡ºç°çš„åŸå› ï¼›è€ŒAngularJSå¯ä»¥åªé€šè¿‡å‰ç«¯æŠ€æœ¯å°±å®ç°åŠ¨[m
[31m-æ€çš„é¡µé¢ã€‚[m
[31m-[m
[31m-     2.ä¸‹è½½å¹¶å¼•å…¥AngularJS[m
[31m-     AngularJSä¸‹è½½åœ°å€ï¼šhttps://angularjs.org/ï¼Œå¦‚å›¾7-36æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾7-36ã€€ä¸‹è½½é¡µé¢[m
[31m-[m
[31m-     æœ€ç®€å•çš„AngularJSé¡µé¢ï¼š[m
[31m-[m
[31m-       <!doctype html>[m
[31m-       <html ng-app><!-- 1 -->[m
[31m-[m
[31m-           <head>[m
[31m-              <script src="js/angular.min.js"></script><!-- 2 -->[m
[31m-[m
[31m-           </head>[m
[31m-           <body>[m
[31m-[m
[31m-              <div>[m
[31m-                  <label>åå­—:</label>[m
[31m-                   <input type="text" ng-model="yourName" placeholder="è¼¸[m
[31m-[m
[31m-       å…¥ä½ çš„åå­—"><!-- 3 -->[m
[31m-                  <hr>[m
[31m-                  <h1>ä½ å¥½ {{yourName}}!</h1><!-- 4 -->[m
[31m-[m
[31m-              </div>[m
[31m-           </body>[m
[31m-       </html>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ ng-appæ‰€ä½œç”¨çš„èŒƒå›´æ˜¯AngularJSèµ·æ•ˆçš„èŒƒå›´ï¼Œæœ¬ä¾‹æ˜¯æ•´[m
[31m-ä¸ªé¡µé¢æœ‰æ•ˆã€‚[m
[31m-     â‘¡è½½å…¥AngularJSçš„è„šæœ¬ã€‚[m
[31m-     â‘¢ng-modelå®šä¹‰æ•´ä¸ªAngularJSçš„å‰ç«¯æ•°æ®æ¨¡å‹ï¼Œæ¨¡å‹çš„å[m
[31m-ç§°ä¸ºyourNameï¼Œæ¨¡å‹çš„å€¼æ¥è‡ªä½ è¾“å…¥çš„å€¼è‹¥è¾“å…¥çš„å€¼æ”¹å˜ï¼Œ[m
[31m-åˆ™æ•°æ®æ¨¡å‹å€¼ä¹Ÿä¼šæ”¹å˜ã€‚[m
[31m-     â‘£ä½¿ç”¨{{æ¨¡å‹å}}æ¥è¯»å–æ¨¡å‹ä¸­çš„å€¼ã€‚[m
[31m-     æ•ˆæœå¦‚å›¾7-37æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾7-37ã€€è¿è¡Œæ•ˆæœ[m
[31m-[m
[31m-     3.æ¨¡å—ã€æ§åˆ¶å™¨å’Œæ•°æ®ç»‘å®š[m
[31m-     æˆ‘ä»¬å¯¹MVCçš„æ¦‚å¿µå·²ç»çƒ‚ç†Ÿäºå¿ƒäº†ï¼Œä½†æ˜¯å¹³æ—¶çš„MVCéƒ½[m
[31m-æ˜¯æœåŠ¡ç«¯çš„MVCï¼Œè¿™é‡Œç”¨AngularJSå®ç°äº†çº¯é¡µé¢ç«¯çš„MVCï¼Œ[m
[31m-å³å®ç°äº†è§†å›¾æ¨¡æ¿ã€æ•°æ®æ¨¡å‹ã€ä»£ç æ§åˆ¶çš„åˆ†ç¦»ã€‚[m
[31m-     å†æ¥çœ‹çœ‹æ•°æ®ç»‘å®šï¼Œæ•°æ®ç»‘å®šæ˜¯å°†è§†å›¾å’Œæ•°æ®æ¨¡å‹ç»‘å®šåœ¨[m
[31m-ä¸€èµ·ã€‚å¦‚æœè§†å›¾å˜äº†ï¼Œåˆ™æ¨¡å‹çš„å€¼å°±å˜äº†ï¼›å¦‚æœæ¨¡å‹å€¼å˜äº†ï¼Œ[m
[31m-åˆ™è§†å›¾ä¹Ÿä¼šè·Ÿç€æ”¹å˜ã€‚[m
[31m-     AngularJSä¸ºäº†åˆ†ç¦»ä»£ç è¾¾åˆ°å¤ç”¨çš„æ•ˆæœï¼Œæä¾›äº†ä¸€ä¸ª[m
[31m-moduleï¼ˆæ¨¡å—ï¼‰ã€‚å®šä¹‰ä¸€ä¸ªæ¨¡å—éœ€ä½¿ç”¨ä¸‹é¢çš„ä»£ç ã€‚[m
[31m-[m
[31m-     æ— ä¾èµ–æ¨¡å—ï¼š[m
[31m-[m
[31m-       angular.module('firstModule',[]);[m
[31m-[m
[31m-     æœ‰ä¾èµ–æ¨¡å—ï¼š[m
[31m-[m
[31m-       angular.module('firstModule',['moduleA','moduleB']);[m
[31m-[m
[31m-     æˆ‘ä»¬çœ‹åˆ°äº†Vå°±æ˜¯æˆ‘ä»¬çš„é¡µé¢å…ƒç´ ï¼ŒMå°±æ˜¯æˆ‘ä»¬çš„ng-[m
[31m-modelï¼Œé‚£Cå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç æ¥å®šä¹‰æ§åˆ¶å™¨ï¼Œé¡µ[m
[31m-é¢ä½¿ç”¨ng-controlleræ¥å’Œå…¶å…³è”ï¼š[m
[31m-[m
[31m-       angular.module('firstModule',[])[m
[31m-              .controller('firstController',function(){[m
[31m-              ...[m
[31m-[m
[31m-       };[m
[31m-       );[m
[31m-[m
[31m-       <div ng-controller="firstController">[m
[31m-       ...[m
[31m-       </div>[m
[31m-[m
[31m-     4.Scopeå’ŒEvent[m
[31m-     ï¼ˆ1ï¼‰Scope[m
[31m-     Scopeæ˜¯AngularJSçš„å†…ç½®å¯¹è±¡ï¼Œç”¨$Scopeæ¥è·å¾—ã€‚åœ¨Scope[m
[31m-ä¸­å®šä¹‰çš„æ•°æ®æ˜¯æ•°æ®æ¨¡å‹ï¼Œå¯ä»¥é€šè¿‡{{æ¨¡å‹å}}åœ¨è§†å›¾ä¸Šè·[m
[31m-å¾—ã€‚Scopeä¸»è¦æ˜¯åœ¨ç¼–ç ä¸­éœ€è¦å¯¹æ•°æ®æ¨¡å‹è¿›è¡Œå¤„ç†çš„æ—¶å€™ä½¿[m
[31m-ç”¨ï¼ŒScopeçš„ä½œç”¨èŒƒå›´ä¸åœ¨é¡µé¢å£°æ˜çš„èŒƒå›´ä¸€è‡´ï¼ˆå¦‚åœ¨[m
[31m-controllerå†…ä½¿ç”¨ï¼Œscopeçš„ä½œç”¨èŒƒå›´æ˜¯é¡µé¢å£°æ˜ng-controlleræ ‡[m
[31m-ç­¾å…ƒç´ çš„ä½œç”¨èŒƒå›´ï¼‰ã€‚[m
[31m-[m
[31m-     å®šä¹‰ï¼š[m
[31m-[m
[31m-       $scope.greeting='Hello'[m
[31m-[m
[31m-     è·å–ï¼š[m
[31m-[m
[31m-       {{greeting}}[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰Event[m
[31m-     å› ä¸ºScopeçš„ä½œç”¨èŒƒå›´ä¸åŒï¼Œæ‰€ä»¥ä¸åŒçš„Scopeä¹‹é—´è‹¥è¦äº¤[m
[31m-äº’çš„è¯éœ€è¦é€šè¿‡äº‹ä»¶ï¼ˆEventï¼‰æ¥å®Œæˆã€‚[m
[31m-     1ï¼‰å†’æ³¡äº‹ä»¶ï¼ˆEmitï¼‰å†’æ³¡äº‹ä»¶è´Ÿè´£ä»å­Scopeå‘ä¸Šå‘é€äº‹[m
[31m-ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚[m
[31m-     å­Scopeå‘é€ï¼š[m
[31m-[m
[31m-       $scope.$emit('EVENT_NAME_EMIT ', 'message');[m
[31m-[m
[31m-     çˆ¶Scopeæ¥å—ï¼š[m
[31m-       $scope.$on(''EVENT_NAME_EMIT', function(event, data) {[m
[31m-       ...[m
[31m-       })[m
[31m-[m
[31m-     2ï¼‰å¹¿æ’­äº‹ä»¶ï¼ˆBroadcastï¼‰ã€‚å¹¿æ’­äº‹ä»¶è´Ÿè´£ä»çˆ¶Scopeå‘ä¸‹[m
[31m-å‘é€äº‹ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚[m
[31m-[m
[31m-     çˆ¶Scopeå‘é€ï¼š[m
[31m-[m
[31m-       $scope.$broadcast('EVENT_NAME_BROAD ', 'message');[m
[31m-[m
[31m-     å­scopeæ¥å—[m
[31m-[m
[31m-       $scope.$on(''EVENT_NAME_BROAD', function(event, data) {[m
[31m-       ...[m
[31m-       })[m
[31m-[m
[31m-     5.å¤šè§†å›¾å’Œè·¯ç”±[m
[31m-     å¤šè§†å›¾å’Œè·¯ç”±æ˜¯AngularJSå®ç°å•é¡µé¢åº”ç”¨çš„æŠ€æœ¯å…³é”®ï¼Œ[m
[31m-AngularJSå†…ç½®äº†ä¸€ä¸ª$routeProviderå¯¹è±¡æ¥è´Ÿè´£é¡µé¢åŠ è½½å’Œé¡µ[m
[31m-é¢è·¯ç”±è½¬å‘ã€‚[m
[31m-     éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ1.2.0ä¹‹åçš„AngularJSå°†è·¯ç”±åŠŸèƒ½ç§»å‡ºï¼Œæ‰€[m
[31m-ä»¥ä½¿ç”¨è·¯ç”±åŠŸèƒ½è¦å¦å¤–å¼•å…¥angular-route.js[m
[31m-     ä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       angular.module('firstModule').config(function($routeProvider) {[m
[31m-       $routeProvider.when('/view1', { //1[m
[31m-[m
[31m-              controller: 'Controller1', //2[m
[31m-              templateUrl: 'view1.html', //3[m
[31m-       }).when('/view2', {[m
[31m-[m
[31m-              controller: 'Controller2',[m
[31m-              templateUrl: 'view2.html',[m
[31m-       });[m
[31m-       })[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ æ­¤å¤„å®šä¹‰çš„æ˜¯æŸä¸ªé¡µé¢çš„è·¯ç”±åç§°ã€‚[m
[31m-[m
[31m-     â‘¡æ­¤å¤„å®šä¹‰çš„æ˜¯å½“å‰é¡µé¢ä½¿ç”¨çš„æ§åˆ¶å™¨ã€‚[m
[31m-[m
[31m-     â‘¢æ­¤å¤„å®šä¹‰çš„è¦åŠ è½½çš„çœŸå®é¡µé¢ã€‚[m
[31m-[m
[31m-     åœ¨é¡µé¢ä¸Šå¯ä»¥ç”¨ä¸‹é¢ä»£ç æ¥ä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„è·¯ç”±ï¼š[m
[31m-[m
[31m-       <ul>[m
[31m-              <li><a href="#/view1">view1</a></li>[m
[31m-              <li><a href="#/view2">view2</a></li>[m
[31m-[m
[31m-       </ul>[m
[31m-       <ng-view></ng-view> <!-- æ­¤å¤„ä¸ºåŠ è½½è¿›æ¥çš„é¡µé¢æ˜¾ç¤ºçš„ä½ç½®-->[m
[31m-[m
[31m-     6.ä¾èµ–æ³¨å…¥[m
[31m-[m
[31m-     ä¾èµ–æ³¨å…¥æ˜¯AngularJSçš„ä¸€å¤§é…·ç‚«åŠŸèƒ½ã€‚å¯ä»¥å®ç°å¯¹ä»£ç çš„[m
[31m-è§£è€¦ï¼Œåœ¨ä»£ç é‡Œå¯ä»¥æ³¨å…¥AngularJSçš„å¯¹è±¡æˆ–è€…æˆ‘ä»¬è‡ªå®šä¹‰çš„[m
[31m-å¯¹è±¡ã€‚ä¸‹é¢ç¤ºä¾‹æ˜¯åœ¨æ§åˆ¶å™¨ä¸­æ³¨å…¥$scopeï¼Œæ³¨æ„ä½¿ç”¨ä¾èµ–æ³¨å…¥[m
[31m-çš„ä»£ç æ ¼å¼ã€‚[m
[31m-[m
[31m-             angular.module('firstModule')[m
[31m-              .controller("diController", ['$scope',[m
[31m-[m
[31m-       function ($scope) {[m
[31m-                                      ...[m
[31m-[m
[31m-                      }]);[m
[31m-     7.Serviceå’ŒFactory[m
[31m-[m
[31m-     AngularJSä¸ºæˆ‘ä»¬å†…ç½®äº†ä¸€äº›æœåŠ¡ï¼Œå¦‚$locationã€[m
[31m-$timeoutã€$rootScopeï¼ˆè¯·è¯»è€…è‡ªè¡Œå­¦ä¹ ç›¸å…³çš„çŸ¥è¯†ï¼‰ã€‚å¾ˆå¤šæ—¶[m
[31m-å€™æˆ‘ä»¬éœ€è¦è‡ªå·±å®šåˆ¶ä¸€äº›æœåŠ¡ï¼ŒAngularJSä¸ºæˆ‘ä»¬æä¾›äº†[m
[31m-Serviceå’ŒFactoryã€‚[m
[31m-[m
[31m-     Serviceå’ŒFactoryçš„åŒºåˆ«æ˜¯ï¼šä½¿ç”¨Serviceçš„è¯ï¼ŒAngularJSä¼š[m
[31m-ä½¿ç”¨newæ¥åˆå§‹åŒ–å¯¹è±¡ï¼›è€Œä½¿ç”¨Factoryä¼šç›´æ¥è·å¾—å¯¹è±¡ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰Service[m
[31m-[m
[31m-     å®šä¹‰ï¼š[m
[31m-[m
[31m-       angular.module('firstModule').service('helloService',function()[m
[31m-       {[m
[31m-[m
[31m-              this.sayHello=function(name){[m
[31m-                      alert('Hello '+name);[m
[31m-[m
[31m-              }[m
[31m-       });[m
[31m-[m
[31m-     æ³¨å…¥è°ƒç”¨ï¼š[m
[31m-[m
[31m-             angular.module('firstModule')[m
[31m-              .controller("diController", ['$scope', 'helloService',[m
[31m-[m
[31m-       function ($scope,helloService) {[m
[31m-                                      helloService.sayHello('wyf');[m
[31m-[m
[31m-                      }]);[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰Factory[m
[31m-[m
[31m-     å®šä¹‰ï¼š[m
[31m-       angular.module('firstModule').service('helloFactory',function()[m
[31m-       {[m
[31m-[m
[31m-              return{[m
[31m-              sayHello:function(name){[m
[31m-[m
[31m-                             alert('Hello '+name);[m
[31m-                      }[m
[31m-              }[m
[31m-       });[m
[31m-[m
[31m-     æ³¨å…¥è°ƒç”¨ï¼š[m
[31m-[m
[31m-             angular.module('firstModule')[m
[31m-              .controller("diController", ['$scope', 'helloFactory',[m
[31m-[m
[31m-       function ($scope, helloFactory) {[m
[31m-                                      helloFactory.sayHello('wyf');[m
[31m-[m
[31m-                      }]);[m
[31m-[m
[31m-     8.httpæ“ä½œ[m
[31m-[m
[31m-     AngularJSå†…ç½®äº†$httpå¯¹è±¡ç”¨æ¥è¿›è¡ŒAjaxçš„æ“ä½œï¼š[m
[31m-[m
[31m-       $http.get(url)[m
[31m-       $http.post(url,data)[m
[31m-       $http.put(url,data)[m
[31m-       $http.delete(url)[m
[31m-       $http.head(url)[m
[31m-[m
[31m-     9.è‡ªå®šä¹‰æŒ‡ä»¤[m
[31m-[m
[31m-     AngularJSå†…ç½®äº†å¤§é‡çš„æŒ‡ä»¤ï¼ˆdirectiveï¼‰ï¼Œå¦‚ng-repeatã€[m
[31m-ng-showã€ng-modelç­‰ã€‚å³ä½¿ç”¨ä¸€ä¸ªç®€çŸ­çš„æŒ‡ä»¤å¯å®ç°ä¸€ä¸ªå‰[m
[31m-ç«¯ç»„ä»¶ã€‚[m
[31m-[m
[31m-     æ¯”æ–¹è¯´ï¼Œæœ‰ä¸€ä¸ªæ—¥æœŸçš„js/jQueryæ’ä»¶ï¼Œä½¿ç”¨AngularJSå°è£…[m
[31m-åï¼Œåœ¨é¡µé¢ä¸Šè°ƒç”¨æ­¤æ’ä»¶å¯ä»¥é€šè¿‡æŒ‡ä»¤æ¥å®ç°ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       å…ƒç´ æŒ‡ä»¤: <date-picker></date-picker>[m
[31m-       å±æ€§æŒ‡ä»¤: <input type="text" date-picker/>[m
[31m-       æ ·å¼æŒ‡ä»¤: <input type="text" class="date-picker"/>[m
[31m-       æ³¨é‡ŠæŒ‡ä»¤ : <!--directive:date-picker-->[m
[31m-[m
[31m-     å®šä¹‰æŒ‡ä»¤ï¼š[m
[31m-[m
[31m-       angular.module('myApp',[m
[31m-       []).directive('helloWorld', function() {[m
[31m-       return {[m
[31m-[m
[31m-              restrict: 'AE',//æ”¯æŒä½¿ç”¨å±æ€§ã€å…ƒç´ [m
[31m-              replace: true,[m
[31m-              template: '<h3>Hello, World!</h3>'[m
[31m-       };[m
[31m-       });[m
[31m-[m
[31m-     è°ƒç”¨æŒ‡ä»¤ï¼Œå…ƒç´ æ ‡ç­¾ï¼š[m
[31m-[m
[31m-       <hello-world/>[m
[31m-       <hello:world/>[m
[31m-[m
[31m-     æˆ–è€…å±æ€§æ–¹å¼ï¼š[m
[31m-[m
[31m-       <div hello-world />[m
[31m-[m
[31m-7.7.3ã€€å®æˆ˜[m
[31m-     åœ¨å‰é¢ä¸¤èŠ‚ï¼Œæˆ‘ä»¬å¿«é€Ÿä»‹ç»äº†Bootstrapå’ŒAngularJSï¼Œæœ¬èŠ‚[m
[31m-æˆ‘ä»¬å°†å®ƒä»¬å’ŒSpring Bootä¸²èµ·æ¥åšä¸ªä¾‹å­ã€‚[m
[31m-[m
[31m-     åœ¨ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Bootstrapåˆ¶ä½œå¯¼èˆªï¼Œä½¿ç”¨AngularJSå®[m
[31m-ç°å¯¼èˆªåˆ‡æ¢é¡µé¢çš„è·¯ç”±åŠŸèƒ½ï¼Œå¹¶æ¼”ç¤ºAngularJSé€šè¿‡$httpæœåŠ¡[m
[31m-å’ŒSpring Bootæä¾›çš„RESTæœåŠ¡ï¼Œæœ€åæ¼”ç¤ºç”¨æŒ‡ä»¤å°è£…jQuery[m
[31m-UIçš„æ—¥æœŸé€‰æ‹©å™¨ã€‚[m
[31m-[m
[31m-     1.æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     åˆå§‹åŒ–ä¸€ä¸ªSpring Booté¡¹ç›®ï¼Œä¾èµ–åªéœ€é€‰æ‹©Webï¼ˆspring-[m
[31m-boot-starter-webï¼‰ã€‚[m
[31m-[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-       groupIdï¼šcom.wisely[m
[31m-       arctifactId:ch7_7[m
[31m-       package: com.wisely.ch7_7[m
[31m-[m
[31m-     å‡†å¤‡Bootstrapã€AngularJSã€jQueryã€jQueryUIç›¸å…³çš„èµ„æº[m
[31m-åˆ°src/main/resources/staticä¸‹ï¼Œç»“æ„å¦‚å›¾7-38æ‰€ç¤ºã€‚[m
[31m-                                      å›¾7-38ã€€ç»“æ„[m
[31m-[m
[31m-     å¦å¤–è¦è¯´æ˜çš„æ˜¯ï¼Œæœ¬ä¾‹çš„é¡µé¢éƒ½æ˜¯é™æ€é¡µé¢ï¼Œæ‰€ä»¥å…¨éƒ¨æ”¾[m
[31m-ç½®åœ¨/staticç›®å½•ä¸‹ã€‚[m
[31m-[m
[31m-     2.åˆ¶ä½œå¯¼èˆª[m
[31m-[m
[31m-     é¡µé¢ä½ç½®ï¼šsrc/main/resources/static/action.htmlï¼š[m
[31m-[m
[31m-       <!DOCTYPE html>[m
[31m-       <html lang="zh-cn" ng-app="actionApp">[m
[31m-       <head>[m
[31m-<meta charset="utf-8">[m
[31m-<meta http-equiv="X-UA-Compatible" content="IE=edge">[m
[31m-<meta name="viewport" content="width=device-width, initial-[m
[31m-scale=1">[m
[31m-<title>å®æˆ˜</title>[m
[31m-[m
[31m-<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">[m
[31m-<link href="jqueryui/jquery-ui.min.css" rel="stylesheet">[m
[31m-<style type="text/css">[m
[31m-[m
[31m-.content {[m
[31m-   padding: 100px 15px;[m
[31m-   text-align: center;[m
[31m-[m
[31m-}[m
[31m-</style>[m
[31m-[m
[31m-<!--[if lt IE 9]>[m
[31m-          <script src="js/html5shiv.min.js"></script>[m
[31m-          <script src="js/respond.min.js"></script>[m
[31m-[m
[31m-       <![endif]-->[m
[31m-</head>[m
[31m-<body>[m
[31m-<!-- 1 -->[m
[31m-[m
[31m-       <nav class="navbar navbar-inverse navbar-fixed-top">[m
[31m-          <div class="container">[m
[31m-[m
[31m-              <div id="navbar" class="collapse navbar-collapse">[m
[31m-                  <ul class="nav navbar-nav">[m
[31m-                     <li><a href="#/oper">åå°äº¤äº’</a></li>[m
[31m-                     <li><a href="#/directive">è‡ªå®šä¹‰æŒ‡ä»¤</a></li>[m
[31m-                  </ul>[m
[31m-[m
[31m-              </div>[m
[31m-          </div>[m
[31m-       </nav>[m
[31m-[m
[31m-       <!-- 2 -->[m
[31m-         <div class="content">[m
[31m-              <ng-view></ng-view>[m
[31m-[m
[31m-</div>[m
[31m-<!-- 3 -->[m
[31m-[m
[31m-       <script src="js/jquery.min.js"></script>[m
[31m-       <script src="jqueryui/jquery-ui.min.js"></script>[m
[31m-       <script src="bootstrap/js/bootstrap.min.js"></script>[m
[31m-       <script src="js/angular.min.js"></script>[m
[31m-       <script src="js/angular-route.min.js"></script>[m
[31m-       <script src="js-action/app.js"></script>[m
[31m-       <script src="js-action/directives.js"></script>[m
[31m-       <script src="js-action/controllers.js"></script>[m
[31m-       </body>[m
[31m-       </html>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä½¿ç”¨Bootstrapå®šä¹‰çš„å¯¼èˆªï¼Œå¹¶é…åˆAngularJSçš„è·¯ç”±ï¼Œé€š[m
[31m-è¿‡è·¯ç”±åç§°#/operå’Œ#/directiveåˆ‡æ¢è§†å›¾ï¼›[m
[31m-[m
[31m-     â‘¡é€šè¿‡<ng-view></ng-view>å±•ç¤ºè½½å…¥çš„é¡µé¢ã€‚[m
[31m-[m
[31m-     â‘¢åŠ è½½æœ¬ä¾‹æ‰€éœ€çš„è„šæœ¬ï¼Œå…¶ä¸­jquery-ui.min.jsçš„è„šæœ¬æ˜¯ä¸ºæˆ‘[m
[31m-ä»¬å®šåˆ¶æŒ‡ä»¤æ‰€ç”¨ï¼›app.jså®šä¹‰AngularJSçš„æ¨¡å—å’Œè·¯ç”±ï¼›[m
[31m-directives.jsä¸ºè‡ªå®šä¹‰çš„æŒ‡ä»¤ï¼›controllers.jsæ˜¯æ§åˆ¶å™¨å®šä¹‰ä¹‹å¤„ã€‚[m
[31m-[m
[31m-     3.æ¨¡å—å’Œè·¯ç”±å®šä¹‰[m
[31m-[m
[31m-     é¡µé¢ä½ç½®ï¼šsrc/main/resources/static/js-action/app.jsï¼š[m
[31m-[m
[31m-       var actionApp = angular.module('actionApp',[m
[31m-       ['ngRoute']); //1[m
[31m-[m
[31m-       actionApp.config(['$routeProvider' , function($routeProvider) {//2[m
[31m-              $routeProvider.when('/oper', { //3[m
[31m-                      controller: 'View1Controller', //4[m
[31m-                      templateUrl: 'views/view1.html', //5[m
[31m-              }).when('/directive', {[m
[31m-                      controller: 'View2Controller',[m
[31m-                      templateUrl: 'views/view2.html',[m
[31m-              });[m
[31m-[m
[31m-       }]);[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ å®šä¹‰æ¨¡å—actionAppï¼Œå¹¶ä¾èµ–äºè·¯ç”±æ¨¡å—ngRoutã€‚[m
[31m-â‘¡é…ç½®è·¯ç”±ï¼Œå¹¶æ³¨å…¥$routeProvideræ¥é…ç½®ã€‚[m
[31m-â‘¢/operä¸ºè·¯ç”±åç§°ã€‚[m
[31m-â‘£controllerå®šä¹‰çš„æ˜¯è·¯ç”±çš„æ§åˆ¶å™¨åç§°ã€‚[m
[31m-â‘¤templateUrlå®šä¹‰çš„æ˜¯è§†å›¾çš„çœŸæ­£åœ°å€ã€‚[m
[31m-4.æ§åˆ¶å™¨å®šä¹‰[m
[31m-è„šæœ¬ä½ç½®ï¼šsrc/main/resources/static/js-action/controllers.jsï¼š[m
[31m-[m
[31m-//1[m
[31m-actionApp.controller('View1Controller', ['$rootScope', '$scope', '$http[m
[31m-[m
[31m-       //2[m
[31m-       $scope.$on('$viewContentLoaded', function() {[m
[31m-[m
[31m-              console.log('é¡µé¢åŠ è½½å®Œæˆ');[m
[31m-       });[m
[31m-       //3[m
[31m-       $scope.search = function(){//3.1[m
[31m-[m
[31m-          personName = $scope.personName; //3.2[m
[31m-          $http.get('search',{ //3.3[m
[31m-[m
[31m-                                      params:{personName:personName}//3.4[m
[31m-                }).success(function(data){ //3.5[m
[31m-[m
[31m-                     $scope.person=data; //3.6[m
[31m-                });[m
[31m-[m
[31m-       };[m
[31m-}]);[m
[31m-[m
[31m-actionApp.controller('View2Controller', ['$rootScope', '$scope',  funct[m
[31m-[m
[31m-       $scope.$on('$viewContentLoaded', function() {[m
[31m-              console.log('é¡µé¢åŠ è½½å®Œæˆ');[m
[31m-[m
[31m-       });[m
[31m-[m
[31m-}]);[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-â‘ å®šä¹‰æ§åˆ¶å™¨View1Controllerï¼Œå¹¶æ³¨å…¥$rootScopeã€$scope[m
[31m-å’Œ$httpã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨$scope.$onç›‘å¬$viewContentLoadedäº‹ä»¶ï¼Œå¯ä»¥åœ¨é¡µ[m
[31m-é¢å†…å®¹åŠ è½½å®Œæˆåè¿›è¡Œä¸€äº›æ“ä½œã€‚[m
[31m-[m
[31m-     â‘¢è¿™æ®µä»£ç æ˜¯è¿™ä¸ªæ¼”ç¤ºçš„æ ¸å¿ƒä»£ç ï¼Œè¯·ç»“åˆä¸‹é¢çš„Viewl[m
[31m-çš„ç•Œé¢ä¸€èµ·ç†è§£ï¼š[m
[31m-[m
[31m-     åœ¨scopeå†…å®šä¹‰ä¸€ä¸ªæ–¹æ³•searchï¼Œåœ¨é¡µé¢ä¸Šé€šè¿‡ng-clickè°ƒ[m
[31m-     ç”¨ã€‚[m
[31m-     é€šè¿‡$scope.personNameè·å–é¡µé¢å®šä¹‰çš„ng-[m
[31m-     model=â€œpersonNameâ€çš„å€¼ã€‚[m
[31m-     ä½¿ç”¨$http.getå‘æœåŠ¡ç«¯åœ°å€searchå‘é€getè¯·æ±‚ã€‚[m
[31m-     ä½¿ç”¨paramså¢åŠ è¯·æ±‚å‚æ•°ã€‚[m
[31m-     ç”¨successæ–¹æ³•ä½œä¸ºè¯·æ±‚æˆåŠŸåçš„å›è°ƒã€‚[m
[31m-     å°†æœåŠ¡ç«¯è¿”å›çš„æ•°æ®dataé€šè¿‡$scope.personèµ‹ç»™æ¨¡å‹[m
[31m-     personï¼Œè¿™æ ·é¡µé¢è§†å›¾ä¸Šå¯ä»¥é€šè¿‡{{person.name}}ã€[m
[31m-     {{person.age}}ã€{{person.address}}æ¥è°ƒç”¨ï¼Œä¸”æ¨¡å‹person[m
[31m-     å€¼æ”¹å˜åï¼Œè§†å›¾æ˜¯è‡ªåŠ¨æ›´æ–°çš„ã€‚[m
[31m-[m
[31m-     5.View1çš„ç•Œé¢ï¼ˆæ¼”ç¤ºä¸æœåŠ¡ç«¯äº¤äº’ï¼‰[m
[31m-[m
[31m-     é¡µé¢ä½ç½®ï¼šsrc/main/resources/static/views/view1.htmlã€‚[m
[31m-[m
[31m-           <div class="row">[m
[31m-                   <label for="attr" class="col-md-2 control-label">åç§°[m
[31m-[m
[31m-       </label>[m
[31m-       <div class="col-md-2">[m
[31m-[m
[31m-                  <!-- 1 -->[m
[31m-                                <input type="text" class="form-control" ng-[m
[31m-[m
[31m-       model="personName">[m
[31m-              </div>[m
[31m-[m
[31m-       <div class="col-md-1">[m
[31m-       <!-- 2 -->[m
[31m-[m
[31m-                <button class="btn btn-primary" ng-click="search()">æŸ¥è¯¢[m
[31m-       </button>[m
[31m-   </div>[m
[31m-</div>[m
[31m-[m
[31m-<div class="row">[m
[31m-[m
[31m-<div class="col-md-4">[m
[31m-[m
[31m-        <ul class="list-group">[m
[31m-[m
[31m-           <!-- 3 -->[m
[31m-[m
[31m-                         <li                              class="list-group-item">å[m
[31m-                                                          class="list-group-item">å¹´[m
[31m-å­—ï¼š {{person.name}}</li>                                   class="list-group-item">åœ°[m
[31m-[m
[31m-                         <li[m
[31m-[m
[31m-é¾„ï¼š {{person.age}}</li>[m
[31m-[m
[31m-                                                     <li[m
[31m-å€ï¼š {{person.address}}</li>[m
[31m-[m
[31m-        </ul>[m
[31m-[m
[31m-</div>[m
[31m-[m
[31m-</div>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ å®šä¹‰æ•°æ®æ¨¡å‹ng-model=â€œpersonNameâ€ã€‚[m
[31m-[m
[31m-     â‘¡é€šè¿‡ng-click=â€œsearchï¼ˆï¼‰â€è°ƒç”¨æ§åˆ¶å™¨ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚[m
[31m-[m
[31m-     â‘¢é€šè¿‡{{person.name}}ã€{{person.age}}ã€[m
[31m-{{person.address}}è®¿é—®æ§åˆ¶å™¨çš„scopeé‡Œå®šä¹‰çš„personæ¨¡å‹ï¼Œæ¨¡[m
[31m-å‹å’Œè§†å›¾æ˜¯ç»‘å®šçš„ã€‚[m
[31m-[m
[31m-     6.æœåŠ¡ç«¯ä»£ç [m
[31m-[m
[31m-     ä¼ å€¼å¯¹è±¡Javabeanï¼š[m
[31m-[m
[31m-       package com.wisely.ch7_7;[m
[31m-[m
[31m-       public class Person {[m
[31m-              private String name;[m
[31m-              private Integer age;[m
[31m-              private String address;[m
[31m-       public Person() {[m
[31m-              super();[m
[31m-[m
[31m-       }[m
[31m-       public Person(String name, Integer age, String address) {[m
[31m-[m
[31m-              super();[m
[31m-              this.name = name;[m
[31m-              this.age = age;[m
[31m-              this.address = address;[m
[31m-       }[m
[31m-       public String getName() {[m
[31m-              return name;[m
[31m-       }[m
[31m-       public void setName(String name) {[m
[31m-              this.name = name;[m
[31m-       }[m
[31m-       public Integer getAge() {[m
[31m-              return age;[m
[31m-       }[m
[31m-       public void setAge(Integer age) {[m
[31m-              this.age = age;[m
[31m-       }[m
[31m-       public String getAddress() {[m
[31m-              return address;[m
[31m-       }[m
[31m-       public void setAddress(String address) {[m
[31m-              this.address = address;[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-æ§åˆ¶å™¨ï¼š[m
[31m-[m
[31m-package com.wisely.ch7_7;[m
[31m-[m
[31m-import org.springframework.boot.SpringApplication;[m
[31m-import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-import org.springframework.http.MediaType;[m
[31m-import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-@RestController[m
[31m-       @SpringBootApplication[m
[31m-       public class Ch77Application {[m
[31m-[m
[31m-                                           @RequestMapping(value="/search",produces=[m
[31m-       {MediaType.APPLICATION_JSON_VALUE})[m
[31m-[m
[31m-              public Person search(String personName){[m
[31m-[m
[31m-                      return new Person(personName, 32, "hefei");[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              public static void main(String[] args) {[m
[31m-                      SpringApplication.run(Ch77Application.class, args);[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     è¿™é‡Œæˆ‘ä»¬åªæ˜¯æ¨¡æ‹Ÿä¸€ä¸ªæŸ¥è¯¢ï¼Œå³æ¥å—å‰å°ä¼ å…¥çš„[m
[31m-personNameï¼Œç„¶åè¿”å›Personç±»ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯[m
[31m-@RestControllerï¼Œä¸”è¿”å›å€¼ç±»å‹æ˜¯Personï¼Œæ‰€ä»¥Spring MVCä¼š[m
[31m-è‡ªåŠ¨å°†å¯¹è±¡è¾“å‡ºä¸ºJSONã€‚[m
[31m-[m
[31m-     7.è‡ªå®šä¹‰æŒ‡ä»¤[m
[31m-[m
[31m-     è„šæœ¬ä½ç½®ï¼šsrc/main/resources/static/js-action/directives.jsï¼š[m
[31m-[m
[31m-       actionApp.directive('datePicker',function(){//1[m
[31m-              return {[m
[31m-                      restrict: 'AC', //2[m
[31m-                      link:function(scope,elem,attrs) { //3[m
[31m-                             elem.datepicker();//4[m
[31m-                      }[m
[31m-              };[m
[31m-[m
[31m-       });[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ å®šä¹‰ä¸€ä¸ªæŒ‡ä»¤åä¸ºdatePickerã€‚[m
[31m-[m
[31m-     â‘¡é™åˆ¶ä¸ºå±æ€§æŒ‡ä»¤å’Œæ ·å¼æŒ‡ä»¤ã€‚[m
[31m-[m
[31m-     â‘¢ä½¿ç”¨linkæ–¹æ³•æ¥å®šä¹‰æŒ‡ä»¤ï¼Œåœ¨linkæ–¹æ³•å†…å¯ä½¿ç”¨å½“å‰[m
[31m-scopeã€å½“å‰å…ƒç´ åŠå…ƒç´ å±æ€§ã€‚[m
[31m-[m
[31m-     â‘£åˆå§‹åŒ–jqueryuiçš„datePickerï¼ˆjqueryçš„å†™æ³•æ˜¯$[m
[31m-ï¼ˆâ€˜#idâ€™ï¼‰.datePickerï¼ˆï¼‰ï¼‰ã€‚[m
[31m-[m
[31m-     é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å°±å®šåˆ¶äº†ä¸€ä¸ªå°è£…jqueryuiçš„[m
[31m-datePickerçš„æŒ‡ä»¤ï¼Œæœ¬ä¾‹åªæ˜¯ä¸ºäº†æ¼”ç¤ºçš„ç›®çš„ï¼Œä¸»æµçš„è„šæœ¬æ¡†[m
[31m-æ¶å·²ç»è¢«å¾ˆå¤šäººå°è£…è¿‡äº†ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è®¿é—®[m
[31m-http://ngmodules.org/ç½‘ç«™ï¼Œè¿™ä¸ªç½‘ç«™åŒ…å«äº†å¤§é‡AngularJSçš„ç¬¬[m
[31m-ä¸‰æ–¹æ¨¡å—ã€æ’ä»¶å’ŒæŒ‡ä»¤ã€‚[m
[31m-[m
[31m-     8.View2çš„é¡µé¢ï¼ˆæ¼”ç¤ºè‡ªå®šä¹‰æŒ‡ä»¤ï¼‰[m
[31m-[m
[31m-     é¡µé¢åœ°å€ï¼šsrc/main/resources/static/views/view2.htmlï¼š[m
[31m-[m
[31m-           <div class="row">[m
[31m-                <label for="attr" class="col-md-2 control-label">å±æ€§å½¢å¼[m
[31m-[m
[31m-       </label>[m
[31m-       <div class="col-md-2">[m
[31m-[m
[31m-                  <!-- 1 -->[m
[31m-                  <input type="text" class="form-control" date-picker>[m
[31m-              </div>[m
[31m-           </div>[m
[31m-[m
[31m-           <div class="row">[m
[31m-              <label for="style" class="col-md-2 control-label">æ ·å¼å½¢å¼[m
[31m-[m
[31m-       </label>[m
[31m-       <div class="col-md-2">[m
[31m-[m
[31m-                  <!-- 2 -->[m
[31m-                  <input type="text" class="form-control date-picker" >[m
[31m-              </div>[m
[31m-           </div>[m
[31m-ä»£ç è§£é‡Š[m
[31m-â‘ ä½¿ç”¨å±æ€§å½¢å¼è°ƒç”¨æŒ‡ä»¤ã€‚[m
[31m-â‘¡ä½¿ç”¨æ ·å¼å½¢å¼è°ƒç”¨æŒ‡ä»¤ã€‚[m
[31m-9.è¿è¡Œ[m
[31m-èœå•åŠè·¯ç”±åˆ‡æ¢å¦‚å›¾7-39æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                        å›¾7-39ã€€èœå•åŠè·¯ç”±äº¤æ¢[m
[31m-[m
[31m-ä¸åå°äº¤äº’å¦‚å›¾7-40æ‰€ç¤ºã€‚[m
[31m-                           å›¾7-40ã€€ä¸åå°äº¤äº’[m
[31m-[m
[31m-è‡ªå®šä¹‰æŒ‡ä»¤å¦‚å›¾7-41æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                           å›¾7-41ã€€è‡ªå®šä¹‰æŒ‡ä»¤[m
[31m-ç¬¬8ç« ã€€Spring Bootçš„æ•°æ®è®¿é—®[m
[31m-[m
[31m-     Spring Dataé¡¹ç›®æ˜¯Springç”¨æ¥è§£å†³æ•°æ®è®¿é—®é—®é¢˜çš„ä¸€æ½å­[m
[31m-è§£å†³æ–¹æ¡ˆï¼ŒSpring Dataæ˜¯ä¸€ä¸ªä¼å½¢é¡¹ç›®ï¼ŒåŒ…å«äº†å¤§é‡å…³ç³»å‹æ•°[m
[31m-æ®åº“åŠéå…³ç³»å‹æ•°æ®åº“çš„æ•°æ®è®¿é—®è§£å†³æ–¹æ¡ˆã€‚Spring Dataä½¿æˆ‘[m
[31m-ä»¬å¯ä»¥å¿«é€Ÿä¸”ç®€å•åœ°ä½¿ç”¨æ™®é€šçš„æ•°æ®è®¿é—®æŠ€æœ¯åŠæ–°çš„æ•°æ®è®¿é—®[m
[31m-æŠ€æœ¯ã€‚[m
[31m-[m
[31m-     Spring DataåŒ…å«çš„å­é¡¹ç›®å¦‚è¡¨8-1æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                          è¡¨8-1ã€€SpringDataåŒ…æ‹¬çš„å­é¡¹ç›®[m
[31m-     Spring Dataä¸ºæˆ‘ä»¬ä½¿ç”¨ç»Ÿä¸€çš„APIæ¥å¯¹ä¸Šè¿°çš„æ•°æ®å­˜å‚¨æŠ€[m
[31m-æœ¯è¿›è¡Œæ•°æ®è®¿é—®æ“ä½œæä¾›äº†æ”¯æŒã€‚è¿™æ˜¯Springé€šè¿‡æä¾›Spring[m
[31m-Data Commonsé¡¹ç›®æ¥å®ç°çš„ï¼Œå®ƒæ˜¯ä¸Šè¿°å„ç§Spring Dataé¡¹ç›®çš„[m
[31m-ä¾èµ–ã€‚Spring Data Commonsè®©æˆ‘ä»¬åœ¨ä½¿ç”¨å…³ç³»å‹æˆ–éå…³ç³»å‹[m
[31m-æ•°æ®è®¿é—®æŠ€æœ¯æ—¶éƒ½ä½¿ç”¨åŸºäºSpringçš„ç»Ÿä¸€æ ‡å‡†ï¼Œè¯¥æ ‡å‡†åŒ…å«[m
[31m-CRUDï¼ˆåˆ›å»ºã€è·å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰ã€æŸ¥è¯¢ã€æ’åºå’Œåˆ†é¡µçš„ç›¸[m
[31m-å…³çš„æ“ä½œã€‚[m
[31m-[m
[31m-æ­¤å¤„ä»‹ç»ä¸‹Spring Data Commonsçš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šSpring[m
[31m-[m
[31m-Data RepositoryæŠ½è±¡ã€‚ä½¿ç”¨Spring Data Repositoryå¯ä»¥æå¤§åœ°å‡[m
[31m-[m
[31m-å°‘æ•°æ®è®¿é—®å±‚çš„ä»£ç ã€‚æ—¢ç„¶æ˜¯æ•°æ®è®¿é—®æ“ä½œçš„ç»Ÿä¸€æ ‡å‡†ï¼Œé‚£è‚¯[m
[31m-[m
[31m-å®šæ˜¯å®šä¹‰äº†å„ç§å„æ ·å’Œæ•°æ®è®¿é—®ç›¸å…³çš„æ¥å£ï¼ŒSpring      Data[m
[31m-[m
[31m-RepositoryæŠ½è±¡çš„æ ¹æ¥å£æ˜¯Repositoryæ¥å£ï¼š[m
[31m-[m
[31m-package org.springframework.data.repository;[m
[31m-import java.io.Serializable;[m
[31m-public interface Repository<T, ID extends Serializable> {[m
[31m-}[m
[31m-     ä»æºç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå®ƒæ¥å—é¢†åŸŸç±»ï¼ˆJPAä¸ºå®ä½“ç±»ï¼‰å’Œé¢†[m
[31m-åŸŸç±»çš„idç±»å‹ä½œä¸ºç±»å‹å‚æ•°ã€‚[m
[31m-[m
[31m-     å®ƒçš„å­æ¥å£CrudRepositoryå®šä¹‰äº†å’ŒCRUDæ“ä½œç›¸å…³çš„å†…[m
[31m-å®¹ï¼š[m
[31m-[m
[31m-       package org.springframework.data.repository;[m
[31m-       import java.io.Serializable;[m
[31m-       @NoRepositoryBean[m
[31m-       public interface CrudRepository<T, ID extends Serializable> extends Rep[m
[31m-[m
[31m-              <S extends T> S save(S entity);[m
[31m-              <S extends T> Iterable<S> save(Iterable<S> entities);[m
[31m-              T findOne(ID id);[m
[31m-              boolean exists(ID id);[m
[31m-              Iterable<T> findAll();[m
[31m-              Iterable<T> findAll(Iterable<ID> ids);[m
[31m-              long count();[m
[31m-              void delete(ID id);[m
[31m-              void delete(T entity);[m
[31m-              void delete(Iterable<? extends T> entities);[m
[31m-              void deleteAll();[m
[31m-       }[m
[31m-[m
[31m-     CrudRepositoryçš„å­æ¥å£PagingAndSortingRepositoryå®šä¹‰äº†[m
[31m-ä¸åˆ†é¡µå’Œæ’åºæ“ä½œç›¸å…³çš„å†…å®¹ï¼š[m
[31m-[m
[31m-       package org.springframework.data.repository;[m
[31m-       import java.io.Serializable;[m
[31m-       import org.springframework.data.domain.Page;[m
[31m-       import org.springframework.data.domain.Pageable;[m
[31m-       import org.springframework.data.domain.Sort;[m
[31m-[m
[31m-       @NoRepositoryBean[m
[31m-       public interface PagingAndSortingRepository<T, ID extends Serializable>[m
[31m-[m
[31m-              Iterable<T> findAll(Sort sort);[m
[31m-              Page<T> findAll(Pageable pageable);[m
[31m-       }[m
[31m-     ä¸åŒçš„æ•°æ®è®¿é—®æŠ€æœ¯ä¹Ÿæä¾›äº†ä¸åŒçš„Repositoryï¼Œå¦‚Spring[m
[31m-Data JPAæœ‰JpaRepositoryã€Spring Data MongoDBæœ‰[m
[31m-MongoRepositoryã€‚[m
[31m-[m
[31m-     Spring Dataé¡¹ç›®è¿˜ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ¿€åŠ¨äººå¿ƒçš„åŠŸèƒ½ï¼Œå³[m
[31m-å¯ä»¥æ ¹æ®å±æ€§åè¿›è¡Œè®¡æ•°ã€åˆ é™¤ã€æŸ¥è¯¢æ–¹æ³•ç­‰æ“ä½œï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       public interface PersonRepository extends Repository<Person, Long> {[m
[31m-              //æŒ‰ç…§å¹´é¾„è®¡æ•°[m
[31m-              Long countByAge(Integer age);[m
[31m-              //æŒ‰ç…§åå­—åˆ é™¤[m
[31m-              Long deleteByName(String name);[m
[31m-              //æŒ‰ç…§åå­—æŸ¥è¯¢[m
[31m-              List<Person> findByName(String name);[m
[31m-              //æŒ‰ç…§åå­—å’Œåœ°å€æŸ¥è¯¢[m
[31m-              List<Person> findByNameAndAddress(String name,String address);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     æˆ‘ä»¬å°†åœ¨8.2èŠ‚å¯¹Spring Dataæä¾›çš„ç®€åŒ–æ•°æ®è®¿é—®æ“ä½œè¿›è¡Œ[m
[31m-æ›´ä¸ºè¯¦ç»†çš„è®²è§£ã€‚[m
[31m-[m
[31m-     æœ¬ç« å°†å­¦ä¹ Spring Data JPAã€Spring Data MongoDBã€[m
[31m-Spring Data RESTã€Spring Data Redisã€‚é€šè¿‡å¯¹è¿™äº›Spring Data[m
[31m-é¡¹ç›®çš„å­¦ä¹ ï¼Œå¹¶æŒ‰ç…§Spring Dataæä¾›çš„ç»Ÿä¸€æ ‡å‡†ï¼Œå½“ä½ æœ‰éœ€è¦[m
[31m-çš„æ—¶å€™ï¼Œä¹Ÿä¼šå¿«é€ŸæŒæ¡Spring Dataçš„å…¶ä»–é¡¹ç›®ã€‚[m
[31m-8.1ã€€å¼•å…¥Docker[m
[31m-[m
[31m-     å¤§å®¶ä¹Ÿè®¸å¾ˆå¥‡æ€ªä¸ºä»€ä¹ˆæœ¬ä¹¦åœ¨æ­¤å¤„è¦å¼•å…¥Dockerï¼ŒDocker[m
[31m-ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œå®ƒèƒ½å¹²ä»€ä¹ˆï¼Ÿ[m
[31m-[m
[31m-     Dockerè¿™ä¸¤å¹´å¤§å—è¿½æ§ï¼Œé£å…‰æ— äºŒã€‚Dockeræ˜¯ä¸€ä¸ªè½»é‡çº§[m
[31m-å®¹å™¨æŠ€æœ¯ï¼Œç±»ä¼¼äºè™šæ‹ŸæœºæŠ€æœ¯ï¼ˆxenã€kvmã€vmwareã€[m
[31m-virtualï¼‰ã€‚Dockeræ˜¯ç›´æ¥è¿è¡Œåœ¨å½“å‰æ“ä½œç³»ç»Ÿï¼ˆLinuxï¼‰ä¹‹ä¸Šï¼Œ[m
[31m-è€Œä¸æ˜¯è¿è¡Œåœ¨è™šæ‹Ÿæœºä¸­ï¼Œä½†æ˜¯ä¹Ÿå®ç°äº†è™šæ‹ŸæœºæŠ€æœ¯çš„èµ„æºéš”[m
[31m-ç¦»ï¼Œæ€§èƒ½è¿œè¿œé«˜äºè™šæ‹ŸæœºæŠ€æœ¯ã€‚[m
[31m-[m
[31m-     Dockeræ”¯æŒå°†è½¯ä»¶ç¼–è¯‘æˆä¸€ä¸ªé•œåƒï¼ˆimageï¼‰ï¼Œåœ¨è¿™ä¸ªé•œåƒ[m
[31m-é‡Œåšå¥½å¯¹è½¯ä»¶çš„å„ç§é…ç½®ï¼Œç„¶åå‘å¸ƒè¿™ä¸ªé•œåƒï¼Œä½¿ç”¨è€…å¯ä»¥è¿[m
[31m-è¡Œè¿™ä¸ªé•œåƒï¼Œè¿è¡Œä¸­çš„é•œåƒç§°ä¹‹ä¸ºå®¹å™¨ï¼ˆcontainerï¼‰ï¼Œå®¹å™¨çš„[m
[31m-å¯åŠ¨æ˜¯éå¸¸å¿«çš„ï¼Œä¸€èˆ¬éƒ½æ˜¯ä»¥ç§’ä¸ºå•ä½ã€‚è¿™ä¸ªæœ‰ç‚¹åƒæˆ‘ä»¬å¹³æ—¶[m
[31m-å®‰è£…ghostæ“ä½œç³»ç»Ÿï¼Ÿç³»ç»Ÿå®‰è£…å¥½åè½¯ä»¶éƒ½æœ‰äº†ï¼Œè™½ç„¶å®Œå…¨ä¸[m
[31m-æ˜¯ä¸€ç§ä¸œè¥¿ï¼Œä½†æ˜¯æ€è·¯æ˜¯ç±»ä¼¼çš„ã€‚[m
[31m-[m
[31m-     ç›®å‰å„å¤§ä¸»æµäº‘è®¡ç®—å¹³å°éƒ½æ”¯æŒDockerå®¹å™¨æŠ€æœ¯ï¼ŒåŒ…æ‹¬é˜¿[m
[31m-é‡Œäº‘ã€ç™¾åº¦äº‘å¹³å°ï¼ˆèµ„æºéš”ç¦»é€šè¿‡Dockerå®ç°ï¼‰ã€Cloud[m
[31m-Foundryï¼ˆå’ŒSpringä¸€å®¶å…¬å¸çš„ï¼Œç›®å‰æœ€æˆç†Ÿä¹Ÿæœ€ç¨³å®šï¼‰ã€[m
[31m-HeroKuã€DigitalOceanã€OpenShiftï¼ˆJBossçš„ï¼‰ã€Apache[m
[31m-Stratosã€Apache MesOSï¼ˆæ‰¹å¤„ç†å¹³å°ï¼Œæ”¯æŒæ­å»ºåŸºäºDockerçš„[m
[31m-äº‘å¹³å°ï¼‰ã€Deisï¼ˆå¼€æºPaaSå¹³å°ï¼‰ï¼›è¿å¾®è½¯ä¹Ÿä¼šåœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬[m
[31m-çš„Windows ServeråŠå…¶äº‘å¹³å°Azureä¸Šæ”¯æŒDockerï¼Œè¿™æ ·çœ‹æ¥[m
[31m-Dockerå¤§æœ‰ç»Ÿä¸€äº‘è®¡ç®—çš„è¶‹åŠ¿ã€‚[m
[31m-[m
[31m-     è¿™é‡Œçš„äº‘è®¡ç®—å¹³å°ä¸€èˆ¬æŒ‡çš„æ˜¯PaaSï¼ˆå¹³å°å³æœåŠ¡ï¼‰ï¼Œå®ƒæ˜¯[m
[31m-ä¸€ä¸ªè¿™æ ·çš„äº‘è®¡ç®—ï¼šå¹³å°æä¾›äº†å­˜å‚¨ã€æ•°æ®åº“ã€ç½‘ç»œã€è´Ÿè½½å‡[m
[31m-è¡¡ã€è‡ªåŠ¨æ‰©å±•ç­‰åŠŸèƒ½ï¼Œä½ åªéœ€å°†ä½ çš„ç¨‹åºäº¤ç»™äº‘è®¡ç®—å¹³å°å°±å¯[m
[31m-ä»¥äº†ã€‚ä½ çš„ç¨‹åºå¯ä»¥æ˜¯ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å¼€å‘çš„ï¼Œè€Œä½¿ç”¨çš„[m
[31m-Dockerçš„äº‘è®¡ç®—å¹³å°å°±æ˜¯ç”¨Dockeræ¥å®ç°ä»¥ä¸ŠåŠŸèƒ½åŠä¸åŒç¨‹åº[m
[31m-ä¹‹é—´çš„éš”ç¦»çš„ã€‚[m
[31m-[m
[31m-     ç›®å‰ä¸»æµçš„è½¯ä»¶ä»¥åŠéä¸»æµçš„è½¯ä»¶å¤§éƒ¨åˆ†éƒ½æœ‰äººå°†å…¶å°è£…[m
[31m-æˆDockeré•œåƒï¼Œæˆ‘ä»¬åªéœ€ä¸‹è½½Dockeré•œåƒï¼Œç„¶åè¿è¡Œé•œåƒå°±å¯[m
[31m-ä»¥å¿«é€Ÿè·å¾—å·²åšå¥½é…ç½®å¯è¿è¡Œçš„è½¯ä»¶ã€‚[m
[31m-[m
[31m-     ä»æœ¬ç« å¼€å§‹ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“å°†ä½¿ç”¨Oracle XEã€éœ€å®‰è£…[m
[31m-Redisä½œä¸ºç¼“å­˜å’ŒNoSQLæ•°æ®åº“çš„æ¼”ç¤ºã€éœ€å®‰è£…MongoDBè¿›è¡Œ[m
[31m-NoSQLæ•°æ®åº“æ¼”ç¤ºã€‚[m
[31m-[m
[31m-     åœ¨ç¬¬9ç« éœ€è¦å®‰è£…ActiveMQä»¥åŠRabbitMQè¿›è¡Œå¼‚æ­¥æ¶ˆæ¯çš„[m
[31m-æ¼”ç¤ºã€‚åœ¨ç¬¬10ç« æˆ‘ä»¬ä¼šæ¼”ç¤ºåŸºäºDockerçš„Spring Bootçš„éƒ¨ç½²ã€‚[m
[31m-ä½¿ç”¨Dockeråæˆ‘ä»¬å°†ä¸ç”¨æ‰‹åŠ¨ä¸‹è½½ã€å®‰è£…å’Œé…ç½®è¿™äº›è½¯ä»¶ã€‚[m
[31m-[m
[31m-     å¦å¤–è¦ç‰¹åˆ«æŒ‡å‡ºçš„æ˜¯ï¼ŒDockerå¹¶ä¸æ˜¯ä¸ºå¼€å‘æµ‹è¯•æ–¹ä¾¿è€Œæ[m
[31m-ä¾›çš„å°å·¥å…·ï¼Œè€Œæ˜¯å¯ä»¥ç”¨äºå®é™…ç”Ÿäº§ç¯å¢ƒçš„ä¸€ç§æå¥½çš„éƒ¨ç½²æ–¹[m
[31m-å¼ã€‚[m
[31m-[m
[31m-     å½“ç„¶ï¼Œå¦‚æœä½ è§‰å¾—ç›®å‰æ²¡æœ‰è¿«åˆ‡å­¦ä¹ Dockerçš„å¿…è¦ï¼Œå¯ä»¥[m
[31m-ç•¥è¿‡æ­¤èŠ‚ï¼Œå¹¶è‡ªè¡Œä¸‹è½½å®‰è£…æœ¬ä¹¦ç¤ºä¾‹ä¸­æ‰€éœ€è¦çš„è½¯ä»¶ï¼Œä¸è¿‡è¿™[m
[31m-ä¹ˆç®€å•æ˜“ç”¨çš„æŠ€æœ¯è¿˜æ˜¯å¼ºçƒˆå»ºè®®å­¦ä¹ ä¸€ä¸‹ã€‚[m
[31m-[m
[31m-     å½“ç„¶ï¼Œæœ¬ä¹¦ä¸­æ¶‰åŠçš„Dockerå†…å®¹ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å¼€å‘[m
[31m-æµ‹è¯•æ‰€éœ€å®‰è£…çš„è½¯ä»¶ï¼Œä¸ä¼šæ¶‰åŠDockeræ‰€æœ‰çš„å†…å®¹ï¼Œå½“ç„¶ä¹Ÿä¸[m
[31m-å¤±äºå­¦ä¹ Dockerå…¥é—¨çš„å¥½ææ–™ã€‚é€šè¿‡å­¦ä¹ æœ¬ä¹¦çš„Dockerå†…å®¹ï¼Œ[m
[31m-å¯ä»¥å¿«é€Ÿå…¥é—¨Dockerï¼Œç„¶åæŒ‰ç…§è‡ªå·±çš„éœ€æ±‚çœ‹æ˜¯å¦éœ€è¦ç»§ç»­æ·±[m
[31m-å…¥å­¦ä¹ ã€‚[m
[31m-[m
[31m-8.1.1ã€€Dockerçš„å®‰è£…[m
[31m-     å› ä¸ºDockerçš„è¿è¡ŒåŸç†æ˜¯åŸºäºLinuxçš„ï¼Œæ‰€ä»¥Dockeråªèƒ½åœ¨[m
[31m-Linuxä¸‹è¿è¡Œã€‚ä¸è¦ç´§å¼ ï¼Œè¿™åªèƒ½è¯´æ˜åœ¨çœŸæ­£çš„ç”Ÿäº§ç¯èŠ‚ä¸‹ï¼Œ[m
[31m-åŸºäºDockerçš„éƒ¨ç½²åªèƒ½åœ¨Linuxä¸Šï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨å¼€å‘æµ‹è¯•çš„æ—¶[m
[31m-å€™ï¼ŒDockeræ˜¯å¯ä»¥åœ¨Windowsä»¥åŠMac OS Xç³»ç»Ÿä¸‹çš„ï¼Œè¿è¡Œçš„[m
[31m-åŸç†æ˜¯å¯åŠ¨ä¸€ä¸ªVirtualBoxè™šæ‹Ÿæœºï¼Œåœ¨æ­¤è™šæ‹Ÿæœºé‡Œè¿è¡Œ[m
[31m-Dockerã€‚[m
[31m-[m
[31m-     1.Linuxä¸‹å®‰è£…[m
[31m-[m
[31m-     CentOSå®‰è£…å‘½ä»¤ï¼š[m
[31m-[m
[31m-       sudo yum update[m
[31m-       sudo yum install docker[m
[31m-[m
[31m-     Ubuntuï¼š[m
[31m-[m
[31m-       sudo apt-get update[m
[31m-       sudo apt-get docker.io[m
[31m-[m
[31m-     2.Windowsä¸‹å®‰è£…[m
[31m-[m
[31m-     Windowsä¸‹è¿è¡ŒDockeræ˜¯é€šè¿‡è¿™ä¸ªBoot2Dockerè¿™ä¸ªè½¯ä»¶æ¥[m
[31m-å®ç°çš„ï¼Œè¿™ä¸ªè½¯ä»¶åŒ…å«äº†ä¸€ä¸ªVirtualBoxã€‚åœ¨Windowsä¸‹çš„[m
[31m-Dockeråªé€‚åˆäºå¼€å‘æµ‹è¯•ï¼Œä¸é€‚åˆäºç”Ÿäº§ç¯å¢ƒã€‚[m
[31m-[m
[31m-     Boot2Dockerä¸‹è½½åœ°å€ï¼š[m
[31m-https://github.com/boot2docker/windows-installer/releases/latestã€‚[m
[31m-[m
[31m-     å› åœ¨Windowsä¸‹è¿è¡Œçš„Dockeræ˜¯åŸºäºVirtualBoxè™šæ‹Ÿæœºè½¯[m
[31m-ä»¶ï¼Œå› æ­¤åœ¨å®‰è£…å‰è¯·ç¡®è®¤ç”µè„‘çš„BIOSè®¾ç½®ä¸­çš„CPUè™šæ‹ŸåŒ–æŠ€[m
[31m-æœ¯æ”¯æŒå·²ç»å¼€å¯ã€‚[m
[31m-     åœ¨æˆ‘ä»¬ç›®å‰æµ‹è¯•çš„ç‰ˆæœ¬ï¼ˆ1.7.0ï¼‰ä¸­ï¼ŒBoot2Dockeræš‚æ—¶ä¸æ”¯[m
[31m-æŒWindows 10ç³»ç»Ÿã€‚[m
[31m-[m
[31m-     åŒå‡»docker-install.exeå¼€å§‹å®‰è£…ï¼Œå¦‚å›¾8-1æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                    å›¾8-1ã€€å¼€å§‹å®‰è£…[m
[31m-[m
[31m-     é€‰æ‹©å®Œæ•´å®‰è£…ï¼Œå…¶ä¸­ï¼ŒMSYS-git UNIX toolsæ˜¯åœ¨Windows[m
[31m-ä¸‹è¿è¡ŒUNIXï¼ˆLinuxï¼‰å‘½ä»¤çš„å·¥å…·ï¼Œå¦‚å›¾8-2æ‰€ç¤ºã€‚[m
[31m-                                    å›¾8-2ã€€å®Œæ•´å®‰è£…[m
[31m-[m
[31m-     å‹¾é€‰â€œReboot Windows at end of installationï¼ˆé€‰æ‹©å®‰è£…å®Œæˆ[m
[31m-åé‡å¯ç”µè„‘ï¼‰â€é€‰é¡¹ï¼Œå¦‚å›¾8-3æ‰€ç¤ºã€‚[m
[31m-[m
[31m-å›¾8-3ã€€å‹¾é€‰â€œReboot Windows at the end of installationï¼ˆå®‰è£…å®Œæˆåé‡å¯[m
[31m-                                       ç”µè„‘ï¼‰é€‰é¡¹[m
[31m-     å®‰è£…â€œé€šç”¨ä¸²è¡Œæ€»çº¿æ§åˆ¶å™¨â€ï¼Œå¦‚å›¾8-4æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                         å›¾8-4ã€€å®‰è£…â€œé€šç”¨ä¸²è¡Œæ€»æ§åˆ¶å™¨â€[m
[31m-[m
[31m-     å®‰è£…å®Œæˆåï¼Œè‡ªåŠ¨é‡å¯ç”µè„‘ã€‚å¯åŠ¨Dockerï¼Œé€‰æ‹©æ¡Œé¢å›¾æ ‡[m
[31m-Boot2Docker Startï¼Œå¦‚å›¾8-5æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                        å›¾8-5ã€€æ¡Œé¢å›¾æ ‡Boot2Docker Start[m
[31m-[m
[31m-     å®‰è£…æˆåŠŸéªŒè¯ï¼Œè¾“å…¥ä¸‹é¢å‘½ä»¤éªŒè¯Dockerç‰ˆæœ¬ï¼Œå¦‚å›¾8-6æ‰€[m
[31m-ç¤ºã€‚[m
[31m-       docker -v[m
[31m-[m
[31m-                               å›¾8-6ã€€éªŒè¯Dockerç‰ˆæœ¬[m
[31m-[m
[31m-     æ­¤æ—¶VirtualBoxè¿è¡Œäº†ä¸€ä¸ªè™šæ‹Ÿæœºã€‚æ‰“å¼€VirtualBoxè½¯ä»¶ï¼Œ[m
[31m-å¦‚å›¾8-7æ‰€ç¤ºã€‚[m
[31m-                                å›¾8-7ã€€VirtualBoxè½¯ä»¶[m
[31m-[m
[31m-8.1.2ã€€Dockerå¸¸ç”¨å‘½ä»¤åŠå‚æ•°[m
[31m-[m
[31m-     1.Dockeré•œåƒå‘½ä»¤[m
[31m-     åŸºäºDockeré•œåƒæ˜¯å¯ä»¥è‡ªå·±ç¼–è¯‘çš„ï¼Œæˆ‘ä»¬å°†åœ¨10.3èŠ‚è®²è§£[m
[31m-å¦‚ä½•ç¼–è¯‘è‡ªå·±çš„Dockeré•œåƒï¼Œæœ¬èŠ‚æˆ‘ä»¬è®²è¿°ä¸Dockeré•œåƒæ“ä½œ[m
[31m-ç›¸å…³çš„å‘½ä»¤ã€‚[m
[31m-[m
[31m-     é€šå¸¸æƒ…å†µä¸‹ï¼ŒDockerçš„é•œåƒéƒ½æ”¾ç½®åœ¨Dockerå®˜ç½‘çš„Docker[m
[31m-Hubä¸Šï¼Œåœ°å€æ˜¯https://registry.hub.docker.comï¼Œå¦‚å›¾8-8æ‰€ç¤ºã€‚[m
[31m-                                  å›¾8-8ã€€Docker Hub[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰Dockeré•œåƒæ£€ç´¢[m
[31m-     é™¤äº†å¯ä»¥åœ¨https://registry.hub.docker.comç½‘ç«™æ£€ç´¢é•œåƒä»¥[m
[31m-å¤–ï¼Œè¿˜å¯ä»¥ç”¨ä¸‹é¢å‘½ä»¤æ£€ç´¢ï¼š[m
[31m-[m
[31m-       docker search é•œåƒå[m
[31m-[m
[31m-     æ£€ç´¢Redisï¼Œè¾“å…¥ï¼š[m
[31m-[m
[31m-       docker search redis[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰é•œåƒä¸‹è½½[m
[31m-     ä¸‹è½½é•œåƒé€šè¿‡ä¸‹é¢å‘½ä»¤å®ç°ï¼š[m
[31m-       docker pull é•œåƒå[m
[31m-[m
[31m-     ä¸‹è½½Redisé•œåƒï¼Œè¿è¡Œï¼š[m
[31m-[m
[31m-       docker pull redis[m
[31m-[m
[31m-     è¿™æ ¹æ®æ®ç½‘ç»œæƒ…å†µå¯èƒ½è¦èŠ±è´¹ä¸€æ®µæ—¶é—´ã€‚[m
[31m-     ï¼ˆ3ï¼‰é•œåƒåˆ—è¡¨[m
[31m-     æŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨ï¼Œå¦‚å›¾8-9æ‰€ç¤ºï¼Œé€šè¿‡ä¸‹é¢å‘½ä»¤ï¼š[m
[31m-[m
[31m-       docker images[m
[31m-[m
[31m-                                    å›¾8-9ã€€é•œåƒåˆ—è¡¨[m
[31m-[m
[31m-     å…¶ä¸­REPOSITORYæ˜¯é•œåƒåï¼›TAGæ˜¯è½¯ä»¶ç‰ˆæœ¬ï¼Œlatestä¸ºæœ€[m
[31m-æ–°ç‰ˆï¼›IMAGE IDæ˜¯å½“å‰é•œåƒçš„å”¯ä¸€æ ‡è¯†ï¼›CREATEDæ˜¯å½“å‰[m
[31m-é•œåƒåˆ›å»ºæ—¶é—´ï¼›VIRTUAL SIZEæ˜¯å½“å‰é•œåƒçš„å¤§å°ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰é•œåƒåˆ é™¤[m
[31m-     åˆ é™¤æŒ‡å®šé•œåƒé€šè¿‡ä¸‹é¢å‘½ä»¤ï¼š[m
[31m-[m
[31m-       docker rmi image-id[m
[31m-     åˆ é™¤æ‰€æœ‰é•œåƒé€šè¿‡ä¸‹é¢å‘½ä»¤ï¼š[m
[31m-[m
[31m-       docker rmi $(docker images -q)[m
[31m-[m
[31m-     2.Dockerå®¹å™¨å‘½ä»¤[m
[31m-     ï¼ˆ1ï¼‰å®¹å™¨åŸºæœ¬æ“ä½œ[m
[31m-     æœ€ç®€å•çš„è¿è¡Œé•œåƒä¸ºå®¹å™¨çš„å‘½ä»¤å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       docker run --name container-name -d image-name[m
[31m-[m
[31m-     è¿è¡Œä¸€ä¸ªå®¹å™¨åªè¦é€šè¿‡Docker runå‘½ä»¤å³å¯å®ç°ï¼Œå…¶ä¸­ï¼Œ--[m
[31m-nameå‚æ•°æ˜¯ä¸ºå®¹å™¨å–å¾—åç§°ï¼›-dè¡¨ç¤ºdetachedï¼Œæ„å‘³ç€æ‰§è¡Œå®Œ[m
[31m-è¿™å¥å‘½ä»¤åæ§åˆ¶å°å°†ä¸ä¼šè¢«é˜»ç¢ï¼Œå¯ç»§ç»­è¾“å…¥å‘½ä»¤æ“ä½œï¼›æœ€å[m
[31m-çš„image-nameæ˜¯è¦ä½¿ç”¨å“ªä¸ªé•œåƒæ¥è¿è¡Œå®¹å™¨ã€‚[m
[31m-[m
[31m-     æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸ªRediså®¹å™¨ï¼š[m
[31m-[m
[31m-       docker run --name test-redis -d redis[m
[31m-[m
[31m-     Dockerä¼šä¸ºæˆ‘ä»¬çš„å®¹å™¨ç”Ÿæˆå”¯ä¸€çš„æ ‡è¯†ã€‚[m
[31m-     ï¼ˆ2ï¼‰å®¹å™¨åˆ—è¡¨[m
[31m-     é€šè¿‡ä¸‹é¢å‘½ä»¤ï¼ŒæŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨åˆ—è¡¨ï¼Œå¦‚å›¾8-10æ‰€ç¤ºã€‚[m
[31m-[m
[31m-       docker ps[m
[31m-                                   å›¾8-10ã€€å®¹å™¨åˆ—è¡¨[m
[31m-[m
[31m-     å…¶ä¸­CONTAINER IDæ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™ç”Ÿæˆçš„IDï¼›IMAGE[m
[31m-æ˜¯è¯¥å®¹å™¨ä½¿ç”¨çš„é•œåƒï¼›COMMANDæ˜¯å®¹å™¨å¯åŠ¨æ—¶è°ƒç”¨çš„å‘½[m
[31m-ä»¤ï¼›CREATEDæ˜¯å®¹å™¨åˆ›å»ºæ—¶é—´ï¼›STATUSæ˜¯å½“å‰å®¹å™¨çš„çŠ¶[m
[31m-æ€ï¼›PORTSæ˜¯å®¹å™¨ç³»ç»Ÿæ‰€ä½¿ç”¨çš„ç«¯å£å·ï¼ŒRedisé»˜è®¤ä½¿ç”¨6379[m
[31m-ç«¯å£ï¼›NAMESæ˜¯åˆšæ‰ç»™å®¹å™¨å®šä¹‰çš„åç§°ã€‚[m
[31m-[m
[31m-     é€šè¿‡ä¸‹åˆ—å‘½ä»¤å¯æŸ¥çœ‹è¿è¡Œå’Œåœæ­¢çŠ¶æ€çš„å®¹å™¨ï¼š[m
[31m-[m
[31m-       docker ps -a[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰åœæ­¢å’Œå¯åŠ¨å®¹å™¨[m
[31m-     1ï¼‰åœæ­¢å®¹å™¨[m
[31m-     åœæ­¢å®¹å™¨é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼š[m
[31m-[m
[31m-       docker stop container-name/container-id[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥é€šè¿‡å®¹å™¨åç§°æˆ–è€…å®¹å™¨idæ¥åœæ­¢å®¹å™¨ï¼Œä»¥åœæ­¢ä¸Š[m
[31m-é¢çš„Rediså®¹å™¨ä¸ºä¾‹ï¼š[m
[31m-[m
[31m-       docker stop test-redis[m
[31m-     æ­¤æ—¶è¿è¡Œä¸­çš„å®¹å™¨åˆ—è¡¨ä¸ºç©ºã€‚æŸ¥çœ‹æ‰€æœ‰å®¹å™¨å‘½ä»¤ï¼Œå¯çœ‹å‡º[m
[31m-æ­¤æ—¶çš„STATUSä¸ºé€€å‡ºã€‚[m
[31m-[m
[31m-     2ï¼‰å¯åŠ¨å®¹å™¨[m
[31m-     å¯åŠ¨å®¹å™¨é€šè¿‡ä¸‹é¢å‘½ä»¤ï¼š[m
[31m-[m
[31m-       docker start container-name/container-id[m
[31m-[m
[31m-     å†æ¬¡å¯åŠ¨æˆ‘ä»¬åˆšæ‰åœæ­¢çš„å®¹å™¨ï¼š[m
[31m-[m
[31m-       docker start test-redis[m
[31m-[m
[31m-     æ­¤æ—¶æŸ¥çœ‹å®¹å™¨åˆ—è¡¨å¦‚å›¾8-11æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                           å›¾8-11ã€€å¯åŠ¨åˆšæ‰åœæ­¢çš„å®¹å™¨[m
[31m-[m
[31m-     3ï¼‰ç«¯å£æ˜ å°„[m
[31m-     Dockerå®¹å™¨ä¸­è¿è¡Œçš„è½¯ä»¶æ‰€ä½¿ç”¨çš„ç«¯å£ï¼Œåœ¨æœ¬æœºå’Œæœ¬æœºçš„[m
[31m-å±€åŸŸç½‘æ˜¯ä¸èƒ½è®¿é—®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†Dockerå®¹å™¨ä¸­çš„ç«¯å£æ˜ [m
[31m-å°„åˆ°å½“å‰ä¸»æœºçš„ç«¯å£ä¸Šï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æœ¬æœºå’Œæœ¬æœºæ‰€åœ¨çš„å±€åŸŸç½‘[m
[31m-å°±èƒ½å¤Ÿè®¿é—®è¯¥è½¯ä»¶äº†ã€‚[m
[31m-     Dockerçš„ç«¯å£æ˜ å°„æ˜¯é€šè¿‡ä¸€ä¸ª-på‚æ•°æ¥å®ç°çš„ã€‚æˆ‘ä»¬ä»¥åˆš[m
[31m-æ‰çš„Redisä¸ºä¾‹ï¼Œæ˜ å°„å®¹å™¨çš„6379ç«¯å£åˆ°æœ¬æœºçš„6378ç«¯å£ï¼Œå‘½[m
[31m-ä»¤å¦‚ä¸‹ï¼š[m
[31m-       docker run -d -p 6378:6379 --name port-redis redis[m
[31m-[m
[31m-     ç›®å‰åœ¨Windowsä¸‹è¿è¡Œçš„Dockerå…¶å®æ˜¯è¿è¡Œåœ¨VirtualBoxè™š[m
[31m-æ‹Ÿæœºä¸­çš„ï¼Œå³æˆ‘ä»¬å½“å‰çš„æœ¬æœºå¹¶ä¸æ˜¯æˆ‘ä»¬å½“å‰çš„å¼€å‘æœºå™¨ï¼Œè€Œ[m
[31m-æ˜¯VirtualBoxè™šæ‹Ÿæœºï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å†åšä¸€æ¬¡ç«¯å£æ˜ å°„ï¼Œå°†[m
[31m-VirtualBoxè™šæ‹Ÿçš„ç«¯å£æ˜ å°„åˆ°å½“å‰çš„å¼€å‘æœºå™¨ã€‚è¿™éƒ¨åˆ†å†…å®¹å°†[m
[31m-åœ¨å®é™…éƒ¨ç½²è½¯ä»¶çš„æ—¶å€™è¿›è¡Œæ¼”ç¤ºã€‚[m
[31m-[m
[31m-     4ï¼‰åˆ é™¤å®¹å™¨[m
[31m-     åˆ é™¤å•ä¸ªå®¹å™¨ï¼Œå¯é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼š[m
[31m-[m
[31m-       docker rm container-id[m
[31m-[m
[31m-     åˆ é™¤æ‰€æœ‰å®¹å™¨ï¼Œå¯é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼š[m
[31m-[m
[31m-       docker rm $(docker ps -a -q)[m
[31m-[m
[31m-     5ï¼‰å®¹å™¨æ—¥å¿—[m
[31m-     æŸ¥çœ‹å½“å‰å®¹å™¨æ—¥å¿—ï¼Œå¯é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼š[m
[31m-[m
[31m-       docker logs container-name/container-id[m
[31m-[m
[31m-     æˆ‘ä»¬æŸ¥çœ‹ä¸‹ä¸Šé¢ä¸€ä¸ªå®¹å™¨çš„æ—¥å¿—ï¼Œå¦‚å›¾8-12æ‰€ç¤ºï¼Œå‘½ä»¤å¦‚[m
[31m-ä¸‹ï¼š[m
[31m-       docker logs port-redis[m
[31m-[m
[31m-                                 å›¾8-12ã€€å®¹å™¨çš„æ—¥å¿—[m
[31m-[m
[31m-     6ï¼‰ç™»å½•å®¹å™¨[m
[31m-     è¿è¡Œä¸­çš„å®¹å™¨å…¶å®æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„Linuxæ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥[m
[31m-æˆ‘ä»¬å¯ä»¥åƒå¸¸è§„çš„ç³»ç»Ÿä¸€æ ·ç™»å½•å¹¶è®¿é—®å®¹å™¨ã€‚[m
[31m-     æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼Œç™»å½•è®¿é—®å½“å‰å®¹å™¨ï¼Œç™»å½•åæˆ‘ä»¬[m
[31m-å¯ä»¥åœ¨å®¹å™¨ä¸­è¿›è¡Œå¸¸è§„çš„Linuxç³»ç»Ÿæ“ä½œå‘½ä»¤ï¼Œè¿˜å¯ä»¥ä½¿ç”¨exit[m
[31m-å‘½ä»¤é€€å‡ºç™»å½•ã€‚[m
[31m-[m
[31m-       docker exec -it container-id/container-name bash[m
[31m-[m
[31m-8.1.3ã€€ä¸‹è½½æœ¬ä¹¦æ‰€éœ€çš„Dockeré•œåƒ[m
[31m-[m
[31m-     æœ‰äº›éœ€è¦ä¸‹è½½çš„é•œåƒè¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæ‰€ä»¥åœ¨æ­¤å¤„å…ˆä¸‹è½½ä¸‹[m
[31m-æ¥ï¼Œä»¥å¤‡åé¢ä½¿ç”¨ã€‚[m
[31m-     Oracle xeã€MongoDBã€Redisã€å’ŒActiveMQRabbit MQä»¥åŠ[m
[31m-å¸¦æœ‰ç®¡ç†ç•Œé¢çš„RabbitMQçš„é•œåƒåˆ†åˆ«å¦‚ä¸‹ï¼šRabbitMQä»¥åŠå¸¦[m
[31m-æœ‰ç®¡ç†ç•Œé¢çš„RabbitMQï¼š[m
[31m-[m
[31m-       docker pull wnameless/oracle-xe-11g[m
[31m-       docker pull mongo[m
[31m-       docker pull redis:2.8.21[m
[31m-       docker pull cloudesire/activemq[m
[31m-       docker pull rabbitmq[m
[31m-       docker pull rabbitmq:3-management[m
[31m-[m
[31m-     ä¸‹è½½å®Œæˆåï¼ŒæŸ¥çœ‹Dockeré•œåƒåˆ—è¡¨ï¼Œå¦‚8-13æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾8-13ã€€Dockeré•œåƒåˆ—è¡¨[m
[31m-[m
[31m-8.1.4ã€€å¼‚å¸¸å¤„ç†[m
[31m-[m
[31m-     è‹¥å‡ºç°å‘½ä»¤ä¸èƒ½æ‰§è¡Œçš„é”™è¯¯ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤ç™»å½•[m
[31m-VirtualBoxè™šæ‹Ÿæœºæ‰§è¡Œå‘½ä»¤ï¼š[m
[31m-[m
[31m-       boot2docker ssh[m
[31m-[m
[31m-     åœ¨ç™»å½•è™šæ‹Ÿæœºåï¼Œå†æ‰§è¡Œå¸¸è§„å‘½ä»¤ï¼Œå¦‚å›¾8-14æ‰€ç¤ºã€‚[m
[31m-å›¾8-14ã€€ç™»å½•è™šæ‹Ÿæœº[m
[31m-8.2ã€€Spring Data JPA[m
[31m-[m
[31m-8.2.1ã€€ç‚¹ç›Spring Data JPA[m
[31m-[m
[31m-     1.ä»€ä¹ˆæ˜¯Spring Data JPA[m
[31m-[m
[31m-     åœ¨ä»‹ç»Spring Data JPAçš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆè®¤è¯†ä¸‹[m
[31m-Hibernateã€‚Hibernateæ˜¯æ•°æ®è®¿é—®è§£å†³æŠ€æœ¯çš„ç»å¯¹éœ¸ä¸»ï¼Œä½¿ç”¨[m
[31m-O/Ræ˜ å°„ï¼ˆObject-Relational Mappingï¼‰æŠ€æœ¯å®ç°æ•°æ®è®¿é—®ï¼Œ[m
[31m-O/Ræ˜ å°„å³å°†é¢†åŸŸæ¨¡å‹ç±»å’Œæ•°æ®åº“çš„è¡¨è¿›è¡Œæ˜ å°„ï¼Œé€šè¿‡ç¨‹åºæ“[m
[31m-ä½œå¯¹è±¡è€Œå®ç°è¡¨æ•°æ®æ“ä½œçš„èƒ½åŠ›ï¼Œè®©æ•°æ®è®¿é—®æ“ä½œæ— é¡»å…³æ³¨æ•°[m
[31m-æ®åº“ç›¸å…³çš„æŠ€æœ¯ã€‚[m
[31m-[m
[31m-     éšç€Hibernateçš„ç››è¡Œï¼ŒHibernateä¸»å¯¼äº†EJB 3.0çš„JPAè§„[m
[31m-èŒƒï¼ŒJPAå³Java Persistence APIã€‚JPAæ˜¯ä¸€ä¸ªåŸºäºO/Ræ˜ å°„çš„æ ‡[m
[31m-å‡†è§„èŒƒï¼ˆç›®å‰æœ€æ–°ç‰ˆæœ¬æ˜¯JPA 2.1ï¼‰ã€‚æ‰€è°“è§„èŒƒå³åªå®šä¹‰æ ‡å‡†[m
[31m-è§„åˆ™ï¼ˆå¦‚æ³¨è§£ã€æ¥å£ï¼‰ï¼Œä¸æä¾›å®ç°ï¼Œè½¯ä»¶æä¾›å•†å¯ä»¥æŒ‰ç…§æ ‡[m
[31m-å‡†è§„èŒƒæ¥å®ç°ï¼Œè€Œä½¿ç”¨è€…åªéœ€æŒ‰ç…§è§„èŒƒä¸­å®šä¹‰çš„æ–¹å¼æ¥ä½¿ç”¨ï¼Œ[m
[31m-è€Œä¸ç”¨å’Œè½¯ä»¶æä¾›å•†çš„å®ç°æ‰“äº¤é“ã€‚JPAçš„ä¸»è¦å®ç°ç”±[m
[31m-Hibernateã€EclipseLinkå’ŒOpenJPAç­‰ï¼Œè¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬åªè¦ä½¿[m
[31m-ç”¨JPAæ¥å¼€å‘ï¼Œæ— è®ºæ˜¯å“ªä¸€ä¸ªå¼€å‘æ–¹å¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚[m
[31m-[m
[31m-     Spring Data JPAæ˜¯Spring Dataçš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œå®ƒé€šè¿‡æä¾›[m
[31m-åŸºäºJPAçš„Repositoryæå¤§åœ°å‡å°‘äº†JPAä½œä¸ºæ•°æ®è®¿é—®æ–¹æ¡ˆçš„ä»£[m
[31m-ç é‡ã€‚[m
[31m-[m
[31m-     2.å®šä¹‰æ•°æ®è®¿é—®å±‚[m
[31m-[m
[31m-     ä½¿ç”¨Spring Data JPAå»ºç«‹æ•°æ®è®¿é—®å±‚ååˆ†ç®€å•ï¼Œåªéœ€å®šä¹‰[m
[31m-ä¸€ä¸ªç»§æ‰¿JpaRepositoryçš„æ¥å£å³å¯ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-              //å®šä¹‰æ•°æ®è®¿é—®æ“ä½œçš„æ–¹æ³•[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ç»§æ‰¿JpaRepositoryæ¥å£æ„å‘³ç€æˆ‘ä»¬é»˜è®¤å·²ç»æœ‰äº†ä¸‹é¢çš„æ•°[m
[31m-æ®è®¿é—®æ“ä½œæ–¹æ³•ï¼š[m
[31m-[m
[31m-       @NoRepositoryBean[m
[31m-       public interface JpaRepository<T, ID extends Serializable> extends Pagi[m
[31m-[m
[31m-              List<T> findAll();[m
[31m-              List<T> findAll(Sort sort);[m
[31m-              List<T> findAll(Iterable<ID> ids);[m
[31m-              <S extends T> List<S> save(Iterable<S> entities);[m
[31m-              void flush();[m
[31m-              <S extends T> S saveAndFlush(S entity);[m
[31m-              void deleteInBatch(Iterable<T> entities);[m
[31m-              void deleteAllInBatch();[m
[31m-              T getOne(ID id);[m
[31m-       }[m
[31m-[m
[31m-     3.é…ç½®ä½¿ç”¨Spring Data JPA[m
[31m-[m
[31m-     åœ¨Springç¯å¢ƒä¸­ï¼Œä½¿ç”¨Spring Data JPAå¯é€šè¿‡[m
[31m-@EnableJpaRepositoriesæ³¨è§£æ¥å¼€å¯Spring Data JPAçš„æ”¯æŒï¼Œ[m
[31m-@EnableJpaRepositoriesæ¥æ”¶çš„valueå‚æ•°ç”¨æ¥æ‰«ææ•°æ®è®¿é—®å±‚[m
[31m-æ‰€åœ¨åŒ…ä¸‹çš„æ•°æ®è®¿é—®çš„æ¥å£å®šä¹‰ã€‚[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableJpaRepositories("com.wisely.repos")[m
[31m-       public class JpaConfiguration {[m
[31m-[m
[31m-              @Bean[m
[31m-              public EntityManagerFactory entityManagerFactory() {[m
[31m-[m
[31m-                      //...[m
[31m-              }[m
[31m-                  //è¿˜éœ€é…ç½®DataSourceã€PlatformTransactionManagerç­‰ç›¸å…³å¿…é¡»[m
[31m-[m
[31m-       bean[m
[31m-       }[m
[31m-[m
[31m-     4.å®šä¹‰æŸ¥è¯¢æ–¹æ³•[m
[31m-[m
[31m-     åœ¨è®²è§£æŸ¥è¯¢æ–¹æ³•å‰ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€å¼ æ•°æ®è¡¨å«PERSONï¼Œ[m
[31m-æœ‰IDï¼ˆNumberï¼‰ã€NAMEï¼ˆVarchar2ï¼‰ã€AGEï¼ˆNumberï¼‰ã€[m
[31m-ADDRESSï¼ˆVarchar2ï¼‰å‡ ä¸ªå­—æ®µï¼›å¯¹åº”çš„å®ä½“ç±»å«Personï¼Œåˆ†[m
[31m-åˆ«æœ‰idï¼ˆLongï¼‰ã€nameï¼ˆStringï¼‰ã€ageï¼ˆIntegerï¼‰ã€[m
[31m-addressï¼ˆStringï¼‰ã€‚ä¸‹é¢æˆ‘ä»¬å°±ä»¥è¿™ä¸ªç®€å•çš„å®ä½“æŸ¥è¯¢ä½œä¸ºæ¼”[m
[31m-ç¤ºã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ ¹æ®å±æ€§åæŸ¥è¯¢[m
[31m-[m
[31m-     Spring Data JPAæ”¯æŒé€šè¿‡å®šä¹‰åœ¨Repositoryæ¥å£ä¸­çš„æ–¹æ³•å[m
[31m-æ¥å®šä¹‰æŸ¥è¯¢ï¼Œè€Œæ–¹æ³•åæ˜¯æ ¹æ®å®ä½“ç±»çš„å±æ€§åæ¥ç¡®å®šçš„ã€‚[m
[31m-[m
[31m-     1ï¼‰å¸¸è§„æŸ¥è¯¢ã€‚æ ¹æ®å±æ€§åæ¥å®šä¹‰æŸ¥è¯¢æ–¹æ³•ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-              /**[m
[31m-                *[m
[31m-                * é€šè¿‡åå­—ç›¸ç­‰æŸ¥è¯¢ï¼Œå‚æ•°ä¸ºname[m
[31m-                * ç›¸å½“äºJPQL:select p from Person p where p.name=?1[m
[31m-                */[m
[31m-              List<Person> findByName(String name);[m
[31m-              /**[m
[31m-                *[m
[31m-                * é€šè¿‡åå­—likeæŸ¥è¯¢ï¼Œå‚æ•°ä¸ºname[m
[31m-                 * ç›¸å½“äºJPQLï¼šselect p from Person p where p.name like ?[m
[31m-[m
[31m-       1[m
[31m-                */[m
[31m-[m
[31m-              List<Person> findByNameLike(String name);[m
[31m-              /**[m
[31m-[m
[31m-                *[m
[31m-                * é€šè¿‡åå­—å’Œåœ°å€æŸ¥è¯¢,å‚æ•°ä¸ºnameå’Œaddress[m
[31m-                     * ç›¸å½“äºJPQLï¼šselect p from Person p where p.name=?[m
[31m-       1 and p.address=?2[m
[31m-[m
[31m-                */[m
[31m-              List<Person> findByNameAndAddress(String name,String address);[m
[31m-       }[m
[31m-[m
[31m-     ä»ä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™é‡Œä½¿ç”¨äº†findByã€Likeã€Andè¿™æ ·çš„å…³[m
[31m-é”®å­—ã€‚å…¶ä¸­findByå¯ä»¥ç”¨findã€readã€readByã€queryã€[m
[31m-queryByã€getã€getByæ¥ä»£æ›¿ã€‚[m
[31m-[m
[31m-     è€ŒLikeå’Œandè¿™ç±»æŸ¥è¯¢å…³é”®å­—ï¼Œå¦‚è¡¨8-2æ‰€ç¤ºï¼š[m
[31m-[m
[31m-                                  è¡¨8-2ã€€æŸ¥è¯¢å…³é”®å­—[m
[31m-[m
[31m-     2ï¼‰é™åˆ¶ç»“æœæ•°é‡ã€‚ç»“æœæ•°é‡æ˜¯ç”¨topå’Œfirstå…³é”®å­—æ¥å®ç°[m
[31m-çš„ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-              /**[m
[31m-                *[m
[31m-                * è·å¾—ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„å‰10æ¡æ•°æ®[m
[31m-                *[m
[31m-                */[m
[31m-[m
[31m-              List<Person> findFirst10ByName(String name);[m
[31m-[m
[31m-              /**[m
[31m-                *[m
[31m-                * è·å¾—ç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„å‰30æ¡æ•°æ®[m
[31m-                *[m
[31m-                */[m
[31m-[m
[31m-              List<Person> findTop30ByName(String name);[m
[31m-       }[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰ä½¿ç”¨JPAçš„NamedQueryæŸ¥è¯¢[m
[31m-[m
[31m-     Spring Data JPAæ”¯æŒç”¨JPAçš„NameQueryæ¥å®šä¹‰æŸ¥è¯¢æ–¹æ³•ï¼Œ[m
[31m-å³ä¸€ä¸ªåç§°æ˜ å°„ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚å®šä¹‰å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       @Entity[m
[31m-       @NamedQuery(name = "Person.findByName",[m
[31m-[m
[31m-              query = "select p from Person p where p.name=?1")[m
[31m-       public class Person {[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼š[m
[31m-[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-              /**[m
[31m-                *[m
[31m-                 * è¿™æ—¶æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯NamedQueryé‡Œå®šä¹‰çš„æŸ¥è¯¢è¯­å¥ï¼Œè€Œä¸æ˜¯æ ¹æ®æ–¹æ³•åç§°[m
[31m-[m
[31m-       æŸ¥è¯¢[m
[31m-                *[m
[31m-                */[m
[31m-[m
[31m-              List<Person> findByName(String name);[m
[31m-       }[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰ä½¿ç”¨@QueryæŸ¥è¯¢[m
[31m-     1ï¼‰ä½¿ç”¨å‚æ•°ç´¢å¼•ã€‚Spring Data JPAè¿˜æ”¯æŒç”¨@Queryæ³¨è§£[m
[31m-åœ¨æ¥å£çš„æ–¹æ³•ä¸Šå®ç°æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-              @Query("select p from Person p where p.address=?1")[m
[31m-              List<Person> findByAddress(String address);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     2ï¼‰ä½¿ç”¨å‘½åå‚æ•°ã€‚ä¸Šé¢çš„ä¾‹å­æ˜¯ä½¿ç”¨å‚æ•°çš„ç´¢å¼•å·æ¥æŸ¥[m
[31m-è¯¢çš„ï¼Œåœ¨Spring Data JPAé‡Œè¿˜æ”¯æŒåœ¨è¯­å¥é‡Œç”¨åç§°æ¥åŒ¹é…æŸ¥è¯¢[m
[31m-å‚æ•°ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-              @Query("select p from Person p where p.address= :address")[m
[31m-              List<Person> findByAddress(@Param("address") String address);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     3ï¼‰æ›´æ–°æŸ¥è¯¢ã€‚Spring Data JPAæ”¯æŒ@Modifyingå’Œ@Query[m
[31m-æ³¨è§£ç»„åˆæ¥äº‹ä»¶æ›´æ–°æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-              @Modifying[m
[31m-[m
[31m-       @Transactional[m
[31m-              @Query("update Person p set p.name=?1")[m
[31m-              int setName(String name);[m
[31m-[m
[31m-       }[m
[31m-     å…¶ä¸­è¿”å›å€¼intè¡¨ç¤ºæ›´æ–°è¯­å¥å½±å“çš„è¡Œæ•°ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰Specification[m
[31m-[m
[31m-     JPAæä¾›äº†åŸºäºå‡†åˆ™æŸ¥è¯¢çš„æ–¹å¼ï¼Œå³CriteriaæŸ¥è¯¢ã€‚è€ŒSpring[m
[31m-Data JPAæä¾›äº†ä¸€ä¸ªSpecificationï¼ˆè§„èŒƒï¼‰æ¥å£è®©æˆ‘ä»¬å¯ä»¥æ›´æ–¹[m
[31m-ä¾¿åœ°æ„é€ å‡†åˆ™æŸ¥è¯¢ï¼ŒSpecificationæ¥å£å®šä¹‰äº†ä¸€ä¸ªtoPredicateæ–¹[m
[31m-æ³•ç”¨æ¥æ„é€ æŸ¥è¯¢æ¡ä»¶ã€‚[m
[31m-[m
[31m-     1ï¼‰å®šä¹‰ã€‚æˆ‘ä»¬çš„æ¥å£ç±»å¿…éœ€å®ç°JpaSpecificationExecutor[m
[31m-æ¥å£ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long>,[m
[31m-                                                                                       JpaSpecificationExecutor<Pe[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ç„¶åéœ€è¦å®šä¹‰CriterialæŸ¥è¯¢ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       import javax.persistence.criteria.CriteriaBuilder;[m
[31m-       import javax.persistence.criteria.CriteriaQuery;[m
[31m-       import javax.persistence.criteria.Predicate;[m
[31m-       import javax.persistence.criteria.Root;[m
[31m-[m
[31m-       import org.springframework.data.jpa.domain.Specification;[m
[31m-[m
[31m-       import com.wisely.domain.Person;[m
[31m-[m
[31m-       public class CustomerSpecs {[m
[31m-[m
[31m-              public static Specification<Person> personFromHefei() {[m
[31m-                      return new Specification<Person>() {[m
[31m-[m
[31m-                             @Override[m
[31m-                             public Predicate toPredicate(Root<Person> root, CriteriaQue[m
[31m-       > query, CriteriaBuilder cb) {[m
[31m-[m
[31m-                                            return cb.equal(root.get("address"), "åˆ[m
[31m-è‚¥");             }[m
[31m-          };[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-     æˆ‘ä»¬ä½¿ç”¨Rootæ¥è·å¾—éœ€è¦æŸ¥è¯¢çš„å±æ€§ï¼Œé€šè¿‡CriteriaBuilder[m
[31m-æ„é€ æŸ¥è¯¢æ¡ä»¶ï¼Œæœ¬ä¾‹çš„å«ä¹‰æ˜¯æŸ¥å‡ºæ‰€æœ‰æ¥è‡ªåˆè‚¥çš„äººã€‚[m
[31m-[m
[31m-     æ³¨æ„ï¼šCriteriaBuilderã€CriteriaQueryã€Predicateã€Rootéƒ½æ˜¯[m
[31m-æ¥è‡ªJPAçš„æ¥å£ã€‚[m
[31m-[m
[31m-     CriteriaBuilderåŒ…å«çš„æ¡ä»¶æ„é€ æœ‰ï¼šexistsã€andã€orã€notã€[m
[31m-conjunctionã€disjunctionã€isTrueã€isFalseã€isNullã€isNotNullã€[m
[31m-equalã€notEqualã€greaterThanã€greaterThanOrEqualToã€[m
[31m-lessThanã€lessThanOrEqualToã€betweenç­‰ï¼Œè¯¦ç»†è¯·æŸ¥çœ‹[m
[31m-CriteriaBuilderçš„APIã€‚[m
[31m-[m
[31m-     2ï¼‰ä½¿ç”¨ã€‚é™æ€å¯¼å…¥ï¼š[m
[31m-[m
[31m-       import static com.wisely.specs.CustomerSpecs.*;[m
[31m-[m
[31m-æ³¨å…¥personRepositoryçš„Beanåï¼š[m
[31m-[m
[31m-List<Person> people = personRepository.findAll(personFromHefei());[m
[31m-[m
[31m-ï¼ˆ5ï¼‰æ’åºä¸åˆ†é¡µ[m
[31m-Spring Data JPAå……åˆ†è€ƒè™‘äº†åœ¨å®é™…å¼€å‘ä¸­æ‰€å¿…éœ€çš„æ’åºå’Œ[m
[31m-åˆ†é¡µçš„åœºæ™¯ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†Sortç±»ä»¥åŠPageæ¥å£å’ŒPageableæ¥[m
[31m-å£ã€‚[m
[31m-[m
[31m-     1ï¼‰å®šä¹‰ï¼š[m
[31m-[m
[31m-       package com.wisely.repos;[m
[31m-       import java.util.List;[m
[31m-       import org.springframework.data.domain.Page;[m
[31m-       import org.springframework.data.domain.Pageable;[m
[31m-       import org.springframework.data.domain.Sort;[m
[31m-       import org.springframework.data.jpa.repository.JpaRepository;[m
[31m-       import org.springframework.data.jpa.repository.Modifying;[m
[31m-       import org.springframework.data.jpa.repository.Query;[m
[31m-       import org.springframework.data.repository.query.Param;[m
[31m-       import com.wisely.domain.Person;[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-[m
[31m-              List<Person> findByName(String name,Sort sort);[m
[31m-              Page<Person> findByName(String name,Pageable pageable);[m
[31m-       }[m
[31m-[m
[31m-     2ï¼‰ä½¿ç”¨æ’åºï¼š[m
[31m-[m
[31m-       List<Person> people = personRepository.findByName("xx", new Sort(Direct[m
[31m-[m
[31m-     3ï¼‰ä½¿ç”¨åˆ†é¡µï¼š[m
[31m-[m
[31m-       Page<Person> people2 = personRepository.findByName("xx", new PageReques[m
[31m-[m
[31m-     å…¶ä¸­Pageæ¥å£å¯ä»¥è·å¾—å½“å‰é¡µé¢çš„è®°å½•ã€æ€»é¡µæ•°ã€æ€»è®°å½•[m
[31m-æ•°ã€æ˜¯å¦æœ‰ä¸Šä¸€é¡µæˆ–ä¸‹ä¸€é¡µç­‰ã€‚[m
[31m-[m
[31m-5.è‡ªå®šä¹‰Repositoryçš„å®ç°[m
[31m-[m
[31m-Spring              Dataæä¾›äº†å’ŒCrudRepositoryã€[m
[31m-[m
[31m-PagingAndSortingRepositoryï¼›Spring Data JPAä¹Ÿæä¾›äº†[m
[31m-[m
[31m-JpaRepositoryã€‚å¦‚æœæˆ‘ä»¬æƒ³æŠŠè‡ªå·±å¸¸ç”¨çš„æ•°æ®åº“æ“ä½œå°è£…èµ·[m
[31m-[m
[31m-æ¥ï¼ŒåƒJpaRepositoryä¸€æ ·æä¾›ç»™æˆ‘ä»¬é¢†åŸŸç±»çš„Repositoryæ¥å£ä½¿[m
[31m-[m
[31m-ç”¨ï¼Œåº”è¯¥æ€ä¹ˆæ“åšå‘¢ï¼Ÿ[m
[31m-[m
[31m-ï¼ˆ1ï¼‰å®šä¹‰è‡ªå®šä¹‰Repositoryæ¥å£ï¼š[m
[31m-[m
[31m-@NoRepositoryBean//1[m
[31m-public interface CustomRepository<T, ID extends Serializable>extends Pa[m
[31m-[m
[31m-       public void doSomething(ID id);//3[m
[31m-[m
[31m-}[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ @NoRepositoryBeanæŒ‡æ˜å½“å‰è¿™ä¸ªæ¥å£ä¸æ˜¯æˆ‘ä»¬é¢†åŸŸç±»[m
[31m-çš„æ¥å£ï¼ˆå¦‚PersonRepositoryã€‚[m
[31m-[m
[31m-     â‘¡æˆ‘ä»¬è‡ªå®šä¹‰çš„Repositoryå®ç°PagingAndSortingRepository[m
[31m-æ¥å£ï¼Œå…·å¤‡åˆ†é¡µå’Œæ’åºçš„èƒ½åŠ›ã€‚[m
[31m-[m
[31m-     â‘¢è¦å®šä¹‰çš„æ•°æ®æ“ä½œæ–¹æ³•åœ¨æ¥å£ä¸­çš„å®šä¹‰ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰å®šä¹‰æ¥å£å®ç°ï¼š[m
[31m-[m
[31m-       public class CustomRepositoryImpl <T, ID extends Serializable>[m
[31m-                                           extends SimpleJpaRepository<T, ID> implements Cust[m
[31m-              private final EntityManager entityManager;//2[m
[31m-[m
[31m-              public CustomRepositoryImpl(Class<T> domainClass, EntityManager ent[m
[31m-                      super(domainClass, entityManager);[m
[31m-                      this.entityManager = entityManager;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public void doSomething(ID id) {[m
[31m-[m
[31m-                      // 4[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é¦–å…ˆè¦å®ç°CustomRepositoryæ¥å£ï¼Œç»§æ‰¿[m
[31m-SimpleJpaRepositoryç±»è®©æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶æä¾›çš„æ–¹æ³•ï¼ˆå¦‚[m
[31m-findAllï¼‰ã€‚[m
[31m-[m
[31m-     â‘¡è®©æ•°æ®æ“ä½œæ–¹æ³•ä¸­å¯ä»¥ä½¿ç”¨entityManagerã€‚[m
[31m-[m
[31m-     â‘¢CustomRepositoryImplçš„æ„é€ å‡½æ•°ï¼Œéœ€å½“å‰å¤„ç†çš„é¢†åŸŸç±»[m
[31m-ç±»å‹å’ŒentityManagerä½œä¸ºæ„é€ å‚æ•°ï¼Œåœ¨è¿™é‡Œä¹Ÿç»™æˆ‘ä»¬çš„[m
[31m-entityManagerèµ‹å€¼äº†ã€‚[m
[31m-[m
[31m-     â‘£åœ¨æ­¤å¤„å®šä¹‰æ•°æ®è®¿é—®æ“ä½œï¼Œå¦‚è°ƒç”¨findAllæ–¹æ³•å¹¶æ„é€ ä¸€[m
[31m-äº›æŸ¥è¯¢æ¡ä»¶ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰è‡ªå®šä¹‰RepositoryFactoryBeanã€‚è‡ªå®šä¹‰[m
[31m-JpaRepositoryFactoryBeanæ›¿ä»£é»˜è®¤RepositoryFactoryBeanï¼Œæˆ‘[m
[31m-ä»¬ä¼šè·å¾—ä¸€ä¸ªRepositoryFactoryï¼ŒRepositoryFactoryå°†ä¼šæ³¨å†Œæˆ‘[m
[31m-ä»¬è‡ªå®šä¹‰çš„Repositoryçš„å®ç°ï¼š[m
[31m-[m
[31m-       public class CustomRepositoryFactoryBean<T extends JpaRepository<S, ID>[m
[31m-          extends JpaRepositoryFactoryBean<T, S, ID> {// 1[m
[31m-[m
[31m-   @Override[m
[31m-   protected RepositoryFactorySupport createRepositoryFactory(EntityMa[m
[31m-[m
[31m-          return new CustomRepositoryFactory(entityManager);[m
[31m-   }[m
[31m-[m
[31m-   private static class CustomRepositoryFactory extends JpaRepositoryF[m
[31m-[m
[31m-      public CustomRepositoryFactory(EntityManager entityManager) {[m
[31m-             super(entityManager);[m
[31m-[m
[31m-      }[m
[31m-[m
[31m-              @Override[m
[31m-              @SuppressWarnings({"unchecked"})[m
[31m-              protected <T, ID extends Serializable> SimpleJpaRepository<?, ?[m
[31m-> getTargetRepository([m
[31m-[m
[31m-                             RepositoryInformation information, EntityManager entity[m
[31m-                                     return new CustomRepositoryImpl<T, ID>[m
[31m-[m
[31m-((Class<T>) information.getDomainType(), entityManager);[m
[31m-[m
[31m-      }[m
[31m-[m
[31m-      @Override[m
[31m-[m
[31m-                 protected                   Class<?[m
[31m-[m
[31m-> getRepositoryBaseClass(RepositoryMetadata metadata) {// 5[m
[31m-[m
[31m-         return CustomRepositoryImpl.class;[m
[31m-[m
[31m-      }[m
[31m-[m
[31m-   }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ è‡ªå®šä¹‰RepositoryFactoryBeanï¼Œç»§æ‰¿[m
[31m-JpaRepositoryFactoryBeanã€‚[m
[31m-[m
[31m-     â‘¡é‡å†™createRepositoryFactoryæ–¹æ³•ï¼Œç”¨å½“å‰çš„[m
[31m-CustomRepositoryFactoryåˆ›å»ºå®ä¾‹ã€‚[m
[31m-[m
[31m-     â‘¢åˆ›å»ºCustomRepositoryFactoryï¼Œå¹¶ç»§æ‰¿[m
[31m-JpaRepositoryFactoryã€‚[m
[31m-[m
[31m-     â‘£é‡å†™getTargetRepositoryæ–¹æ³•ï¼Œè·å¾—å½“å‰è‡ªå®šä¹‰çš„[m
[31m-Repositoryå®ç°ã€‚[m
[31m-[m
[31m-     â‘¤é‡å†™getRepositoryBaseClassï¼Œè·å¾—å½“å‰è‡ªå®šä¹‰çš„[m
[31m-Repositoryå®ç°çš„ç±»å‹ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰å¼€å¯è‡ªå®šä¹‰æ”¯æŒä½¿ç”¨@EnableJpaRepositoriesçš„[m
[31m-repositoryFactoryBeanClassæ¥æŒ‡å®šFactoryBeanå³å¯ï¼Œä»£ç å¦‚[m
[31m-ä¸‹ï¼š[m
[31m-[m
[31m-       @EnableJpaRepositories(repositoryFactoryBeanClass= CustomRepositoryFact[m
[31m-[m
[31m-8.2.2ã€€Spring Bootçš„æ”¯æŒ[m
[31m-[m
[31m-1.JDBCçš„è‡ªåŠ¨é…ç½®[m
[31m-[m
[31m-spring-boot-starter-data-jpaä¾èµ–äºspring-boot-starter-jdbcï¼Œ[m
[31m-[m
[31m-è€ŒSpring  Bootå¯¹JDBCåšäº†ä¸€äº›è‡ªåŠ¨é…ç½®ã€‚æºç æ”¾ç½®åœ¨[m
[31m-[m
[31m-org.springframework.boot.autoconfigure.jdbcä¸‹ï¼Œå¦‚å›¾8-15æ‰€ç¤ºã€‚[m
[31m-        å›¾8-15ã€€JDBCæºç ä½ç½®[m
[31m-[m
[31m-     ä»æºç åˆ†æå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬é€šè¿‡â€œspring.datasoureâ€ä¸ºå‰ç¼€[m
[31m-çš„å±æ€§è‡ªåŠ¨é…ç½®dataSourceï¼›Spring Bootè‡ªåŠ¨å¼€å¯äº†æ³¨è§£äº‹åŠ¡[m
[31m-çš„æ”¯æŒï¼ˆ@EnableTransactionManagementï¼‰ï¼›è¿˜é…ç½®äº†ä¸€ä¸ª[m
[31m-jdbcTemplateã€‚[m
[31m-[m
[31m-     Spring Bootè¿˜æä¾›äº†ä¸€ä¸ªåˆå§‹åŒ–æ•°æ®çš„åŠŸèƒ½ï¼šæ”¾ç½®åœ¨ç±»è·¯[m
[31m-å¾„ä¸‹çš„schema.sqlæ–‡ä»¶ä¼šè‡ªåŠ¨ç”¨æ¥åˆå§‹åŒ–è¡¨ç»“æ„ï¼›æ”¾ç½®åœ¨ç±»è·¯[m
[31m-å¾„ä¸‹çš„data.sqlæ–‡ä»¶ä¼šè‡ªåŠ¨ç”¨æ¥å¡«å……è¡¨æ•°æ®ã€‚[m
[31m-[m
[31m-2.å¯¹JPAçš„è‡ªåŠ¨é…ç½®[m
[31m-[m
[31m-Spring       Bootå¯¹JPAçš„è‡ªåŠ¨é…ç½®æ”¾ç½®åœ¨[m
[31m-[m
[31m-org.springframework.boot.autoconfigure.orm.jpaä¸‹ï¼Œå¦‚å›¾8-16æ‰€[m
[31m-[m
[31m-ç¤ºã€‚[m
[31m-           å›¾8-16ã€€JPAçš„æºç ä½ç½®[m
[31m-[m
[31m-     ä»HibernateJpaAutoConfigurationå¯ä»¥çœ‹å‡ºï¼ŒSpring Booté»˜[m
[31m-è®¤JPAçš„å®ç°è€…æ˜¯Hibernateï¼›HibernateJpaAutoConfigurationä¾[m
[31m-èµ–äºDataSourceAutoConfigurationã€‚[m
[31m-[m
[31m-     ä»JpaPropertiesçš„æºç å¯ä»¥çœ‹å‡ºï¼Œé…ç½®JPAå¯ä»¥ä½¿ç”¨[m
[31m-spring.jpaä¸ºå‰ç¼€çš„å±æ€§åœ¨application.propertiesä¸­é…ç½®ã€‚[m
[31m-[m
[31m-     ä»JpaBaseConfigurationçš„æºç ä¸­å¯ä»¥çœ‹å‡ºï¼ŒSpring Bootä¸º[m
[31m-æˆ‘ä»¬é…ç½®äº†transactionManagerã€jpaVendorAdapterã€[m
[31m-entityManagerFactoryç­‰Beanã€‚JpaBaseConfigurationè¿˜æœ‰ä¸€ä¸ª[m
[31m-getPackagesToScanæ–¹æ³•ï¼Œå¯ä»¥è‡ªåŠ¨æ‰«ææ³¨è§£æœ‰@Entityçš„å®ä½“[m
[31m-ç±»ã€‚[m
[31m-[m
[31m-åœ¨Webé¡¹ç›®ä¸­æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°åœ¨æ§åˆ¶å™¨æˆ–è€…é¡µé¢è®¿é—®æ•°æ®[m
[31m-[m
[31m-çš„æ—¶å€™å‡ºç°ä¼šè¯è¿æ¥å·²å…³é—­çš„é”™è¯¯ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¼šé…ç½®ä¸€ä¸ª[m
[31m-[m
[31m-Open EntityManagerï¼ˆSessionï¼‰In Viewè¿™ä¸ªè¿‡æ»¤å™¨ã€‚ä»¤äººæƒŠå–œ[m
[31m-[m
[31m-çš„æ˜¯ï¼ŒSpring                Bootä¸ºæˆ‘ä»¬è‡ªåŠ¨é…ç½®äº†[m
[31m-[m
[31m-OpenEntityManagerInViewInterceptorè¿™ä¸ªBeanï¼Œå¹¶æ³¨å†Œåˆ°[m
[31m-[m
[31m-Spring MVCçš„æ‹¦æˆªå™¨ä¸­ã€‚[m
[31m-[m
[31m-3.å¯¹Spring Data JPAçš„è‡ªåŠ¨é…ç½®[m
[31m-[m
[31m-     è€ŒSpring Bootå¯¹Spring Data JPAçš„è‡ªåŠ¨é…ç½®æ”¾ç½®åœ¨[m
[31m-org.springframework.boot.autoconfigure.data.jpaä¸‹ï¼Œå¦‚å›¾8-17æ‰€[m
[31m-ç¤ºã€‚[m
[31m-[m
[31m-                       å›¾8-17ã€€Spring Data JPAçš„è‡ªåŠ¨é…ç½®[m
[31m-[m
[31m-     ä»JpaRepositoriesAutoConfigurationå’Œ[m
[31m-JpaRepositoriesAutoConfigureRegistraræºç å¯ä»¥çœ‹å‡ºï¼Œ[m
[31m-JpaRepositoriesAutoConfigurationæ˜¯ä¾èµ–äº[m
[31m-HibernateJpaAutoConfigurationé…ç½®çš„ï¼Œä¸”Spring Bootè‡ªåŠ¨å¼€å¯[m
[31m-äº†å¯¹Spring Data JPAçš„æ”¯æŒï¼Œå³æˆ‘ä»¬æ— é¡»åœ¨é…ç½®ç±»æ˜¾ç¤ºå£°æ˜[m
[31m-@EnableJpaRepositoriesã€‚[m
[31m-[m
[31m-     4.Spring Bootä¸‹çš„Spring Data JPA[m
[31m-     é€šè¿‡ä¸Šé¢çš„åˆ†æå¯çŸ¥ï¼Œæˆ‘ä»¬åœ¨Spring Bootä¸‹ä½¿ç”¨Spring[m
[31m-Data JPAï¼Œåœ¨é¡¹ç›®çš„Mavenä¾èµ–é‡Œæ·»åŠ spring-boot-stater-data-[m
[31m-jpaï¼Œç„¶ååªéœ€å®šä¹‰DataSourceã€å®ä½“ç±»å’Œæ•°æ®è®¿é—®å±‚ï¼Œå¹¶åœ¨éœ€[m
[31m-è¦ä½¿ç”¨æ•°æ®è®¿é—®çš„åœ°æ–¹æ³¨å…¥æ•°æ®è®¿é—®å±‚çš„Beanå³å¯ï¼Œæ— é¡»ä»»ä½•[m
[31m-é¢å¤–é…ç½®ã€‚[m
[31m-[m
[31m-8.2.3ã€€å®æˆ˜[m
[31m-[m
[31m-     åœ¨æœ¬èŠ‚çš„å®æˆ˜é‡Œï¼Œæˆ‘ä»¬å°†æ¼”ç¤ºåŸºäºæ–¹æ³•åçš„æŸ¥è¯¢ã€åŸºäº[m
[31m-@Queryçš„æŸ¥è¯¢ã€åˆ†é¡µåŠæ’åºï¼Œæœ€åæˆ‘ä»¬å°†ç»“åˆSpecificationå’Œ[m
[31m-è‡ªå®šä¹‰Repositoryå®ç°æ¥å®Œæˆä¸€ä¸ªé€šç”¨å®ä½“æŸ¥è¯¢ï¼Œå³å¯¹äºä»»æ„[m
[31m-ç±»å‹çš„å®ä½“ç±»çš„ä¼ å€¼å¯¹è±¡ï¼Œåªè¦å¯¹è±¡æœ‰å€¼çš„å±æ€§æˆ‘ä»¬å°±è¿›è¡Œè‡ª[m
[31m-åŠ¨æ„é€ æŸ¥è¯¢ï¼ˆå­—ç¬¦å‹ç”¨likeï¼Œå…¶ä»–ç±»å‹ç”¨ç­‰äºï¼‰ã€‚è¿™é‡Œèµ·ä¸€ä¸ª[m
[31m-æŠ›ç –å¼•ç‰çš„åŠŸèƒ½ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥ç»§ç»­æ‰©å±•ï¼Œå¦‚æ„é€ èŒƒå›´æŸ¥[m
[31m-è¯¢åŠå…³è”è¡¨æŸ¥è¯¢ç­‰ã€‚[m
[31m-[m
[31m-1.å®‰è£…Oracle XE[m
[31m-[m
[31m-     å› å¤§éƒ¨åˆ†Javaç¨‹åºå‘˜åœ¨å®é™…å¼€å‘ä¸­ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯Oracleï¼Œ[m
[31m-æ‰€ä»¥æ­¤å¤„é€‰æ‹©ç”¨Oracle XEä½œä¸ºå¼€å‘æµ‹è¯•æ•°æ®åº“ã€‚[m
[31m-[m
[31m-     Oracle XEæ˜¯Oracleå…¬å¸æä¾›çš„å…è´¹å¼€å‘æµ‹è¯•ç”¨é€”çš„æ•°æ®[m
[31m-åº“ï¼Œå¯è‡ªç”±ä½¿ç”¨ï¼ŒåŠŸèƒ½å’Œä½¿ç”¨ä¸Oracleå®Œå…¨ä¸€è‡´ï¼Œä½†æ•°æ®å¤§å°[m
[31m-é™åˆ¶ä¸º4Gã€‚[m
[31m-[m
[31m-ï¼ˆ1ï¼‰éDockerå®‰è£…[m
[31m-[m
[31m-ä¸æ‰“ç®—ä½¿ç”¨Dockerå®‰è£…Oracle  XEçš„è¯»è€…è¯·è‡³[m
[31m-[m
[31m-http://www.oracle.com/technetwork/database/database-[m
[31m-technologies/express-edition/downloads/index.htmlä¸‹è½½Oracle XE[m
[31m-[m
[31m-å®‰è£…ã€‚[m
[31m-[m
[31m-ï¼ˆ2ï¼‰Dockerå®‰è£…[m
[31m-[m
[31m-     æˆ‘ä»¬åœ¨8.13èŠ‚å·²ç»ä¸‹è½½äº†Oracle XEçš„é•œåƒï¼Œç°åœ¨æˆ‘ä»¬è¿è¡Œ[m
[31m-å¯åŠ¨ä¸€ä¸ªOracle XEçš„å®¹å™¨ã€‚[m
[31m-[m
[31m-è¿è¡Œå‘½ä»¤ï¼š[m
[31m-[m
[31m-docker run -d -p 9090:8080 -p 1521:1521 wnameless/oracle-xe-[m
[31m-11g[m
[31m-[m
[31m-     å°†å®¹å™¨ä¸­çš„Oracle XEç®¡ç†ç•Œé¢çš„8080ç«¯å£æ˜ å°„ä¸ºæœ¬æœºçš„[m
[31m-9090ç«¯å£ï¼Œå°†Oracle XEçš„1521ç«¯å£æ˜ å°„ä¸ºæœ¬æœºçš„1521ç«¯å£ã€‚[m
[31m-[m
[31m-     æœ¬å®¹å™¨æä¾›å¦‚ä¸‹çš„å®‰è£…ä¿¡æ¯ï¼š[m
[31m-       hostname:localhost[m
[31m-       ç«¯å£:1521[m
[31m-       SID: XE[m
[31m-       username:system/sys[m
[31m-       password:oracle[m
[31m-[m
[31m-     ç®¡ç†ç•Œé¢è®¿é—®ï¼š[m
[31m-[m
[31m-       url:http://localhost:9090/apex[m
[31m-       workspace:internal[m
[31m-       username:admin[m
[31m-       password:oracle[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰ç«¯å£æ˜ å°„[m
[31m-[m
[31m-     æˆ‘ä»¬åœ¨8.1èŠ‚æ›¾ç»æåˆ°ï¼Œå®¹å™¨æš´éœ²çš„ç«¯å£åªæ˜¯æ˜ å°„åˆ°[m
[31m-VirtualBoxè™šæ‹Ÿæœºä¸Šï¼Œè€Œæœ¬æœºè¦è®¿é—®å®¹å™¨çš„è¯éœ€è¦æˆ‘ä»¬æŠŠ[m
[31m-VirtualBoxçš„è™šæ‹Ÿæœºçš„ç«¯å£æ˜ å°„åˆ°å½“å‰å¼€å‘æœºå™¨ä¸Šã€‚è¿™ç¡®å®æœ‰[m
[31m-ç‚¹éº»çƒ¦ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯åŸºäºLinuxéƒ¨ç½²Docker[m
[31m-çš„ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚[m
[31m-[m
[31m-     ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºå°†VirtualBoxè™šæ‹Ÿæœºçš„ç«¯å£æ˜ å°„åˆ°å½“å‰å¼€å‘[m
[31m-æœºå™¨ã€‚[m
[31m-[m
[31m-     æ‰“å¼€VirtualBoxè½¯ä»¶ï¼Œå¦‚å›¾8-18æ‰€ç¤ºã€‚[m
[31m-                            å›¾8-18ã€€æ‰“å¼€VirtualBoxè½¯ä»¶[m
[31m-[m
[31m-     é€‰ä¸­boot2docker-vmï¼Œå•å‡»â€œè®¾ç½®â€æŒ‰é’®ï¼Œæˆ–è€…å³å‡»ï¼Œåœ¨å³[m
[31m-é”®èœå•ä¸­é€‰ä¸­â€œè®¾ç½®â€ï¼Œæ‰“å¼€è™šæ‹Ÿæœºè®¾ç½®é¡µé¢ï¼Œå¦‚å›¾8-19æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                           å›¾8-19ã€€æ‰“å¼€è™šæ‹Ÿæœºè®¾ç½®é¡µé¢[m
[31m-[m
[31m-     å•å‡»â€œç½‘ç»œâ€ï¼Œé¡µé¢ä¸‹æ–¹å‡ºç°äº†â€œç«¯å£è½¬å‘â€æŒ‰é’®ï¼Œå¦‚å›¾8-20[m
[31m-æ‰€ç¤ºã€‚[m
[31m-                               å›¾8-20ã€€â€œç«¯å£è½¬å‘â€æŒ‰é’®[m
[31m-[m
[31m-     å•å‡»â€œç«¯å“è½¬å‘â€æŒ‰é’®ï¼Œå¼¹å‡ºâ€œç«¯å£è½¬å‘è§„åˆ™â€ç•Œé¢ï¼Œå°†æˆ‘ä»¬[m
[31m-åˆšæ‰æ›éœ²åˆ°è™šæ‹Ÿæœºçš„9090åŠ1521ç«¯å£æ˜ å°„ä¸ºå¼€å‘æœºçš„9090åŠ[m
[31m-1521ç«¯å£ï¼Œå¦‚å›¾8-21æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                    å›¾8-21ã€€å°†è™šæ‹Ÿæœºç«¯å£æ˜ å°„ä¸ºå¼€å‘æœºç«¯å£[m
[31m-[m
[31m-     åšäº†å¦‚ä¸Šè®¾ç½®åï¼Œæˆ‘ä»¬å³å¯é€šè¿‡æœ¬æœº9090åŠ1521ç«¯å£æ­£ç¡®[m
[31m-è®¿é—®Oracle XEå®¹å™¨é‡Œçš„ç«¯å£äº†ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰ç®¡ç†[m
[31m-     é€šè¿‡ä¸Šé¢çš„è®¾ç½®ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒæ“ä½œæ™®é€šçš„Oracleæ•°[m
[31m-æ®åº“ä¸€æ ·æ“ä½œOracle XEäº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—®XEçš„ç®¡ç†ç•Œ[m
[31m-é¢ï¼šhttp://localhostï¼š9090/apexç™»å½•ç®¡ç†æ•°æ®åº“ï¼›æˆ–è€…åœ¨å¼€å‘[m
[31m-æœºå™¨å®‰è£…Oracle Clientï¼Œç®¡ç†å¹¶å®‰è£…ä¸€ä¸ªæ•°æ®åº“ç®¡ç†å·¥å…·ï¼ˆå¦‚[m
[31m-PL/SQL Developerï¼‰æ¥ç®¡ç†æ•°æ®åº“ã€‚[m
[31m-[m
[31m-     åˆ©ç”¨æˆ‘ä»¬çš„ç®¡ç†å·¥å…·ï¼ˆå¦‚PL/SQL Developerï¼‰åˆ›å»ºä¸€ä¸ªç”¨[m
[31m-æˆ·ï¼Œä½œä¸ºæˆ‘ä»¬ç¨‹åºä½¿ç”¨çš„æ•°æ®åº“è´¦å·ï¼Œè´¦å·å¯†ç çš†ä¸ºbootã€‚[m
[31m-[m
[31m-     3.æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     æ­å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–é€‰æ‹©JPAï¼ˆspring-boot-starter-[m
[31m-data-jpaï¼‰å’ŒWebï¼ˆspring-boot-starter-webï¼‰ã€‚[m
[31m-[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-       groupIdï¼šcom.wisely[m
[31m-       arctifactId:ch8_2[m
[31m-       package: com.wisely.ch8_2[m
[31m-[m
[31m-     å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Oracle XEæ•°æ®åº“ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨Oracle[m
[31m-çš„JDBCé©±åŠ¨ï¼Œè€ŒMavenä¸­å¿ƒåº“æ²¡æœ‰Oracle JDBCçš„é©±åŠ¨ä¸‹è½½ï¼Œ[m
[31m-å› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡Mavenå‘½ä»¤ï¼Œè‡ªå·±æ‰“åŒ…Oracleçš„JDBCé©±åŠ¨åˆ°[m
[31m-æœ¬åœ°åº“ã€‚[m
[31m-[m
[31m-     åœ¨Oracleå®˜ç½‘ä¸‹è½½[m
[31m-ojdbc6.jarï¼ˆhttp://www.oracle.com/technetwork/database/enterprise-[m
[31m-edition/jdbc-112010-090769.htmlï¼‰ï¼Œå½“ç„¶ä¸€èˆ¬æˆ‘ä»¬éƒ½æœ‰è¿™ä¸ªjar[m
[31m-åŒ…ã€‚[m
[31m-[m
[31m-     é€šè¿‡åœ¨æ§åˆ¶å°æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œå°†ojdbc6.jarå®‰è£…åˆ°æœ¬åœ°åº“ï¼š[m
[31m-mvn install:install-file -DgroupId=com.oracle  "-[m
[31m-                                               "-[m
[31m-DartifactId=ojdbc6"  "-Dversion=11.2.0.2.0"[m
[31m-[m
[31m-Dpackaging=jar" "-Dfile=E:\ojdbc6.jar"[m
[31m-[m
[31m-     è¯´æ˜ï¼š[m
[31m-[m
[31m-     -DgroupId=com.oracleï¼šæŒ‡å®šå½“å‰åŒ…çš„groupIdä¸º[m
[31m-com.oracleã€‚[m
[31m-[m
[31m-     -DartifactId=ojdbc6ï¼šæŒ‡å®šå½“å‰åŒ…çš„artifactfactIdä¸ºojdbc6ã€‚[m
[31m-     -Dversion=11.2.0.2.0ï¼šæŒ‡å®šå½“å‰åŒ…versionä¸º11.2.0.2.0ã€‚[m
[31m-     -Dfile=Eï¼š\ojdbc6.jarï¼šæŒ‡å®šè¦æ‰“åŒ…çš„jarçš„æ–‡ä»¶ä½ç½®ã€‚[m
[31m-     æ­¤æ—¶ojdbc6è¢«æ‰“åŒ…åˆ°æœ¬åœ°åº“ï¼Œå¦‚å›¾8-22æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                          å›¾8-22ã€€ojdbc6è¢«æ‰“åŒ…åˆ°æœ¬åœ°åº“[m
[31m-[m
[31m-     è¿™æ—¶æˆ‘ä»¬åªéœ€åœ¨Spring Booté¡¹ç›®ä¸­çš„pom.xmlåŠ å…¥ä¸‹é¢å[m
[31m-æ ‡å³å¯å¼•å…¥ojdbc6ï¼š[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>com.oracle</groupId>[m
[31m-                             <artifactId>ojdbc6</artifactId>[m
[31m-                             <version>11.2.0.2.0</version>[m
[31m-[m
[31m-                      </dependency>[m
[31m-     æ·»åŠ google guavaä¾èµ–ï¼Œå®ƒåŒ…å«å¤§é‡Javaå¸¸ç”¨çš„å·¥å…·ç±»ï¼š[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>com.google.guava</groupId>[m
[31m-                             <artifactId>guava</artifactId>[m
[31m-                             <version>18.0</version>[m
[31m-[m
[31m-                      </dependency>[m
[31m-[m
[31m-     æ–°å»ºä¸€ä¸ªdata.sqlæ–‡ä»¶æ”¾ç½®åœ¨src/main/resourcesä¸‹ï¼Œå†…å®¹ä¸º[m
[31m-å‘è¡¨æ ¼å¢åŠ ä¸€äº›æ•°æ®ï¼Œæ•°æ®æ’å…¥å®Œæˆåè¯·åˆ é™¤æˆ–å¯¹æ­¤æ–‡ä»¶æ”¹[m
[31m-åï¼š[m
[31m-[m
[31m-       insert into person(id,name,age,address) values(hibernate_sequence.nextv[m
[31m-       äº‘é£',32,'åˆè‚¥');[m
[31m-       insert into person(id,name,age,address) values(hibernate_sequence.nextv[m
[31m-       äº¬');[m
[31m-       insert into person(id,name,age,address) values(hibernate_sequence.nextv[m
[31m-[m
[31m-       ',30,'ä¸Šæµ·');[m
[31m-       insert into person(id,name,age,address) values(hibernate_sequence.nextv[m
[31m-[m
[31m-       ',29,'å—äº¬');[m
[31m-       insert into person(id,name,age,address) values(hibernate_sequence.nextv[m
[31m-[m
[31m-       ',28,'æ­¦æ±‰');[m
[31m-       insert into person(id,name,age,address) values(hibernate_sequence.nextv[m
[31m-',27,'åˆè‚¥');[m
[31m-[m
[31m-4.é…ç½®åŸºæœ¬å±æ€§[m
[31m-åœ¨application.propertiesé‡Œé…ç½®æ•°æ®æºå’Œjpaçš„ç›¸å…³å±æ€§ã€‚[m
[31m-[m
[31m-spring.datasource.driverClassName=oracle.jdbc.OracleDriver[m
[31m-spring.datasource.url=jdbc[m
[31m-[m
[31m-\:oracle\:thin\:@localhost[m
[31m-[m
[31m-\:1521\:xe[m
[31m-[m
[31m-spring.datasource.username=boot[m
[31m-spring.datasource.password=boot[m
[31m-#1[m
[31m-spring.jpa.hibernate.ddl-auto=update[m
[31m-#2[m
[31m-spring.jpa.show-sql=true[m
[31m-#3[m
[31m-spring.jackson.serialization.indent_output=true[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-     ä¸Šé¢ä»£ç ç¬¬ä¸€æ®µæ˜¯ç”¨æ¥é…ç½®æ•°æ®æºï¼Œç¬¬äºŒæ®µæ˜¯ç”¨æ¥é…ç½®[m
[31m-jpaï¼Œæ›´å¤šé…ç½®å†…å®¹è¯·æŸ¥çœ‹é™„å½•A.3[m
[31m-ä»¥â€œspring.datasourceâ€å’Œâ€œspring.jpaâ€ä¸ºå‰ç¼€çš„å±æ€§é…ç½®ã€‚[m
[31m-[m
[31m-     â‘ hibernateæä¾›äº†æ ¹æ®å®ä½“ç±»è‡ªåŠ¨ç»´æŠ¤æ•°æ®åº“è¡¨ç»“æ„çš„åŠŸ[m
[31m-èƒ½ï¼Œå¯é€šè¿‡spring.jpa.hibernate.ddl-autoæ¥é…ç½®ï¼Œæœ‰ä¸‹åˆ—å¯é€‰[m
[31m-é¡¹ï¼š[m
[31m-[m
[31m-     createï¼šå¯åŠ¨æ—¶åˆ é™¤ä¸Šä¸€æ¬¡ç”Ÿæˆçš„è¡¨ï¼Œå¹¶æ ¹æ®å®ä½“ç±»ç”Ÿæˆ[m
[31m-     è¡¨ï¼Œè¡¨ä¸­æ•°æ®ä¼šè¢«æ¸…ç©ºã€‚[m
[31m-     create-dropï¼šå¯åŠ¨æ—¶æ ¹æ®å®ä½“ç±»ç”Ÿæˆè¡¨ï¼ŒsessionFactoryå…³[m
[31m-     é—­æ—¶è¡¨ä¼šè¢«åˆ é™¤ã€‚[m
[31m-     updateï¼šå¯åŠ¨æ—¶ä¼šæ ¹æ®å®ä½“ç±»ç”Ÿæˆè¡¨ï¼Œå½“å®ä½“ç±»å±æ€§å˜åŠ¨[m
[31m-     çš„æ—¶å€™ï¼Œè¡¨ç»“æ„ä¹Ÿä¼šæ›´æ–°ï¼Œåœ¨åˆæœŸå¼€å‘é˜¶æ®µä½¿ç”¨æ­¤é€‰é¡¹ã€‚[m
[31m-     validateï¼šå¯åŠ¨æ—¶éªŒè¯å®ä½“ç±»å’Œæ•°æ®è¡¨æ˜¯å¦ä¸€è‡´ï¼Œåœ¨æˆ‘ä»¬æ•°[m
[31m-     æ®ç»“æ„ç¨³å®šæ—¶é‡‡ç”¨æ­¤é€‰é¡¹ã€‚[m
[31m-     noneï¼šä¸é‡‡å–ä»»ä½•æªæ–½ã€‚[m
[31m-[m
[31m-     â‘¡spring.jpa.show-sqlç”¨æ¥è®¾ç½®hibernateæ“ä½œçš„æ—¶å€™åœ¨æ§åˆ¶[m
[31m-å°æ˜¾ç¤ºå…¶çœŸå®çš„sqlè¯­å¥ã€‚[m
[31m-[m
[31m-     â‘¢è®©æ§åˆ¶å™¨è¾“å‡ºçš„jsonå­—ç¬¦ä¸²æ ¼å¼æ›´ç¾è§‚ã€‚[m
[31m-[m
[31m-     5.å®šä¹‰æ˜ å°„å®ä½“ç±»[m
[31m-[m
[31m-     Hibernateæ”¯æŒè‡ªåŠ¨å°†å®ä½“ç±»æ˜ å°„ä¸ºæ•°æ®è¡¨æ ¼ï¼š[m
[31m-[m
[31m-       package com.wisely.domain;[m
[31m-[m
[31m-       import javax.persistence.Entity;[m
[31m-       import javax.persistence.GeneratedValue;[m
[31m-       import javax.persistence.Id;[m
[31m-[m
[31m-       @Entity //1[m
[31m-       @NamedQuery(name = "Person.withNameAndAddressNamedQuery",[m
[31m-       query = "select p from Person p where p.name=?[m
[31m-       1 and address=?2")[m
[31m-       public class Person {[m
[31m-[m
[31m-              @Id //2[m
[31m-              @GeneratedValue //3[m
[31m-              private Long id;[m
[31m-[m
[31m-              private String name;[m
[31m-[m
[31m-              private Integer age;[m
[31m-[m
[31m-              private String address;[m
[31m-[m
[31m-              public Person() {[m
[31m-                      super();[m
[31m-[m
[31m-              }[m
[31m-              public Person(Long id, String name, Integer age, String address) {[m
[31m-[m
[31m-                      super();[m
[31m-                      this.id = id;[m
[31m-                      this.name = name;[m
[31m-                      this.age = age;[m
[31m-                      this.address = address;[m
[31m-              }[m
[31m-[m
[31m-              // çœç•¥setterã€getter[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ @Entityæ³¨è§£æŒ‡æ˜è¿™æ˜¯ä¸€ä¸ªå’Œæ•°æ®åº“è¡¨æ˜ å°„çš„å®ä½“ç±»ã€‚[m
[31m-[m
[31m-     â‘¡@Idæ³¨è§£æŒ‡æ˜è¿™ä¸ªå±æ€§æ˜ å°„ä¸ºæ•°æ®åº“çš„ä¸»é”®ã€‚[m
[31m-[m
[31m-     â‘¢@GeneratedValueæ³¨è§£é»˜è®¤ä½¿ç”¨ä¸»é”®ç”Ÿæˆæ–¹å¼ä¸ºè‡ªå¢ï¼Œ[m
[31m-hibernateä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåä¸ºHIBERNATE_SEQUENCE[m
[31m-çš„åºåˆ—ã€‚[m
[31m-[m
[31m-     åœ¨æ­¤ä¾‹ä¸­ä½¿ç”¨çš„æ³¨è§£ä¹Ÿè®¸å’Œä½ å¹³æ—¶ç»å¸¸ä½¿ç”¨çš„æ³¨è§£å®ä½“ç±»[m
[31m-ä¸å¤§ä¸€æ ·ï¼Œæ¯”å¦‚æ²¡æœ‰ä½¿ç”¨@Tableï¼ˆå®ä½“ç±»æ˜ å°„è¡¨åï¼‰ã€[m
[31m-@Columnï¼ˆå±æ€§æ˜ å°„å­—æ®µåï¼‰æ³¨è§£ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ˜¯é‡‡ç”¨æ­£[m
[31m-å‘å·¥ç¨‹é€šè¿‡å®ä½“ç±»ç”Ÿæˆè¡¨ç»“æ„ï¼Œè€Œä¸æ˜¯é€šè¿‡é€†å‘å·¥ç¨‹ä»è¡¨ç»“æ„[m
[31m-ç”Ÿæˆæ•°æ®åº“ã€‚[m
[31m-[m
[31m-     åœ¨è¿™é‡Œä½ å¯èƒ½æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬æ²¡æœ‰é€šè¿‡@Columnæ³¨è§£æ¥æ³¨è§£[m
[31m-æ™®é€šå±æ€§ï¼Œ@Columnæ˜¯ç”¨æ¥æ˜ å°„å±æ€§åå’Œå­—æ®µåï¼Œä¸æ³¨è§£çš„[m
[31m-æ—¶å€™hibernateä¼šè‡ªåŠ¨æ ¹æ®å±æ€§åç”Ÿæˆæ•°æ®è¡¨çš„å­—æ®µåã€‚å¦‚å±æ€§[m
[31m-ånameæ˜ å°„æˆå­—æ®µNAMEï¼›å¤šå­—æ¯å±æ€§å¦‚testNameä¼šè‡ªåŠ¨æ˜ å°„[m
[31m-ä¸ºTEST_NAMEã€‚è¡¨åçš„æ˜ å°„è§„åˆ™ä¹Ÿå¦‚æ­¤ã€‚[m
[31m-[m
[31m-     6.å®šä¹‰æ•°æ®è®¿é—®æ¥å£[m
[31m-[m
[31m-       package com.wisely.dao;[m
[31m-[m
[31m-       import java.util.List;[m
[31m-[m
[31m-       import org.springframework.data.jpa.repository.JpaRepository;[m
[31m-       import org.springframework.data.jpa.repository.Query;[m
[31m-[m
[31m-       import com.wisely.domain.Person;[m
[31m-[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-              //1[m
[31m-              List<Person> findByAddress(String name);[m
[31m-              //2[m
[31m-              Person findByNameAndAddress(String name,String address);[m
[31m-              //3[m
[31m-              @Query("select p from Person p where p.name= :name and p.address= :[m
[31m-              Person withNameAndAddressQuery(@Param("name")String name,[m
[31m-                                                                                         @Param("address")String ad[m
[31m-              //4[m
[31m-              List<Person> withNameAndAddressNamedQuery(String name,String addres[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä½¿ç”¨æ–¹æ³•åæŸ¥è¯¢ï¼Œæ¥å—ä¸€ä¸ªnameå‚æ•°ï¼Œè¿”å›å€¼ä¸ºåˆ—è¡¨ã€‚[m
[31m-     â‘¡ä½¿ç”¨æ–¹æ³•åæŸ¥è¯¢ï¼Œæ¥å—nameå’Œaddressï¼Œè¿”å›å€¼ä¸ºå•ä¸ªå¯¹[m
[31m-è±¡ã€‚[m
[31m-[m
[31m-     â‘¢ä½¿ç”¨@QueryæŸ¥è¯¢ï¼Œå‚æ•°æŒ‰ç…§åç§°ç»‘å®šã€‚[m
[31m-[m
[31m-     â‘£ä½¿ç”¨@NamedQueryæŸ¥è¯¢ï¼Œè¯·æ³¨æ„æˆ‘ä»¬åœ¨å®ä½“ç±»ä¸­åšçš„[m
[31m-@NamedQueryçš„å®šä¹‰ã€‚[m
[31m-[m
[31m-     7.è¿è¡Œ[m
[31m-[m
[31m-     åœ¨æœ¬ä¾‹ä¸­æ²¡æœ‰å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘ä»¬å°†PersonRepositoryæ³¨[m
[31m-å…¥åˆ°æ§åˆ¶å™¨ä¸­ï¼Œä»¥ç®€åŒ–æ¼”ç¤ºã€‚[m
[31m-[m
[31m-       package com.wisely.web;[m
[31m-[m
[31m-       import java.util.List;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.data.domain.Page;[m
[31m-       import org.springframework.data.domain.PageRequest;[m
[31m-       import org.springframework.data.domain.Sort;[m
[31m-       import org.springframework.data.domain.Sort.Direction;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-       import com.wisely.dao.PersonRepository;[m
[31m-       import com.wisely.domain.Person;[m
[31m-[m
[31m-       @RestController[m
[31m-       public class DataController {[m
[31m-[m
[31m-              //1 Spring Data JPAå·²è‡ªåŠ¨ä¸ºä½ æ³¨å†Œbeanï¼Œæ‰€ä»¥å¯è‡ªåŠ¨æ³¨å…¥[m
[31m-              @Autowired[m
[31m-              PersonRepository personRepository;[m
[31m-              /**[m
[31m-[m
[31m-                * ä¿å­˜[m
[31m-                * saveæ”¯æŒæ‰¹é‡ä¿å­˜ï¼š<S extends T> Iterable[m
[31m-[m
[31m-       <S> save(Iterable[m
[31m-<S> entities);[m
[31m-         *[m
[31m-         * åˆ é™¤ï¼š[m
[31m-         *æ”¯æŒä½¿ç”¨idåˆ é™¤å¯¹è±¡ã€æ‰¹é‡åˆ é™¤ä»¥åŠåˆ é™¤å…¨éƒ¨ï¼š[m
[31m-         * void delete(ID id);[m
[31m-         * void delete(T entity);[m
[31m-         * void delete(Iterable[m
[31m-[m
[31m-<? extends T> entities);[m
[31m-         * void deleteAll();[m
[31m-         *[m
[31m-         */[m
[31m-[m
[31m-       @RequestMapping("/save")[m
[31m-       public Person save(String name,String address,Integer age)[m
[31m-{[m
[31m-[m
[31m-              Person p = personRepository.save(new Person(null, name, age, ad[m
[31m-[m
[31m-              return p;[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       /**[m
[31m-         * æµ‹è¯•findByAddress[m
[31m-         */[m
[31m-[m
[31m-       @RequestMapping("/q1")[m
[31m-       public List<Person> q1(String address){[m
[31m-[m
[31m-              List<Person> people = personRepository.findByAddress(address);[m
[31m-[m
[31m-              return people;[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       /**[m
[31m-         * æµ‹è¯•findByNameAndAddress[m
[31m-         */[m
[31m-[m
[31m-       @RequestMapping("/q2")[m
[31m-       public Person q2(String name,String address){[m
[31m-       Person people = personRepository.findByNameAndAddress(name, add[m
[31m-[m
[31m-       return people;[m
[31m-[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * æµ‹è¯•withNameAndAddressQuery[m
[31m- */[m
[31m-[m
[31m-@RequestMapping("/q3")[m
[31m-public Person q3(String name,String address){[m
[31m-[m
[31m-       Person p = personRepository.withNameAndAddressQuery(name, addre[m
[31m-[m
[31m-       return p;[m
[31m-[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * æµ‹è¯•withNameAndAddressNamedQuery[m
[31m- */[m
[31m-[m
[31m-@RequestMapping("/q4")[m
[31m-public Person q4(String name,String address){[m
[31m-[m
[31m-       Person p = personRepository.withNameAndAddressNamedQuery(name,[m
[31m-[m
[31m-       return p;[m
[31m-[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * æµ‹è¯•æ’åº[m
[31m- */[m
[31m-[m
[31m-@RequestMapping("/sort")[m
[31m-public List<Person> sort(){[m
[31m-[m
[31m-       List<Person> people = personRepository.findAll(new Sort(Directi[m
[31m-[m
[31m-       return people;[m
[31m-[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * æµ‹è¯•åˆ†é¡µ[m
[31m- */[m
[31m-[m
[31m-@RequestMapping("/page")[m
[31m-public Page<Person> page(){[m
[31m-                      Page<Person> pagePeople = personRepository.findAll(new PageRequ[m
[31m-                      return pagePeople;[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä¸‹é¢åˆ†åˆ«è®¿é—®åœ°å€æµ‹è¯•è¿è¡Œæ•ˆæœã€‚[m
[31m-     è®¿é—®http://localhostï¼š8080/saveï¼Ÿname=dd&address=ä¸Šæµ·[m
[31m-&age=25ï¼Œå¦‚å›¾8-23æ‰€ç¤ºã€‚[m
[31m-[m
[31m-    å›¾8-23ã€€è®¿é—®http://localhostï¼š8080/saveï¼Ÿname=dd&address=ä¸Šæµ·[m
[31m-                                         &age=25[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8080/q1ï¼Ÿaddress=åˆè‚¥ï¼Œå¦‚å›¾8-24æ‰€[m
[31m-ç¤ºã€‚[m
[31m-           å›¾8-24ã€€è®¿é—®ï¼šhttp://localhostï¼š8080/q1ï¼Ÿaddress=åˆè‚¥[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8080/q2ï¼Ÿaddress=åˆè‚¥&name=æ±ªäº‘[m
[31m-é£ï¼Œå¦‚å›¾8-25æ‰€ç¤ºã€‚[m
[31m-[m
[31m-   å›¾8-25ã€€è®¿é—®http://localhostï¼š8080/q2ï¼Ÿaddress=åˆè‚¥&name=æ±ªäº‘é£[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8080/q3ï¼Ÿaddress=åˆè‚¥&name=æ±ªäº‘[m
[31m-é£ï¼Œå¦‚å›¾8-26æ‰€ç¤ºã€‚[m
[31m-[m
[31m-   å›¾8-26ã€€è®¿é—®http://localhostï¼š8080/q3ï¼Ÿaddress=åˆè‚¥&name=æ±ªäº‘é£[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8080/q4ï¼Ÿaddress=åˆè‚¥&name=æ±ªäº‘[m
[31m-é£ï¼Œå¦‚å›¾8-27æ‰€ç¤ºã€‚[m
[31m-å›¾8-27ã€€è®¿é—®http://localhostï¼š8080/q4ï¼Ÿaddress=åˆè‚¥&name=æ±ªäº‘é£[m
[31m-[m
[31m-  è®¿é—®http://localhostï¼š8080/sortï¼Œå¦‚å›¾8-28æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                   å›¾8-28ã€€è®¿é—®http://localhostï¼š8080/sort[m
[31m-[m
[31m-  è®¿é—®http://localhostï¼š8080/pageï¼Œå¦‚å›¾8-29æ‰€ç¤ºã€‚[m
[31m-                     å›¾8-29ã€€è®¿é—®http://localhostï¼š8080/page[m
[31m-[m
[31m-     7.è‡ªå®šä¹‰Repositoryå®ç°[m
[31m-[m
[31m-     ä¸Šé¢çš„å®æˆ˜æ¼”ç¤ºå·²ç»åŒ…å«äº†Spring Bootå’ŒSpring Data JPA[m
[31m-ç»„åˆçš„ç»å¤§å¤šæ•°åŠŸèƒ½ã€‚ä¸‹é¢æˆ‘ä»¬å°†ç»“åˆSpecificationå’Œè‡ªå®šä¹‰[m
[31m-Repositoryå®ç°æ¥å®šåˆ¶ä¸€ä¸ªè‡ªåŠ¨æ¨¡ç³ŠæŸ¥è¯¢ã€‚å³å¯¹äºä»»æ„çš„å®ä½“[m
[31m-å¯¹è±¡è¿›è¡ŒæŸ¥è¯¢ï¼Œå¯¹è±¡é‡Œæœ‰å‡ ä¸ªå€¼æˆ‘ä»¬å°±æŸ¥å‡ ä¸ªå€¼ï¼Œå½“å€¼ä¸ºå­—ç¬¦[m
[31m-å‹æ—¶æˆ‘ä»¬å°±è‡ªåŠ¨likeæŸ¥è¯¢ï¼Œå…¶ä½™çš„ç±»å‹ä½¿ç”¨è‡ªåŠ¨ç­‰äºæŸ¥è¯¢ï¼Œæ²¡[m
[31m-æœ‰å€¼æˆ‘ä»¬å°±æŸ¥è¯¢å…¨éƒ¨ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰å®šä¹‰Specificationï¼š[m
[31m-[m
[31m-       package com.wisely.specs;[m
[31m-[m
[31m-       import static com.google.common.collect.Iterables.toArray;[m
[31m-[m
[31m-       import java.lang.reflect.Field;[m
[31m-       import java.util.ArrayList;[m
[31m-       import java.util.List;[m
[31m-import javax.persistence.EntityManager;[m
[31m-import javax.persistence.criteria.CriteriaBuilder;[m
[31m-import javax.persistence.criteria.CriteriaQuery;[m
[31m-import javax.persistence.criteria.Predicate;[m
[31m-import javax.persistence.criteria.Root;[m
[31m-import javax.persistence.metamodel.Attribute;[m
[31m-import javax.persistence.metamodel.EntityType;[m
[31m-import javax.persistence.metamodel.SingularAttribute;[m
[31m-[m
[31m-import org.springframework.data.jpa.domain.Specification;[m
[31m-import org.springframework.util.ReflectionUtils;[m
[31m-import org.springframework.util.StringUtils;[m
[31m-[m
[31m-public class CustomerSpecs {[m
[31m-[m
[31m-       public static <T> Specification<T> byAuto(final EntityManager entit[m
[31m-[m
[31m-              final Class<T> type = (Class<T>) example.getClass();//2[m
[31m-[m
[31m-              return new Specification<T>() {[m
[31m-[m
[31m-                     @Override[m
[31m-                     public Predicate toPredicate(Root<T> root, CriteriaQuery<?[m
[31m-> query, CriteriaBuilder cb) {[m
[31m-[m
[31m-                              List<Predicate> predicates = new ArrayList<>[m
[31m-(); //3[m
[31m-[m
[31m-                             EntityType<T> entity = entityManager.getMetamodel().ent[m
[31m-[m
[31m-                                                                      for (Attribute<T, ?[m
[31m-> attr : entity.getDeclaredAttributes()) {//5[m
[31m-[m
[31m-                                    Object attrValue = getValue(example, attr); //6[m
[31m-                                    if (attrValue != null) {[m
[31m-[m
[31m-                                           if (attr.getJavaType() == String.class) { //7[m
[31m-                                                  if (!StringUtils.isEmpty(attrValue)) { //8[m
[31m-                                                          predicates.add(cb.like(root.get(attribu[m
[31m-                                                                        pattern((String) attrValue)));[m
[31m-                                                  }[m
[31m-[m
[31m-                                           } else {[m
[31m-       predicates.add(cb.equal(root.get(attribute(entity, attr.getName(),[m
[31m-[m
[31m-                                                                 attrValue)); //10[m
[31m-                                           }[m
[31m-                                    }[m
[31m-[m
[31m-                             }[m
[31m-                             return predicates.isEmpty() ? cb.conjunction() : cb.and[m
[31m-                     }[m
[31m-> attr) {  /**[m
[31m-            * 12[m
[31m-            */[m
[31m-[m
[31m-           private <T> Object getValue(T example, Attribute<T, ?[m
[31m-[m
[31m-                  return ReflectionUtils.getField((Field) attr.getJavaMem[m
[31m-           }[m
[31m-[m
[31m-           /**[m
[31m-            * 13[m
[31m-            */[m
[31m-[m
[31m-           private <E, T> SingularAttribute<T, E> attribute(EntityType[m
[31m-                         Class<E> fieldClass) {[m
[31m-[m
[31m-                  return entity.getDeclaredSingularAttribute(fieldName, f[m
[31m-           }[m
[31m-[m
[31m-      };[m
[31m-[m
[31m-   }[m
[31m-[m
[31m-   /**[m
[31m-    * 14[m
[31m-    */[m
[31m-[m
[31m-   static private String pattern(String str) {[m
[31m-          return "%" + str + "%";[m
[31m-[m
[31m-   }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ å®šä¹‰ä¸€ä¸ªè¿”å›å€¼ä¸ºSpecificationçš„æ–¹æ³•byAutoï¼Œè¿™é‡Œä½¿ç”¨[m
[31m-çš„æ˜¯æ³›å‹Tï¼Œæ‰€ä»¥è¿™ä¸ªSpecificationæ˜¯å¯ä»¥ç”¨äºä»»æ„çš„å®ä½“ç±»[m
[31m-çš„ã€‚å®ƒæ¥å—çš„å‚æ•°æ˜¯entityManagerå’Œå½“å‰çš„åŒ…å«å€¼ä½œä¸ºæŸ¥è¯¢æ¡[m
[31m-ä»¶çš„å®ä½“ç±»å¯¹è±¡ã€‚[m
[31m-[m
[31m-     â‘¡è·å¾—å½“å‰å®ä½“ç±»å¯¹è±¡ç±»çš„ç±»å‹ã€‚[m
[31m-[m
[31m-     â‘¢æ–°å»ºPredicateåˆ—è¡¨å­˜å‚¨æ„é€ çš„æŸ¥è¯¢æ¡ä»¶ã€‚[m
[31m-     â‘£è·å¾—å®ä½“ç±»çš„EntityTypeï¼Œæˆ‘ä»¬å¯ä»¥ä»EntityTypeè·å¾—å®[m
[31m-ä½“ç±»çš„å±æ€§ã€‚[m
[31m-[m
[31m-     â‘¤å¯¹å®ä½“ç±»çš„æ‰€æœ‰å±æ€§åšå¾ªç¯ã€‚[m
[31m-[m
[31m-     â‘¥è·å¾—å®ä½“ç±»å¯¹è±¡æŸä¸€ä¸ªå±æ€§çš„å€¼ã€‚[m
[31m-[m
[31m-     â‘¦å½“å‰å±æ€§å€¼ä¸ºå­—ç¬¦ç±»å‹çš„æ—¶å€™ã€‚[m
[31m-[m
[31m-     â‘§è‹¥å½“å‰å­—ç¬¦ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹ã€‚[m
[31m-[m
[31m-     â‘¨æ„é€ å½“å‰å±æ€§likeï¼ˆå‰å%ï¼‰å±æ€§å€¼æŸ¥è¯¢æ¡ä»¶ï¼Œå¹¶æ·»åŠ åˆ°[m
[31m-æ¡ä»¶åˆ—è¡¨ä¸­ã€‚[m
[31m-[m
[31m-     â‘©å…¶ä½™æƒ…å†µä¸‹ï¼Œæ„é€ å±æ€§å’Œå±æ€§å€¼equalæŸ¥è¯¢æ¡ä»¶ï¼Œå¹¶æ·»åŠ [m
[31m-åˆ°æ¡ä»¶åˆ—è¡¨ä¸­ã€‚[m
[31m-[m
[31m-     â‘ªå°†æ¡ä»¶åˆ—è¡¨è½¬æ¢æˆPredicateã€‚[m
[31m-[m
[31m-     â‘«é€šè¿‡åå°„è·å¾—å®ä½“ç±»å¯¹è±¡å¯¹åº”å±æ€§çš„å±æ€§å€¼ã€‚[m
[31m-[m
[31m-     â‘¬è·å¾—å®ä½“ç±»çš„å½“å‰å±æ€§çš„SingularAttributeï¼Œ[m
[31m-SingularAttributeåŒ…å«çš„æ˜¯å®ä½“ç±»çš„æŸä¸ªå•ç‹¬å±æ€§ã€‚[m
[31m-[m
[31m-     â‘­æ„é€ likeçš„æŸ¥è¯¢æ¨¡å¼ï¼Œå³å‰ååŠ %ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰å®šä¹‰æ¥å£ï¼š[m
[31m-[m
[31m-       package com.wisely.support;[m
[31m-[m
[31m-       import java.io.Serializable;[m
[31m-[m
[31m-       import org.springframework.data.domain.Page;[m
[31m-       import org.springframework.data.domain.Pageable;[m
[31m-       import org.springframework.data.jpa.repository.JpaRepository;[m
[31m-       import org.springframework.data.jpa.repository.JpaSpecificationExecutor[m
[31m-       import org.springframework.data.repository.NoRepositoryBean;[m
[31m-       @NoRepositoryBean[m
[31m-       public interface CustomRepository<T, ID extends Serializable>extends Jp[m
[31m-       {[m
[31m-[m
[31m-              Page<T> findByAuto(T example,Pageable pageable);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     æ­¤ä¾‹ä¸­çš„æ¥å£ç»§æ‰¿äº†JpaRepositoryï¼Œè®©æˆ‘ä»¬å…·å¤‡äº†[m
[31m-JpaRepositoryæ‰€æä¾›çš„æ–¹æ³•ï¼›ç»§æ‰¿äº†JpaSpecificationExecutorï¼Œ[m
[31m-è®©æˆ‘ä»¬å…·å¤‡ä½¿ç”¨Specificationçš„èƒ½åŠ›ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰å®šä¹‰å®ç°ï¼š[m
[31m-[m
[31m-       package com.wisely.support;[m
[31m-[m
[31m-       import java.io.Serializable;[m
[31m-[m
[31m-       import javax.persistence.EntityManager;[m
[31m-[m
[31m-       import org.springframework.data.domain.Page;[m
[31m-       import org.springframework.data.domain.Pageable;[m
[31m-       import org.springframework.data.jpa.repository.support.SimpleJpaReposit[m
[31m-[m
[31m-       import static com.wisely.specs.CustomerSpecs.*;[m
[31m-[m
[31m-       public class CustomRepositoryImpl <T, ID extends Serializable>[m
[31m-                                           extends SimpleJpaRepository<T, ID> implements Cust[m
[31m-[m
[31m-              private final EntityManager entityManager;[m
[31m-[m
[31m-              public CustomRepositoryImpl(Class<T> domainClass, EntityManager ent[m
[31m-                      super(domainClass, entityManager);[m
[31m-                      this.entityManager = entityManager;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public Page<T> findByAuto(T example, Pageable pageable) {[m
[31m-                      return findAll(byAuto(entityManager, example),pageable);[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     æ­¤ç±»ç»§æ‰¿JpaRepositoryçš„å®ç°ç±»SimpleJpaRepositoryï¼Œè®©æˆ‘[m
[31m-ä»¬å¯ä»¥ä½¿ç”¨SimpleJpaRepositoryçš„æ–¹æ³•ï¼›æ­¤ç±»å½“ç„¶è¿˜è¦å®ç°æˆ‘[m
[31m-ä»¬è‡ªå®šä¹‰çš„æ¥å£CustomRepositoryã€‚[m
[31m-[m
[31m-     findByAutoæ–¹æ³•ä½¿ç”¨byAuto Specificationæ„é€ çš„æ¡ä»¶æŸ¥è¯¢ï¼Œ[m
[31m-å¹¶æä¾›åˆ†é¡µåŠŸèƒ½ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰å®šä¹‰repositoryFactoryBeanï¼š[m
[31m-[m
[31m-       package com.wisely.support;[m
[31m-[m
[31m-       import java.io.Serializable;[m
[31m-[m
[31m-       import javax.persistence.EntityManager;[m
[31m-[m
[31m-       import org.springframework.data.jpa.repository.JpaRepository;[m
[31m-       import org.springframework.data.jpa.repository.support.JpaRepositoryFac[m
[31m-       import org.springframework.data.jpa.repository.support.JpaRepositoryFac[m
[31m-       import org.springframework.data.jpa.repository.support.SimpleJpaReposit[m
[31m-       import org.springframework.data.repository.core.RepositoryInformation;[m
[31m-       import org.springframework.data.repository.core.RepositoryMetadata;[m
[31m-       import org.springframework.data.repository.core.support.RepositoryFacto[m
[31m-[m
[31m-       public class CustomRepositoryFactoryBean<T extends JpaRepository<S, ID>[m
[31m-                      extends JpaRepositoryFactoryBean<T, S, ID> {[m
[31m-[m
[31m-              @Override[m
[31m-              protected RepositoryFactorySupport createRepositoryFactory(EntityMa[m
[31m-[m
[31m-                      return new CustomRepositoryFactory(entityManager);[m
[31m-              }[m
[31m-[m
[31m-              private static class CustomRepositoryFactory extends JpaRepositoryF[m
[31m-      public CustomRepositoryFactory(EntityManager entityManager) {[m
[31m-             super(entityManager);[m
[31m-[m
[31m-      }[m
[31m-[m
[31m-              @Override[m
[31m-              @SuppressWarnings({"unchecked"})[m
[31m-              protected <T, ID extends Serializable> SimpleJpaRepository<?, ?[m
[31m-> getTargetRepository([m
[31m-[m
[31m-                             RepositoryInformation information, EntityManager entity[m
[31m-                                     return new CustomRepositoryImpl<T, ID>[m
[31m-[m
[31m-((Class<T>) information.getDomainType(), entityManager);[m
[31m-[m
[31m-      }[m
[31m-[m
[31m-      @Override[m
[31m-[m
[31m-                 protected                   Class<?[m
[31m-[m
[31m-> getRepositoryBaseClass(RepositoryMetadata metadata) {[m
[31m-[m
[31m-         return CustomRepositoryImpl.class;[m
[31m-[m
[31m-      }[m
[31m-[m
[31m-   }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     åœ¨8.2.1ä¸­æˆ‘ä»¬å¯¹å®šä¹‰RepositoryFactoryBeanåšäº†è®²è§£ï¼Œè¿™[m
[31m-é‡Œçš„ä»£ç å¤§å¯ä»¥ä½œä¸ºæ¨¡æ¿ä»£ç ä½¿ç”¨ï¼Œåªéœ€ä¿®æ”¹å’Œå®šä¹‰å®ç°ç±»ç›¸[m
[31m-å…³çš„ä»£ç å³å¯ã€‚[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰ä½¿ç”¨ï¼š[m
[31m-[m
[31m-       package com.wisely.dao;[m
[31m-[m
[31m-       import java.util.List;[m
[31m-[m
[31m-       import org.springframework.data.jpa.repository.Query;[m
[31m-       import org.springframework.data.repository.query.Param;[m
[31m-[m
[31m-       import com.wisely.domain.Person;[m
[31m-       import com.wisely.support.CustomRepository;[m
[31m-       public interface PersonRepository extends CustomRepository<Person, Long[m
[31m-[m
[31m-              List<Person> findByAddress(String address);[m
[31m-              Person findByNameAndAddress(String name,String address);[m
[31m-              @Query("select p from Person p where p.name= :name and p.address= :[m
[31m-              Person withNameAndAddressQuery(@Param("name")String name,@Param("ad[m
[31m-              Person withNameAndAddressNamedQuery(String name,String address);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     åªéœ€è®©å®ä½“ç±»Repositoryç»§æ‰¿æˆ‘ä»¬è‡ªå®šä¹‰çš„Repositoryæ¥[m
[31m-å£ï¼Œå³å¯ä½¿ç”¨æˆ‘ä»¬åœ¨è‡ªå®šä¹‰Respositoryä¸­å®ç°çš„åŠŸèƒ½ã€‚[m
[31m-[m
[31m-       package com.wisely.web;[m
[31m-[m
[31m-       import java.util.List;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.data.domain.Page;[m
[31m-       import org.springframework.data.domain.PageRequest;[m
[31m-       import org.springframework.data.domain.Sort;[m
[31m-       import org.springframework.data.domain.Sort.Direction;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-       import com.wisely.dao.PersonRepository;[m
[31m-       import com.wisely.domain.Person;[m
[31m-[m
[31m-       @RestController[m
[31m-       public class DataController {[m
[31m-[m
[31m-              @RequestMapping("/auto")[m
[31m-              public Page<Person> auto(Person person){[m
[31m-[m
[31m-                      Page<Person> pagePeople = personRepository.findByAuto(person, n[m
[31m-[m
[31m-                      return pagePeople;[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     æ§åˆ¶å™¨ä¸­æ¥å—ä¸€ä¸ªPersonå¯¹è±¡ï¼Œå½“Personçš„nameæœ‰å€¼æ—¶ï¼Œ[m
[31m-ä¼šè‡ªåŠ¨å¯¹nameè¿›è¡ŒlikeæŸ¥è¯¢ï¼›å½“ageæœ‰å€¼æ—¶ï¼Œä¼šè¿›è¡Œç­‰äºæŸ¥è¯¢ï¼›[m
[31m-å½“Personä¸­æœ‰å¤šä¸ªå€¼ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æ„é€ å¤šä¸ªæŸ¥è¯¢æ¡[m
[31m-ä»¶ï¼›å½“Personæ‰€æœ‰å€¼ä¸ºç©ºçš„æ—¶å€™ï¼Œé»˜è®¤æŸ¥è¯¢å‡ºæ‰€æœ‰è®°å½•ã€‚[m
[31m-[m
[31m-     æ­¤å¤„éœ€è¦ç‰¹åˆ«æŒ‡å‡ºçš„æ˜¯ï¼Œåœ¨å®ä½“ç±»ä¸­å®šä¹‰çš„æ•°æ®ç±»å‹è¦ç”¨[m
[31m-åŒ…è£…ç±»å‹ï¼ˆLongã€Integerï¼‰ï¼Œè€Œä¸èƒ½ä½¿ç”¨åŸå§‹æ•°æ®ç±»å‹[m
[31m-ï¼ˆlongã€intï¼‰ã€‚å› ä¸ºåœ¨Spring MVCä¸­ï¼Œä½¿ç”¨åŸå§‹æ•°æ®ç±»å‹ä¼šè‡ª[m
[31m-åŠ¨åˆå§‹åŒ–ä¸º0ï¼Œè€Œä¸æ˜¯ç©ºï¼Œå¯¼è‡´æˆ‘ä»¬æ„é€ æ¡ä»¶å¤±è´¥ã€‚[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰é…ç½®ï¼š[m
[31m-[m
[31m-       package com.wisely;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.boot.SpringApplication;[m
[31m-       import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-       import org.springframework.data.jpa.repository.config.EnableJpaReposito[m
[31m-[m
[31m-       import com.wisely.dao.PersonRepository;[m
[31m-       import com.wisely.support.CustomRepositoryFactoryBean;[m
[31m-[m
[31m-       @SpringBootApplication[m
[31m-       @EnableJpaRepositories(repositoryFactoryBeanClass = CustomRepositoryFac[m
[31m-       public class Ch82Application {[m
[31m-[m
[31m-              @Autowired[m
[31m-              PersonRepository personRepository;[m
[31m-[m
[31m-              public static void main(String[] args) {[m
[31m-                      SpringApplication.run(Ch82Application.class, args);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     åœ¨é…ç½®ç±»ä¸Šé…ç½®@EnableJpaRepositoriesï¼Œå¹¶æŒ‡å®š[m
[31m-repositoryFactoryBeanClassï¼Œè®©æˆ‘ä»¬è‡ªå®šä¹‰çš„Repositoryå®ç°èµ·[m
[31m-æ•ˆã€‚[m
[31m-[m
[31m-     å¦‚æœæˆ‘ä»¬ä¸éœ€è¦è‡ªå®šä¹‰Repositoryå®ç°ï¼Œåˆ™åœ¨Spring Data[m
[31m-JPAé‡Œæ— é¡»æ·»åŠ @EnableJpaRepositoriesæ³¨è§£ï¼Œå› ä¸º[m
[31m-@SpringBootApplicationåŒ…å«çš„@EnableAutoConfigurationæ³¨è§£[m
[31m-å·²ç»å¼€å¯äº†å¯¹Spring Data JPAçš„æ”¯æŒã€‚[m
[31m-[m
[31m-     7.è¿è¡Œ[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8080/autoï¼Œæ— æ„é€ æŸ¥è¯¢æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨[m
[31m-éƒ¨ï¼Œå¦‚å›¾8-30æ‰€ç¤ºã€‚[m
[31m-                              å›¾8-30ã€€æ— æ„é€ æŸ¥è¯¢æ¡ä»¶[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8080/autoï¼Ÿaddress=è‚¥ï¼Œæ„é€ address[m
[31m-çš„likeæŸ¥è¯¢ï¼Œå¦‚å›¾8-31æ‰€ç¤ºã€‚[m
[31m-                           å›¾8-31ã€€æ„é€ addressçš„likeæŸ¥è¯¢[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8080/autoï¼Ÿaddress=è‚¥&name=äº‘[m
[31m-&age=32ï¼Œæ„é€ addressçš„likeæŸ¥è¯¢ã€nameçš„likeæŸ¥è¯¢ä»¥åŠageçš„[m
[31m-equalæŸ¥è¯¢ï¼Œå¦‚å›¾8-32æ‰€ç¤ºã€‚[m
[31m-[m
[31m-  å›¾8-32ã€€æ„é€ addressçš„likeæŸ¥è¯¢ã€nameçš„likeæŸ¥è¯¢ä»¥åŠageçš„equalæŸ¥è¯¢[m
[31m-8.3ã€€Spring Data REST[m
[31m-[m
[31m-8.3.1ã€€ç‚¹ç›Spring Data REST[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯Spring Data REST[m
[31m-[m
[31m-     Spring Data JPAæ˜¯åŸºäºSpring Dataçš„repositoryä¹‹ä¸Šï¼Œå¯ä»¥[m
[31m-å°†repositoryè‡ªåŠ¨è¾“å‡ºä¸ºRESTèµ„æºã€‚ç›®å‰Spring Data RESTæ”¯æŒ[m
[31m-å°†Spring Data JPAã€Spring Data MongoDBã€Spring Data[m
[31m-Neo4jã€Spring Data GemFireä»¥åŠSpring Data Cassandraçš„[m
[31m-repositoryè‡ªåŠ¨è½¬æ¢æˆRESTæœåŠ¡ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰Spring MVCä¸­é…ç½®ä½¿ç”¨Spring Data REST[m
[31m-[m
[31m-     Spring Data RESTçš„é…ç½®æ˜¯å®šä¹‰åœ¨[m
[31m-RepositoryRestMvcConfigurationï¼ˆorg.springframework.data.rest.webmvc.co[m
[31m-é…ç½®ç±»ä¸­å·²ç»é…ç½®å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿æ­¤ç±»æˆ–è€…ç›´æ¥åœ¨è‡ª[m
[31m-å·±çš„é…ç½®ç±»ä¸Š@Importæ­¤é…ç½®ç±»ã€‚[m
[31m-[m
[31m-     1ï¼‰ç»§æ‰¿æ–¹å¼æ¼”ç¤ºï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       public class MyRepositoryRestMvcConfiguration extends RepositoryRestMvc[m
[31m-[m
[31m-              @Override[m
[31m-              public RepositoryRestConfiguration config() {[m
[31m-[m
[31m-                      return super.config();[m
[31m-              }[m
[31m-[m
[31m-              //å…¶ä»–å¯é‡å†™ä»¥configå¼€å¤´çš„æ–¹æ³•[m
[31m-       }[m
[31m-     2ï¼‰å¯¼å…¥æ–¹å¼æ¼”ç¤ºï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       @Import(RepositoryRestMvcConfiguration.class)[m
[31m-       public class AppConfig {[m
[31m-       }[m
[31m-[m
[31m-     å› åœ¨Spring MVCä¸­ä½¿ç”¨Spring Data RESTå’Œåœ¨Spring Boot[m
[31m-ä¸­ä½¿ç”¨æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨å®æˆ˜ç¯èŠ‚è®²è§£Spring Data[m
[31m-RESTã€‚[m
[31m-[m
[31m-8.3.2ã€€Spring Bootçš„æ”¯æŒ[m
[31m-[m
[31m-     Spring Bootå¯¹Spring Data RESTçš„è‡ªåŠ¨é…ç½®æ”¾ç½®åœ¨Restä¸­ï¼Œ[m
[31m-å¦‚å›¾8-33æ‰€ç¤ºã€‚[m
[31m-[m
[31m-              å›¾8-33ã€€Restk[m
[31m-[m
[31m-é€šè¿‡SpringBootRepositoryRestMvcConfigurationç±»çš„æºç æˆ‘[m
[31m-[m
[31m-ä»¬å¯ä»¥å¾—å‡ºï¼ŒSpring  Bootå·²ç»ä¸ºæˆ‘ä»¬è‡ªåŠ¨é…ç½®äº†[m
[31m-[m
[31m-RepositoryRestConfigurationï¼Œæ‰€ä»¥åœ¨Spring Bootä¸­ä½¿ç”¨Spring[m
[31m-[m
[31m-Data RESTåªéœ€å¼•å…¥spring-boot-starter-data-restçš„ä¾èµ–ï¼Œæ— é¡»ä»»[m
[31m-[m
[31m-ä½•é…ç½®å³å¯ä½¿ç”¨ã€‚[m
[31m-[m
[31m-Spring        Booté€šè¿‡åœ¨application.propertiesä¸­é…ç½®[m
[31m-[m
[31m-ä»¥â€œspring.data.restâ€ä¸ºå‰ç¼€çš„å±æ€§æ¥é…ç½®[m
[31m-[m
[31m-RepositoryRestConfigurationï¼Œå¦‚å›¾8-34æ‰€ç¤ºã€‚[m
[31m-                    å›¾8-34ã€€é…ç½®RepositoryRestConfiguration[m
[31m-[m
[31m-8.3.3ã€€å®æˆ˜[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ–°å»ºSpring Booté¡¹ç›®ã€‚[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºJPAï¼ˆspring-boot-starter-data-[m
[31m-jpaï¼‰å’ŒRest Repositoriesï¼ˆspring-boot-starter-data-restï¼‰ã€‚[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-       groupIdï¼šcom.wisely[m
[31m-       arctifactId:ch8_3[m
[31m-       package: com.wisely.ch8_3[m
[31m-[m
[31m-     æ·»åŠ Oracle JDBCé©±åŠ¨ï¼Œå¹¶åœ¨application.propertiesé…ç½®ç›¸å…³[m
[31m-å±æ€§ï¼Œä¸ä¸Šä¾‹ä¿æŒä¸€è‡´ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰å®ä½“ç±»ï¼š[m
[31m-[m
[31m-       package com.wisely.ch8_3.domain;[m
[31m-       import javax.persistence.Entity;[m
[31m-       import javax.persistence.GeneratedValue;[m
[31m-       import javax.persistence.Id;[m
[31m-@Entity[m
[31m-public class Person {[m
[31m-[m
[31m-       @Id[m
[31m-       @GeneratedValue[m
[31m-       private Long id;[m
[31m-[m
[31m-       private String name;[m
[31m-[m
[31m-       private Integer age;[m
[31m-[m
[31m-       private String address;[m
[31m-[m
[31m-       public Person() {[m
[31m-              super();[m
[31m-[m
[31m-       }[m
[31m-       public Person(Long id, String name, Integer age, String address) {[m
[31m-[m
[31m-              super();[m
[31m-              this.id = id;[m
[31m-              this.name = name;[m
[31m-              this.age = age;[m
[31m-              this.address = address;[m
[31m-       }[m
[31m-//çœç•¥getterã€setter[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ3ï¼‰å®ä½“ç±»çš„Repositoryï¼š[m
[31m-[m
[31m-package com.wisely.ch8_3.dao;[m
[31m-[m
[31m-import org.springframework.data.jpa.repository.JpaRepository;[m
[31m-[m
[31m-import com.wisely.ch8_3.domain.Person;[m
[31m-[m
[31m-public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-[m
[31m-       Person findByNameStartsWith(String name);[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ4ï¼‰å®‰è£…Chromeæ’ä»¶Postman REST Clientã€‚[m
[31m-     Postmanæ˜¯ä¸€ä¸ªæ”¯æŒRESTçš„å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æµ‹è¯•[m
[31m-æˆ‘ä»¬çš„RESTèµ„æºã€‚[m
[31m-[m
[31m-     æœ¬èŠ‚å°†ä¼šPostmanæ’ä»¶æ”¾åœ¨æºç ä¸­ï¼Œä¸‹é¢è®²è§£Postmanåœ¨[m
[31m-Chromeä¸‹çš„å®‰è£…æ–¹å¼ï¼Œè¿™ä¸åœ¨Chromeæµè§ˆå™¨ä¸‹å®‰è£…å…¶ä»–æ’ä»¶[m
[31m-æ˜¯ä¸€è‡´çš„ã€‚Postmanæ’ä»¶æ”¾ç½®äºæœ¬èŠ‚ç¤ºä¾‹çš„src/main/resourcesç›®[m
[31m-å½•ä¸‹ã€‚[m
[31m-[m
[31m-     æœ¬ä¹¦ä½¿ç”¨çš„Chromeç‰ˆæœ¬æ˜¯43.0ï¼ŒPostmanç‰ˆæœ¬æ˜¯3.0.4ã€‚æ–°[m
[31m-ç‰ˆæœ¬çš„Chromeé™åˆ¶éChromeåº”ç”¨å•†åº—çš„æ’ä»¶å®‰è£…ã€‚ä¸‹é¢æ¥å®‰[m
[31m-è£…Postmanæ’ä»¶ã€‚[m
[31m-[m
[31m-     â‘ ç”¨è§£å‹ç¼©è½¯ä»¶æ‰“å¼€postman.crxï¼Œå¹¶è§£å‹åˆ°ä»»æ„ç›®å½•ï¼Œå¦‚[m
[31m-å›¾8-35æ‰€ç¤ºã€‚[m
[31m-                              å›¾8-35ã€€æ‰“å¼€postman.crx[m
[31m-[m
[31m-     â‘¡å°†_metadataæ–‡ä»¶å¤¹åç§°ä¿®æ”¹ä¸ºmetadataã€‚[m
[31m-[m
[31m-     æ‰“å¼€Chromeè½¯ä»¶ï¼Œè®¾ç½®â†’æ‰©å±•ç¨‹åºï¼Œæ‰“å¼€â€œå¼€å‘è€…æ¨¡å¼â€ï¼Œ[m
[31m-å¹¶ä»â€œåŠ è½½æ­£åœ¨å¼€å‘çš„æ‰©å±•ç¨‹åº...â€åŠ è½½æˆ‘ä»¬åˆšæ‰è§£å‹çš„ç›®å½•ï¼Œ[m
[31m-å¦‚å›¾8-36æ‰€ç¤ºã€‚[m
[31m-                                 å›¾8-36ã€€åŠ è½½Postman[m
[31m-[m
[31m-     å®‰è£…å®Œæˆåçš„æ•ˆæœå¦‚å›¾8-37æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾8-37ã€€åŠ è½½å®Œæˆ[m
[31m-[m
[31m-     â‘¢åœ¨Chromeåœ°å€æ è¾“å…¥â€œchromeï¼š//appsâ€ï¼Œå¯çœ‹åˆ°[m
[31m-Postmanï¼Œå¦‚å›¾8-38æ‰€ç¤ºã€‚[m
[31m-                   å›¾8-38ã€€é€šè¿‡ChromeæŸ¥çœ‹Postman[m
[31m-[m
[31m-æˆ–è€…é€šè¿‡Chromeæä¾›çš„å¿«æ·æ–¹å¼æ‰“å¼€ï¼Œå¦‚å›¾8-39æ‰€ç¤ºã€‚[m
[31m-        å›¾8-39ã€€é€šè¿‡Chromeæä¾›çš„å¿«æ·æ–¹å¼æ‰“å¼€Postman[m
[31m-[m
[31m-Postmançš„ç•Œé¢å¦‚å›¾8-40æ‰€ç¤ºã€‚[m
[31m-                                 å›¾8-40ã€€Postmanç•Œé¢[m
[31m-[m
[31m-     5.RESTæœåŠ¡æµ‹è¯•[m
[31m-[m
[31m-     åœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Postmanæµ‹è¯•RESTèµ„æºæœåŠ¡ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰jQuery[m
[31m-[m
[31m-     åœ¨å®é™…å¼€å‘ä¸­ï¼Œåœ¨jQueryæˆ‘ä»¬ä½¿ç”¨$.ajaxæ–¹æ³•çš„typeå±æ€§æ¥[m
[31m-ä¿®æ”¹æäº¤æ–¹æ³•ï¼š[m
[31m-[m
[31m-       $.ajax({[m
[31m-                               type: "GET",[m
[31m-                               dataType: "json",[m
[31m-                               url: "http://localhost:8080/persons ",[m
[31m-                               success: function(data){[m
[31m-                                    alert(data);[m
[31m-                               }[m
[31m-[m
[31m-                       });[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰AngularJS[m
[31m-[m
[31m-     åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯ä»¥ä½¿ç”¨$httpå¯¹è±¡æ¥æ“ä½œï¼š[m
[31m-       $http.get(url)[m
[31m-       $http.post(url,data)[m
[31m-       $http.put(url,data)[m
[31m-       $http.delete(url)[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰åˆ—è¡¨[m
[31m-     åœ¨å®é™…å¼€å‘ä¸­ï¼Œåœ¨Postmanä¸­ä½¿ç”¨GETè®¿é—®http://localhostï¼š[m
[31m-8080/personsï¼Œè·å¾—åˆ—è¡¨æ•°æ®ï¼Œå¦‚å›¾8-41æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                å›¾8-41ã€€è·å¾—åˆ—è¡¨æ•°æ®[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰è·å–å•ä¸€å¯¹è±¡[m
[31m-     åœ¨Postmanä¸­ä½¿ç”¨GETè®¿é—®http://localhostï¼š8080/1ï¼Œè·å¾—id[m
[31m-ä¸º1çš„å¯¹è±¡ï¼Œå¦‚å›¾8-42æ‰€ç¤ºã€‚[m
[31m-                              å›¾8-42ã€€è·å¾—idä¸º1çš„å¯¹è±¡[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰æŸ¥è¯¢[m
[31m-[m
[31m-     åœ¨ä¸Šé¢çš„è‡ªå®šä¹‰å®ä½“ç±»Repositoryä¸­å®šä¹‰äº†[m
[31m-findByNameStartsWithæ–¹æ³•ï¼Œè‹¥æƒ³æ­¤æ–¹æ³•ä¹Ÿæš´éœ²ä¸ºRESTèµ„æºï¼Œ[m
[31m-éœ€åšå¦‚ä¸‹ä¿®æ”¹ï¼š[m
[31m-[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-[m
[31m-              @RestResource(path = "nameStartsWith", rel = "nameStartsWith")[m
[31m-              Person findByNameStartsWith(@Param("name")String name);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     æ­¤æ—¶åœ¨Postmanä¸­ä½¿ç”¨GETè®¿é—®http://localhostï¼š[m
[31m-8080/persons/search/nameStartsWithï¼Ÿname=æ±ªï¼Œå¯å®ç°æŸ¥è¯¢æ“[m
[31m-ä½œï¼Œå¦‚å›¾8-43æ‰€ç¤ºã€‚[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰åˆ†é¡µ[m
[31m-[m
[31m-     åœ¨Postmanä¸­ä½¿ç”¨GETè®¿é—®http://localhostï¼š8080/persons/ï¼Ÿ[m
[31m-page=1&size=2ï¼Œpage=1å³ç¬¬äºŒé¡µï¼Œsize=2å³æ¯é¡µæ•°é‡ä¸º2ï¼Œå¦‚[m
[31m-å›¾8-44æ‰€ç¤ºã€‚[m
[31m-                              å›¾8-43ã€€å›åº”ç°æŸ¥è¯¢æ“ä½œ[m
[31m-[m
[31m-                                      å›¾8-44ã€€åˆ†å¸ƒ[m
[31m-[m
[31m-     ä»è¿”å›ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ä¸ä»…èƒ½è·å¾—å½“å‰åˆ†é¡µçš„å¯¹è±¡ï¼Œ[m
[31m-è€Œä¸”è¿˜ç»™å‡ºäº†æˆ‘ä»¬ä¸Šä¸€é¡µã€ä¸‹ä¸€é¡µã€ç¬¬ä¸€é¡µã€æœ€åä¸€é¡µçš„[m
[31m-RESTèµ„æºè·¯å¾„ã€‚[m
[31m-[m
[31m-     ï¼ˆ7ï¼‰æ’åº[m
[31m-     åœ¨Postmanä¸­ä½¿ç”¨GETè®¿é—®localhostï¼š8080/persons/ï¼Ÿ[m
[31m-sort=ageï¼Œdescï¼Œå³æŒ‰ç…§ageå±æ€§å€’åºï¼Œå¦‚å›¾8-45æ‰€ç¤ºã€‚[m
[31m-                                      å›¾8-45ã€€æ’åº[m
[31m-[m
[31m-     ï¼ˆ8ï¼‰ä¿å­˜[m
[31m-[m
[31m-     å‘http://localhostï¼š8080/personså‘èµ·POSTè¯·æ±‚ï¼Œå°†æˆ‘ä»¬è¦[m
[31m-ä¿å­˜çš„æ•°æ®æ”¾ç½®åœ¨è¯·æ±‚ä½“ä¸­ï¼Œæ•°æ®ç±»å‹è®¾ç½®ä¸ºJSONï¼ŒJSONå†…[m
[31m-å®¹å¦‚å›¾8-46æ‰€ç¤ºã€‚[m
[31m-[m
[31m-       {"name":"cc","address":"æˆéƒ½","age":24}[m
[31m-                                      å›¾8-46ã€€ä¿å­˜[m
[31m-[m
[31m-     é€šè¿‡è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œä¿å­˜æˆåŠŸåï¼Œæˆ‘ä»¬çš„æ–°æ•°æ®çš„idä¸º[m
[31m-21ã€‚[m
[31m-[m
[31m-     ï¼ˆ9ï¼‰æ›´æ–°[m
[31m-[m
[31m-     ç°åœ¨æˆ‘ä»¬æ›´æ–°æ–°å¢çš„idä¸º21çš„æ•°æ®ï¼Œç”¨PUTæ–¹å¼è®¿é—®[m
[31m-http://localhostï¼š8080/persons/21ï¼Œå¹¶ä¿®æ”¹æäº¤çš„æ•°æ®ï¼Œå¦‚å›¾8-[m
[31m-47æ‰€ç¤ºã€‚[m
[31m-[m
[31m-       {"name":"cc2","address":"æˆéƒ½","age":23}[m
[31m-                                      å›¾8-47ã€€æ›´æ–°[m
[31m-[m
[31m-     ä»è¾“å‡ºæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ•°æ®æ›´æ–°å·²æˆåŠŸã€‚[m
[31m-[m
[31m-     ï¼ˆ10ï¼‰åˆ é™¤[m
[31m-[m
[31m-     åœ¨è¿™ä¸€æ­¥æˆ‘ä»¬åˆ é™¤åˆšæ‰æ–°å¢çš„idä¸º21çš„æ•°æ®ï¼Œä½¿ç”¨[m
[31m-DELETEæ–¹å¼è®¿é—®http://localhostï¼š8080/persons/21ï¼Œå¦‚å›¾8-48[m
[31m-æ‰€ç¤ºã€‚[m
[31m-                                      å›¾8-48ã€€åˆ é™¤[m
[31m-[m
[31m-     æ­¤æ—¶å†ç”¨GETæ–¹å¼è®¿é—®http://localhostï¼š8080/persons/21ï¼Œ[m
[31m-å¦‚å›¾8-49æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾8-49ã€€è·å–å¤±è´¥[m
[31m-[m
[31m-     è¿”å›ç»“æœä¸º404 Not Foundï¼Œè¯´æ˜æ‰€è®¿é—®çš„RESTèµ„æºä¸å­˜[m
[31m-åœ¨ã€‚[m
[31m-     6.å®šåˆ¶[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰å®šåˆ¶æ ¹è·¯å¾„[m
[31m-[m
[31m-     åœ¨ä¸Šé¢çš„å®æˆ˜ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¿é—®çš„RESTèµ„æºçš„è·¯å¾„æ˜¯åœ¨[m
[31m-æ ¹ç›®å½•ä¸‹çš„ï¼Œå³http://localhostï¼š8080/personsï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦[m
[31m-å®šåˆ¶æ ¹è·¯å¾„çš„è¯ï¼Œåªéœ€åœ¨Spring Bootçš„application.propertiesä¸‹[m
[31m-å¢åŠ å¦‚ä¸‹å®šä¹‰å³å¯ï¼š[m
[31m-[m
[31m-       spring.data.rest.base-path= /api[m
[31m-[m
[31m-     æ­¤æ—¶RESTèµ„æºçš„è·¯å¾„å˜æˆäº†http://localhostï¼š[m
[31m-8080/api/personsã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰å®šåˆ¶èŠ‚ç‚¹è·¯å¾„[m
[31m-[m
[31m-     ä¸Šä¾‹å®æˆ˜ä¸­ï¼Œæˆ‘ä»¬çš„èŠ‚ç‚¹è·¯å¾„ä¸ºhttp://localhostï¼š[m
[31m-8080/personsï¼Œè¿™æ˜¯Spring Data RESTçš„é»˜è®¤è§„åˆ™ï¼Œå°±æ˜¯åœ¨å®ä½“[m
[31m-ç±»ä¹‹ååŠ â€œsâ€æ¥å½¢æˆè·¯å¾„ã€‚æˆ‘ä»¬çŸ¥é“personçš„å¤æ•°æ˜¯peopleè€Œä¸[m
[31m-æ˜¯personsï¼Œåœ¨ç±»ä¼¼çš„æƒ…å†µä¸‹è¦å¯¹æ˜ å°„çš„åç§°è¿›è¡Œä¿®æ”¹çš„è¯ï¼Œæˆ‘[m
[31m-ä»¬éœ€è¦åœ¨å®ä½“ç±»Repositoryä¸Šä½¿ç”¨@RepositoryRestResourceæ³¨[m
[31m-è§£çš„pathå±æ€§è¿›è¡Œä¿®æ”¹ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       @RepositoryRestResource(path = "people")[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-[m
[31m-              @RestResource(path = "nameStartsWith", rel = "nameStartsWith")[m
[31m-              Person findByNameStartsWith(@Param("name")String name);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     æ­¤æ—¶æˆ‘ä»¬è®¿é—®RESTæœåŠ¡çš„åœ°å€å˜ä¸ºï¼šhttp://localhostï¼š[m
[31m-8080/api/peopleã€‚[m
[31m-8.4ã€€å£°åå¼äº‹åŠ¡[m
[31m-[m
[31m-8.4.1ã€€Springçš„äº‹åŠ¡æœºåˆ¶[m
[31m-[m
[31m-     æ‰€æœ‰çš„æ•°æ®è®¿é—®æŠ€æœ¯éƒ½æœ‰äº‹åŠ¡å¤„ç†æœºåˆ¶ï¼Œè¿™äº›æŠ€æœ¯æä¾›äº†[m
[31m-APIç”¨æ¥å¼€å¯äº‹åŠ¡ã€æäº¤äº‹åŠ¡æ¥å®Œæˆæ•°æ®æ“ä½œï¼Œæˆ–è€…åœ¨å‘ç”Ÿé”™[m
[31m-è¯¯çš„æ—¶å€™å›æ»šæ•°æ®ã€‚[m
[31m-[m
[31m-     è€ŒSpringçš„äº‹åŠ¡æœºåˆ¶æ˜¯ç”¨ç»Ÿä¸€çš„æœºåˆ¶æ¥å¤„ç†ä¸åŒæ•°æ®è®¿é—®[m
[31m-æŠ€æœ¯çš„äº‹åŠ¡å¤„ç†ã€‚Springçš„äº‹åŠ¡æœºåˆ¶æä¾›äº†ä¸€ä¸ª[m
[31m-PlatformTransactionManageræ¥å£ï¼Œä¸åŒçš„æ•°æ®è®¿é—®æŠ€æœ¯çš„äº‹åŠ¡[m
[31m-ä½¿ç”¨ä¸åŒçš„æ¥å£å®ç°ï¼Œå¦‚è¡¨8-3æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                            è¡¨8-3ã€€æ•°æ®è®¿é—®æŠ€æœ¯åŠå®ç°[m
[31m-[m
[31m-     åœ¨ç¨‹åºä¸­å®šä¹‰äº‹åŠ¡ç®¡ç†å™¨çš„ä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-         @Bean[m
[31m-         public PlatformTransactionManager transactionManager() {[m
[31m-[m
[31m-              JpaTransactionManager transactionManager = new JpaTransactionManage[m
[31m-              transactionManager.setDataSource(dataSource());[m
[31m-              return transactionManager;[m
[31m-         }[m
[31m-8.4.2ã€€å£°åå¼äº‹åŠ¡[m
[31m-[m
[31m-     Springæ”¯æŒå£°åå¼äº‹åŠ¡ï¼Œå³ä½¿ç”¨æ³¨è§£æ¥é€‰æ‹©éœ€è¦ä½¿ç”¨äº‹åŠ¡[m
[31m-çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨@Transactionalæ³¨è§£åœ¨æ–¹æ³•ä¸Šè¡¨æ˜è¯¥æ–¹æ³•éœ€è¦[m
[31m-äº‹åŠ¡æ”¯æŒã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäºAOPçš„å®ç°æ“ä½œï¼Œè¯»è€…å¯ä»¥é‡æ¸©1.3.3[m
[31m-èŠ‚ä¸­ä½¿ç”¨æ³¨è§£å¼çš„æ‹¦æˆªæ–¹å¼æ¥ç†è§£Springçš„å£°åå¼äº‹åŠ¡ã€‚è¢«æ³¨[m
[31m-è§£çš„æ–¹æ³•åœ¨è¢«è°ƒç”¨æ—¶ï¼ŒSpringå¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå½“æ–¹æ³•æ— å¼‚[m
[31m-å¸¸è¿è¡Œç»“æŸåï¼ŒSpringä¼šæäº¤è¿™ä¸ªäº‹åŠ¡ã€‚[m
[31m-[m
[31m-@Transactional                  id, String name) {[m
[31m-[m
[31m-public void saveSomething(Long[m
[31m-       //æ•°æ®åº“æ“ä½œ[m
[31m-[m
[31m-}[m
[31m-[m
[31m-     åœ¨æ­¤å¤„éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ­¤@Transactionalæ³¨è§£æ¥è‡ª[m
[31m-org.springframework.transaction.annotationåŒ…ï¼Œè€Œä¸æ˜¯[m
[31m-javax.transactionã€‚[m
[31m-[m
[31m-     Springæä¾›äº†ä¸€ä¸ª@EnableTransactionManagementæ³¨è§£åœ¨é…[m
[31m-ç½®ç±»ä¸Šæ¥å¼€å¯å£°åå¼äº‹åŠ¡çš„æ”¯æŒã€‚ä½¿ç”¨äº†[m
[31m-@EnableTransactionManagementåï¼ŒSpringå®¹å™¨ä¼šè‡ªåŠ¨æ‰«ææ³¨[m
[31m-è§£@Transactionalçš„æ–¹æ³•å’Œç±»ã€‚@EnableTransactionManagement[m
[31m-çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableTransactionManagement[m
[31m-       public class AppConfig {[m
[31m-[m
[31m-       }[m
[31m-8.4.3ã€€æ³¨è§£äº‹åŠ¡è¡Œä¸º[m
[31m-[m
[31m-     @Transactionalæœ‰å¦‚è¡¨8-4æ‰€ç¤ºçš„å±æ€§æ¥å®šåˆ¶äº‹åŠ¡è¡Œä¸ºã€‚[m
[31m-[m
[31m-                            è¡¨8-4ã€€@Transactionalçš„å±æ€§[m
[31m-[m
[31m-8.4.4ã€€ç±»çº§åˆ«ä½¿ç”¨@Transactional[m
[31m-[m
[31m-     @Transactionalä¸ä»…å¯ä»¥æ³¨è§£åœ¨æ–¹æ³•ä¸Šï¼Œä¹Ÿå¯ä»¥æ³¨è§£åœ¨ç±»[m
[31m-ä¸Šã€‚å½“æ³¨è§£åœ¨ç±»ä¸Šçš„æ—¶å€™æ„å‘³ç€æ­¤ç±»çš„æ‰€æœ‰publicæ–¹æ³•éƒ½æ˜¯å¼€[m
[31m-å¯äº‹åŠ¡çš„ã€‚å¦‚æœç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«åŒæ—¶ä½¿ç”¨äº†@Transactional[m
[31m-æ³¨è§£ï¼Œåˆ™ä½¿ç”¨åœ¨ç±»çº§åˆ«çš„æ³¨è§£ä¼šé‡è½½æ–¹æ³•çº§åˆ«çš„æ³¨è§£ã€‚[m
[31m-[m
[31m-8.4.5ã€€Spring Data JPAçš„äº‹åŠ¡æ”¯æŒ[m
[31m-[m
[31m-     Spring Data JPAå¯¹æ‰€æœ‰çš„é»˜è®¤æ–¹æ³•éƒ½å¼€å¯äº†äº‹åŠ¡æ”¯æŒï¼Œä¸”[m
[31m-æŸ¥è¯¢ç±»äº‹åŠ¡é»˜è®¤å¯ç”¨readOnly=trueå±æ€§ã€‚[m
[31m-[m
[31m-     è¿™äº›æˆ‘ä»¬åœ¨SimpleJpaRepositoryçš„æºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸‹é¢[m
[31m-å°±æ¥çœ‹çœ‹ç¼©å‡çš„SimpleJpaRepositoryçš„æºç ï¼š[m
[31m-[m
[31m-       @Repository[m
[31m-       @Transactional(readOnly = true)[m
[31m-       public class SimpleJpaRepository<T, ID extends Serializable> implements[m
[31m-[m
[31m-                      JpaSpecificationExecutor<T> {[m
[31m-[m
[31m-              @Transactional[m
[31m-              public void delete(ID id) {}[m
[31m-              @Transactional[m
[31m-              public void delete(T entity) {}[m
[31m-              @Transactional[m
[31m-              public void delete(Iterable<? extends T> entities) {}[m
[31m-              @Transactional[m
[31m-              public void deleteInBatch(Iterable<T> entities) {}[m
[31m-              @Transactional[m
[31m-              public void deleteAll() {}[m
[31m-              @Transactional[m
[31m-              public void deleteAllInBatch() {}[m
[31m-              public T findOne(ID id) {}[m
[31m-              @Override[m
[31m-              public T getOne(ID id) {}[m
[31m-              public boolean exists(ID id) {}[m
[31m-              public List<T> findAll() {}[m
[31m-              public List<T> findAll(Iterable<ID> ids) {}[m
[31m-              public List<T> findAll(Sort sort) {}[m
[31m-              public Page<T> findAll(Pageable pageable) {}[m
[31m-              public T findOne(Specification<T> spec) {}[m
[31m-              public List<T> findAll(Specification<T> spec) {}[m
[31m-              public Page<T> findAll(Specification<T> spec, Pageable pageable) {}[m
[31m-              public List<T> findAll(Specification<T> spec, Sort sort) {}[m
[31m-              public long count() {}[m
[31m-              public long count(Specification<T> spec) {}[m
[31m-              @Transactional[m
[31m-              public <S extends T> S save(S entity) {}[m
[31m-[m
[31m-              @Transactional[m
[31m-              public <S extends T> S saveAndFlush(S entity) {}[m
[31m-              @Transactional[m
[31m-              public <S extends T> List<S> save(Iterable<S> entities) {}[m
[31m-              @Transactional[m
[31m-              public void flush() {}[m
[31m-       }[m
[31m-[m
[31m-     ä»æºç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒSimpleJpaRepositoryåœ¨ç±»çº§åˆ«å®šä¹‰[m
[31m-äº†@Transactionalï¼ˆreadOnly=trueï¼‰ï¼Œè€Œåœ¨å’Œsaveã€deleteç›¸å…³[m
[31m-çš„æ“ä½œé‡å†™äº†@Transactionalå±æ€§ï¼Œæ­¤æ—¶readOnlyå±æ€§æ˜¯falseï¼Œ[m
[31m-å…¶ä½™æŸ¥è¯¢æ“ä½œreadOnlyä»ç„¶ä¸ºfalseã€‚[m
[31m-[m
[31m-8.4.6ã€€Spring Bootçš„äº‹åŠ¡æ”¯æŒ[m
[31m-[m
[31m-     1.è‡ªåŠ¨é…ç½®çš„äº‹åŠ¡ç®¡ç†å™¨[m
[31m-[m
[31m-     åœ¨ä½¿ç”¨JDBCä½œä¸ºæ•°æ®è®¿é—®æŠ€æœ¯çš„æ—¶å€™ï¼ŒSpring Bootä¸ºæˆ‘ä»¬[m
[31m-å®šä¹‰äº†PlatformTransactionManagerçš„å®ç°[m
[31m-DataSourceTransactionManagerçš„Beanï¼›é…ç½®è§[m
[31m-org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManager[m
[31m-ç±»ä¸­çš„å®šä¹‰ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              @ConditionalOnMissingBean[m
[31m-              @ConditionalOnBean(DataSource.class)[m
[31m-              public PlatformTransactionManager transactionManager() {[m
[31m-[m
[31m-                      return new DataSourceTransactionManager(this.dataSource);[m
[31m-}[m
[31m-[m
[31m-     åœ¨ä½¿ç”¨JPAä½œä¸ºæ•°æ®è®¿é—®æŠ€æœ¯çš„æ—¶å€™ï¼ŒSpring Bootä¸ºæˆ‘ä»¬[m
[31m-äº†å®šä¹‰ä¸€ä¸ªPlatformTransactionManagerçš„å®ç°[m
[31m-JpaTransactionManagerçš„Beanï¼›é…ç½®è§[m
[31m-org.springframework.boot.autoconfigure.orm.jpa.JpaBaseConfiguration.class[m
[31m-ç±»ä¸­çš„å®šä¹‰ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              @ConditionalOnMissingBean(PlatformTransactionManager.class)[m
[31m-              public PlatformTransactionManager transactionManager() {[m
[31m-[m
[31m-                      return new JpaTransactionManager();[m
[31m-              }[m
[31m-[m
[31m-2.è‡ªåŠ¨å¼€å¯æ³¨è§£äº‹åŠ¡çš„æ”¯æŒ[m
[31m-[m
[31m-Spring  Bootä¸“é—¨ç”¨äºé…ç½®äº‹åŠ¡çš„ç±»ä¸ºï¼š[m
[31m-[m
[31m-org.springframework.boot.autoconfigure.transaction.TransactionAutoConfigur[m
[31m-[m
[31m-æ­¤é…ç½®ç±»ä¾èµ–äºJpaBaseConfigurationå’ŒDataSource[m
[31m-[m
[31m-TransactionManagerAutoConfigurationã€‚[m
[31m-[m
[31m-     è€Œåœ¨DataSourceTransactionManagerAutoConfigurationé…ç½®[m
[31m-é‡Œè¿˜å¼€å¯äº†å¯¹å£°åå¼äº‹åŠ¡çš„æ”¯æŒï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-@ConditionalOnMissingBean(AbstractTransactionManagementConfiguratio[m
[31m-@Configuration[m
[31m-@EnableTransactionManagement[m
[31m-protected static class TransactionManagementConfiguration {[m
[31m-[m
[31m-}[m
[31m-æ‰€ä»¥åœ¨Spring                  Bootä¸­ï¼Œæ— é¡»æ˜¾ç¤ºå¼€å¯ä½¿ç”¨[m
[31m-[m
[31m-@EnableTransactionManagementæ³¨è§£ã€‚[m
[31m-[m
[31m-8.4.7ã€€å®æˆ˜[m
[31m-[m
[31m-     åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä½¿ç”¨Spring Booté»˜è®¤çš„é…ç½®å°±èƒ½æ»¡è¶³æˆ‘ä»¬[m
[31m-ç»å¤§å¤šæ•°éœ€æ±‚ã€‚åœ¨æœ¬èŠ‚çš„å®æˆ˜é‡Œï¼Œæˆ‘ä»¬å°†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨[m
[31m-@Transactionalä½¿ç”¨å¼‚å¸¸å¯¼è‡´æ•°æ®å›æ»šå’Œä½¿ç”¨å¼‚å¸¸è®©æ•°æ®ä¸å›[m
[31m-æ»šã€‚[m
[31m-[m
[31m-     1.æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºJPAï¼ˆspring-boot-starter-data-[m
[31m-jpaï¼‰å’ŒWebï¼ˆspring-boot-starter-webï¼‰ã€‚[m
[31m-[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-groupIdï¼šcom.wisely[m
[31m-arctifactId:ch8_4[m
[31m-package: com.wisely.ch8_4[m
[31m-[m
[31m-     æ·»åŠ Oracle JDBCé©±åŠ¨ï¼Œå¹¶åœ¨application.propertiesé…ç½®ç›¸å…³[m
[31m-å±æ€§ï¼Œä¸ä¸Šä¾‹ä¿æŒä¸€è‡´ã€‚[m
[31m-[m
[31m-     2.å®ä½“ç±»[m
[31m-[m
[31m-       import javax.persistence.Entity;[m
[31m-       import javax.persistence.GeneratedValue;[m
[31m-       import javax.persistence.Id;[m
[31m-[m
[31m-       @Entity[m
[31m-       public class Person {[m
[31m-[m
[31m-              @Id[m
[31m-       @GeneratedValue[m
[31m-       private Long id;[m
[31m-       private String name;[m
[31m-       private Integer age;[m
[31m-       private String address;[m
[31m-       public Person() {[m
[31m-[m
[31m-              super();[m
[31m-       }[m
[31m-       public Person(Long id, String name, Integer age, String address) {[m
[31m-[m
[31m-              super();[m
[31m-              this.id = id;[m
[31m-              this.name = name;[m
[31m-              this.age = age;[m
[31m-              this.address = address;[m
[31m-       }[m
[31m-       //çœç•¥getterã€setter[m
[31m-}[m
[31m-[m
[31m-3.å®ä½“ç±»Repository[m
[31m-[m
[31m-import org.springframework.data.jpa.repository.JpaRepository;[m
[31m-import com.wisely.ch8_4.domain.Person;[m
[31m-public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-[m
[31m-}[m
[31m-[m
[31m-4.ä¸šåŠ¡æœåŠ¡Service[m
[31m-ï¼ˆ1ï¼‰æœåŠ¡æ¥å£ï¼š[m
[31m-[m
[31m-package com.wisely.ch8_4.service;[m
[31m-import com.wisely.ch8_4.domain.Person;[m
[31m-[m
[31m-public interface DemoService {[m
[31m-       public Person savePersonWithRollBack(Person person);[m
[31m-       public Person savePersonWithoutRollBack(Person person);[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ2ï¼‰æœåŠ¡å®ç°ï¼š[m
[31m-[m
[31m-package com.wisely.ch8_4.service.impl;[m
[31m-[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.stereotype.Service;[m
[31m-import org.springframework.transaction.annotation.Transactional;[m
[31m-[m
[31m-import com.wisely.ch8_4.dao.PersonRepository;[m
[31m-import com.wisely.ch8_4.domain.Person;[m
[31m-import com.wisely.ch8_4.service.DemoService;[m
[31m-@Service[m
[31m-public class DemoServiceImpl implements DemoService {[m
[31m-[m
[31m-       @Autowired[m
[31m-       PersonRepository personRepository; //1[m
[31m-[m
[31m-                                                             @Transactional(rollbackFor=[m
[31m-{IllegalArgumentException.class}) //2[m
[31m-[m
[31m-       public Person savePersonWithRollBack(Person person){[m
[31m-              Person p =personRepository.save(person);[m
[31m-[m
[31m-              if(person.getName().equals("æ±ªäº‘é£")){[m
[31m-                       throw new IllegalArgumentException("æ±ªäº‘é£å·²å­˜åœ¨ï¼Œ[m
[31m-[m
[31m-æ•°æ®å°†å›æ»š"); //3[m
[31m-              }[m
[31m-              return p;[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-                                                         @Transactional(noRollbackFor=[m
[31m-{IllegalArgumentException.class}) //4[m
[31m-[m
[31m-       public Person savePersonWithoutRollBack(Person person){[m
[31m-              Person p =personRepository.save(person);[m
[31m-[m
[31m-              if(person.getName().equals("æ±ªäº‘é£")){[m
[31m-                          throw new IllegalArgumentException("æ±ªäº‘é£è™½å·²å­˜[m
[31m-       åœ¨ï¼Œæ•°æ®å°†ä¸ä¼šå›æ»š");[m
[31m-                      }[m
[31m-                      return p;[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ å¯ä»¥ç›´æ¥æ³¨å…¥æˆ‘ä»¬çš„RersonRepositoryçš„Beanã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨@Transactionalæ³¨è§£çš„rollbackForå±æ€§ï¼ŒæŒ‡å®šç‰¹å®šå¼‚[m
[31m-å¸¸æ—¶ï¼Œæ•°æ®å›æ»šã€‚[m
[31m-[m
[31m-     â‘¢ç¡¬ç¼–ç æ‰‹åŠ¨è§¦å‘å¼‚å¸¸ã€‚[m
[31m-[m
[31m-     â‘£ä½¿ç”¨@Transactionalæ³¨è§£çš„noRollbackForå±æ€§ï¼ŒæŒ‡å®šç‰¹å®š[m
[31m-å¼‚å¸¸æ—¶ï¼Œæ•°æ®å›æ»šã€‚[m
[31m-[m
[31m-     5.æ§åˆ¶å™¨[m
[31m-[m
[31m-       package com.wisely.ch8_4.web;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-       import com.wisely.ch8_4.domain.Person;[m
[31m-       import com.wisely.ch8_4.service.DemoService;[m
[31m-[m
[31m-       @RestController[m
[31m-       public class MyController {[m
[31m-[m
[31m-              @Autowired[m
[31m-              DemoService demoService;[m
[31m-[m
[31m-              @RequestMapping("/rollback")[m
[31m-              public Person rollback(Person person){ //1[m
[31m-[m
[31m-                      return demoService.savePersonWithRollBack(person);[m
[31m-              }[m
[31m-              @RequestMapping("/norollback")[m
[31m-              public Person noRollback(Person person){//2[m
[31m-[m
[31m-                      return demoService.savePersonWithoutRollBack(person);[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ æµ‹è¯•å›æ»šæƒ…å†µã€‚[m
[31m-     â‘¡æµ‹è¯•ä¸å›æ»šæƒ…å†µã€‚[m
[31m-     6.è¿è¡Œ[m
[31m-     ä¸ºäº†æ›´æ¸…æ¥šåœ°ç†è§£å›æ»šï¼Œæˆ‘ä»¬ä»¥debugï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰å¯åŠ¨[m
[31m-ç¨‹åºã€‚å¹¶åœ¨DemoServiceImplçš„savePersonWithRollBackæ–¹æ³•æ‰“[m
[31m-ä¸Šæ–­ç‚¹ã€‚[m
[31m-     ï¼ˆ1ï¼‰å›æ»š[m
[31m-     è®¿é—®http://localhostï¼š8080/rollbackï¼Ÿname=æ±ªäº‘é£[m
[31m-&age=32ï¼Œè°ƒè¯•è‡³savePersonWithRollBackæ–¹æ³•ï¼Œå¦‚å›¾8-50æ‰€[m
[31m-ç¤ºã€‚[m
[31m-                                      å›¾8-50ã€€å›æ»š[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥å‘ç°æ•°æ®å·²ä¿å­˜ä¸”è·å¾—idä¸º27ã€‚ç»§ç»­æ‰§è¡ŒæŠ›å‡ºå¼‚[m
[31m-å¸¸ï¼Œå°†å¯¼è‡´æ•°æ®å›æ»šï¼Œå¦‚å›¾8-51æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾8-51ã€€æ•°æ®å›æ»š[m
[31m-[m
[31m-     æˆ‘ä»¬æŸ¥çœ‹æ•°æ®åº“ï¼Œå¹¶æ²¡æœ‰æ–°å¢æ•°æ®ï¼Œå¦‚å›¾8-52æ‰€ç¤ºã€‚[m
[31m-                                 å›¾8-52ã€€æœªæ–°å¢æ•°æ®[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰ä¸å›æ»š[m
[31m-     è®¿é—®http://localhostï¼š8080/norollbackï¼Ÿname=æ±ªäº‘é£[m
[31m-&age=32ï¼Œè™½ç„¶æˆ‘ä»¬ä¹ŸæŠ›å‡ºäº†å¼‚å¸¸ï¼Œå¦‚å›¾8-53æ‰€ç¤ºã€‚ä½†æ•°æ®å¹¶[m
[31m-æ²¡æœ‰å›æ»šï¼Œä¸”æ•°æ®åº“è¿˜æ–°å¢äº†ä¸€æ¡è®°å½•ï¼Œå¦‚å›¾8-54æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                 å›¾8-53ã€€æ•°æ®ä¸å›æ»š[m
[31m-å›¾8-54ã€€æ–°å¢äº†ä¸€æ¡æ•°æ®[m
[31m-8.5ã€€æ•°æ®ç¼“å­˜Cache[m
[31m-[m
[31m-     æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªç¨‹åºçš„ç“¶é¢ˆåœ¨äºæ•°æ®åº“ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“å†…å­˜çš„[m
[31m-é€Ÿåº¦æ˜¯å¤§å¤§å¿«äºç¡¬ç›˜çš„é€Ÿåº¦çš„ã€‚å½“æˆ‘ä»¬éœ€è¦é‡å¤åœ°è·å–ç›¸åŒçš„[m
[31m-æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€æ¬¡åˆä¸€æ¬¡çš„è¯·æ±‚æ•°æ®åº“æˆ–è€…è¿œç¨‹æœåŠ¡ï¼Œå¯¼[m
[31m-è‡´å¤§é‡çš„æ—¶é—´è€—è´¹åœ¨æ•°æ®åº“æŸ¥è¯¢æˆ–è€…è¿œç¨‹æ–¹æ³•è°ƒç”¨ä¸Šï¼Œå¯¼è‡´ç¨‹[m
[31m-åºæ€§èƒ½çš„æ¶åŒ–ï¼Œè¿™ä¾¿æ˜¯æ•°æ®ç¼“å­˜è¦è§£å†³çš„é—®é¢˜ã€‚[m
[31m-[m
[31m-8.5.1ã€€Springç¼“å­˜æ”¯æŒ[m
[31m-[m
[31m-     Springå®šä¹‰äº†org.springframework.cache.CacheManagerå’Œ[m
[31m-org.springframework.cache.Cacheæ¥å£ç”¨æ¥ç»Ÿä¸€ä¸åŒçš„ç¼“å­˜çš„æŠ€[m
[31m-æœ¯ã€‚å…¶ä¸­ï¼ŒCacheManageræ˜¯Springæä¾›çš„å„ç§ç¼“å­˜æŠ€æœ¯æŠ½è±¡æ¥[m
[31m-å£ï¼ŒCacheæ¥å£åŒ…å«ç¼“å­˜çš„å„ç§æ“ä½œï¼ˆå¢åŠ ã€åˆ é™¤ã€è·å¾—ç¼“[m
[31m-å­˜ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šç›´æ¥å’Œæ­¤æ¥å£æ‰“äº¤é“ï¼‰ã€‚[m
[31m-[m
[31m-     1.Springæ”¯æŒçš„CacheManager[m
[31m-[m
[31m-     é’ˆå¯¹ä¸åŒçš„ç¼“å­˜æŠ€æœ¯ï¼Œéœ€è¦å®ç°ä¸åŒçš„CacheManagerï¼Œ[m
[31m-Springå®šä¹‰äº†å¦‚è¡¨8-5æ‰€ç¤ºçš„CacheManagerå®ç°ã€‚[m
[31m-[m
[31m-                              è¡¨8-5ã€€CacheManagerå®ç°[m
[31m-     åœ¨æˆ‘ä»¬ä½¿ç”¨ä»»æ„ä¸€ä¸ªå®ç°çš„CacheManagerçš„æ—¶å€™ï¼Œéœ€æ³¨å†Œ[m
[31m-å®ç°çš„CacheManagerçš„Beanï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       @Bean[m
[31m-       public EhCacheCacheManager cacheManager(CacheManager ehCacheCacheManage[m
[31m-[m
[31m-              return new EhCacheCacheManager(ehCacheCacheManager);[m
[31m-       }[m
[31m-[m
[31m-     å½“ç„¶ï¼Œæ¯ç§ç¼“å­˜æŠ€æœ¯éƒ½æœ‰å¾ˆå¤šçš„é¢å¤–é…ç½®ï¼Œä½†é…ç½®[m
[31m-cacheManageræ˜¯å¿…ä¸å¯å°‘çš„ã€‚[m
[31m-[m
[31m-     2.å£°åå¼ç¼“å­˜æ³¨è§£[m
[31m-     Springæä¾›äº†4ä¸ªæ³¨è§£æ¥å£°æ˜ç¼“å­˜è§„åˆ™ï¼ˆåˆæ˜¯ä½¿ç”¨æ³¨è§£å¼çš„[m
[31m-AOPçš„ä¸€ä¸ªç”ŸåŠ¨ä¾‹å­ï¼‰ã€‚è¿™å››ä¸ªæ³¨è§£å¦‚è¡¨8-6æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                               è¡¨8-6ã€€å£°æ˜å¼ç¼“å­˜æ³¨æ„[m
[31m-[m
[31m-     @Cacheableã€@CachePutã€@CacheEvitéƒ½æœ‰valueå±æ€§ï¼ŒæŒ‡[m
[31m-å®šçš„æ˜¯è¦ä½¿ç”¨çš„ç¼“å­˜åç§°ï¼›keyå±æ€§æŒ‡å®šçš„æ˜¯æ•°æ®åœ¨ç¼“å­˜ä¸­çš„[m
[31m-å­˜å‚¨çš„é”®ã€‚[m
[31m-[m
[31m-     3.å¼€å¯å£°åå¼ç¼“å­˜æ”¯æŒ[m
[31m-     å¼€å¯å£°åå¼ç¼“å­˜æ”¯æŒååˆ†ç®€å•ï¼Œåªéœ€åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨[m
[31m-@EnableCachingæ³¨è§£å³å¯ï¼Œä¾‹å¦‚ï¼š[m
[31m-@Configuration[m
[31m-@EnableCaching[m
[31m-public class AppConfig {[m
[31m-[m
[31m-}[m
[31m-[m
[31m-8.5.2ã€€Spring Bootçš„æ”¯æŒ[m
[31m-[m
[31m-     åœ¨Springä¸­ä½¿ç”¨ç¼“å­˜æŠ€æœ¯çš„å…³é”®æ˜¯é…ç½®CacheManagerï¼Œè€Œ[m
[31m-Spring Bootä¸ºæˆ‘ä»¬è‡ªåŠ¨é…ç½®äº†å¤šä¸ªCacheManagerçš„å®ç°ã€‚[m
[31m-[m
[31m-Spring  Bootçš„CacheManagerçš„è‡ªåŠ¨é…ç½®æ”¾ç½®åœ¨[m
[31m-[m
[31m-org.springframework.boot.autoconfigure.cacheåŒ…ä¸­ï¼Œå¦‚å›¾8-55æ‰€[m
[31m-[m
[31m-ç¤ºã€‚[m
[31m-                        å›¾8-55ã€€CacheManagerçš„è‡ªåŠ¨é…ç½®[m
[31m-[m
[31m-     é€šè¿‡å›¾8-56æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒSpring Bootä¸ºæˆ‘ä»¬è‡ªåŠ¨é…ç½®äº†[m
[31m-EhCacheCacheConfigurationï¼ˆä½¿ç”¨EhCacheï¼‰ã€[m
[31m-GenericCacheConfigurationï¼ˆä½¿ç”¨Collectionï¼‰ã€[m
[31m-GuavaCacheConfigurationï¼ˆä½¿ç”¨Guavaï¼‰ã€[m
[31m-HazelcastCacheConfigurationï¼ˆä½¿ç”¨Hazelcastï¼‰ã€[m
[31m-InfinispanCacheConfigurationï¼ˆä½¿ç”¨Infinispanï¼‰ã€[m
[31m-JCacheCacheConfigurationï¼ˆä½¿ç”¨JCacheï¼‰ã€[m
[31m-NoOpCacheConfigurationï¼ˆä¸ä½¿ç”¨å­˜å‚¨ï¼‰ã€[m
[31m-RedisCacheConfigurationï¼ˆä½¿ç”¨Redisï¼‰ã€[m
[31m-SimpleCacheConfigurationï¼ˆä½¿ç”¨ConcurrentMapï¼‰ã€‚åœ¨ä¸åšä»»[m
[31m-ä½•é¢å¤–é…ç½®çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯[m
[31m-SimpleCacheConfigurationï¼Œå³ä½¿ç”¨      Bootæ”¯æŒ[m
[31m-ConcurrentMapCacheManagerã€‚Spring[m
[31m-ä»¥â€œspring.cacheâ€ä¸ºå‰ç¼€çš„å±æ€§æ¥é…ç½®ç¼“å­˜ã€‚[m
[31m-[m
[31m-spring.cache.type= # å¯é€‰[m
[31m-[m
[31m-generic, ehcache, hazelcast, infinispan, jcache, redis, # guava, simple[m
[31m-spring.cache.cache-names= # ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºç¼“å­˜åç§°[m
[31m-spring.cache.ehcache.config= # ehcacheé…ç½®æ–‡ä»¶åœ°å€[m
[31m-spring.cache.hazelcast.config= # hazelcast é…ç½®æ–‡ä»¶åœ°å€[m
[31m-spring.cache.infinispan.config= # infinispan é…ç½®æ–‡ä»¶åœ°å€[m
[31m-spring.cache.jcache.config= # jcache é…ç½®æ–‡ä»¶åœ°å€[m
[31m-spring.cache.jcache.provider= #å½“å¤šä¸ª jcacheå®ç°åœ¨ç±»è·¯å¾„ä¸­çš„æ—¶[m
[31m-å€™ï¼ŒæŒ‡å®šjcacheå®ç°[m
[31m-[m
[31m-spring.cache.guava.spec= # guava specs[m
[31m-[m
[31m-     åœ¨Spring Bootç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ç¼“å­˜æŠ€æœ¯åªéœ€åœ¨é¡¹ç›®ä¸­å¯¼å…¥ç›¸[m
[31m-å…³ç¼“å­˜æŠ€æœ¯çš„ä¾èµ–åŒ…ï¼Œå¹¶åœ¨é…ç½®ç±»ä½¿ç”¨@EnableCachingå¼€å¯ç¼“[m
[31m-å­˜æ”¯æŒå³å¯ã€‚[m
[31m-[m
[31m-8.5.3ã€€å®æˆ˜[m
[31m-[m
[31m-     æœ¬ä¾‹å°†ä»¥Spring Booté»˜è®¤çš„ConcurrentMapCacheManagerä½œ[m
[31m-ä¸ºç¼“å­˜æŠ€æœ¯ï¼Œæ¼”ç¤º@Cacheableã€@CachePutã€@CacheEvitï¼Œæœ€[m
[31m-åä½¿ç”¨EhCacheã€Guavaæ¥æ›¿æ¢ç¼“å­˜æŠ€æœ¯ã€‚[m
[31m-[m
[31m-     1.æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºCacheï¼ˆspring-boot-starter-[m
[31m-cacheï¼‰ã€JPAï¼ˆspring-boot-starter-data-jpaï¼‰å’ŒWebï¼ˆspring-[m
[31m-boot-starter-webï¼‰ã€‚[m
[31m-[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-       groupIdï¼šcom.wisely[m
[31m-       arctifactId:ch8_5[m
[31m-       package: com.wisely.ch8_5[m
[31m-[m
[31m-     æ·»åŠ Oracle JDBCé©±åŠ¨ï¼Œå¹¶åœ¨application.propertiesé…ç½®ç›¸å…³[m
[31m-å±æ€§ï¼Œä¸ä¸Šä¾‹ä¿æŒä¸€è‡´ã€‚[m
[31m-[m
[31m-     2.å®ä½“ç±»[m
[31m-[m
[31m-       package com.wisely.ch8_5.domain;[m
[31m-[m
[31m-       import javax.persistence.Entity;[m
[31m-       import javax.persistence.GeneratedValue;[m
[31m-       import javax.persistence.Id;[m
[31m-[m
[31m-       @Entity[m
[31m-       public class Person {[m
[31m-[m
[31m-              @Id[m
[31m-              @GeneratedValue[m
[31m-              private Long id;[m
[31m-[m
[31m-              private String name;[m
[31m-[m
[31m-              private Integer age;[m
[31m-[m
[31m-              private String address;[m
[31m-[m
[31m-              public Person() {[m
[31m-                      super();[m
[31m-[m
[31m-              }[m
[31m-              public Person(Long id, String name, Integer age, String address) {[m
[31m-[m
[31m-                      super();[m
[31m-                      this.id = id;[m
[31m-                      this.name = name;[m
[31m-                      this.age = age;[m
[31m-                      this.address = address;[m
[31m-              }[m
[31m-              //çœç•¥getterã€setter[m
[31m-       }[m
[31m-3.å®ä½“ç±»Repository[m
[31m-[m
[31m-package com.wisely.ch8_5.dao;[m
[31m-import org.springframework.data.jpa.repository.JpaRepository;[m
[31m-import com.wisely.ch8_5.domain.Person;[m
[31m-public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-[m
[31m-}[m
[31m-[m
[31m-4.ä¸šåŠ¡æœåŠ¡[m
[31m-ï¼ˆ1ï¼‰æ¥å£ï¼š[m
[31m-[m
[31m-package com.wisely.ch8_5.service;[m
[31m-import com.wisely.ch8_5.domain.Person;[m
[31m-public interface DemoService {[m
[31m-[m
[31m-       public Person save(Person person);[m
[31m-       public void remove(Long id);[m
[31m-       public Person findOne(Person person);[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ2ï¼‰å®ç°ç±»ï¼š[m
[31m-[m
[31m-package com.wisely.ch8_5.service.impl;[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.cache.annotation.CacheEvict;[m
[31m-import org.springframework.cache.annotation.CachePut;[m
[31m-import org.springframework.cache.annotation.Cacheable;[m
[31m-import org.springframework.stereotype.Service;[m
[31m-[m
[31m-import com.wisely.ch8_5.dao.PersonRepository;[m
[31m-import com.wisely.ch8_5.domain.Person;[m
[31m-import com.wisely.ch8_5.service.DemoService;[m
[31m-@Service[m
[31m-public class DemoServiceImpl implements DemoService {[m
[31m-[m
[31m-       @Autowired[m
[31m-       PersonRepository personRepository;[m
[31m-[m
[31m-   @Override[m
[31m-[m
[31m-   @CachePut(value = "people",key="#person.id") //1[m
[31m-[m
[31m-   public Person save(Person person) {[m
[31m-[m
[31m-      Person p = personRepository.save(person);[m
[31m-      System.out.println("ä¸ºidã€keyä¸º:"+p.getId()+"æ•°æ®åšäº†ç¼“[m
[31m-[m
[31m-å­˜");[m
[31m-[m
[31m-      return p;[m
[31m-[m
[31m-   }[m
[31m-[m
[31m-   @Override[m
[31m-[m
[31m-   @CacheEvict(value = "peopele") //2[m
[31m-[m
[31m-   public void remove(Long id) {[m
[31m-          System.out.println("åˆ é™¤äº†idã€keyä¸º"+id+"çš„æ•°æ®ç¼“å­˜");[m
[31m-[m
[31m-          personRepository.delete(id);[m
[31m-[m
[31m-   }[m
[31m-[m
[31m-   @Override[m
[31m-[m
[31m-   @Cacheable(value="people",key="#person.id") //3[m
[31m-[m
[31m-   public Person findOne(Person person) {[m
[31m-[m
[31m-      Person p = personRepository.findOne(person.getId());[m
[31m-      System.out.println("ä¸ºidã€keyä¸º:"+p.getId()+"æ•°æ®åšäº†ç¼“[m
[31m-[m
[31m-å­˜");[m
[31m-[m
[31m-      return p;[m
[31m-[m
[31m-   }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-â‘ @CachePutç¼“å­˜æ–°å¢çš„æˆ–æ›´æ–°çš„æ•°æ®åˆ°ç¼“å­˜ï¼Œå…¶ä¸­ç¼“å­˜[m
[31m-åç§°ä¸ºpeopleï¼Œæ•°æ®çš„keyæ˜¯personçš„idã€‚[m
[31m-[m
[31m-     â‘¡@CacheEvictä»ç¼“å­˜peopleä¸­åˆ é™¤keyä¸ºidçš„æ•°æ®ã€‚[m
[31m-[m
[31m-     â‘¢@Cacheableç¼“å­˜keyä¸ºpersonçš„idæ•°æ®åˆ°ç¼“å­˜peopleä¸­ã€‚[m
[31m-[m
[31m-     è¿™é‡Œç‰¹åˆ«è¯´æ˜ä¸‹ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®škeyï¼Œåˆ™æ–¹æ³•å‚æ•°ä½œä¸ºkey[m
[31m-ä¿å­˜åˆ°ç¼“å­˜ä¸­ã€‚[m
[31m-[m
[31m-     5.æ§åˆ¶å™¨[m
[31m-[m
[31m-       package com.wisely.ch8_5.web;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-       import com.wisely.ch8_5.domain.Person;[m
[31m-       import com.wisely.ch8_5.service.DemoService;[m
[31m-[m
[31m-       @RestController[m
[31m-       public class CacheController {[m
[31m-[m
[31m-              @Autowired[m
[31m-              DemoService demoService;[m
[31m-[m
[31m-              @RequestMapping("/put")[m
[31m-              public Person put(Person person){[m
[31m-[m
[31m-                      return demoService.save(person);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @RequestMapping("/able")[m
[31m-              public Person cacheable(Person person){[m
[31m-[m
[31m-                      return demoService.findOne(person);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @RequestMapping("/evit")[m
[31m-              public String evit(Long id){[m
[31m-          demoService.remove(id);[m
[31m-          return "ok";[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-6.å¼€å¯ç¼“å­˜æ”¯æŒ[m
[31m-[m
[31m-package com.wisely.ch8_5;[m
[31m-[m
[31m-import org.springframework.boot.SpringApplication;[m
[31m-import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-import org.springframework.cache.annotation.EnableCaching;[m
[31m-[m
[31m-@SpringBootApplication[m
[31m-@EnableCaching[m
[31m-public class Ch85Application {[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-              SpringApplication.run(Ch85Application.class, args);[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     åœ¨Spring Bootä¸­è¿˜æ˜¯è¦ä½¿ç”¨@EnableCachingå¼€å¯ç¼“å­˜æ”¯[m
[31m-æŒã€‚[m
[31m-[m
[31m-     7.è¿è¡Œ[m
[31m-[m
[31m-     å½“æˆ‘ä»¬å¯¹æ•°æ®åšäº†ç¼“å­˜ä¹‹åï¼Œæ•°æ®çš„è·å¾—å°†ä»ç¼“å­˜ä¸­å¾—[m
[31m-åˆ°ï¼Œè€Œä¸æ˜¯ä»æ•°æ®åº“ä¸­å¾—åˆ°ã€‚å½“å‰çš„æ•°æ®åº“çš„æ•°æ®æƒ…å†µå¦‚å›¾8-[m
[31m-56æ‰€ç¤ºã€‚[m
[31m-                          å›¾8-56ã€€å½“å‰æ•°æ®åº“çš„æ•°æ®æƒ…å†µ[m
[31m-[m
[31m-     æˆ‘ä»¬åœ¨æ¯æ¬¡è¿è¡Œæµ‹è¯•æƒ…å†µä¸‹ï¼Œéƒ½é‡å¯äº†åº”ç”¨ç¨‹åºã€‚[m
[31m-     ï¼ˆ1ï¼‰æµ‹è¯•@Cacheable[m
[31m-     ç¬¬ä¸€æ¬¡è®¿é—®http://localhostï¼š8080/ableï¼Ÿid=1ï¼Œç¬¬ä¸€æ¬¡å°†è°ƒ[m
[31m-ç”¨æ–¹æ³•æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶å°†æ•°æ®æ”¾åˆ°ç¼“å­˜peopleä¸­ã€‚[m
[31m-     æ­¤æ—¶æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š[m
[31m-[m
[31m-     é¡µé¢è¾“å‡ºå¦‚å›¾8-57æ‰€ç¤ºã€‚[m
[31m-                                å›¾8-57ã€€é¡µé¢è¾“å‡ºç»“æœ[m
[31m-[m
[31m-     å†æ¬¡è®¿é—®http://localhostï¼š8080/ableï¼Ÿid=1ï¼Œæ­¤æ—¶æ§åˆ¶å°æ²¡[m
[31m-æœ‰å†æ¬¡è¾“å‡ºHibernateçš„æŸ¥è¯¢è¯­å¥ï¼Œä»¥åŠâ€œä¸ºidã€keyweiï¼š1æ•°æ®[m
[31m-åšäº†ç¼“å­˜â€å­—æ ·ï¼Œè¡¨ç¤ºæ²¡æœ‰è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé¡µé¢ç›´æ¥ä»æ•°æ®ç¼“[m
[31m-å­˜ä¸­è·å¾—æ•°æ®ã€‚[m
[31m-[m
[31m-     é¡µé¢è¾“å‡ºç»“æœå¦‚å›¾8-58æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                å›¾8-58ã€€é¡µé¢è¾“å‡ºç»“æœ[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰æµ‹è¯•@CachePut[m
[31m-     è®¿é—®http://localhostï¼š8080/putï¼Ÿname=cc&age=22&address=[m
[31m-æˆéƒ½ï¼Œæ­¤æ—¶æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š[m
[31m-[m
[31m-     é¡µé¢è¾“å‡ºå¦‚å›¾8-59æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                               å›¾8-59ã€€æµ‹è¯•@CachePut[m
[31m-[m
[31m-     æˆ‘ä»¬å†æ¬¡è®¿é—®http://localhostï¼š8080/ableï¼Ÿid=62ï¼Œæ§åˆ¶å°æ— [m
[31m-è¾“å‡ºï¼Œä»ç¼“å­˜ç›´æ¥è·å¾—æ•°æ®ï¼Œé¡µé¢æ˜¾ç¤ºå¦‚å›¾8-59æ‰€ç¤ºã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰æµ‹è¯•@CacheEvit[m
[31m-     è®¿é—®http://localhostï¼š8080/ableï¼Ÿid=1ï¼Œä¸ºidä¸º1çš„æ•°æ®åšç¼“[m
[31m-å­˜ï¼Œå†æ¬¡è®¿é—®http://localhostï¼š8080/ableï¼Ÿid=1ï¼Œç¡®è®¤æ•°æ®å·²ä»[m
[31m-ç¼“å­˜ä¸­è·å–ã€‚[m
[31m-     è®¿é—®http://localhostï¼š8080/evitï¼Ÿid=1ï¼Œä»ç¼“å­˜ä¸­åˆ é™¤keyä¸º[m
[31m-1çš„ç¼“å­˜æ•°æ®ï¼š[m
[31m-     å†æ¬¡è®¿é—®http://localhostï¼š8080/ableï¼Ÿid=1ï¼Œè§‚å¯Ÿæ§åˆ¶å°é‡[m
[31m-æ–°åšäº†ç¼“å­˜ï¼š[m
[31m-[m
[31m-é¡µé¢æ˜¾ç¤ºå¦‚å›¾8-58æ‰€ç¤ºã€‚[m
[31m-[m
[31m-8.5.4ã€€åˆ‡æ¢ç¼“å­˜æŠ€æœ¯[m
[31m-[m
[31m-åˆ‡æ¢ç¼“å­˜æŠ€æœ¯é™¤äº†ç§»å…¥ç›¸å…³ä¾èµ–åŒ…æˆ–è€…é…ç½®ä»¥å¤–ï¼Œä½¿ç”¨æ–¹[m
[31m-[m
[31m-å¼å’Œå®æˆ˜ä¾‹å­ä¿æŒä¸€è‡´ã€‚ä¸‹é¢ç®€è¦è®²è§£åœ¨Spring                    Bootä¸‹ï¼Œ[m
[31m-[m
[31m-EhCacheå’ŒGuavaä½œä¸ºç¼“å­˜æŠ€æœ¯çš„æ–¹å¼ï¼Œå…¶ä½™ç¼“å­˜æŠ€æœ¯ä¹Ÿæ˜¯ç±»[m
[31m-[m
[31m-ä¼¼çš„æ–¹å¼ã€‚[m
[31m-[m
[31m-     1.EhCache[m
[31m-[m
[31m-     å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨EhCacheä½œä¸ºç¼“å­˜æŠ€æœ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€[m
[31m-åœ¨pom.xmlä¸­æ·»åŠ EhCacheçš„ä¾èµ–å³å¯ï¼š[m
[31m-[m
[31m-<dependency>[m
[31m-         <groupId>net.sf.ehcache</groupId>[m
[31m-         <artifactId>ehcache</artifactId>[m
[31m-[m
[31m- </dependency>[m
[31m-[m
[31m-     EhCacheæ‰€éœ€çš„é…ç½®æ–‡ä»¶ehcache.xmlåªéœ€æ”¾åœ¨ç±»è·¯å¾„ä¸‹ï¼Œ[m
[31m-Spring Bootä¼šè‡ªåŠ¨æ‰«æï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       <?xml version="1.0" encoding="UTF-8"?>[m
[31m-       <ehcache>[m
[31m-[m
[31m-                      <cache name="people" maxElementsInMemory="1000" />[m
[31m-</ehcache>[m
[31m-[m
[31m-     Spring  Bootä¼šç»™æˆ‘ä»¬è‡ªåŠ¨é…ç½®EhCacheCacheManagerçš„[m
[31m-Beanã€‚[m
[31m-[m
[31m-2.Guava[m
[31m-[m
[31m-     å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨Guavaä½œä¸ºç¼“å­˜æŠ€æœ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€[m
[31m-åœ¨pom.xmlä¸­å¢åŠ Guavaçš„ä¾èµ–å³å¯ï¼š[m
[31m-[m
[31m-             <dependency>[m
[31m-                    <groupId>com.google.guava</groupId>[m
[31m-                    <artifactId>guava</artifactId>[m
[31m-                    <version>18.0</version>[m
[31m-[m
[31m-             </dependency>[m
[31m-[m
[31m-     Spring  Bootä¼šç»™æˆ‘ä»¬è‡ªåŠ¨é…ç½®GuavaCacheManagerè¿™ä¸ª[m
[31m-Beanã€‚[m
[31m-[m
[31m-3.Redis[m
[31m-ä½¿ç”¨Redisï¼Œåªéœ€æ·»åŠ ä¸‹é¢çš„ä¾èµ–å³å¯ï¼š[m
[31m-[m
[31m-              <dependency>[m
[31m-                     <groupId>org.springframework.boot</groupId>[m
[31m-                                                    <artifactId>spring-boot-starter-[m
[31m-[m
[31m-redis</artifactId>[m
[31m-              </dependency>[m
[31m-[m
[31m-     Spring Bootå°†ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨é…ç½®RedisCacheManagerä»¥åŠ[m
[31m-RedisTemplateçš„Beanã€‚[m
[31m-8.6ã€€éå…³ç³»å‹æ•°æ®åº“NoSQL[m
[31m-[m
[31m-     NoSQLæ˜¯å¯¹äºä¸ä½¿ç”¨å…³ç³»ä½œä¸ºæ•°æ®ç®¡ç†çš„æ•°æ®åº“ç³»ç»Ÿçš„ç»Ÿ[m
[31m-ç§°ã€‚NoSQLçš„ä¸»è¦ç‰¹ç‚¹æ˜¯ä¸ä½¿ç”¨SQLè¯­è¨€ä½œä¸ºæŸ¥è¯¢è¯­è¨€ï¼Œæ•°æ®[m
[31m-å­˜å‚¨ä¹Ÿä¸æ˜¯å›ºå®šçš„è¡¨ã€å­—æ®µã€‚[m
[31m-[m
[31m-     NoSQLæ•°æ®åº“ä¸»è¦æœ‰æ–‡æ¡£å­˜å‚¨å‹ï¼ˆMongoDBï¼‰ã€å›¾å½¢å…³ç³»[m
[31m-å­˜å‚¨å‹ï¼ˆNeo4jï¼‰å’Œé”®å€¼å¯¹å­˜å‚¨å‹ï¼ˆRedisï¼‰ã€‚[m
[31m-[m
[31m-     æœ¬èŠ‚å°†æ¼”ç¤ºåŸºäºMongoDBçš„æ•°æ®è®¿é—®ä»¥åŠåŸºäºRedisçš„æ•°[m
[31m-æ®è®¿é—®ã€‚[m
[31m-[m
[31m-8.6.1ã€€MongoDB[m
[31m-[m
[31m-     MongoDBæ˜¯ä¸€ä¸ªåŸºäºæ–‡æ¡£ï¼ˆDocumentï¼‰çš„å­˜å‚¨å‹çš„æ•°æ®[m
[31m-åº“ï¼Œä½¿ç”¨é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œæ¯ä¸€æ¡æ•°æ®è®°å½•éƒ½æ˜¯æ–‡æ¡£çš„å¯¹è±¡ã€‚[m
[31m-[m
[31m-     åœ¨æœ¬èŠ‚æˆ‘ä»¬ä¸ä¼šä»‹ç»å¤ªå¤šå…³äºMongoDBæ•°æ®åº“æœ¬èº«çš„çŸ¥[m
[31m-è¯†ï¼Œæœ¬èŠ‚ä¸»è¦è®²è¿°SpringåŠSpring Bootå¯¹MongoDBçš„æ”¯æŒï¼Œä»¥[m
[31m-åŠåŸºäºSpring Bootå’ŒMongoDBçš„å®æˆ˜ä¾‹å­ã€‚[m
[31m-[m
[31m-     1.Springçš„æ”¯æŒ[m
[31m-[m
[31m-     Springå¯¹MongoDBçš„æ”¯æŒä¸»è¦æ˜¯é€šè¿‡Spring Data MongoDB[m
[31m-æ¥å®ç°çš„ï¼ŒSpring Data MongoDBä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹åŠŸèƒ½ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰Object/Documentæ˜ å°„æ³¨è§£æ”¯æŒ[m
[31m-[m
[31m-     JPAæä¾›äº†ä¸€å¥—Object/Relationæ˜ å°„çš„æ³¨è§£ï¼ˆ@Entityã€[m
[31m-@Idï¼‰ï¼Œè€ŒSpring Data MongoDBä¹Ÿæä¾›äº†è¡¨8-7æ‰€ç¤ºçš„æ³¨è§£ã€‚[m
[31m-[m
[31m-                                       è¡¨8-7ã€€æ³¨æˆ·[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰MongoTemplate[m
[31m-     åƒJdbcTemplateä¸€æ ·ï¼ŒSpring Data MongoDBä¹Ÿä¸ºæˆ‘ä»¬æä¾›[m
[31m-äº†ä¸€ä¸ªMongoTemplateï¼ŒMongoTemplateä¸ºæˆ‘ä»¬æä¾›äº†æ•°æ®è®¿[m
[31m-é—®çš„æ–¹æ³•ã€‚æˆ‘ä»¬è¿˜éœ€è¦ä¸ºMongoClientä»¥åŠMongoDbFactoryæ¥[m
[31m-é…ç½®æ•°æ®åº“è¿æ¥å±æ€§ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public MongoClient client() throws UnknownHostException {[m
[31m-[m
[31m-                      MongoClient client = new MongoClient(new ServerAddress("127.0.0[m
[31m-                      return client;[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              public MongoDbFactory mongoDbFactory() throws Exception {[m
[31m-[m
[31m-                      String database = new MongoClientURI("mongodb://localhost/test"[m
[31m-                      return new SimpleMongoDbFactory(client() , database);[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              public MongoTemplate mongoTemplate(MongoDbFactory mongoDbFactory) t[m
[31m-[m
[31m-                      return new MongoTemplate(mongoDbFactory);[m
[31m-              }[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰Repositoryçš„æ”¯æŒ[m
[31m-     ç±»ä¼¼äºSpring Data JPAï¼ŒSpring Data MongoDBä¹Ÿæä¾›äº†[m
[31m-Repositoryçš„æ”¯æŒï¼Œä½¿ç”¨æ–¹å¼å’ŒSpring Data JPAä¸€è‡´ï¼Œå®šä¹‰å¦‚[m
[31m-ä¸‹ï¼š[m
[31m-[m
[31m-       public interface PersonRepository extends MongoRepository<Person, Strin[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ç±»ä¼¼äºSpring Data JPAçš„å¼€å¯æ”¯æŒæ–¹å¼ï¼ŒMongoDBçš„[m
[31m-Repositoryçš„æ”¯æŒå¼€å¯éœ€åœ¨é…ç½®ç±»ä¸Šæ³¨è§£[m
[31m-@EnableMongoRepositoriesï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableMongoRepositories[m
[31m-       public class AppConfig {[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-2.Spring Bootçš„æ”¯æŒ[m
[31m-Spring Bootå¯¹MongoDBçš„æ”¯æŒï¼Œåˆ†åˆ«ä½äºï¼š[m
[31m-[m
[31m-org.springframework.boot.autoconfigure.mongo[m
[31m-[m
[31m-ä¸»è¦é…ç½®æ•°æ®åº“è¿æ¥ã€MongoTemplateã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨[m
[31m-[m
[31m-ä»¥â€œspring.data.mongodbâ€ä¸ºå‰ç¼€çš„å±æ€§æ¥é…ç½®MongoDBç›¸å…³çš„[m
[31m-[m
[31m-ä¿¡æ¯ã€‚Spring  Bootä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›é»˜è®¤å±æ€§ï¼Œå¦‚é»˜è®¤[m
[31m-[m
[31m-MongoDBçš„ç«¯å£ä¸º27017ã€é»˜è®¤æœåŠ¡å™¨ä¸ºlocalhostã€é»˜è®¤æ•°æ®[m
[31m-[m
[31m-åº“ä¸ºtestã€‚Spring Bootçš„ä¸»è¦é…ç½®å¦‚ä¸‹ï¼š[m
[31m-       spring.data.mongodb.host= # æ•°æ®åº“ä¸»æœºåœ°å€ï¼Œé»˜è®¤localhost[m
[31m-       spring.data.mongodb.port=27017 # æ•°æ®åº“è¿æ¥ç«¯å£é»˜è®¤27107[m
[31m-       spring.data.mongodb.uri=mongodb://localhost/test # connection URL[m
[31m-       spring.data.mongodb.database=[m
[31m-       spring.data.mongodb.authentication-database=[m
[31m-       spring.data.mongodb.grid-fs-database=[m
[31m-       spring.data.mongodb.username=[m
[31m-       spring.data.mongodb.password=[m
[31m-       spring.data.mongodb.repositories.enabled=true #repositoryæ”¯æŒ[m
[31m-       æ˜¯å¦å¼€å¯ï¼Œé»˜è®¤ä¸ºå·²å¼€å¯[m
[31m-       spring.data.mongodb.field-naming-strategy=[m
[31m-       org.springframework.boot.autoconfigure.data.mongo[m
[31m-[m
[31m-     ä¸ºæˆ‘ä»¬å¼€å¯äº†å¯¹Repositoryçš„æ”¯æŒï¼Œå³è‡ªåŠ¨ä¸ºæˆ‘ä»¬é…ç½®äº†[m
[31m-@EnableMongoRepositoriesã€‚[m
[31m-[m
[31m-     æ‰€ä»¥æˆ‘ä»¬åœ¨Spring Bootä¸‹ä½¿ç”¨MongoDBåªéœ€å¼•å…¥spring-[m
[31m-boot-starter-data-mongodbä¾èµ–å³å¯ï¼Œæ— é¡»ä»»ä½•é…ç½®ã€‚[m
[31m-[m
[31m-     3.å®æˆ˜[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰å®‰è£…MongoDB[m
[31m-[m
[31m-     1ï¼‰éDockerå®‰è£…ã€‚è‹¥ä¸ä½¿ç”¨Dockerä½œä¸ºå®‰è£…æ–¹å¼ï¼Œåˆ™æˆ‘ä»¬[m
[31m-å¯ä»¥è®¿é—®https://www.mongodb.org/downloadsæ¥ä¸‹è½½é€‚åˆè‡ªå·±[m
[31m-å½“å‰æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬æ¥å®‰è£…MongoDBã€‚[m
[31m-[m
[31m-     2ï¼‰Dockerå®‰è£…ã€‚å‰é¢å·²ç»ä¸‹è½½å¥½äº†MongoDBçš„Dockeré•œ[m
[31m-åƒï¼Œæ¥ä¸‹æ¥éœ€é€šè¿‡ä¸‹é¢å‘½ä»¤è¿è¡ŒDockerå®¹å™¨ï¼š[m
[31m-[m
[31m-       docker run -d -p 27017:27017 mongo[m
[31m-[m
[31m-     è¿è¡Œå¥½ä»¥åï¼Œè®°å¾—åœ¨VirtualBoxå†åšä¸€æ¬¡ç«¯å£æ˜ å°„ï¼Œå¦‚å›¾8-[m
[31m-60æ‰€ç¤ºã€‚[m
[31m-                                   å›¾8-60ã€€ç«¯å£æ˜ å°„[m
[31m-[m
[31m-     MongoDBæ•°æ®åº“ç®¡ç†è½¯ä»¶å¯ä½¿ç”¨Robomongoï¼Œä¸‹è½½åœ°å€æ˜¯[m
[31m-http://www.robomongo.orgï¼Œå¦‚å›¾8-61æ‰€ç¤ºã€‚[m
[31m-[m
[31m-          å›¾8-61ã€€Robomongoç•Œé¢[m
[31m-[m
[31m-ï¼ˆ2ï¼‰æ­å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-æ­å»ºSpring  Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºMongoDBï¼ˆspring-boot-[m
[31m-[m
[31m-starter-data-mongodbï¼‰å’ŒWebï¼ˆspring-boot-starter-webï¼‰ã€‚[m
[31m-[m
[31m-é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-groupIdï¼šcom.wisely[m
[31m-arctifactId:ch8_6_1[m
[31m-package: com.wisely. ch8_6_1[m
[31m-[m
[31m-     å› ä¸ºSpring Bootçš„é»˜è®¤æ•°æ®åº“è¿æ¥æ»¡è¶³æˆ‘ä»¬å½“å‰æµ‹è¯•çš„è¦[m
[31m-æ±‚ï¼Œæ‰€ä»¥å°†ä¸åœ¨ä¸ºapplication.propertiesé…ç½®è¿æ¥ä¿¡æ¯ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰é¢†åŸŸæ¨¡å‹[m
[31m-[m
[31m-     æœ¬ä¾‹çš„é¢†åŸŸæ¨¡å‹æ˜¯äººï¼ˆPersonï¼‰ï¼ŒåŒ…å«ä»–å·¥ä½œè¿‡çš„åœ°ç‚¹[m
[31m-ï¼ˆLocationï¼‰ã€‚è¿™ä¸ªè™½ç„¶å’Œå…³ç³»å‹æ•°æ®åº“çš„ä¸€å¯¹å¤šç±»ä¼¼ï¼Œä½†è¿˜[m
[31m-æ˜¯ä¸ä¸€æ ·çš„ï¼ŒLocationçš„æ•°æ®åªå±äºæŸä¸ªäººã€‚[m
[31m-[m
[31m-     Personæºç ï¼š[m
[31m-[m
[31m-package com.wisely.ch8_6_1.domain;[m
[31m-[m
[31m-import java.util.Collection;[m
[31m-import java.util.LinkedHashSet;[m
[31m-[m
[31m-import org.springframework.data.annotation.Id;[m
[31m-import org.springframework.data.mongodb.core.mapping.Document;[m
[31m-[m
[31m-@Document //1                                     new LinkedHashSet<Locatio[m
[31m-public class Person {[m
[31m-[m
[31m-       @Id //2[m
[31m-       private String id;[m
[31m-       private String name;[m
[31m-       private Integer age;[m
[31m-       @Field("locs")//3[m
[31m-       private Collection<Location> locations =[m
[31m-();[m
[31m-[m
[31m-       public Person(String name, Integer age) {[m
[31m-              super();[m
[31m-              this.name = name;[m
[31m-              this.age = age;[m
[31m-[m
[31m-       }[m
[31m-//çœç•¥getterã€setteræ–¹æ³•[m
[31m-}[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ @Documentæ³¨è§£æ˜ å°„é¢†åŸŸæ¨¡å‹å’ŒMongoDBçš„æ–‡æ¡£ã€‚[m
[31m-     â‘¡@Idæ³¨è§£è¡¨æ˜è¿™ä¸ªå±æ€§ä¸ºæ–‡æ¡£çš„Idã€‚[m
[31m-     â‘¢@Fieldæ³¨è§£æ­¤å±æ€§åœ¨æ–‡æ¡£ä¸­çš„åç§°ä¸ºlocsï¼Œlocationså±æ€§[m
[31m-å°†ä»¥æ•°ç»„å½¢å¼å­˜åœ¨å½“å‰æ•°æ®è®°å½•ä¸­ã€‚[m
[31m-     Locationæºç ï¼š[m
[31m-[m
[31m-       package com.wisely.ch8_6_1.domain;[m
[31m-       public class Location {[m
[31m-[m
[31m-              private String place;[m
[31m-              private String year;[m
[31m-              public Location(String place, String year) {[m
[31m-[m
[31m-                      super();[m
[31m-                      this.place = place;[m
[31m-                      this.year = year;[m
[31m-              }[m
[31m-       //çœç•¥getterã€setteræ–¹æ³•[m
[31m-       }[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰æ•°æ®è®¿é—®ï¼š[m
[31m-[m
[31m-       package com.wisely.ch8_6_1.dao;[m
[31m-       import java.util.List;[m
[31m-       import org.springframework.data.mongodb.repository.MongoRepository;[m
[31m-       import org.springframework.data.mongodb.repository.Query;[m
[31m-       import com.wisely.ch8_6_1.domain.Person;[m
[31m-       public interface PersonRepository extends MongoRepository<Person, Strin[m
[31m-         Person findByName(String name); //1[m
[31m-[m
[31m-         @Query("{'age': ?0}") //2[m
[31m-         List<Person> withQueryFindByAge(Integer age);[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ æ”¯æŒæ–¹æ³•åæŸ¥è¯¢ã€‚[m
[31m-[m
[31m-â‘¡æ”¯æŒ@QueryæŸ¥è¯¢ï¼ŒæŸ¥è¯¢å‚æ•°æ„é€ JSONå­—ç¬¦ä¸²å³å¯ã€‚[m
[31m-[m
[31m-ï¼ˆ5ï¼‰æ§åˆ¶å™¨ï¼š[m
[31m-[m
[31m-package com.wisely.ch8_6_1.web;[m
[31m-[m
[31m-import java.util.Collection;[m
[31m-import java.util.LinkedHashSet;[m
[31m-import java.util.List;[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-import org.springframework.web.bind.annotation.RestController;[m
[31m-import com.wisely.ch8_6_1.dao.PersonRepository;[m
[31m-import com.wisely.ch8_6_1.domain.Location;[m
[31m-import com.wisely.ch8_6_1.domain.Person;[m
[31m-[m
[31m-@RestController[m
[31m-public class DataController {[m
[31m-[m
[31m-       @Autowired[m
[31m-       PersonRepository personRepository;[m
[31m-[m
[31m-       @RequestMapping("/save") //1[m
[31m-       public Person save(){[m
[31m-[m
[31m-              Person p = new Person("wyf",32);[m
[31m-              Collection<Location> locations = new LinkedHashSet<Location>[m
[31m-();[m
[31m-              Location loc1 = new Location("ä¸Šæµ·","2009");[m
[31m-              Location loc2 = new Location("åˆè‚¥","2010");[m
[31m-              Location loc3 = new Location("å¹¿å·","2011");[m
[31m-                      Location loc4 = new Location("é©¬éå±±","2012");[m
[31m-                      locations.add(loc1);[m
[31m-                      locations.add(loc2);[m
[31m-                      locations.add(loc3);[m
[31m-                      locations.add(loc4);[m
[31m-                      p.setLocations(locations);[m
[31m-                      return personRepository.save(p);[m
[31m-              }[m
[31m-[m
[31m-              @RequestMapping("/q1") //2[m
[31m-              public Person q1(String name){[m
[31m-[m
[31m-                      return personRepository.findByName(name);[m
[31m-              }[m
[31m-[m
[31m-              @RequestMapping("/q2") //3[m
[31m-              public List<Person> q2(Integer age){[m
[31m-[m
[31m-                      return personRepository.withQueryFindByAge(age);[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ æµ‹è¯•ä¿å­˜æ•°æ®ã€‚[m
[31m-[m
[31m-     â‘¡æµ‹è¯•æ–¹æ³•åæŸ¥è¯¢ã€‚[m
[31m-[m
[31m-     â‘¢æµ‹è¯•@QueryæŸ¥è¯¢ã€‚[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰è¿è¡Œ[m
[31m-[m
[31m-     æµ‹è¯•ä¿å­˜æ•°æ®[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8080/saveæµ‹è¯•ä¿å­˜ï¼Œé¡µé¢å¦‚å›¾8-62æ‰€[m
[31m-ç¤ºã€‚[m
[31m-                                   å›¾8-62ã€€æµ‹è¯•ä¿å­˜[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥åœ¨Robomongoä¸­æŸ¥çœ‹ä¿å­˜åçš„æ•°æ®ï¼Œå¦‚å›¾8-63æ‰€[m
[31m-ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾8-63ã€€æŸ¥çœ‹ä¿å­˜åçš„æ•°æ®[m
[31m-[m
[31m-     æµ‹è¯•æ–¹æ³•åæŸ¥è¯¢[m
[31m-     è®¿é—®http://localhostï¼š8080/q1ï¼Ÿname=wyfï¼Œé¡µé¢ç»“æœå¦‚å›¾8-[m
[31m-64æ‰€ç¤ºã€‚[m
[31m-     æµ‹è¯•@QueryæŸ¥è¯¢[m
[31m-     è®¿é—®http://localhostï¼š8080/q2ï¼Ÿage=32ï¼Œé¡µé¢ç»“æœå¦‚å›¾8-65[m
[31m-æ‰€ç¤ºã€‚[m
[31m-                              å›¾8-64ã€€æµ‹è¯•æ–¹æ³•åæŸ¥è¯¢[m
[31m-[m
[31m-                              å›¾8-65ã€€æµ‹è¯•@QueryæŸ¥è¯¢[m
[31m-[m
[31m-8.6.2ã€€Redis[m
[31m-[m
[31m-     Redisæ˜¯ä¸€ä¸ªåŸºäºé”®å€¼å¯¹çš„å¼€æºå†…å­˜æ•°æ®å­˜å‚¨ï¼Œå½“ç„¶Redis[m
[31m-ä¹Ÿå¯ä»¥åšæ•°æ®ç¼“å­˜ï¼ˆè§8.5.4èŠ‚ï¼‰ã€‚[m
[31m-[m
[31m-     1.Springçš„æ”¯æŒ[m
[31m-     ï¼ˆ1ï¼‰é…ç½®[m
[31m-     Springå¯¹Redisçš„æ”¯æŒä¹Ÿæ˜¯é€šè¿‡Spring Data Redisæ¥å®ç°çš„ï¼Œ[m
[31m-Spring Data JPAä¸ºæˆ‘ä»¬æä¾›äº†è¿æ¥ç›¸å…³çš„ConnectionFactoryå’Œ[m
[31m-æ•°æ®æ“ä½œç›¸å…³çš„RedisTemplateã€‚åœ¨æ­¤ç‰¹åˆ«æŒ‡å‡ºï¼ŒSpring Data[m
[31m-Redisåªå¯¹Redis 2.6å’Œ2.8ç‰ˆæœ¬åšè¿‡æµ‹è¯•ã€‚[m
[31m-[m
[31m-     æ ¹æ®Redisçš„ä¸åŒçš„Javaå®¢æˆ·ç«¯ï¼ŒSpring Data Redisæä¾›äº†å¦‚[m
[31m-ä¸‹çš„ConnectionFactoryï¼š[m
[31m-[m
[31m-     JedisConnectionFactoryï¼šä½¿ç”¨Jedisä½œä¸ºRediså®¢æˆ·ç«¯ã€‚[m
[31m-[m
[31m-     JredisConnectionFactoryï¼šä½¿ç”¨Jredisä½œä¸ºRediså®¢æˆ·ç«¯ã€‚[m
[31m-[m
[31m-     LettuceConnectionFactoryï¼šä½¿ç”¨Lettuceä½œä¸ºRediså®¢æˆ·ç«¯ã€‚[m
[31m-[m
[31m-     SrpConnectionFactoryï¼šä½¿ç”¨Spullara/redis-protocolä½œä¸º[m
[31m-Rediså®¢æˆ·ç«¯ã€‚[m
[31m-[m
[31m-     é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-             @Bean[m
[31m-              public RedisConnectionFactory redisConnectionFactory() {[m
[31m-                      return new JedisConnectionFactory();[m
[31m-              }[m
[31m-[m
[31m-     RedisTemplateé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public RedisTemplate<Object, Object> redisTemplate()throws UnknownH[m
[31m-[m
[31m-                      RedisTemplate<Object, Object> template = new RedisTemplate<Obje[m
[31m-       ();[m
[31m-[m
[31m-                      template.setConnectionFactory(redisConnectionFactory());[m
[31m-                      return template;[m
[31m-              }[m
[31m-     ï¼ˆ2ï¼‰ä½¿ç”¨[m
[31m-[m
[31m-     Spring Data Redisä¸ºæˆ‘ä»¬æä¾›äº†RedisTemplateå’Œ[m
[31m-StringRedisTemplateä¸¤ä¸ªæ¨¡æ¿æ¥è¿›è¡Œæ•°æ®æ“ä½œï¼Œå…¶ä¸­ï¼Œ[m
[31m-StringRedisTemplateåªé’ˆå¯¹é”®å€¼éƒ½æ˜¯å­—ç¬¦å‹çš„æ•°æ®è¿›è¡Œæ“ä½œã€‚[m
[31m-[m
[31m-     RedisTemplateå’ŒStringRedisTemplateæä¾›çš„ä¸»è¦æ•°æ®è®¿é—®[m
[31m-æ–¹æ³•å¦‚è¡¨8-8æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                 è¡¨8-8ã€€æ•°æ®è®¿é—®æ–¹æ³•[m
[31m-[m
[31m-     æ›´å¤šå…³äºSpring Data Redisçš„æ“ä½œï¼Œè¯·æŸ¥çœ‹Spring Data[m
[31m-Rediså®˜æ–¹æ–‡æ¡£ã€‚[m
[31m-[m
[31m-ï¼ˆ3ï¼‰å®šä¹‰Serializer[m
[31m-[m
[31m-     å½“æˆ‘ä»¬çš„æ•°æ®å­˜å‚¨åˆ°Redisçš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„é”®ï¼ˆkeyï¼‰å’Œå€¼[m
[31m-ï¼ˆvalueï¼‰éƒ½æ˜¯é€šè¿‡Springæä¾›çš„Serializeråºåˆ—åŒ–åˆ°æ•°æ®åº“çš„ã€‚[m
[31m-RedisTemplateé»˜è®¤ä½¿ç”¨çš„æ˜¯JdkSerializationRedisSerializerï¼Œ[m
[31m-StringRedisTemplateé»˜è®¤ä½¿ç”¨çš„æ˜¯StringRedisSerializerã€‚[m
[31m-[m
[31m-Spring Data JPAä¸ºæˆ‘ä»¬æä¾›äº†ä¸‹é¢çš„Serializerï¼š[m
[31m-[m
[31m-     GenericToStringSerializerã€Jackson2JsonRedisSerializerã€[m
[31m-JacksonJsonRedisSerializerã€JdkSerializationRedisSerializerã€[m
[31m-OxmSerializerã€StringRedisSerializerã€‚[m
[31m-[m
[31m-2.Spring Bootçš„æ”¯æŒ[m
[31m-[m
[31m-Spring            Bootå¯¹Redisçš„æ”¯æŒï¼Œ[m
[31m-org.springframework.boot.autoconfigure.redisåŒ…å¦‚å›¾8-66æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                    å›¾8-66ã€€RedisåŒ…[m
[31m-[m
[31m-     RedisAutoConfigurationä¸ºæˆ‘ä»¬é»˜è®¤é…ç½®äº†[m
[31m-JedisConnectionFactoryã€RedisTemplateä»¥åŠ[m
[31m-StringRedisTemplateï¼Œè®©æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨Redisä½œä¸ºæ•°æ®å­˜[m
[31m-å‚¨ã€‚[m
[31m-[m
[31m-     RedisPropertieså‘æˆ‘ä»¬å±•ç¤ºäº†å¯ä»¥ä½¿ç”¨ä»¥â€œspring.redisâ€ä¸ºå‰[m
[31m-ç¼€çš„å±æ€§åœ¨application.propertiesä¸­é…ç½®Redisï¼Œä¸»è¦å±æ€§å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       spring.redis.database= 0# æ•°æ®åº“åç§°ï¼Œé»˜è®¤ä¸ºdb0[m
[31m-       spring.redis.host=localhost #æœåŠ¡å™¨åœ°å€ï¼Œé»˜è®¤ä¸ºlocalhostt[m
[31m-       spring.redis.password= # æ•°æ®åº“å¯†ç d[m
[31m-       spring.redis.port=6379 # è¿æ¥ç«¯å£å·ï¼Œé»˜è®¤ä¸º6379[m
[31m-       spring.redis.pool.max-idle=8 # è¿æ¥æ± è®¾ç½®[m
[31m-       spring.redis.pool.min-idle=0[m
[31m-       spring.redis.pool.max-active=8[m
[31m-       spring.redis.pool.max-wait=-1[m
[31m-       spring.redis.sentinel.master=[m
[31m-       spring.redis.sentinel.nodes=[m
[31m-       spring.redis.timeout=[m
[31m-[m
[31m-     3.å®æˆ˜[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰å®‰è£…Redis[m
[31m-[m
[31m-     1ï¼‰éDockerå®‰è£…ã€‚è‹¥ä¸åŸºäºDockerå®‰è£…çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ°[m
[31m-http://redis.io/downloadä¸‹è½½åˆé€‚ç‰ˆæœ¬çš„Redisã€‚æ³¨æ„ä¸è¦ä¸‹è½½æœ€[m
[31m-æ–°ç‰ˆæœ¬çš„3.0.xç‰ˆæœ¬ã€‚[m
[31m-     2ï¼‰Dockerå®‰è£…ã€‚å‰é¢æˆ‘ä»¬å·²ç»ä¸‹è½½å¥½äº†Redisé•œåƒï¼Œé€šè¿‡[m
[31m-[m
[31m-ä¸‹é¢å‘½ä»¤è¿è¡Œå®¹å™¨ï¼š[m
[31m-[m
[31m-       docker run -d -p 6379:6379 redis:2.8.21[m
[31m-[m
[31m-     å¹¶åœ¨VirtualBoxé…ç½®ç«¯å£æ˜ å°„ï¼Œå¦‚å›¾8-67æ‰€ç¤ºã€‚[m
[31m-[m
[31m-å›¾8-67ã€€ç«¯å£æ˜ å°„[m
[31m-[m
[31m-Redisæ•°æ®ç®¡ç†å¯ä»¥ä½¿ç”¨Redis  Clientï¼Œä¸‹è½½åœ°å€ä¸º[m
[31m-[m
[31m-https://github.com/caoxinyu/RedisClientï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥ç‹¬ç«‹è¿[m
[31m-[m
[31m-è¡Œçš„jaråŒ…ï¼Œå¦‚å›¾8-68æ‰€ç¤ºã€‚[m
[31m-                                  å›¾8-68ã€€RedisClient[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰æ–°å»ºSpring Booté¡¹ç›®[m
[31m-     æ­å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºRedisï¼ˆspring-boot-starter-[m
[31m-redisï¼‰å’ŒWebï¼ˆspring-boot-starter-webï¼‰ã€‚[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-       groupIdï¼šcom.wisely[m
[31m-       arctifactId:ch8_6_2[m
[31m-       package: com.wisely. ch8_6_2[m
[31m-[m
[31m-     å› ä¸ºSpring Bootçš„é»˜è®¤æ•°æ®åº“è¿æ¥æ»¡è¶³æˆ‘ä»¬å½“å‰æµ‹è¯•çš„è¦[m
[31m-æ±‚ï¼Œæ‰€ä»¥æ— é¡»ä¸åœ¨application.propertiesé…ç½®è¿æ¥ä¿¡æ¯ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰é¢†åŸŸæ¨¡å‹ç±»ï¼š[m
[31m-[m
[31m-       package com.wisely.ch8_6_2.dao;[m
[31m-       import java.io.Serializable;[m
[31m-       public class Person implements Serializable{[m
[31m-[m
[31m-              private static final long serialVersionUID = 1L;[m
[31m-[m
[31m-              private String id;[m
[31m-              private String name;[m
[31m-              private Integer age;[m
[31m-[m
[31m-              public Person() {[m
[31m-                      super();[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              public Person(String id,String name, Integer age) {[m
[31m-                      super();[m
[31m-                      this.id = id;[m
[31m-                      this.name = name;[m
[31m-                      this.age = age;[m
[31m-[m
[31m-              }[m
[31m-       //çœç•¥getterã€setteræ–¹æ³•[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     æ­¤ç±»å¿…é¡»ç”¨æ—¶é—´åºåˆ—åŒ–æ¥å£ï¼Œå› ä¸ºä½¿ç”¨Jacksonåšåºåˆ—åŒ–éœ€[m
[31m-è¦ä¸€ä¸ªç©ºæ„é€ ã€‚[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰æ•°æ®è®¿é—®ï¼š[m
[31m-[m
[31m-       package com.wisely.ch8_6_2.domain;[m
[31m-[m
[31m-       import javax.annotation.Resource;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.data.redis.core.RedisTemplate;[m
[31m-       import org.springframework.data.redis.core.StringRedisTemplate;[m
[31m-       import org.springframework.data.redis.core.ValueOperations;[m
[31m-       import org.springframework.stereotype.Repository;[m
[31m-[m
[31m-       import com.wisely.ch8_6_2.dao.Person;[m
[31m-[m
[31m-       @Repository[m
[31m-       public class PersonDao {[m
[31m-[m
[31m-              @Autowired[m
[31m-              StringRedisTemplate stringRedisTemplate; //1[m
[31m-[m
[31m-              @Resource(name="stringRedisTemplate")[m
[31m-              ValueOperations<String,String> valOpsStr; //3[m
[31m-[m
[31m-              @Autowired[m
[31m-              RedisTemplate<Object, Object> redisTemplate; //2[m
[31m-[m
[31m-              @Resource(name="redisTemplate")[m
[31m-              ValueOperations<Object, Object> valOps; //4[m
[31m-[m
[31m-              public void stringRedisTemplateDemo(){ //5[m
[31m-                      valOpsStr.set("xx", "yy");[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              public void save(Person person){[m
[31m-                      valOps.set(person.getId(),person); //6[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              public String getString(){[m
[31m-                      return valOpsStr.get("xx");//7[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              public Person getPerson(){[m
[31m-                      return (Person) valOps.get("1");//8[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ Spring Bootå·²ä¸ºæˆ‘ä»¬é…ç½®StringRedisTemplateï¼Œåœ¨æ­¤å¤„å¯[m
[31m-ä»¥ç›´æ¥æ³¨å…¥ã€‚[m
[31m-[m
[31m-     â‘¡Spring Bootå·²ä¸ºæˆ‘ä»¬é…ç½®RedisTemplateï¼Œåœ¨æ­¤å¤„å¯ä»¥ç›´[m
[31m-æ¥æ³¨å…¥ã€‚[m
[31m-[m
[31m-     â‘¢å¯ä»¥ä½¿ç”¨@Resourceæ³¨è§£æŒ‡å®šstringRedisTemplateï¼Œå¯æ³¨[m
[31m-å…¥åŸºäºå­—ç¬¦ä¸²çš„ç®€å•å±æ€§æ“ä½œæ–¹æ³•ã€‚[m
[31m-[m
[31m-     â‘£å¯ä»¥ä½¿ç”¨@Resourceæ³¨è§£æŒ‡å®šredisTemplateï¼Œå¯æ³¨å…¥åŸºäº[m
[31m-å¯¹è±¡çš„ç®€å•å±æ€§æ“ä½œæ–¹æ³•ï¼›[m
[31m-[m
[31m-â‘¤é€šè¿‡setæ–¹æ³•ï¼Œå­˜å‚¨å­—ç¬¦ä¸²ç±»å‹ã€‚[m
[31m-[m
[31m-â‘¥é€šè¿‡setæ–¹æ³•ï¼Œå­˜å‚¨å¯¹è±¡ç±»å‹ã€‚[m
[31m-[m
[31m-â‘¦é€šè¿‡getæ–¹æ³•ï¼Œè·å¾—å­—ç¬¦ä¸²ã€‚[m
[31m-[m
[31m-â‘§é€šè¿‡getæ–¹æ³•ï¼Œè·å¾—å¯¹è±¡ã€‚[m
[31m-[m
[31m-ï¼ˆ5ï¼‰é…ç½®[m
[31m-[m
[31m-Spring     Bootä¸ºæˆ‘ä»¬è‡ªåŠ¨é…ç½®äº†RedisTemplateï¼Œè€Œ[m
[31m-[m
[31m-RedisTemplateä½¿ç”¨çš„æ˜¯JdkSerializationRedisSerializerï¼Œè¿™ä¸ªå¯¹[m
[31m-[m
[31m-æˆ‘ä»¬æ¼”ç¤ºRedis          Clientå¾ˆä¸ç›´è§‚ï¼Œå› ä¸º[m
[31m-[m
[31m-JdkSerializationRedisSerializerä½¿ç”¨äºŒçº§åˆ¶å½¢å¼å­˜å‚¨æ•°æ®ï¼Œåœ¨æ­¤[m
[31m-[m
[31m-æˆ‘ä»¬å°†è‡ªå·±é…ç½®RedisTemplateå¹¶å®šä¹‰Serializerã€‚[m
[31m-[m
[31m-package com.wisely.ch8_6_2;[m
[31m-[m
[31m-import java.net.UnknownHostException;[m
[31m-[m
[31m-import org.springframework.boot.SpringApplication;[m
[31m-import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-import org.springframework.context.annotation.Bean;[m
[31m-import org.springframework.data.redis.connection.RedisConnectionFactory[m
[31m-import org.springframework.data.redis.core.RedisTemplate;[m
[31m-import org.springframework.data.redis.serializer.Jackson2JsonRedisSeria[m
[31m-import org.springframework.data.redis.serializer.StringRedisSerializer;[m
[31m-[m
[31m-import com.fasterxml.jackson.annotation.JsonAutoDetect;[m
[31m-import com.fasterxml.jackson.annotation.PropertyAccessor;[m
[31m-import com.fasterxml.jackson.databind.ObjectMapper;[m
[31m-[m
[31m-@SpringBootApplication[m
[31m-public class Ch862Application {[m
[31m-              public static void main(String[] args) {[m
[31m-                      SpringApplication.run(Ch862Application.class, args);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              @SuppressWarnings({ "rawtypes", "unchecked" })[m
[31m-              public RedisTemplate<Object, Object> redisTemplate(RedisConnectionF[m
[31m-[m
[31m-                             throws UnknownHostException {[m
[31m-                      RedisTemplate<Object, Object> template = new RedisTemplate<Obje[m
[31m-       ();[m
[31m-                      template.setConnectionFactory(redisConnectionFactory);[m
[31m-[m
[31m-                      Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new J[m
[31m-                      ObjectMapper om = new ObjectMapper();[m
[31m-                      om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibilit[m
[31m-                      om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);[m
[31m-                      jackson2JsonRedisSerializer.setObjectMapper(om);[m
[31m-[m
[31m-                      template.setValueSerializer(jackson2JsonRedisSerializer); //1[m
[31m-                      template.setKeySerializer(new StringRedisSerializer()); //2[m
[31m-[m
[31m-                      template.afterPropertiesSet();[m
[31m-                      return template;[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ è®¾ç½®å€¼ï¼ˆvalueï¼‰çš„åºåˆ—åŒ–é‡‡ç”¨[m
[31m-Jackson2JsonRedisSerializerã€‚[m
[31m-[m
[31m-     â‘¡è®¾ç½®é”®ï¼ˆkeyï¼‰çš„åºåˆ—åŒ–é‡‡ç”¨StringRedisSerializerã€‚[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰æ§åˆ¶å™¨ï¼š[m
[31m-[m
[31m-       package com.wisely.ch8_6_2.web;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-import com.wisely.ch8_6_2.dao.Person;[m
[31m-import com.wisely.ch8_6_2.domain.PersonDao;[m
[31m-[m
[31m-@RestController[m
[31m-public class DataController {[m
[31m-[m
[31m-       @Autowired[m
[31m-       PersonDao personDao;[m
[31m-[m
[31m-       @RequestMapping("/set") //1[m
[31m-       public void set(){[m
[31m-[m
[31m-              Person person = new Person("1","wyf", 32);[m
[31m-              personDao.save(person);[m
[31m-              personDao.stringRedisTemplateDemo();[m
[31m-       }[m
[31m-[m
[31m-       @RequestMapping("/getStr") //2[m
[31m-       public String getStr(){[m
[31m-[m
[31m-              return personDao.getString();[m
[31m-       }[m
[31m-[m
[31m-       @RequestMapping("/getPerson") //3[m
[31m-       public Person getPerson(){[m
[31m-[m
[31m-              return personDao.getPerson();[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ æ¼”ç¤ºè®¾ç½®å­—ç¬¦åŠå¯¹è±¡ã€‚[m
[31m-[m
[31m-â‘¡æ¼”ç¤ºè·å¾—å­—ç¬¦ã€‚[m
[31m-[m
[31m-â‘¢æ¼”ç¤ºè·å¾—å¯¹è±¡ã€‚[m
[31m-[m
[31m-ï¼ˆ7ï¼‰è¿è¡Œ[m
[31m-[m
[31m-æ¼”ç¤ºè®¾ç½®å­—ç¬¦åŠå¯¹è±¡ï¼Œè®¿é—®http://localhostï¼š8080/setï¼Œæ­¤æ—¶[m
[31m-æŸ¥çœ‹Redis Clientã€‚[m
[31m-     å­—ç¬¦å­˜å‚¨å¦‚å›¾8-69æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾8-69ã€€å­—ç¬¦å­˜å‚¨[m
[31m-[m
[31m-     å¯¹è±¡å­˜å‚¨å¦‚å›¾8-70æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾8-70ã€€å¯¹è±¡å­˜å‚¨[m
[31m-[m
[31m-     æ¼”ç¤ºè·å¾—å­—ç¬¦ï¼Œè®¿é—®http://localhostï¼š8080/getStrï¼Œé¡µé¢æ˜¾[m
[31m-ç¤ºå¦‚å›¾8-71æ‰€ç¤ºã€‚[m
[31m-                                   å›¾8-71ã€€è·å¾—å­—ç¬¦[m
[31m-[m
[31m-     æ¼”ç¤ºè·å¾—å¯¹è±¡ï¼Œè®¿é—®http://localhostï¼š8080/getPersonï¼Œé¡µé¢[m
[31m-æ˜¾ç¤ºå¦‚å›¾8-72æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                   å›¾8-72ã€€è·å¾—å¯¹è±¡[m
[31m-ç¬¬9ç« ã€€Spring Bootä¼ä¸šçº§å¼€å‘[m
[31m-[m
[31m-9.1ã€€å®‰å…¨æ§åˆ¶Spring Security[m
[31m-[m
[31m-9.1.1ã€€Spring Securityå¿«é€Ÿå…¥é—¨[m
[31m-[m
[31m-     1.ä»€ä¹ˆæ˜¯Spring Security[m
[31m-[m
[31m-     Spring Securityæ˜¯ä¸“é—¨é’ˆå¯¹åŸºäºSpringçš„é¡¹ç›®çš„å®‰å…¨æ¡†æ¶ï¼Œ[m
[31m-å……åˆ†åˆ©ç”¨äº†ä¾èµ–æ³¨å…¥å’ŒAOPæ¥å®ç°å®‰å…¨çš„åŠŸèƒ½ã€‚[m
[31m-[m
[31m-     åœ¨æ—©æœŸçš„Spring Securityç‰ˆæœ¬ï¼Œä½¿ç”¨Spring Securityéœ€è¦ä½¿[m
[31m-ç”¨å¤§é‡çš„XMLé…ç½®ï¼Œè€Œæœ¬èŠ‚å°†å…¨éƒ¨åŸºäºJavaé…ç½®æ¥å®ç°Spring[m
[31m-Securityçš„åŠŸèƒ½ã€‚[m
[31m-[m
[31m-     å®‰å…¨æ¡†æ¶æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œå³è®¤è¯ï¼ˆAuthenticationï¼‰å’Œ[m
[31m-æˆæƒï¼ˆAuthorizationï¼‰ã€‚è®¤è¯å³ç¡®è®¤ç”¨æˆ·å¯ä»¥è®¿é—®å½“å‰ç³»ç»Ÿï¼›[m
[31m-æˆæƒå³ç¡®å®šç”¨æˆ·åœ¨å½“å‰ç³»ç»Ÿä¸‹æ‰€æ‹¥æœ‰çš„åŠŸèƒ½æƒé™ï¼Œæœ¬èŠ‚å°†å›´ç»•[m
[31m-è®¤è¯å’Œæˆæƒå±•å¼€ã€‚[m
[31m-[m
[31m-     2.Spring Securityçš„é…ç½®[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰DelegatingFilterProxy[m
[31m-[m
[31m-     Spring Securityä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¤šä¸ªè¿‡æ»¤å™¨æ¥å®ç°æ‰€æœ‰å®‰[m
[31m-å…¨çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åªéœ€æ³¨å†Œä¸€ä¸ªç‰¹æ®Šçš„DelegatingFilterProxyè¿‡æ»¤[m
[31m-å™¨åˆ°WebApplicationInitializerå³å¯ã€‚[m
[31m-è€Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬åªéœ€è®©è‡ªå·±çš„Initializerç±»ç»§æ‰¿[m
[31m-[m
[31m-AbstractSecurity  WebApplicationInitializeræŠ½è±¡ç±»å³å¯ã€‚[m
[31m-[m
[31m-AbstractSecurityWebApplicationInitializerå®ç°äº†[m
[31m-[m
[31m-WebApplicationInitializeræ¥å£ï¼Œå¹¶é€šè¿‡onStartupæ–¹æ³•è°ƒç”¨ï¼š[m
[31m-[m
[31m-insertSpringSecurityFilterChain(servletContext);[m
[31m-[m
[31m-     å®ƒä¸ºæˆ‘ä»¬æ³¨å†Œäº†DelegatingFilterProxyã€‚[m
[31m-insertSpringSecurityFilterChainæºç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-              private void insertSpringSecurityFilterChain(ServletContext servlet[m
[31m-                      String filterName = DEFAULT_FILTER_NAME;[m
[31m-                      DelegatingFilterProxy springSecurityFilterChain = new Delegatin[m
[31m-                                    filterName);[m
[31m-                      String contextAttribute = getWebApplicationContextAttribute();[m
[31m-                      if (contextAttribute != null) {[m
[31m-                             springSecurityFilterChain.setContextAttribute(contextAttrib[m
[31m-                      }[m
[31m-                      registerFilter(servletContext, true, filterName, springSecurity[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-     æ‰€ä»¥æˆ‘ä»¬åªéœ€ç”¨ä»¥ä¸‹ä»£ç å³å¯å¼€å¯Spring Securityçš„è¿‡æ»¤å™¨[m
[31m-æ”¯æŒï¼š[m
[31m-[m
[31m-public class AppInitializer extends                Abstrac[m
[31m-}[m
[31m-[m
[31m-ï¼ˆ2ï¼‰é…ç½®[m
[31m-Spring Securityçš„é…ç½®å’ŒSpring MVCçš„é…ç½®ç±»ä¼¼ï¼Œåªéœ€åœ¨[m
[31m-ä¸€ä¸ªé…ç½®ç±»ä¸Šæ³¨è§£@EnableWebSecurityï¼Œå¹¶è®©è¿™ä¸ªç±»ç»§æ‰¿[m
[31m-WebSecurityConfigurerAdapterå³å¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™[m
[31m-configureæ–¹æ³•æ¥é…ç½®ç›¸å…³çš„å®‰å…¨é…ç½®ã€‚[m
[31m-[m
[31m-     ä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableWebSecurity[m
[31m-       public class WebSecurityConfig extends WebSecurityConfigurerAdapter{[m
[31m-[m
[31m-              @Override[m
[31m-              protected void configure(HttpSecurity http) throws Exception {[m
[31m-[m
[31m-                      super.configure(http);[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              protected void configure(AuthenticationManagerBuilder auth) throws[m
[31m-[m
[31m-                      super.configure(auth);[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public void configure(WebSecurity web) throws Exception {[m
[31m-[m
[31m-                      super.configure(web);[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     3.ç”¨æˆ·è®¤è¯[m
[31m-[m
[31m-     è®¤è¯éœ€è¦æˆ‘ä»¬æœ‰ä¸€å¥—ç”¨æˆ·æ•°æ®çš„æ¥æºï¼Œè€Œæˆæƒåˆ™æ˜¯å¯¹äºæŸ[m
[31m-ä¸ªç”¨æˆ·æœ‰ç›¸åº”çš„è§’è‰²æƒé™ã€‚åœ¨Spring Securityé‡Œæˆ‘ä»¬é€šè¿‡é‡å†™[m
[31m-[m
[31m-       protected void configure(AuthenticationManagerBuilder auth)[m
[31m-[m
[31m-     æ–¹æ³•æ¥å®ç°å®šåˆ¶ã€‚[m
[31m-     ï¼ˆ1ï¼‰å†…å­˜ä¸­çš„ç”¨æˆ·[m
[31m-[m
[31m-     ä½¿ç”¨AuthenticationManagerBuilderçš„[m
[31m-inMemoryAuthenticationæ–¹æ³•å³å¯æ·»åŠ åœ¨å†…å­˜ä¸­çš„ç”¨æˆ·ï¼Œå¹¶å¯[m
[31m-ç»™ç”¨æˆ·æŒ‡å®šè§’è‰²æƒé™[m
[31m-[m
[31m-       @Override[m
[31m-              protected void configure(AuthenticationManagerBuilder auth) throws[m
[31m-                      auth.inMemoryAuthentication()[m
[31m-                             .withUser("wyf").password("wyf").roles("ROLE_ADMIN")[m
[31m-                             .and()[m
[31m-                             .withUser("wisely").password("wisely").roles("ROLE_USER");[m
[31m-              }[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰JDBCä¸­çš„ç”¨æˆ·[m
[31m-[m
[31m-     JDBCä¸­çš„ç”¨æˆ·ç›´æ¥æŒ‡å®šdataSourceå³å¯ã€‚[m
[31m-[m
[31m-       @Autowired[m
[31m-              DataSource dataSource;[m
[31m-[m
[31m-              @Override[m
[31m-              protected void configure(AuthenticationManagerBuilder auth) throws[m
[31m-[m
[31m-                      auth.jdbcAuthentication().dataSource(dataSource);[m
[31m-              }[m
[31m-[m
[31m-     ä¸è¿‡è¿™çœ‹ä¸Šå»å¾ˆå¥‡æ€ªï¼Œå…¶å®è¿™é‡Œçš„Spring Securityæ˜¯é»˜è®¤äº†[m
[31m-ä½ çš„æ•°æ®åº“ç»“æ„çš„ã€‚é€šè¿‡jdbcAuthenticationçš„æºç ï¼Œæˆ‘ä»¬å¯ä»¥[m
[31m-çœ‹å‡ºåœ¨JdbcDaoImplä¸­å®šä¹‰äº†é»˜è®¤çš„ç”¨æˆ·åŠè§’è‰²æƒé™è·å–çš„[m
[31m-SQLè¯­å¥ï¼š[m
[31m-[m
[31m-       public static final String DEF_USERS_BY_USERNAME_QUERY = "select userna[m
[31m-                             + "from users " + "where username = ?";[m
[31m-[m
[31m-              public static final String DEF_AUTHORITIES_BY_USERNAME_QUERY = "sel[m
[31m-                             + "from authorities " + "where username = ?";[m
[31m-[m
[31m-     å½“ç„¶æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æˆ‘ä»¬çš„æŸ¥è¯¢ç”¨æˆ·å’Œæƒé™çš„SQLè¯­å¥ï¼Œ[m
[31m-ä¾‹å¦‚ï¼š[m
[31m-[m
[31m-              @Override[m
[31m-              protected void configure(AuthenticationManagerBuilder auth) throws[m
[31m-[m
[31m-                      auth.jdbcAuthentication().dataSource(dataSource)[m
[31m-                             .usersByUsernameQuery("select username,password,true "[m
[31m-                                           + "from myusers where username = ?")[m
[31m-                             .authoritiesByUsernameQuery("select username,role "[m
[31m-                                           + "from roles where username = ?");[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰é€šç”¨çš„ç”¨æˆ·[m
[31m-[m
[31m-     ä¸Šé¢çš„ä¸¤ç§ç”¨æˆ·å’Œæƒé™çš„è·å–æ–¹å¼åªé™äºå†…å­˜æˆ–è€…[m
[31m-JDBCï¼Œæˆ‘ä»¬çš„æ•°æ®è®¿é—®æ–¹å¼å¯ä»¥æ˜¯å¤šç§å„æ ·çš„ï¼Œå¯ä»¥æ˜¯éå…³[m
[31m-ç³»å‹æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„JPAç­‰ã€‚[m
[31m-[m
[31m-     è¿™æ—¶æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰å®ç°UserDetailsServiceæ¥å£ã€‚ä¸Šé¢çš„[m
[31m-å†…å­˜ä¸­ç”¨æˆ·åŠJDBCç”¨æˆ·å°±æ˜¯UserDetailsServiceçš„å®ç°ï¼Œå®šä¹‰[m
[31m-å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       public class CustomUserService implements UserDetailsService {[m
[31m-              @Autowired[m
[31m-              SysUserRepository userRepository;[m
[31m-[m
[31m-              @Override[m
[31m-              public UserDetails loadUserByUsername(String username) throws Usern[m
[31m-[m
[31m-                      SysUser user = userRepository.findByUsername(username);[m
[31m-                      List<GrantedAuthority> authorities =new ArrayList<GrantedAuthor[m
[31m-       ();[m
[31m-                      authorities.add(new SimpleGrantedAuthority("ROLE_ADMIN"));[m
[31m-                      return new User(user.getUsername(),user.getPassword(),authoriti[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     è¯´æ˜ï¼šSysUseræ˜¯æˆ‘ä»¬ç³»ç»Ÿçš„ç”¨æˆ·é¢†åŸŸå¯¹è±¡ç±»ï¼ŒUseræ¥è‡ªäº[m
[31m-org.springframework.security.core.userdetails.Userã€‚[m
[31m-[m
[31m-     é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ³¨å†Œè¿™ä¸ªCustomUserServiceï¼Œä»£ç [m
[31m-å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              UserDetailsService customUserService(){[m
[31m-[m
[31m-                      return new CustomUserService();[m
[31m-              }[m
[31m-              @Override[m
[31m-              protected void configure(AuthenticationManagerBuilder auth) throws[m
[31m-[m
[31m-                      auth.userDetailsService(customUserService());[m
[31m-              }[m
[31m-[m
[31m-     4.è¯·æ±‚æˆæƒ[m
[31m-     Spring Securityæ˜¯é€šè¿‡é‡å†™[m
[31m-[m
[31m-       protected void configure(HttpSecurity http)[m
[31m-[m
[31m-     æ–¹æ³•æ¥å®ç°è¯·æ±‚æ‹¦æˆªçš„ã€‚[m
[31m-     Spring Securityä½¿ç”¨ä»¥ä¸‹åŒ¹é…å™¨æ¥åŒ¹é…è¯·æ±‚è·¯å¾„ï¼š[m
[31m-     antMatchersï¼šä½¿ç”¨Anté£æ ¼çš„è·¯å¾„åŒ¹é…ã€‚[m
[31m-     regexMatchersï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è·¯å¾„ã€‚[m
[31m-     anyRequestï¼šåŒ¹é…æ‰€æœ‰è¯·æ±‚è·¯å¾„ã€‚[m
[31m-     åœ¨åŒ¹é…äº†è¯·æ±‚è·¯å¾„åï¼Œéœ€è¦é’ˆå¯¹å½“å‰ç”¨æˆ·çš„ä¿¡æ¯å¯¹è¯·æ±‚è·¯[m
[31m-å¾„è¿›è¡Œå®‰å…¨å¤„ç†ï¼ŒSpring Securityæä¾›äº†è¡¨9-1æ‰€ç¤ºçš„å®‰å…¨å¤„ç†[m
[31m-æ–¹æ³•ã€‚[m
[31m-[m
[31m-                                 è¡¨9-1ã€€å®‰å…¨å¤„ç†æ–¹æ³•[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ï¼š[m
[31m-[m
[31m-              @Override[m
[31m-              protected void configure(HttpSecurity http) throws Exception {[m
[31m-[m
[31m-                      http[m
[31m-                      .authorizeRequests() //1[m
[31m-                      .antMatchers("/admin/**").hasRole("ROLE_ADMIN") //2[m
[31m-                      .antMatchers("/user/**").hasAnyRole("ROLE_ADMIN","ROLE_USER") /[m
[31m-                      .anyRequest().authenticated();//4[m
[31m-              }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ é€šè¿‡authorizeRequestsæ–¹æ³•æ¥å¼€å§‹è¯·æ±‚æƒé™é…ç½®ã€‚[m
[31m-     â‘¡è¯·æ±‚åŒ¹é…/admin/**ï¼Œåªæœ‰æ‹¥æœ‰ROLE_ADMINè§’è‰²çš„ç”¨[m
[31m-æˆ·å¯ä»¥è®¿é—®ã€‚[m
[31m-[m
[31m-     â‘¢è¯·æ±‚åŒ¹é…/user/**ï¼Œæ‹¥æœ‰ROLE_ADMINæˆ–ROLE_USERè§’[m
[31m-è‰²çš„ç”¨æˆ·éƒ½å¯è®¿é—®ã€‚[m
[31m-[m
[31m-     â‘£å…¶ä½™æ‰€æœ‰çš„è¯·æ±‚éƒ½éœ€è¦è®¤è¯åï¼ˆç™»å½•åï¼‰æ‰å¯è®¿é—®ã€‚[m
[31m-[m
[31m-     5.å®šåˆ¶ç™»å½•è¡Œä¸º[m
[31m-[m
[31m-     æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é‡å†™[m
[31m-[m
[31m-       protected void configure(HttpSecurity http)[m
[31m-[m
[31m-     æ–¹æ³•æ¥å®šåˆ¶æˆ‘ä»¬çš„ç™»å½•è¡Œä¸ºã€‚[m
[31m-[m
[31m-     ä¸‹é¢å°†é‡ç”¨çš„ç™»å½•è¡Œä¸ºçš„å®šåˆ¶ä»¥ç®€çŸ­çš„ä»£ç æ¼”ç¤ºï¼š[m
[31m-[m
[31m-       @Override[m
[31m-              protected void configure(HttpSecurity http) throws Exception {[m
[31m-                      http[m
[31m-                             .formLogin() //1[m
[31m-                               .loginPage("/login") //2[m
[31m-                               .defaultSuccessUrl("/index") //3[m
[31m-                               .failureUrl("/login?error") //4[m
[31m-                               .permitAll()[m
[31m-                             .and()[m
[31m-                             .rememberMe() //5[m
[31m-                                    .tokenValiditySeconds(1209600) //6[m
[31m-                                    .key("myKey") //7[m
[31m-                             .and()[m
[31m-                             .logout()//8[m
[31m-                                    .logoutUrl("/custom-logout") //9[m
[31m-                                    .logoutSuccessUrl("/logout-success") //10[m
[31m-                                    .permitAll();[m
[31m-[m
[31m-              }[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ é€šè¿‡formLoginæ–¹æ³•å®šåˆ¶ç™»å½•æ“ä½œã€‚[m
[31m-     â‘¡ä½¿ç”¨loginPageæ–¹æ³•å®šåˆ¶ç™»å½•é¡µé¢çš„è®¿é—®åœ°å€ã€‚[m
[31m-     â‘¢defaultSuccessUrlæŒ‡å®šç™»å½•æˆåŠŸåè½¬å‘çš„é¡µé¢ã€‚[m
[31m-     â‘£failureUrlæŒ‡å®šç™»å½•å¤±è´¥åè½¬å‘çš„é¡µé¢ã€‚[m
[31m-     â‘¤rememberMeå¼€å¯cookieå­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€‚[m
[31m-     â‘¥tokenValiditySecondsæŒ‡å®šcookieæœ‰æ•ˆæœŸä¸º1209600ç§’ï¼Œå³[m
[31m-2ä¸ªæ˜ŸæœŸã€‚[m
[31m-     â‘¦keyæŒ‡å®šcookieä¸­çš„ç§é’¥ã€‚[m
[31m-     â‘§ä½¿ç”¨logoutæ–¹æ³•å®šåˆ¶æ³¨é”€è¡Œä¸ºã€‚[m
[31m-     â‘¨logoutUrlæŒ‡å®šæ³¨é”€çš„URLè·¯å¾„ã€‚[m
[31m-     â‘©logoutSuccessUrlæŒ‡å®šæ³¨é”€æˆåŠŸåè½¬å‘çš„é¡µé¢ã€‚[m
[31m-[m
[31m-9.1.2ã€€Spring Bootçš„æ”¯æŒ[m
[31m-[m
[31m-Spring  Booté’ˆå¯¹Spring  Securityçš„è‡ªåŠ¨é…ç½®åœ¨[m
[31m-[m
[31m-org.springframework.boot.autoconfigure.securityåŒ…ä¸­ã€‚[m
[31m-[m
[31m-     ä¸»è¦é€šè¿‡SecurityAutoConfigurationå’ŒSecurityPropertiesæ¥å®Œ[m
[31m-æˆé…ç½®ã€‚[m
[31m-[m
[31m-     SecurityAutoConfigurationå¯¼å…¥äº†[m
[31m-SpringBootWebSecurityConfigurationä¸­çš„é…ç½®ã€‚åœ¨[m
[31m-SpringBootWebSecurityConfigurationé…ç½®ä¸­ï¼Œæˆ‘ä»¬è·å¾—å¦‚ä¸‹çš„[m
[31m-è‡ªåŠ¨é…ç½®ï¼š[m
[31m-[m
[31m-     1ï¼‰è‡ªåŠ¨é…ç½®äº†ä¸€ä¸ªå†…å­˜ä¸­çš„ç”¨æˆ·ï¼Œè´¦å·ä¸ºuserï¼Œå¯†ç åœ¨ç¨‹[m
[31m-åºå¯åŠ¨æ—¶å‡ºç°ã€‚[m
[31m-[m
[31m-     2ï¼‰å¿½ç•¥/css/**ã€/js/**ã€/images/**å’Œ/**/favicon.icoç­‰é™æ€[m
[31m-æ–‡ä»¶çš„æ‹¦æˆªã€‚[m
[31m-[m
[31m-     3ï¼‰è‡ªåŠ¨é…ç½®çš„securityFilterChainRegistrationçš„Beanã€‚[m
[31m-[m
[31m-     SecurityPropertiesä½¿ç”¨ä»¥â€œsecurityâ€ä¸ºå‰ç¼€çš„å±æ€§é…ç½®Spring[m
[31m-Securityç›¸å…³çš„é…ç½®ï¼ŒåŒ…å«ï¼š[m
[31m-[m
[31m-       security.user.name=user # å†…å­˜ä¸­çš„ç”¨æˆ·é»˜è®¤è´¦å·ä¸ºuser[m
[31m-       security.user.password= # lé»˜è®¤ç”¨æˆ·çš„å¯†ç [m
[31m-       security.user.role=USER # é»˜è®¤ç”¨æˆ·çš„è§’è‰²[m
[31m-       security.require-ssl=false # æ˜¯å¦éœ€è¦sslæ”¯æŒ[m
[31m-       security.enable-csrf=false # æ˜¯å¦å¼€å¯â€œè·¨ç«™è¯·æ±‚ä¼ªé€ â€æ”¯æŒï¼Œé»˜è®¤å…³é—­[m
[31m-       security.basic.enabled=true[m
[31m-       security.basic.realm=Spring[m
[31m-       security.basic.path= # /**[m
[31m-       security.basic.authorize-mode=[m
[31m-       security.filter-order=0[m
[31m-       security.headers.xss=false[m
[31m-       security.headers.cache=false[m
[31m-       security.headers.frame=false[m
[31m-       security.headers.content-type=false[m
[31m-       security.headers.hsts=all[m
[31m-       security.sessions=stateless[m
[31m-       security.ignored= # ç”¨é€—å·éš”å¼€çš„æ— é¡»æ‹¦æˆªçš„è·¯å¾„[m
[31m-[m
[31m-     Spring Bootä¸ºæˆ‘ä»¬åšäº†å¦‚æ­¤å¤šçš„é…ç½®ï¼Œå½“æˆ‘ä»¬éœ€è¦è‡ªå·±æ‰©[m
[31m-å±•çš„é…ç½®æ—¶ï¼Œåªéœ€é…ç½®ç±»ç»§æ‰¿WebSecurityConfigurerAdapterç±»[m
[31m-å³å¯ï¼Œæ— é¡»ä½¿ç”¨@EnableWebSecurityæ³¨è§£ï¼Œä¾‹å¦‚ï¼š[m
[31m-       @Configuration[m
[31m-       public class WebSecurityConfig extends WebSecurityConfigurerAdapter{[m
[31m-       }[m
[31m-[m
[31m-9.1.3ã€€å®æˆ˜[m
[31m-[m
[31m-     åœ¨æœ¬èŠ‚çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¼”ç¤ºä½¿ç”¨Spring Bootä¸‹çš„Spring[m
[31m-Securityçš„é…ç½®ï¼Œå®Œæˆç®€å•çš„è®¤è¯æˆæƒçš„åŠŸèƒ½ã€‚æ­¤èŠ‚æˆ‘ä»¬å°†é€š[m
[31m-è¿‡Spring Data JPAè·å¾—ç”¨æˆ·æ•°æ®ã€‚é¡µé¢æ¨¡æ¿ä½¿ç”¨Thymeleafï¼Œ[m
[31m-Thymeleafä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†æ”¯æŒSpring Securityçš„æ ‡ç­¾ã€‚[m
[31m-[m
[31m-     1.æ–°å»ºSpring Booté¡¹ç›®[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºJPAï¼ˆspring-boot-starter-data-[m
[31m-jpaï¼‰ã€Securityï¼ˆspring-boot-starter-securityï¼‰ã€[m
[31m-Thymeleafï¼ˆspring-boot-starter-thymeleafï¼‰ã€‚[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-       groupIdï¼šcom.wisely[m
[31m-       arctifactId:ch9_1[m
[31m-       package: com.wisely. ch9_1[m
[31m-[m
[31m-     å¹¶æ·»åŠ Oracleé©±åŠ¨åŠThymeleafçš„Spring Securityçš„æ”¯æŒã€‚[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>com.oracle</groupId>[m
[31m-                             <artifactId>ojdbc6</artifactId>[m
[31m-                             <version>11.2.0.2.0</version>[m
[31m-[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.thymeleaf.extras</groupId>[m
[31m-                                                                 <artifactId>thymeleaf-extras-[m
[31m-[m
[31m-       springsecurity4</artifactId>[m
[31m-                      </dependency>[m
[31m-[m
[31m-     æˆ‘ä»¬çš„application.propertiesé…ç½®å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       spring.datasource.driverClassName=oracle.jdbc.OracleDriver[m
[31m-       spring.datasource.url=jdbc\:oracle\:thin\:@localhost\:1521\:xe[m
[31m-       spring.datasource.username=boot[m
[31m-       spring.datasource.password=boot[m
[31m-[m
[31m-       logging.level.org.springframework.security= INFO[m
[31m-[m
[31m-       spring.thymeleaf.cache=false[m
[31m-[m
[31m-       spring.jpa.hibernate.ddl-auto=update[m
[31m-       spring.jpa.show-sql=true[m
[31m-[m
[31m-     å°†bootstrap.min.cssæ”¾ç½®åœ¨src/main/resources/static/cssä¸‹ï¼Œæ­¤[m
[31m-è·¯å¾„é»˜è®¤ä¸æ‹¦æˆªã€‚[m
[31m-[m
[31m-     2.ç”¨æˆ·å’Œè§’è‰²[m
[31m-     æˆ‘ä»¬ä½¿ç”¨JPAæ¥å®šä¹‰ç”¨æˆ·å’Œè§’è‰²ã€‚[m
[31m-     ç”¨æˆ·ï¼š[m
[31m-[m
[31m-       package com.wisely.ch9_1.domain;[m
[31m-[m
[31m-       import java.util.ArrayList;[m
[31m-       import java.util.Collection;[m
[31m-       import java.util.List;[m
[31m-[m
[31m-       import javax.persistence.CascadeType;[m
[31m-       import javax.persistence.Entity;[m
[31m-import javax.persistence.FetchType;[m
[31m-import javax.persistence.GeneratedValue;[m
[31m-import javax.persistence.Id;[m
[31m-import javax.persistence.ManyToMany;[m
[31m-[m
[31m-import org.springframework.security.core.GrantedAuthority;[m
[31m-import org.springframework.security.core.authority.SimpleGrantedAuthori[m
[31m-import org.springframework.security.core.userdetails.UserDetails;[m
[31m-@Entity[m
[31m-public class SysUser implements UserDetails{//1[m
[31m-[m
[31m-       private static final long serialVersionUID = 1L;[m
[31m-       @Id[m
[31m-       @GeneratedValue[m
[31m-       private Long id;[m
[31m-       private String username;[m
[31m-       private String password;[m
[31m-       @ManyToMany(cascade = {CascadeType.REFRESH},fetch = FetchType.EAGER[m
[31m-       private List<SysRole> roles;[m
[31m-[m
[31m-       @Override[m
[31m-       public Collection<? extends GrantedAuthority> getAuthorities() {//3[m
[31m-[m
[31m-              List<GrantedAuthority> auths = new ArrayList<GrantedAuthority>[m
[31m-();[m
[31m-[m
[31m-              List<SysRole> roles=this.getRoles();[m
[31m-              for(SysRole role:roles){[m
[31m-[m
[31m-                     auths.add(new SimpleGrantedAuthority(role.getName()));[m
[31m-              }[m
[31m-              return auths;[m
[31m-       }[m
[31m-       @Override[m
[31m-       public boolean isAccountNonExpired() {[m
[31m-              return true;[m
[31m-       }[m
[31m-       @Override[m
[31m-       public boolean isAccountNonLocked() {[m
[31m-              return true;[m
[31m-       }[m
[31m-       @Override[m
[31m-       public boolean isCredentialsNonExpired() {[m
[31m-              return true;[m
[31m-       }[m
[31m-       @Override[m
[31m-       public boolean isEnabled() {[m
[31m-              return true;[m
[31m-       }[m
[31m-       //çœç•¥getterã€setteræ–¹æ³•[m
[31m-}[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ è®©æˆ‘ä»¬çš„ç”¨æˆ·å®ä½“å®ç°UserDetailsæ¥å£ï¼Œæˆ‘ä»¬çš„ç”¨æˆ·å®[m
[31m-ä½“å³ä¸ºSpring Securityæ‰€ä½¿ç”¨çš„ç”¨æˆ·ã€‚[m
[31m-[m
[31m-     â‘¡é…ç½®ç”¨æˆ·å’Œè§’è‰²çš„å¤šå¯¹å¤šå…³ç³»ã€‚[m
[31m-[m
[31m-     â‘¢é‡å†™getAuthoritiesæ–¹æ³•ï¼Œå°†ç”¨æˆ·çš„è§’è‰²ä½œä¸ºæƒé™ã€‚[m
[31m-     è§’è‰²ï¼š[m
[31m-[m
[31m-       package com.wisely.ch9_1.domain;[m
[31m-[m
[31m-       import javax.persistence.Entity;[m
[31m-       import javax.persistence.GeneratedValue;[m
[31m-       import javax.persistence.Id;[m
[31m-[m
[31m-       @Entity[m
[31m-       public class SysRole {[m
[31m-[m
[31m-              @Id[m
[31m-              @GeneratedValue[m
[31m-              private Long id;[m
[31m-              private String name; //1[m
[31m-              //çœç•¥getterã€setteræ–¹æ³•[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ nameä¸ºè§’è‰²åç§°ã€‚[m
[31m-     ï¼ˆ1ï¼‰æ•°æ®ç»“æ„åŠåˆå§‹åŒ–[m
[31m-     å½“æˆ‘ä»¬é…ç½®ç”¨æˆ·å’Œè§’è‰²çš„å¤šå¯¹å¤šå…³ç³»åï¼Œé€šè¿‡è®¾ç½®[m
[31m-       spring.jpa.hibernate.ddl-auto=update[m
[31m-[m
[31m-     ä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆç”¨æˆ·è¡¨ï¼šSYS_USERã€è§’è‰²è¡¨ï¼š[m
[31m-SYS_ROLEã€å…³è”è¡¨ï¼šSYS_USER_ROLESã€‚[m
[31m-[m
[31m-     é’ˆå¯¹ä¸Šé¢çš„è¡¨ç»“æ„ï¼Œæˆ‘ä»¬åˆå§‹åŒ–ä¸€äº›æ•°æ®æ¥æ–¹ä¾¿æˆ‘ä»¬æ¼”[m
[31m-ç¤ºã€‚åœ¨src/main/resourcesä¸‹ï¼Œæ–°å»ºdata.sqlï¼Œå³æ–°å»ºä¸¤ä¸ªç”¨æˆ·ï¼Œ[m
[31m-è§’è‰²åˆ†åˆ«ä¸ºROLE_ADMINå’ŒROLE_USERï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       insert into SYS_USER (id,username, password) values (1,'wyf', 'wyf');[m
[31m-       insert into SYS_USER (id,username, password) values (2,'wisely', 'wisel[m
[31m-[m
[31m-       insert into SYS_ROLE(id,name) values(1,'ROLE_ADMIN');[m
[31m-       insert into SYS_ROLE(id,name) values(2,'ROLE_USER');[m
[31m-[m
[31m-       insert into SYS_USER_ROLES(SYS_USER_ID,ROLES_ID) values(1,1);[m
[31m-       insert into SYS_USER_ROLES(SYS_USER_ID,ROLES_ID) values(2,2);[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰ä¼ å€¼å¯¹è±¡[m
[31m-[m
[31m-     ç”¨æ¥æµ‹è¯•ä¸åŒè§’è‰²ç”¨æˆ·çš„æ•°æ®å±•ç¤ºï¼š[m
[31m-[m
[31m-       package com.wisely.ch9_1.domain;[m
[31m-[m
[31m-       public class Msg {[m
[31m-              private String title;[m
[31m-              private String content;[m
[31m-              private String etraInfo;[m
[31m-              public Msg(String title, String content, String etraInfo) {[m
[31m-                      super();[m
[31m-                      this.title = title;[m
[31m-                      this.content = content;[m
[31m-                      this.etraInfo = etraInfo;[m
[31m-              }[m
[31m-              //çœç•¥getterã€setteræ–¹æ³•[m
[31m-[m
[31m-       }[m
[31m-3.æ•°æ®è®¿é—®[m
[31m-æˆ‘ä»¬è¿™é‡Œçš„æ•°æ®è®¿é—®å¾ˆç®€å•ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-package com.wisely.ch9_1.dao;[m
[31m-import org.springframework.data.jpa.repository.JpaRepository;[m
[31m-import com.wisely.ch9_1.domain.SysUser;[m
[31m-public interface SysUserRepository extends JpaRepository<SysUser, Long>[m
[31m-{[m
[31m-[m
[31m-       SysUser findByUsername(String username);[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-è¿™é‡Œåªéœ€ä¸€ä¸ªæ ¹æ®ç”¨æˆ·åæŸ¥å‡ºç”¨æˆ·çš„æ–¹æ³•ã€‚[m
[31m-4.è‡ªå®šä¹‰UserDetailsService[m
[31m-[m
[31m-package com.wisely.ch9_1.security;[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.security.core.userdetails.UserDetails;[m
[31m-import org.springframework.security.core.userdetails.UserDetailsService[m
[31m-import org.springframework.security.core.userdetails.UsernameNotFoundEx[m
[31m-import com.wisely.ch9_1.dao.SysUserRepository;[m
[31m-import com.wisely.ch9_1.domain.SysUser;[m
[31m-public class CustomUserService implements UserDetailsService { //1[m
[31m-[m
[31m-       @Autowired[m
[31m-       SysUserRepository userRepository;[m
[31m-       @Override[m
[31m-       public UserDetails loadUserByUsername(String username) { //2[m
[31m-åœ¨");      SysUser user = userRepository.findByUsername(username);[m
[31m-          if(user == null){[m
[31m-       }[m
[31m-}                     throw new UsernameNotFoundException("ç”¨æˆ·åä¸å­˜[m
[31m-[m
[31m-          }[m
[31m-[m
[31m-          return user; //3[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ è‡ªå®šä¹‰éœ€å®ç°UserDetailsServiceæ¥å£ã€‚[m
[31m-[m
[31m-     â‘¡é‡å†™loadUserByUsernameæ–¹æ³•è·å¾—ç”¨æˆ·ã€‚[m
[31m-[m
[31m-     â‘¢æˆ‘ä»¬å½“å‰çš„ç”¨æˆ·å®ç°äº†UserDetailsæ¥å£ï¼Œå¯ç›´æ¥è¿”å›ç»™[m
[31m-Spring Securityä½¿ç”¨ã€‚[m
[31m-[m
[31m-     5.é…ç½®[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰Spring MVCé…ç½®ï¼š[m
[31m-[m
[31m-       package com.wisely.ch9_1.config;[m
[31m-[m
[31m-       import org.springframework.context.annotation.Configuration;[m
[31m-       import org.springframework.web.servlet.config.annotation.ViewController[m
[31m-       import org.springframework.web.servlet.config.annotation.WebMvcConfigur[m
[31m-[m
[31m-       @Configuration[m
[31m-       public class WebMvcConfig extends WebMvcConfigurerAdapter{[m
[31m-[m
[31m-              @Override[m
[31m-              public void addViewControllers(ViewControllerRegistry registry) {[m
[31m-[m
[31m-                      registry.addViewController("/login").setViewName("login");[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-æ³¨å†Œè®¿é—®/loginè½¬å‘login.htmlé¡µé¢ã€‚[m
[31m-[m
[31m-ï¼ˆ2ï¼‰Spring Securityé…ç½®ï¼š[m
[31m-[m
[31m-package com.wisely.ch9_1.config;[m
[31m-[m
[31m-import org.springframework.context.annotation.Bean;[m
[31m-import org.springframework.context.annotation.Configuration;[m
[31m-import org.springframework.security.config.annotation.authentication.bu[m
[31m-import org.springframework.security.config.annotation.web.builders.Http[m
[31m-import org.springframework.security.config.annotation.web.configuration[m
[31m-import org.springframework.security.core.userdetails.UserDetailsService[m
[31m-import com.wisely.ch9_1.security.CustomUserService;[m
[31m-[m
[31m-@Configuration[m
[31m-public class WebSecurityConfig extends WebSecurityConfigurerAdapter{//1[m
[31m-[m
[31m-       @Bean[m
[31m-       UserDetailsService customUserService(){ //2[m
[31m-[m
[31m-              return new CustomUserService();[m
[31m-       }[m
[31m-[m
[31m-       @Override[m
[31m-       protected void configure(AuthenticationManagerBuilder auth) throws[m
[31m-[m
[31m-              auth.userDetailsService(customUserService()); //3[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       @Override[m
[31m-       protected void configure(HttpSecurity http) throws Exception {[m
[31m-[m
[31m-              http.authorizeRequests()[m
[31m-                                           .anyRequest().authenticated() //4[m
[31m-                                           .and()[m
[31m-                                           .formLogin()[m
[31m-                                                  .loginPage("/login")[m
[31m-                                                  .failureUrl("/login?error")[m
[31m-                                                  .permitAll() //5[m
[31m-                                           .and()[m
[31m-                                           .logout().permitAll(); //6[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ æ‰©å±•Spring                 Securityé…ç½®éœ€ç»§æ‰¿[m
[31m-WebSecurityConfigurerAdapterã€‚[m
[31m-[m
[31m-â‘¡æ³¨å†ŒCustomUserServiceçš„Beanã€‚[m
[31m-[m
[31m-â‘¢æ·»åŠ æˆ‘ä»¬è‡ªå®šä¹‰çš„user detail serviceè®¤è¯ã€‚[m
[31m-[m
[31m-â‘£æ‰€æœ‰è¯·æ±‚éœ€è¦è®¤è¯å³ç™»å½•åæ‰èƒ½è®¿é—®ã€‚[m
[31m-[m
[31m-â‘¤å®šåˆ¶ç™»å½•è¡Œä¸ºï¼Œç™»å½•é¡µé¢å¯ä»»æ„è®¿é—®ã€‚[m
[31m-[m
[31m-â‘¥å®šåˆ¶æ³¨é”€è¡Œä¸ºï¼Œæ³¨é”€è¯·æ±‚å¯ä»»æ„è®¿é—®ã€‚[m
[31m-[m
[31m-6.é¡µé¢[m
[31m-[m
[31m-ï¼ˆ1ï¼‰ç™»å½•é¡µé¢ï¼š[m
[31m-[m
[31m-<!DOCTYPE html>[m
[31m-<html xmlns:th="http://www.thymeleaf.org">[m
[31m-<head>[m
[31m-<meta content="text/html;charset=UTF-8"/>[m
[31m-<title>ç™»å½•é¡µé¢</title>[m
[31m-<link rel="stylesheet" th:href="@{css/bootstap.min.css}"/>[m
[31m-<style type="text/css">[m
[31m-[m
[31m-       body {[m
[31m-   padding-top: 50px;[m
[31m-}[m
[31m-.starter-template {[m
[31m-   padding: 40px 15px;[m
[31m-   text-align: center;[m
[31m-}[m
[31m-</style>[m
[31m-</head>[m
[31m-<body>[m
[31m-[m
[31m-         <nav class="navbar navbar-inverse navbar-fixed-top">[m
[31m-          <div class="container">[m
[31m-              <div class="navbar-header">[m
[31m-ç¤º</a>       <a class="navbar-brand" href="#">Spring Securityæ¼”[m
[31m-[m
[31m-       </div>[m
[31m-       <div id="navbar" class="collapse navbar-collapse">[m
[31m-[m
[31m-          <ul class="nav navbar-nav">[m
[31m-            <li><a th:href="@{/}"> é¦–é¡µ </a></li>[m
[31m-[m
[31m-          </ul>[m
[31m-       </div><!--/.nav[m
[31m-[m
[31m--collapse -->[m
[31m-          </div>[m
[31m-[m
[31m-       </nav>[m
[31m-         <div class="container">[m
[31m-[m
[31m-          <div class="starter-template">[m
[31m-                 <p th:if="${param.logout}" class="bg-warning">å·²æˆåŠŸ[m
[31m-[m
[31m-æ³¨é”€</p><!-- 1 -->[m
[31m-               <p th:if="${param.error}" class="bg-danger">æœ‰é”™è¯¯ï¼Œè¯·[m
[31m-[m
[31m-é‡è¯•</p> <!-- 2 -->[m
[31m-                     <h2>ä½¿ç”¨è´¦å·å¯†ç ç™»å½•</h2>[m
[31m-                     <form name="form" th:action="@{/login}" action="/login" met[m
[31m-[m
[31m-- 3 -->[m
[31m-                             <div class="form-group">[m
[31m-                                    <label for="username">è´¦å·</label>[m
[31m-                                                    <input type="text" class="form-[m
[31m-[m
[31m-control" name="username" value="" placeholder="è´¦å·" />[m
[31m-                             </div>[m
[31m-                             <div class="form-group">[m
[31m-                                    <label for="password">å¯†ç </label>[m
[31m-                                             <input type="password" class="form-[m
[31m-[m
[31m-control" name="password" placeholder="å¯†ç " />[m
[31m-                             </div>[m
[31m-                             <input type="submit" id="login" value="Login" class="bt[m
[31m-[m
[31m-primary" />[m
[31m-                     </form>[m
[31m-[m
[31m-          </div>[m
[31m-       </div>[m
[31m-</body>[m
[31m-</html>[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ æ³¨é”€æˆåŠŸåæ˜¾ç¤ºã€‚[m
[31m-[m
[31m-â‘¡ç™»å½•æœ‰é”™è¯¯æ—¶æ˜¾ç¤ºã€‚[m
[31m-[m
[31m-â‘¢é»˜è®¤çš„ç™»å½•è·¯å¾„ä¸º/loginã€‚[m
[31m-[m
[31m-ï¼ˆ2ï¼‰é¦–é¡µï¼š[m
[31m-[m
[31m-<!DOCTYPE html>[m
[31m-<html xmlns:th="http://www.thymeleaf.org"[m
[31m-[m
[31m-              xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-[m
[31m-springsecurity4"><!-- 1 -->[m
[31m-<head>[m
[31m-<meta content="text/html;charset=UTF-8"/>[m
[31m-<title sec:authentication="name"></title> <!-- 2 -->[m
[31m-<link rel="stylesheet" th:href="@{css/bootstrap.min.css}" />[m
[31m-<style type="text/css">[m
[31m-body {[m
[31m-[m
[31m-   padding-top: 50px;[m
[31m-}[m
[31m-.starter-template {[m
[31m-[m
[31m-   padding: 40px 15px;[m
[31m-   text-align: center;[m
[31m-}[m
[31m-</style>[m
[31m-</head>[m
[31m-<body>[m
[31m-[m
[31m-         <nav class="navbar navbar-inverse navbar-fixed-top">[m
[31m-          <div class="container">[m
[31m-              <div class="navbar-header">[m
[31m-                   <a class="navbar-brand" href="#">Spring Securityæ¼”[m
[31m-[m
[31m-ç¤º</a>[m
[31m-              </div>[m
[31m-              <div id="navbar" class="collapse navbar-collapse">[m
[31m-                  <ul class="nav navbar-nav">[m
[31m-                   <li><a th:href="@{/}"> é¦–é¡µ </a></li>[m
[31m-[m
[31m-                  </ul>[m
[31m-              </div><!--/.nav[m
[31m--collapse -->[m
[31m-          </div>[m
[31m-[m
[31m-       </nav>[m
[31m-[m
[31m-      <div class="container">[m
[31m-[m
[31m-      <div class="starter-template">[m
[31m-           <h1 th:text="${msg.title}"></h1>[m
[31m-[m
[31m-      <p class="bg-primary" th:text="${msg.content}"></p>[m
[31m-[m
[31m-->     <div sec:authorize="hasRole('ROLE_ADMIN')"> <!-- 3 -[m
[31m-</p>               <p class="bg-info" th:text="${msg.etraInfo}">[m
[31m-[m
[31m-      </div>[m
[31m-[m
[31m-                <div sec:authorize="hasRole('ROLE_USER')"> <!-- 4--[m
[31m-[m
[31m->[m
[31m-                     <p class="bg-info">æ— æ›´å¤šä¿¡æ¯æ˜¾ç¤º</p>[m
[31m-[m
[31m-              </div>[m
[31m-[m
[31m-              <form th:action="@{/logout}" method="post">               btn-[m
[31m-[m
[31m-                                       <input type="submit" class="btn[m
[31m-primary" value="æ³¨é”€"/><!-- 5 -->[m
[31m-[m
[31m-              </form>[m
[31m-[m
[31m-          </div>[m
[31m-[m
[31m-       </div>[m
[31m-</body>[m
[31m-</html>[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ Thymeleafä¸ºæˆ‘ä»¬æä¾›çš„Spring Securityçš„æ ‡ç­¾æ”¯æŒã€‚[m
[31m-[m
[31m-     â‘¡é€šè¿‡secï¼šauthentication="name"è·å¾—å½“å‰ç”¨æˆ·çš„ç”¨æˆ·[m
[31m-åã€‚[m
[31m-     â‘¢secï¼šauthorize="hasRoleï¼ˆ'ROLE_ADMIN'ï¼‰"æ„å‘³ç€åª[m
[31m-æœ‰å½“å‰ç”¨æˆ·è§‰å¾—ä¸ºROLE_ADMINæ—¶ï¼Œæ‰å¯æ˜¾ç¤ºæ ‡ç­¾å†…å†…å®¹ã€‚[m
[31m-[m
[31m-     â‘£secï¼šauthorize="hasRoleï¼ˆ'ROLE_USER'ï¼‰"æ„å‘³ç€åªæœ‰[m
[31m-å½“å‰ç”¨æˆ·è§‰å¾—ä¸ºROLE_USERæ—¶ï¼Œæ‰å¯æ˜¾ç¤ºæ ‡ç­¾å†…å†…å®¹ã€‚[m
[31m-[m
[31m-     â‘¤æ³¨é”€çš„é»˜è®¤è·¯å¾„ä¸º/logoutï¼Œéœ€é€šè¿‡POSTè¯·æ±‚æäº¤ã€‚[m
[31m-[m
[31m-     7.æ§åˆ¶å™¨[m
[31m-[m
[31m-     æ­¤æ§åˆ¶å™¨å¾ˆç®€å•ï¼Œåªä¸ºé¦–é¡µæ˜¾ç¤ºå‡†å¤‡æ•°æ®ï¼š[m
[31m-[m
[31m-       package com.wisely.ch9_1.web;[m
[31m-[m
[31m-       import org.springframework.stereotype.Controller;[m
[31m-       import org.springframework.ui.Model;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-[m
[31m-       import com.wisely.ch9_1.domain.Msg;[m
[31m-[m
[31m-       @Controller[m
[31m-       public class HomeController {[m
[31m-[m
[31m-              @RequestMapping("/")[m
[31m-              public String index(Model model){[m
[31m-[m
[31m-                      Msg msg = new Msg("æµ‹è¯•æ ‡é¢˜","æµ‹è¯•å†…å®¹","é¢å¤–ä¿¡æ¯ï¼Œåªå¯¹ç®¡[m
[31m-       ç†å‘˜æ˜¾ç¤º");[m
[31m-[m
[31m-                      model.addAttribute("msg", msg);[m
[31m-                      return "home";[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     8.è¿è¡Œ[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰ç™»å½•ã€‚è®¿é—®http://localhostï¼š8080ï¼Œå°†ä¼šè‡ªåŠ¨è½¬åˆ°ç™»[m
[31m-å½•é¡µé¢http://localhostï¼š8080/loginï¼Œå¦‚å›¾9-1æ‰€ç¤ºã€‚[m
[31m-         å›¾9-1ã€€è½¬åˆ°ç™»å½•é¡µé¢http://localhostï¼š8080/login[m
[31m-[m
[31m-ä½¿ç”¨æ­£ç¡®çš„è´¦å·å¯†ç ç™»å½•ï¼Œå¦‚å›¾9-2æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                   å›¾9-2ã€€ä½¿ç”¨æ­£ç¡®çš„è´¦å·å¯†ç ç™»å½•[m
[31m-[m
[31m-ä½¿ç”¨é”™è¯¯çš„è´¦å·å¯†ç ç™»å½•ï¼Œå¦‚å›¾9-3æ‰€ç¤ºã€‚[m
[31m-                   å›¾9-3ã€€ä½¿ç”¨é”™è¯¯çš„è´¦å·å¯†ç ç™»å½•[m
[31m-[m
[31m-ï¼ˆ2ï¼‰æ³¨é”€ã€‚ç™»å½•æˆåŠŸåï¼Œå•å‡»æ³¨é”€æŒ‰é’®ï¼Œå¦‚å›¾9-4æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                           å›¾9-4ã€€å•å‡»æ³¨é”€æŒ‰é’®[m
[31m-[m
[31m-æ­¤æ—¶é¡µé¢æ˜¾ç¤ºå¦‚å›¾9-5æ‰€ç¤ºã€‚[m
[31m-                           å›¾9-5ã€€å•å‡»æ³¨é”€æŒ‰é’®[m
[31m-[m
[31m-ï¼ˆ3ï¼‰ç”¨æˆ·ä¿¡æ¯[m
[31m-é¡µé¢ä¸Šæˆ‘ä»¬å°†ç”¨æˆ·åæ˜¾ç¤ºåœ¨é¡µé¢çš„æ ‡é¢˜ä¸Šï¼Œå¦‚å›¾9-6æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾9-6ã€€ç”¨æˆ·ä¿¡æ¯[m
[31m-[m
[31m-ï¼ˆ4ï¼‰è§†å›¾æ§åˆ¶[m
[31m-wyfå’Œwiselyç”¨æˆ·è§’è‰²ä¸åŒï¼Œå› æ­¤è·å¾—ä¸åŒçš„è§†å›¾ã€‚[m
[31m-wyfç”¨æˆ·è§†å›¾å¦‚å›¾9-7æ‰€ç¤ºã€‚[m
[31m-                           å›¾9-7ã€€wyfç”¨æˆ·è§†å›¾[m
[31m-[m
[31m-wiselyç”¨æˆ·è§†å›¾å¦‚å›¾9-8æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                          å›¾9-8ã€€wiselyç”¨æˆ·è§†å›¾[m
[31m-9.2ã€€æ‰¹å¤„ç†Spring Batch[m
[31m-[m
[31m-9.2.1ã€€Spring Batchå¿«é€Ÿå…¥é—¨[m
[31m-[m
[31m-     1.ä»€ä¹ˆæ˜¯Spring Batch[m
[31m-     Spring Batchæ˜¯ç”¨æ¥å¤„ç†å¤§é‡æ•°æ®æ“ä½œçš„ä¸€ä¸ªæ¡†æ¶ï¼Œä¸»è¦ç”¨[m
[31m-æ¥è¯»å–å¤§é‡æ•°æ®ï¼Œç„¶åè¿›è¡Œä¸€å®šå¤„ç†åè¾“å‡ºæˆæŒ‡å®šçš„å½¢å¼ã€‚[m
[31m-     2.Spring Batchä¸»è¦ç»„æˆ[m
[31m-     SpringBatchä¸»è¦ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼Œå¦‚è¡¨9-2æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                            è¡¨9-2ã€€SpringBatchç»„æˆéƒ¨åˆ†[m
[31m-[m
[31m-     ä»¥ä¸ŠSpring Batchçš„ä¸»è¦ç»„æˆéƒ¨åˆ†åªéœ€æ³¨å†ŒæˆSpringçš„Bean[m
[31m-å³å¯ã€‚è‹¥æƒ³å¼€å¯æ‰¹å¤„ç†çš„æ”¯æŒè¿˜éœ€åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨[m
[31m-@EnableBatchProcessingã€‚[m
[31m-[m
[31m-     ä¸€ä¸ªç¤ºæ„çš„Spring Batchçš„é…ç½®å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       @Configuration[m
[31m-       @EnableBatchProcessing[m
[31m-       public class BatchConfig {[m
[31m-@Bean[m
[31m-public JobRepository jobRepository(DataSource dataSource, PlatformT[m
[31m-[m
[31m-              throws Exception {[m
[31m-       JobRepositoryFactoryBean jobRepositoryFactoryBean = new JobRepo[m
[31m-       jobRepositoryFactoryBean.setDataSource(dataSource);[m
[31m-       jobRepositoryFactoryBean.setTransactionManager(transactionManag[m
[31m-       jobRepositoryFactoryBean.setDatabaseType("oracle");[m
[31m-       return jobRepositoryFactoryBean.getObject();[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public SimpleJobLauncher jobLauncher(DataSource dataSource, Platfor[m
[31m-[m
[31m-              throws Exception {[m
[31m-       SimpleJobLauncher jobLauncher = new SimpleJobLauncher();[m
[31m-       jobLauncher.setJobRepository(jobRepository(dataSource, transact[m
[31m-       return jobLauncher;[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public Job importJob(JobBuilderFactory jobs, Step s1) {[m
[31m-[m
[31m-       return jobs.get("importJob")[m
[31m-                     .incrementer(new RunIdIncrementer())[m
[31m-                     .flow(s1)[m
[31m-                     .end()[m
[31m-                     .build();[m
[31m-[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public Step step1(StepBuilderFactory stepBuilderFactory, ItemReader[m
[31m-[m
[31m-              ItemProcessor<Person,Person> processor) {[m
[31m-       return stepBuilderFactory[m
[31m-[m
[31m-                     .get("step1")[m
[31m-                     .<Person, Person>chunk(65000)[m
[31m-                     .reader(reader)[m
[31m-                     .processor(processor)[m
[31m-                     .writer(writer)[m
[31m-                     .build();[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public ItemReader<Person> reader() throws Exception {[m
[31m-[m
[31m-              //æ–°å»ºItemReaderæ¥å£çš„å®ç°ç±»è¿”å›[m
[31m-              return reader;[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public ItemProcessor<Person, Person> processor() {[m
[31m-[m
[31m-       //æ–°å»ºItemProcessoræ¥å£çš„å®ç°ç±»è¿”å›[m
[31m-                      return processor;[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              public ItemWriter<Person> writer(DataSource dataSource) {[m
[31m-[m
[31m-                      //æ–°å»ºItemWriteræ¥å£çš„å®ç°ç±»è¿”å›[m
[31m-                      return writer;[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     3.Jobç›‘å¬[m
[31m-[m
[31m-     è‹¥éœ€è¦ç›‘å¬æˆ‘ä»¬çš„Jobçš„æ‰§è¡Œæƒ…å†µï¼Œåˆ™å®šä¹‰ä¸ªä¸€ä¸ªç±»å®ç°[m
[31m-JobExecutionListenerï¼Œå¹¶åœ¨å®šä¹‰Jobçš„Beanä¸Šç»‘å®šè¯¥ç›‘å¬å™¨ã€‚[m
[31m-[m
[31m-     ç›‘å¬å™¨çš„å®šä¹‰å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       public class MyJobListener implements JobExecutionListener{[m
[31m-[m
[31m-              @Override[m
[31m-              public void beforeJob(JobExecution jobExecution) {[m
[31m-              //Jobå¼€å§‹å‰[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public void afterJob(JobExecution jobExecution) {[m
[31m-              //Jobå®Œæˆå[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     æ³¨å†Œå¹¶ç»‘å®šç›‘å¬å™¨åˆ°Jobï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public Job importJob(JobBuilderFactory jobs, Step s1) {[m
[31m-[m
[31m-                      return jobs.get("importJob")[m
[31m-                                    .incrementer(new RunIdIncrementer())[m
[31m-                                    .flow(s1)[m
[31m-                                    .end()[m
[31m-                                    .listener(csvJobListener())[m
[31m-                                    .build();[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              public MyJobListener myJobListener() {[m
[31m-[m
[31m-                      return new MyJobListener();[m
[31m-              }[m
[31m-[m
[31m-     4.æ•°æ®è¯»å–[m
[31m-[m
[31m-     Spring Batchä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡çš„ItemReaderçš„å®ç°ï¼Œç”¨æ¥[m
[31m-è¯»å–ä¸åŒçš„æ•°æ®æ¥æºï¼Œå¦‚å›¾9-9æ‰€ç¤ºã€‚[m
[31m-[m
[31m-     5.æ•°æ®å¤„ç†åŠæ ¡éªŒ[m
[31m-[m
[31m-     æ•°æ®å¤„ç†å’Œæ ¡éªŒéƒ½è¦é€šè¿‡ItemProcessoræ¥å£å®ç°æ¥å®Œæˆã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰æ•°æ®å¤„ç†[m
[31m-[m
[31m-     æ•°æ®å¤„ç†åªéœ€å®ç°ItemProcessoræ¥å£ï¼Œé‡å†™å…¶processæ–¹[m
[31m-æ³•ã€‚æ–¹æ³•è¾“å…¥çš„å‚æ•°æ˜¯ä»ItemReaderè¯»å–åˆ°çš„æ•°æ®ï¼Œè¿”å›çš„æ•°[m
[31m-æ®ç»™ItemWriterã€‚[m
[31m-                       å›¾9-9ã€€å¤§é‡ItemReaderå®ç°[m
[31m-[m
[31m-public class MyItemProcessor implements ItemProcessor<Person, Person> {[m
[31m-[m
[31m-       @Override[m
[31m-       public Person process(Person person){[m
[31m-[m
[31m-                String name = person.getName().toUpperCase();[m
[31m-                person.setName(name);[m
[31m-                return person;[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-     ï¼ˆ2ï¼‰æ•°æ®æ ¡éªŒ[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥JSR-303ï¼ˆä¸»è¦å®ç°æœ‰hibernate-validatorï¼‰çš„æ³¨[m
[31m-è§£ï¼Œæ¥æ ¡éªŒItemReaderè¯»å–åˆ°çš„æ•°æ®æ˜¯å¦æ»¡è¶³è¦æ±‚ã€‚[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥è®©æˆ‘ä»¬çš„ItemProcessorå®ç°[m
[31m-ValidatingItemProcessoræ¥å£ï¼š[m
[31m-[m
[31m-       public class MyItemProcessor extends ValidatingItemProcessor<Person>[m
[31m-       {[m
[31m-[m
[31m-              @Override[m
[31m-              public Person process(Person item) throws ValidationException {[m
[31m-[m
[31m-                      super.process(item);[m
[31m-                      return item;[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     å®šä¹‰æˆ‘ä»¬çš„æ ¡éªŒå™¨ï¼Œå®ç°çš„Validatoræ¥å£æ¥è‡ªäºSpringï¼Œ[m
[31m-æˆ‘ä»¬å°†ä½¿ç”¨JSR-303çš„Validatoræ¥æ ¡éªŒï¼š[m
[31m-[m
[31m-       public class MyBeanValidator<T> implements Validator<T>,InitializingBea[m
[31m-              private javax.validation.Validator validator;[m
[31m-              @Override[m
[31m-              public void afterPropertiesSet() throws Exception {[m
[31m-                      ValidatorFactory validatorFactory = Validation.buildDefaultVali[m
[31m-                      validator = validatorFactory.usingContext().getValidator();[m
[31m-              }[m
[31m-              @Override[m
[31m-              public void validate(T value) throws ValidationException {[m
[31m-                      Set<ConstraintViolation<T>> constraintViolations = validator.va[m
[31m-                      if(constraintViolations.size()>0){[m
[31m-[m
[31m-                             StringBuilder message = new StringBuilder();[m
[31m-                             for (ConstraintViolation<T> constraintViolation : constrain[m
[31m-[m
[31m-                                    message.append(constraintViolation.getMessage() + "\n")[m
[31m-                             }[m
[31m-                             throw new ValidationException(message.toString());[m
[31m-                      }[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     åœ¨å®šä¹‰æˆ‘ä»¬çš„MyItemProcessoræ—¶å¿…é¡»å°†MyBeanValidatorè®¾[m
[31m-ç½®è¿›å»ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public ItemProcessor<Person, Person> processor() {[m
[31m-[m
[31m-                      MyItemProcessor processor = new MyItemProcessor();[m
[31m-                      processor.setValidator(myBeanValidator());[m
[31m-                      return processor;[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              public Validator<Person> myBeanValidator() {[m
[31m-[m
[31m-                      return new MyBeanValidator<Person>();[m
[31m-              }[m
[31m-[m
[31m-     6.æ•°æ®è¾“å‡º[m
[31m-[m
[31m-     Spring Batchä¸ºæˆ‘ä»¬æä¾›äº†å¤§é‡çš„ItemWriterçš„å®ç°ï¼Œç”¨æ¥[m
[31m-å°†æ•°æ®è¾“å‡ºåˆ°ä¸åŒçš„ç›®çš„åœ°ï¼Œå¦‚å›¾9-11æ‰€ç¤ºã€‚[m
[31m-[m
[31m-     7.è®¡åˆ’ä»»åŠ¡[m
[31m-[m
[31m-     Spring Batchçš„ä»»åŠ¡æ˜¯é€šè¿‡JobLauncherçš„runæ–¹æ³•æ¥æ‰§è¡Œ[m
[31m-çš„ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€åœ¨æ™®é€šçš„è®¡åˆ’ä»»åŠ¡æ–¹æ³•ä¸­æ‰§è¡ŒJobLauncher[m
[31m-çš„runæ–¹æ³•å³å¯ã€‚[m
[31m-[m
[31m-     æ¼”ç¤ºä»£ç å¦‚ä¸‹ï¼Œåˆ«å¿˜äº†é…ç½®ç±»ä½¿ç”¨@EnableSchedulingå¼€å¯[m
[31m-è®¡åˆ’ä»»åŠ¡æ”¯æŒï¼š[m
[31m-[m
[31m-       @Service[m
[31m-public class ScheduledTaskService {[m
[31m-       @Autowired[m
[31m-       JobLauncher jobLauncher;[m
[31m-[m
[31m-       @Autowired[m
[31m-       Job importJob;[m
[31m-[m
[31m-       public JobParameters jobParameters;[m
[31m-       @Scheduled(fixedRate = 5000)[m
[31m-       public void execute() throws Exception {[m
[31m-[m
[31m-              jobParameters = new JobParametersBuilder()[m
[31m-                             .addLong("time", System.currentTimeMillis()).toJobParam[m
[31m-[m
[31m-                  jobLauncher.run(importJob,jobParameters);[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-          å›¾9-10ã€€æ•°æ®è¾“å‡º[m
[31m-[m
[31m-8.å‚æ•°åç½®ç»‘å®š[m
[31m-     æˆ‘ä»¬åœ¨ItemReaderå’ŒItemWriterçš„Beanå®šä¹‰çš„æ—¶å€™ï¼Œå‚æ•°å·²[m
[31m-ç»ç¡¬ç¼–ç åœ¨Beançš„åˆå§‹åŒ–ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public ItemReader<Person> reader() throws Exception {[m
[31m-[m
[31m-                      FlatFileItemReader<Person> reader = new FlatFileItemReader<Pers[m
[31m-       ();[m
[31m-[m
[31m-                      reader.setResource(new ClassPathResource("people.csv"));[m
[31m-                      return reader;[m
[31m-              }[m
[31m-[m
[31m-     è¿™æ—¶æˆ‘ä»¬è¦è¯»å–çš„æ–‡ä»¶çš„ä½ç½®å·²ç»ç¡¬ç¼–ç åœ¨Beançš„å®šä¹‰[m
[31m-ä¸­ï¼Œè¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹ä¸ç¬¦åˆæˆ‘ä»¬çš„å®é™…éœ€æ±‚ï¼Œè¿™æ—¶æˆ‘ä»¬éœ€è¦ä½¿[m
[31m-ç”¨å‚æ•°åç½®ç»‘å®šã€‚[m
[31m-[m
[31m-     è¦å®ç°å‚æ•°åç½®ç»‘å®šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨JobParametersä¸­ç»‘å®šå‚[m
[31m-æ•°ï¼Œåœ¨Beanå®šä¹‰çš„æ—¶å€™ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„Beanç”Ÿå‘½å‘¨æœŸæ³¨è§£[m
[31m-@StepScopeï¼Œç„¶åé€šè¿‡@Valueæ³¨å…¥æ­¤å‚æ•°ã€‚[m
[31m-[m
[31m-     å‚æ•°è®¾ç½®ï¼š[m
[31m-[m
[31m-              String path = "people.csv";[m
[31m-[m
[31m-              JobParameters jobParameters = new JobParametersBuilder()[m
[31m-                                    .addLong("time", System.currentTimeMillis())[m
[31m-                                    .addString("input.file.name", path)[m
[31m-                                    .toJobParameters();[m
[31m-[m
[31m-              jobLauncher.run(importJob,jobParameters);[m
[31m-[m
[31m-     å®šä¹‰Beanï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              @StepScope[m
[31m-                         public ItemReader<Person> reader(@Value("#[m
[31m-{jobParameters['input.file.name']}") String pathToFile) throws Exceptio[m
[31m-[m
[31m-              FlatFileItemReader<Person> reader = new FlatFileItemReader<Pers[m
[31m-();[m
[31m-[m
[31m-              reader.setResource(new ClassPathResource(pathToFile));[m
[31m-              return reader;[m
[31m-       }[m
[31m-[m
[31m-9.2.2ã€€Spring Bootçš„æ”¯æŒ[m
[31m-[m
[31m-Spring  Bootå¯¹Spring   Batchæ”¯æŒçš„æºç ä½äº[m
[31m-[m
[31m-org.springframework.boot.autoconfigure.batchä¸‹ã€‚[m
[31m-[m
[31m-     Spring Bootä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆå§‹åŒ–äº†Spring Batchå­˜å‚¨æ‰¹å¤„ç†è®°[m
[31m-å½•çš„æ•°æ®åº“ï¼Œä¸”å½“æˆ‘ä»¬ç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œæˆ‘ä»¬å®šä¹‰çš„[m
[31m-[m
[31m-Jobçš„Beanã€‚[m
[31m-[m
[31m-Spring Bootæä¾›å¦‚ä¸‹å±æ€§æ¥å®šåˆ¶Spring Batchï¼š[m
[31m-[m
[31m-spring.batch.job.names=job1,job2 #å¯åŠ¨æ—¶è¦æ‰§è¡Œçš„Jobï¼Œé»˜è®¤æ‰§è¡Œå…¨éƒ¨[m
[31m-[m
[31m-Job[m
[31m-spring.batch.job.enabled=true #æ˜¯å¦è‡ªåŠ¨æ‰§è¡Œå®šä¹‰çš„Jobï¼Œé»˜è®¤ä¸ºæ˜¯[m
[31m-spring.batch.initializer.enabled=true #æ˜¯å¦åˆå§‹åŒ–Spring Batch[m
[31m-çš„æ•°æ®åº“ï¼Œé»˜è®¤ä¸ºæ˜¯[m
[31m-[m
[31m-spring.batch.schema=[m
[31m-spring.batch.table-prefix= # è®¾ç½®Spring Batchçš„æ•°æ®åº“è¡¨çš„å‰ç¼€[m
[31m-[m
[31m-9.2.3ã€€å®æˆ˜[m
[31m-[m
[31m-     æœ¬ä¾‹å°†ä½¿ç”¨Spring Batchå°†csvæ–‡ä»¶ä¸­çš„æ•°æ®ä½¿ç”¨JDBCæ‰¹å¤„[m
[31m-ç†çš„æ–¹å¼æ’å…¥æ•°æ®åº“ã€‚[m
[31m-     1.æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºJDBCï¼ˆspring-boot-starter-[m
[31m-jdbcï¼‰ã€Batchï¼ˆspring-boot-starter-batchï¼‰ã€Webï¼ˆspring-boot-[m
[31m-starter-webï¼‰ã€‚[m
[31m-[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-       groupIdï¼šcom.wisely[m
[31m-       arctifactId:ch9_2[m
[31m-       package: com.wisely.ch9_2[m
[31m-[m
[31m-     æ­¤é¡¹ç›®ä½¿ç”¨Oracleé©±åŠ¨ï¼ŒSpring Batchä¼šè‡ªåŠ¨åŠ è½½hsqldbé©±[m
[31m-åŠ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å»é™¤ï¼š[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       batch</artifactId>[m
[31m-                             <exclusions>[m
[31m-                                    <exclusion>[m
[31m-                                           <groupId>org.hsqldb[m
[31m-[m
[31m-       </groupId>[m
[31m-                                           <artifactId>hsqldb</artifactId>[m
[31m-[m
[31m-                                    </exclusion>[m
[31m-                             </exclusions>[m
[31m-                      </dependency>[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>com.oracle</groupId>[m
[31m-                             <artifactId>ojdbc6</artifactId>[m
[31m-                             <version>11.2.0.2.0</version>[m
[31m-[m
[31m-                      </dependency>[m
[31m-æ·»åŠ hibernate-validatorä¾èµ–ï¼Œä½œä¸ºæ•°æ®æ ¡éªŒä½¿ç”¨ï¼š[m
[31m-[m
[31m-              <dependency>[m
[31m-                     <groupId>org.hibernate</groupId>[m
[31m-                     <artifactId>hibernate-validator</artifactId>[m
[31m-[m
[31m-              </dependency>[m
[31m-[m
[31m-     æµ‹è¯•csvæ•°æ®ï¼Œä½äºsrc/main/resources/people.csvä¸­ï¼Œå†…å®¹å¦‚[m
[31m-ä¸‹ï¼š[m
[31m-[m
[31m-       æ±ªæŸæŸ,11,æ±‰æ—,åˆè‚¥[m
[31m-       å¼ æŸæŸ,12,æ±‰æ—,ä¸Šæµ·[m
[31m-       ææŸæŸ,13,éæ±‰æ—,æ­¦æ±‰[m
[31m-       åˆ˜æŸ,14,éæ±‰æ—,å—äº¬[m
[31m-       æ¬§é˜³æŸæŸ,115,æ±‰æ—,åŒ—äº¬[m
[31m-[m
[31m-     æ•°æ®è¡¨å®šä¹‰ï¼Œä½äºsrc/main/resources/schema.sqlä¸­ï¼Œå†…å®¹å¦‚[m
[31m-ä¸‹ï¼š[m
[31m-[m
[31m-create table PERSON[m
[31m-[m
[31m-([m
[31m-[m
[31m-   id NUMBER not null primary key,[m
[31m-[m
[31m-   name     VARCHAR2(20),[m
[31m-[m
[31m-   age NUMBER,[m
[31m-[m
[31m-   nation   VARCHAR2(20),[m
[31m-[m
[31m-   address  VARCHAR2(20)[m
[31m-[m
[31m-);[m
[31m-[m
[31m-æ•°æ®æºçš„é…ç½®ä¸å‰é¢ä¾‹å­ä¿æŒä¸€è‡´ã€‚[m
[31m-2.é¢†åŸŸæ¨¡å‹ç±»[m
[31m-package com.wisely.ch9_2.domain;[m
[31m-import javax.validation.constraints.Size;[m
[31m-public class Person {[m
[31m-[m
[31m-       @Size(max=4,min=2) //1[m
[31m-       private String name;[m
[31m-       private int age;[m
[31m-       private String nation;[m
[31m-       private String address;[m
[31m-//çœç•¥getterã€setteræ–¹æ³•[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-â‘ æ­¤å¤„ä½¿ç”¨JSR-303æ³¨è§£æ¥æ ¡éªŒæ•°æ®ã€‚[m
[31m-3.æ•°æ®å¤„ç†åŠæ ¡éªŒ[m
[31m-ï¼ˆ1ï¼‰å¤„ç†ï¼š[m
[31m-[m
[31m-package com.wisely.ch9_2.batch;[m
[31m-import org.springframework.batch.item.validator.ValidatingItemProcessor[m
[31m-import org.springframework.batch.item.validator.ValidationException;[m
[31m-import com.wisely.ch9_2.domain.Person;[m
[31m-public class CsvItemProcessor extends ValidatingItemProcessor<Person>[m
[31m-{[m
[31m-[m
[31m-       @Override[m
[31m-       public Person process(Person item) throws ValidationException {[m
[31m-[m
[31m-              super.process(item); //1[m
[31m-              if(item.getNation().equals("æ±‰æ—")){ //2[m
[31m-[m
[31m-                     item.setNation("01");[m
[31m-                      }else{[m
[31m-                             item.setNation("02");[m
[31m-[m
[31m-                      }[m
[31m-                      return item;[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ éœ€æ‰§è¡Œsuper.procesï¼šï¼ˆitemï¼‰æ‰ä¼šè°ƒç”¨è‡ªå®šä¹‰æ ¡éªŒå™¨ã€‚[m
[31m-[m
[31m-     â‘¡å¯¹æ•°æ®åšç®€å•çš„å¤„ç†ï¼Œè‹¥æ°‘æ—ä¸ºæ±‰æ—ï¼Œåˆ™æ•°æ®è½¬æ¢æˆ[m
[31m-01ï¼Œå…¶ä½™è½¬æ¢æˆ02ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰æ ¡éªŒï¼š[m
[31m-[m
[31m-       package com.wisely.ch9_2.batch;[m
[31m-[m
[31m-       import java.util.Set;[m
[31m-[m
[31m-       import javax.validation.ConstraintViolation;[m
[31m-       import javax.validation.Validation;[m
[31m-       import javax.validation.ValidatorFactory;[m
[31m-[m
[31m-       import org.springframework.batch.item.validator.ValidationException;[m
[31m-       import org.springframework.batch.item.validator.Validator;[m
[31m-       import org.springframework.beans.factory.InitializingBean;[m
[31m-[m
[31m-       public class CsvBeanValidator<T> implements Validator<T>,InitializingBe[m
[31m-              private javax.validation.Validator validator;[m
[31m-              @Override[m
[31m-              public void afterPropertiesSet() throws Exception { //1[m
[31m-                      ValidatorFactory validatorFactory = Validation.buildDefaultVali[m
[31m-                      validator = validatorFactory.usingContext().getValidator();[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public void validate(T value) throws ValidationException {[m
[31m-[m
[31m-                      Set<ConstraintViolation<T>> constraintViolations = validator.va[m
[31m-                      if(constraintViolations.size()>0){[m
[31m-[m
[31m-                             StringBuilder message = new StringBuilder();[m
[31m-                             for (ConstraintViolation<T> constraintViolation : constrain[m
[31m-[m
[31m-                                    message.append(constraintViolation.getMessage() + "\n")[m
[31m-                             }[m
[31m-                             throw new ValidationException(message.toString());[m
[31m-[m
[31m-                      }[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä½¿ç”¨JSR-303çš„Validatoræ¥æ ¡éªŒæˆ‘ä»¬çš„æ•°æ®ï¼Œåœ¨æ­¤å¤„è¿›è¡Œ[m
[31m-JSR-303çš„Validatorçš„åˆå§‹åŒ–ã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨Validatorçš„validateæ–¹æ³•æ ¡éªŒæ•°æ®ã€‚[m
[31m-[m
[31m-     4.Jobç›‘å¬[m
[31m-[m
[31m-       package com.wisely.ch9_2.batch;[m
[31m-[m
[31m-       import org.springframework.batch.core.JobExecution;[m
[31m-       import org.springframework.batch.core.JobExecutionListener;[m
[31m-[m
[31m-       public class CsvJobListener implements JobExecutionListener{[m
[31m-[m
[31m-              long startTime;[m
[31m-              long endTime;[m
[31m-              @Override[m
[31m-              public void beforeJob(JobExecution jobExecution) {[m
[31m-[m
[31m-                      startTime = System.currentTimeMillis();[m
[31m-                      System.out.println("ä»»åŠ¡å¤„ç†å¼€å§‹");[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public void afterJob(JobExecution jobExecution) {[m
[31m-[m
[31m-                      endTime = System.currentTimeMillis();[m
[31m-                      System.out.println("ä»»åŠ¡å¤„ç†ç»“æŸ");[m
[31m-                                                                              System.out.println("è€—[m
[31m-[m
[31m-       æ—¶:" + (endTime - startTime) + "ms");[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     ç›‘å¬å™¨å®ç°JobExecutionListeneræ¥å£ï¼Œå¹¶é‡å†™å…¶[m
[31m-beforeJobã€afterJobæ–¹æ³•å³å¯ã€‚[m
[31m-[m
[31m-     5.é…ç½®[m
[31m-[m
[31m-     é…ç½®çš„å®Œæˆä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       package com.wisely.ch9_2.batch;[m
[31m-[m
[31m-       import javax.sql.DataSource;[m
[31m-[m
[31m-       import org.springframework.batch.core.Job;[m
[31m-       import org.springframework.batch.core.Step;[m
[31m-       import org.springframework.batch.core.configuration.annotation.EnableBa[m
[31m-       import org.springframework.batch.core.configuration.annotation.JobBuild[m
[31m-       import org.springframework.batch.core.configuration.annotation.StepBuil[m
[31m-       import org.springframework.batch.core.launch.support.RunIdIncrementer;[m
[31m-       import org.springframework.batch.core.launch.support.SimpleJobLauncher;[m
[31m-       import org.springframework.batch.core.repository.JobRepository;[m
[31m-       import org.springframework.batch.core.repository.support.JobRepositoryF[m
[31m-       import org.springframework.batch.item.ItemProcessor;[m
[31m-       import org.springframework.batch.item.ItemReader;[m
[31m-       import org.springframework.batch.item.ItemWriter;[m
[31m-       import org.springframework.batch.item.database.BeanPropertyItemSqlParam[m
[31m-       import org.springframework.batch.item.database.JdbcBatchItemWriter;[m
[31m-       import org.springframework.batch.item.file.FlatFileItemReader;[m
[31m-       import org.springframework.batch.item.file.mapping.BeanWrapperFieldSetM[m
[31m-       import org.springframework.batch.item.file.mapping.DefaultLineMapper;[m
[31m-       import org.springframework.batch.item.file.transform.DelimitedLineToken[m
[31m-       import org.springframework.batch.item.validator.Validator;[m
[31m-       import org.springframework.context.annotation.Bean;[m
[31m-       import org.springframework.context.annotation.Configuration;[m
[31m-import org.springframework.core.io.ClassPathResource;[m
[31m-import org.springframework.transaction.PlatformTransactionManager;[m
[31m-[m
[31m-import com.wisely.ch9_2.domain.Person;[m
[31m-[m
[31m-@Configuration[m
[31m-@EnableBatchProcessing[m
[31m-public class CsvBatchConfig {[m
[31m-[m
[31m-       @Bean[m
[31m-       public ItemReader<Person> reader() throws Exception {[m
[31m-[m
[31m-              FlatFileItemReader<Person> reader = new FlatFileItemReader<Pers[m
[31m-();[m
[31m-[m
[31m-              reader.setResource(new ClassPathResource("people.csv"));[m
[31m-                     reader.setLineMapper(new DefaultLineMapper<Person>[m
[31m-[m
[31m-() {{[m
[31m-                             setLineTokenizer(new DelimitedLineTokenizer() {{[m
[31m-                                    setNames(new String[] { "name","age", "nation" ,"ad[m
[31m-                             }});[m
[31m-                             setFieldSetMapper(new BeanWrapperFieldSetMapper<Person>[m
[31m-[m
[31m-() {{[m
[31m-                                    setTargetType(Person.class);[m
[31m-[m
[31m-                             }});[m
[31m-                     }});[m
[31m-                     return reader;[m
[31m-       }[m
[31m-[m
[31m-       @Bean[m
[31m-       public ItemProcessor<Person, Person> processor() {[m
[31m-[m
[31m-              CsvItemProcessor processor = new CsvItemProcessor();[m
[31m-              processor.setValidator(csvBeanValidator());[m
[31m-              return processor;[m
[31m-       }[m
[31m-[m
[31m-       @Bean[m
[31m-       public ItemWriter<Person> writer(DataSource dataSource) {[m
[31m-[m
[31m-              JdbcBatchItemWriter<Person> writer = new JdbcBatchItemWriter<Pe[m
[31m-();[m
[31m-[m
[31m-              writer.setItemSqlParameterSourceProvider(new BeanPropertyItemSq[m
[31m-());[m
[31m-[m
[31m-                           String sql = "insert into person " + "[m
[31m-(id,name,age,nation,address) "[m
[31m-[m
[31m-                             + "values(hibernate_sequence.nextval, :name, :age, :nat[m
[31m-              writer.setSql(sql);[m
[31m-              writer.setDataSource(dataSource);[m
[31m-              return writer;[m
[31m-       }[m
[31m-@Bean[m
[31m-public JobRepository jobRepository(DataSource dataSource, PlatformT[m
[31m-[m
[31m-              throws Exception {[m
[31m-       JobRepositoryFactoryBean jobRepositoryFactoryBean = new JobRepo[m
[31m-       jobRepositoryFactoryBean.setDataSource(dataSource);[m
[31m-       jobRepositoryFactoryBean.setTransactionManager(transactionManag[m
[31m-       jobRepositoryFactoryBean.setDatabaseType("oracle");[m
[31m-       return jobRepositoryFactoryBean.getObject();[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public SimpleJobLauncher jobLauncher(DataSource dataSource, Platfor[m
[31m-[m
[31m-              throws Exception {[m
[31m-       SimpleJobLauncher jobLauncher = new SimpleJobLauncher();[m
[31m-       jobLauncher.setJobRepository(jobRepository(dataSource, transact[m
[31m-       return jobLauncher;[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public Job importJob(JobBuilderFactory jobs, Step s1) {[m
[31m-[m
[31m-       return jobs.get("importJob")[m
[31m-                     .incrementer(new RunIdIncrementer())[m
[31m-                     .flow(s1)[m
[31m-                     .end()[m
[31m-                     .listener(csvJobListener())[m
[31m-                     .build();[m
[31m-[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public Step step1(StepBuilderFactory stepBuilderFactory, ItemReader[m
[31m-[m
[31m-              ItemProcessor<Person,Person> processor) {[m
[31m-       return stepBuilderFactory[m
[31m-[m
[31m-                     .get("step1")[m
[31m-                     .<Person, Person>chunk(65000)[m
[31m-                     .reader(reader)[m
[31m-                     .processor(processor)[m
[31m-                     .writer(writer)[m
[31m-                     .build();[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public CsvJobListener csvJobListener() {[m
[31m-[m
[31m-       return new CsvJobListener();[m
[31m-}[m
[31m-[m
[31m-@Bean[m
[31m-public Validator<Person> csvBeanValidator() {[m
[31m-[m
[31m-       return new CsvBeanValidator<Person>();[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     é…ç½®ä»£ç è¾ƒé•¿ï¼Œæˆ‘ä»¬å°†æ‹†å¼€è®²è§£ï¼Œé¦–å…ˆæˆ‘ä»¬çš„é…ç½®ç±»è¦ä½¿[m
[31m-ç”¨@EnableBatchProcessingå¼€å¯æ‰¹å¤„ç†çš„æ”¯æŒï¼Œè¿™ç‚¹åƒä¸‡ä¸è¦[m
[31m-å¿˜è®°ã€‚[m
[31m-[m
[31m-     ItemReaderå®šä¹‰ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public ItemReader<Person> reader() throws Exception {[m
[31m-[m
[31m-                      FlatFileItemReader<Person> reader = new FlatFileItemReader<Pers[m
[31m-       (); //1[m
[31m-[m
[31m-                      reader.setResource(new ClassPathResource("people.csv")); //2[m
[31m-                             reader.setLineMapper(new DefaultLineMapper<Person>[m
[31m-[m
[31m-       () {{ //3[m
[31m-                                    setLineTokenizer(new DelimitedLineTokenizer() {{[m
[31m-                                           setNames(new String[] { "name","age", "nation" ,"ad[m
[31m-                                    }});[m
[31m-                                    setFieldSetMapper(new BeanWrapperFieldSetMapper<Person>[m
[31m-[m
[31m-       () {{[m
[31m-                                           setTargetType(Person.class);[m
[31m-[m
[31m-                                    }});[m
[31m-                             }});[m
[31m-                             return reader;[m
[31m-              }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä½¿ç”¨FlatFileItemReaderè¯»å–æ–‡ä»¶ã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨FlatFileItemReaderçš„setResourceæ–¹æ³•è®¾ç½®csvæ–‡ä»¶çš„[m
[31m-è·¯å¾„ã€‚[m
[31m-[m
[31m-     â‘¢åœ¨æ­¤å¤„å¯¹cvsæ–‡ä»¶çš„æ•°æ®å’Œé¢†åŸŸæ¨¡å‹ç±»åšå¯¹åº”æ˜ å°„ã€‚[m
[31m-     ItemProcessorå®šä¹‰ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public ItemProcessor<Person, Person> processor() {[m
[31m-[m
[31m-                      CsvItemProcessor processor = new CsvItemProcessor(); //1[m
[31m-                      processor.setValidator(csvBeanValidator()); //2[m
[31m-                      return processor;[m
[31m-              }[m
[31m-[m
[31m-             @Bean[m
[31m-              public Validator<Person> csvBeanValidator() {[m
[31m-                      return new CsvBeanValidator<Person>();[m
[31m-              }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä½¿ç”¨æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ItemProcessorçš„å®ç°[m
[31m-CsvItemProcessorã€‚[m
[31m-[m
[31m-     â‘¡ä¸ºprocessoræŒ‡å®šæ ¡éªŒå™¨ä¸ºCsvBeanValidatorï¼›[m
[31m-[m
[31m-     ItemWriterå®šä¹‰ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public ItemWriter<Person> writer(DataSource dataSource) {//1[m
[31m-[m
[31m-                      JdbcBatchItemWriter<Person> writer = new JdbcBatchItemWriter<Pe[m
[31m-       (); //2[m
[31m-[m
[31m-                      writer.setItemSqlParameterSourceProvider(new BeanPropertyItemSq[m
[31m-       ());[m
[31m-[m
[31m-                                   String sql = "insert into person " + "[m
[31m-       (id,name,age,nation,address) "[m
[31m-[m
[31m-                                    + "values(hibernate_sequence.nextval, :name, :age, :nat[m
[31m-                      writer.setSql(sql); //3[m
[31m-                      writer.setDataSource(dataSource);[m
[31m-                      return writer;[m
[31m-              }[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ Springèƒ½è®©å®¹å™¨ä¸­å·²æœ‰çš„Beanä»¥å‚æ•°çš„å½¢å¼æ³¨å…¥ï¼ŒSpring[m
[31m-Bootå·²ä¸ºæˆ‘ä»¬å®šä¹‰äº†dataSourceã€‚[m
[31m-[m
[31m-     â‘¡æˆ‘ä»¬ä½¿ç”¨JDBCæ‰¹å¤„ç†çš„JdbcBatchItemWriteræ¥å†™æ•°æ®åˆ°[m
[31m-æ•°æ®åº“ã€‚[m
[31m-[m
[31m-     â‘¢åœ¨æ­¤è®¾ç½®è¦æ‰§è¡Œæ‰¹å¤„ç†çš„SQLè¯­å¥ã€‚[m
[31m-[m
[31m-     JobRepositoryå®šä¹‰ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public JobRepository jobRepository(DataSource dataSource, PlatformT[m
[31m-[m
[31m-                             throws Exception {[m
[31m-                      JobRepositoryFactoryBean jobRepositoryFactoryBean = new JobRepo[m
[31m-                      jobRepositoryFactoryBean.setDataSource(dataSource);[m
[31m-                      jobRepositoryFactoryBean.setTransactionManager(transactionManag[m
[31m-                      jobRepositoryFactoryBean.setDatabaseType("oracle");[m
[31m-                      return jobRepositoryFactoryBean.getObject();[m
[31m-              }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     jobRepositoryçš„å®šä¹‰éœ€è¦dataSourceå’ŒtransactioManagerï¼Œ[m
[31m-Spring Bootå·²ä¸ºæˆ‘ä»¬è‡ªåŠ¨é…ç½®äº†è¿™ä¸¤ä¸ªç±»ï¼ŒSpringå¯é€šè¿‡æ–¹æ³•[m
[31m-æ³¨å…¥å·²æœ‰çš„Beanã€‚[m
[31m-[m
[31m-     JobLauncherå®šä¹‰ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public SimpleJobLauncher jobLauncher(DataSource dataSource, Platfor[m
[31m-[m
[31m-                             throws Exception {[m
[31m-                      SimpleJobLauncher jobLauncher = new SimpleJobLauncher();[m
[31m-                      jobLauncher.setJobRepository(jobRepository(dataSource, transact[m
[31m-                      return jobLauncher;[m
[31m-       }[m
[31m-[m
[31m-Jobå®šä¹‰ï¼š[m
[31m-[m
[31m-       @Bean[m
[31m-       public Job importJob(JobBuilderFactory jobs, Step s1) {[m
[31m-[m
[31m-              return jobs.get("importJob")[m
[31m-                             .incrementer(new RunIdIncrementer())[m
[31m-                             .flow(s1) //1[m
[31m-                             .end()[m
[31m-                             .listener(csvJobListener()) //2[m
[31m-                             .build();[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       @Bean[m
[31m-       public CsvJobListener csvJobListener() {[m
[31m-[m
[31m-              return new CsvJobListener();[m
[31m-       }[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ ä¸ºJobæŒ‡å®šStepã€‚[m
[31m-[m
[31m-â‘¡ç»‘å®šç›‘å¬å™¨csvJobListenerã€‚[m
[31m-[m
[31m-Stepå®šä¹‰ï¼š[m
[31m-[m
[31m-       @Bean[m
[31m-       public Step step1(StepBuilderFactory stepBuilderFactory, ItemReader[m
[31m-[m
[31m-                     ItemProcessor<Person,Person> processor) {[m
[31m-              return stepBuilderFactory[m
[31m-[m
[31m-                             .get("step1")[m
[31m-                             .<Person, Person>chunk(65000) //1[m
[31m-                             .reader(reader) //2[m
[31m-                             .processor(processor) //3[m
[31m-                             .writer(writer) //4[m
[31m-                             .build();[m
[31m-       }[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ æ‰¹å¤„ç†æ¯æ¬¡æäº¤65000æ¡æ•°æ®ã€‚[m
[31m-     â‘¡ç»™stepç»‘å®šreaderã€‚[m
[31m-     â‘¢ç»™stepç»‘å®šprocessorã€‚[m
[31m-     â‘£ç»™stepç»‘å®šwriterã€‚[m
[31m-     6.è¿è¡Œ[m
[31m-     å¯åŠ¨ç¨‹åºï¼ŒSpring Bootä¼šè‡ªåŠ¨åˆå§‹åŒ–Spring Batchæ•°æ®åº“ï¼Œ[m
[31m-å¹¶å°†csvä¸­çš„æ•°æ®å¯¼å…¥åˆ°æ•°æ®åº“ä¸­ã€‚[m
[31m-     ä¸ºæˆ‘ä»¬åˆå§‹åŒ–çš„Spring Batchæ•°æ®åº“å¦‚å›¾9-11æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                            å›¾9-11ã€€Spring Batchæ•°æ®åº“[m
[31m-[m
[31m-     ç›‘å¬å™¨æ•ˆæœå¦‚å›¾9-12æ‰€ç¤ºã€‚[m
[31m-     æ•°æ®å·²å¯¼å…¥ä¸”åšè½¬æ¢å¤„ç†ï¼Œå¦‚å›¾9-13æ‰€ç¤ºã€‚[m
[31m-                                 å›¾9-12ã€€ç›‘å¬å™¨æ•ˆæœ[m
[31m-[m
[31m-                        å›¾9-13ã€€æ•°æ®å·²å¯¼å…¥ä¸”åšè½¬æ¢å¤„ç†[m
[31m-[m
[31m-     å°†æˆ‘ä»¬åœ¨Personç±»ä¸Šå®šä¹‰çš„[m
[31m-     @Sizeï¼ˆmax=4ï¼Œmin=2ï¼‰[m
[31m-     ä¿®æ”¹ä¸º[m
[31m-     @Sizeï¼ˆmax=3ï¼Œmin=2ï¼‰ï¼Œå¯åŠ¨ç¨‹åºï¼Œæ§åˆ¶å°è¾“å‡ºæ ¡éªŒé”™[m
[31m-è¯¯ï¼Œå¦‚å›¾9-14æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                å›¾9-14ã€€è¾“å…¥æ ¡éªŒé”™è¯¯[m
[31m-[m
[31m-     7.æ‰‹åŠ¨è§¦å‘ä»»åŠ¡[m
[31m-     å¾ˆå¤šæ—¶å€™æ‰¹å¤„ç†ä»»åŠ¡æ˜¯äººä¸ºè§¦å‘çš„ï¼Œåœ¨æ­¤æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæ§[m
[31m-åˆ¶å™¨ï¼Œé€šè¿‡äººä¸ºè§¦å‘æ‰¹å¤„ç†ä»»åŠ¡ï¼Œå¹¶æ¼”ç¤ºå‚æ•°åç½®ç»‘å®šçš„ä½¿[m
[31m-ç”¨ã€‚[m
[31m-[m
[31m-     æ³¨é‡Šæ‰CsvBatchConfigç±»çš„@Configurationæ³¨è§£ï¼Œè®©æ­¤é…ç½®[m
[31m-ç±»ä¸å†èµ·æ•ˆã€‚æ–°å»ºTriggerBatchConfigé…ç½®ç±»ï¼Œå†…å®¹ä¸[m
[31m-CsvBatchConfigå®Œå…¨ä¿æŒä¸€è‡´ï¼Œé™¤äº†ä¿®æ”¹å®šä¹‰ItemReaderè¿™ä¸ª[m
[31m-Beanï¼ŒItemReaderä¿®æ”¹åçš„å®šä¹‰å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              @StepScope[m
[31m-[m
[31m-                       public FlatFileItemReader<Person> reader(@Value("#[m
[31m-       {jobParameters['input.file.name']}") String pathToFile) throws Exceptio[m
[31m-[m
[31m-                      FlatFileItemReader<Person> reader = new FlatFileItemReader<Pers[m
[31m-       (); //1[m
[31m-[m
[31m-                       reader.setResource(new ClassPathResource(pathToFile)); //2[m
[31m-                             reader.setLineMapper(new DefaultLineMapper<Person>[m
[31m-[m
[31m-       () {{ //3[m
[31m-                                    setLineTokenizer(new DelimitedLineTokenizer() {{[m
[31m-                                           setNames(new String[] { "name","age", "nation" ,"ad[m
[31m-                                    }});[m
[31m-                                    setFieldSetMapper(new BeanWrapperFieldSetMapper<Person>[m
[31m-[m
[31m-       () {{[m
[31m-                                           setTargetType(Person.class);[m
[31m-[m
[31m-                                    }});[m
[31m-                             }});[m
[31m-[m
[31m-                             return reader;[m
[31m-              }[m
[31m-[m
[31m-     æ­¤å¤„éœ€æ³¨æ„Beançš„ç±»å‹ä¿®æ”¹ä¸ºFlatFileItemReaderï¼Œè€Œä¸æ˜¯[m
[31m-ItemReaderã€‚å› ä¸ºItemReaderæ¥å£ä¸­æ²¡æœ‰readæ–¹æ³•ï¼Œè‹¥ä½¿ç”¨[m
[31m-ItemReaderåˆ™ä¼šæŠ¥ä¸€ä¸ªâ€œReader must be open before it can be[m
[31m-readâ€é”™è¯¯ã€‚[m
[31m-[m
[31m-     æ§åˆ¶å®šä¹‰å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       package com.wisely.ch9_2.web;[m
[31m-       import org.springframework.batch.core.Job;[m
[31m-       import org.springframework.batch.core.JobParameters;[m
[31m-       import org.springframework.batch.core.JobParametersBuilder;[m
[31m-       import org.springframework.batch.core.launch.JobLauncher;[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-       @RestController[m
[31m-       public class DemoController {[m
[31m-[m
[31m-                      @Autowired[m
[31m-                      JobLauncher jobLauncher;[m
[31m-                      @Autowired[m
[31m-                      Job importJob;[m
[31m-                      public JobParameters jobParameters;[m
[31m-[m
[31m-                      @RequestMapping("/imp")[m
[31m-                      public String imp(String fileName) throws Exception{[m
[31m-[m
[31m-                             String path = fileName+".csv";[m
[31m-                             jobParameters = new JobParametersBuilder()[m
[31m-[m
[31m-                                           .addLong("time", System.currentTimeMillis())[m
[31m-                                           .addString("input.file.name", path)[m
[31m-                                           .toJobParameters();[m
[31m-                             jobLauncher.run(importJob,jobParameters);[m
[31m-                             return "ok";[m
[31m-                      }[m
[31m-       }[m
[31m-[m
[31m-     æ­¤æ—¶æˆ‘ä»¬è¿˜è¦å…³é—­Spring Bootä¸ºæˆ‘ä»¬è‡ªåŠ¨æ‰§è¡ŒJobçš„é…ç½®ï¼Œ[m
[31m-åœ¨application.propertiesé‡Œä½¿ç”¨ä¸‹é¢ä»£ç å…³é—­é…ç½®ï¼š[m
[31m-[m
[31m-       spring.batch.job.enabled=false[m
[31m-[m
[31m-     æ­¤æ—¶æˆ‘ä»¬è®¿é—®http://localhostï¼š8080/impï¼Ÿ[m
[31m-fileName=peopleï¼Œå¯è·å¾—ç›¸åŒçš„æ•°æ®å¯¼å…¥æ•ˆæœï¼Œå¦‚å›¾9-15æ‰€[m
[31m-ç¤ºã€‚[m
[31m-å›¾9-15ã€€æ•°æ®å¯¼å…¥æ•ˆæœ[m
[31m-9.3ã€€å¼‚æ­¥æ¶ˆæ¯[m
[31m-[m
[31m-     å¼‚æ­¥æ¶ˆæ¯ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç³»ç»Ÿä¸ç³»ç»Ÿä¹‹é—´çš„é€šä¿¡ã€‚æ‰€è°“å¼‚[m
[31m-æ­¥æ¶ˆæ¯å³æ¶ˆæ¯å‘é€è€…æ— é¡»ç­‰å¾…æ¶ˆæ¯æ¥æ”¶è€…çš„å¤„ç†åŠè¿”å›ï¼Œç”šè‡³[m
[31m-æ— é¡»å…³å¿ƒæ¶ˆæ¯æ˜¯å¦å‘é€æˆåŠŸã€‚[m
[31m-[m
[31m-     åœ¨å¼‚æ­¥æ¶ˆæ¯ä¸­æœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå³æ¶ˆæ¯ä»£ç†ï¼ˆmessage[m
[31m-brokerï¼‰å’Œç›®çš„åœ°ï¼ˆdestinationï¼‰ã€‚å½“æ¶ˆæ¯å‘é€è€…å‘é€æ¶ˆæ¯åï¼Œ[m
[31m-æ¶ˆæ¯å°†ç”±æ¶ˆæ¯ä»£ç†æ¥ç®¡ï¼Œæ¶ˆæ¯ä»£ç†ä¿è¯æ¶ˆæ¯ä¼ é€’åˆ°æŒ‡å®šçš„ç›®çš„[m
[31m-åœ°ã€‚[m
[31m-[m
[31m-     å¼‚æ­¥æ¶ˆæ¯ä¸»è¦æœ‰ä¸¤ç§å½¢å¼çš„ç›®çš„åœ°ï¼šé˜Ÿåˆ—ï¼ˆqueueï¼‰å’Œä¸»é¢˜[m
[31m-ï¼ˆtopicï¼‰ã€‚é˜Ÿåˆ—ç”¨äºç‚¹å¯¹ç‚¹å¼ï¼ˆpoint-to-pointï¼‰çš„æ¶ˆæ¯é€šä¿¡ï¼›[m
[31m-ä¸»é¢˜ç”¨äºå‘å¸ƒ/è®¢é˜…å¼ï¼ˆpublish/subscribeï¼‰çš„æ¶ˆæ¯é€šä¿¡ã€‚[m
[31m-[m
[31m-     1.ç‚¹å¯¹ç‚¹å¼[m
[31m-[m
[31m-     å½“æ¶ˆæ¯å‘é€è€…å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯ä»£ç†è·å¾—æ¶ˆæ¯åå°†æ¶ˆæ¯æ”¾è¿›[m
[31m-ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆqueueï¼‰é‡Œï¼Œå½“æœ‰æ¶ˆæ¯æ¥æ”¶è€…æ¥æ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™ï¼Œ[m
[31m-æ¶ˆæ¯å°†ä»é˜Ÿåˆ—é‡Œå–å‡ºæ¥ä¼ é€’ç»™æ¥æ”¶è€…ï¼Œè¿™æ—¶å€™é˜Ÿåˆ—é‡Œå°±æ²¡æœ‰äº†[m
[31m-è¿™æ¡æ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     ç‚¹å¯¹ç‚¹å¼ç¡®ä¿çš„æ˜¯æ¯ä¸€æ¡æ¶ˆæ¯åªæœ‰å”¯ä¸€çš„å‘é€è€…å’Œæ¥æ”¶[m
[31m-è€…ï¼Œä½†è¿™å¹¶ä¸èƒ½è¯´æ˜åªæœ‰ä¸€ä¸ªæ¥æ”¶è€…å¯ä»¥ä»é˜Ÿåˆ—é‡Œæ¥æ”¶æ¶ˆæ¯ã€‚[m
[31m-å› ä¸ºé˜Ÿåˆ—é‡Œæœ‰å¤šä¸ªæ¶ˆæ¯ï¼Œç‚¹å¯¹ç‚¹å¼åªä¿è¯æ¯ä¸€æ¡æ¶ˆæ¯åªæœ‰å”¯ä¸€[m
[31m-çš„å‘é€è€…å’Œæ¥æ”¶è€…ã€‚[m
[31m-[m
[31m-     2.å‘å¸ƒ/è®¢é˜…å¼[m
[31m-[m
[31m-     å’Œç‚¹å¯¹ç‚¹å¼ä¸åŒï¼Œå‘å¸ƒ/è®¢é˜…å¼æ˜¯æ¶ˆæ¯å‘é€è€…å‘é€æ¶ˆæ¯åˆ°ä¸»[m
[31m-é¢˜ï¼ˆtopicï¼‰ï¼Œè€Œå¤šä¸ªæ¶ˆæ¯æ¥æ”¶è€…ç›‘å¬è¿™ä¸ªä¸»é¢˜ã€‚æ­¤æ—¶çš„æ¶ˆæ¯å‘[m
[31m-é€è€…å’Œæ¥æ”¶è€…åˆ†åˆ«å«åšå‘å¸ƒè€…å’Œè®¢é˜…è€…ã€‚[m
[31m-[m
[31m-9.3.1ã€€ä¼ä¸šçº§æ¶ˆæ¯ä»£ç†[m
[31m-[m
[31m-     JMSï¼ˆJava Message Serviceï¼‰å³Javaæ¶ˆæ¯æœåŠ¡ï¼Œæ˜¯åŸºäºJVM[m
[31m-æ¶ˆæ¯ä»£ç†çš„è§„èŒƒã€‚è€ŒActiveMQã€HornetQæ˜¯ä¸€ä¸ªJMSæ¶ˆæ¯ä»£ç†[m
[31m-çš„å®ç°ã€‚[m
[31m-[m
[31m-     AMQPï¼ˆAdvanced Message Queuing Protocolï¼‰ä¹Ÿæ˜¯ä¸€ä¸ªæ¶ˆ[m
[31m-æ¯ä»£ç†çš„è§„èŒƒï¼Œä½†å®ƒä¸ä»…å…¼å®¹JMSï¼Œè¿˜æ”¯æŒè·¨è¯­è¨€å’Œå¹³å°ã€‚[m
[31m-AMQPçš„ä¸»è¦å®ç°æœ‰RabbitMQã€‚[m
[31m-[m
[31m-9.3.2ã€€Springçš„æ”¯æŒ[m
[31m-[m
[31m-     Springå¯¹JMSå’ŒAMQPçš„æ”¯æŒåˆ†åˆ«æ¥è‡ªäºspring-jmså’Œ[m
[31m-Spring-rabbitã€‚[m
[31m-[m
[31m-     å®ƒä»¬åˆ†åˆ«éœ€è¦ConnectionFactoryçš„å®ç°æ¥è¿æ¥æ¶ˆæ¯ä»£ç†ï¼Œ[m
[31m-å¹¶åˆ†åˆ«æä¾›äº†JmsTemplateã€RabbitTemplateæ¥å‘é€æ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     Springä¸ºJMSã€AMQPæä¾›äº†@JmsListenerã€[m
[31m-@RabbitListeneræ³¨è§£åœ¨æ–¹æ³•ä¸Šç›‘å¬æ¶ˆæ¯ä»£ç†å‘å¸ƒçš„æ¶ˆæ¯ã€‚æˆ‘ä»¬[m
[31m-éœ€è¦åˆ†åˆ«é€šè¿‡@EnableJmsã€@EnableRabbitå¼€å¯æ”¯æŒã€‚[m
[31m-[m
[31m-9.3.3ã€€Spring Bootçš„æ”¯æŒ[m
[31m-[m
[31m-Spring                Bootå¯¹JMSçš„è‡ªåŠ¨é…ç½®æ”¯æŒä½äº[m
[31m-[m
[31m-org.springframework.boot.autoconfigure.jmsä¸‹ï¼Œæ”¯æŒJMSçš„å®ç°[m
[31m-æœ‰ActiveMQã€HornetQã€Artemisï¼ˆç”±HornetQæèµ ç»™ActiveMQ[m
[31m-çš„ä»£ç åº“å½¢æˆçš„ActiveMQçš„å­é¡¹ç›®ï¼‰ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥ActiveMQ[m
[31m-ä¸ºä¾‹ï¼ŒSpring Bootä¸ºæˆ‘ä»¬å®šä¹‰äº†ActiveMQConnectionFactoryçš„[m
[31m-Beanä½œä¸ºè¿æ¥ï¼Œå¹¶é€šè¿‡â€œspring.activemqâ€ä¸ºå‰ç¼€çš„å±æ€§æ¥é…ç½®[m
[31m-ActiveMQçš„è¿æ¥å±æ€§ï¼ŒåŒ…å«ï¼š[m
[31m-[m
[31m-       spring.activemq.broker-url=tcp://localhost:61616 # æ¶ˆæ¯ä»£ç†çš„[m
[31m-       è·¯å¾„[m
[31m-       spring.activemq.user=[m
[31m-       spring.activemq.password=[m
[31m-       spring.activemq.in-memory=true[m
[31m-       spring.activemq.pooled=false[m
[31m-[m
[31m-Spring  Bootåœ¨JmsAutoConfigurationè¿˜ä¸ºæˆ‘ä»¬é…ç½®å¥½äº†[m
[31m-[m
[31m-JmsTemplateï¼Œä¸”ä¸ºæˆ‘ä»¬å¼€å¯äº†æ³¨è§£å¼æ¶ˆæ¯ç›‘å¬çš„æ”¯æŒï¼Œå³è‡ª[m
[31m-[m
[31m-åŠ¨å¼€å¯@EnableJmsã€‚[m
[31m-[m
[31m-Spring          Bootå¯¹AMQPçš„è‡ªåŠ¨é…ç½®æ”¯æŒä½äº[m
[31m-[m
[31m-org.springframework.boot.autoconfigure.amqpä¸‹ï¼Œå®ƒä¸ºæˆ‘ä»¬é…ç½®[m
[31m-[m
[31m-äº†è¿æ¥çš„ConnectionFactoryå’ŒRabbitTemplateï¼Œä¸”ä¸ºæˆ‘ä»¬å¼€å¯äº†[m
[31m-[m
[31m-æ³¨è§£å¼æ¶ˆæ¯ç›‘å¬ï¼Œå³è‡ªåŠ¨å¼€å¯@EnableRabbitã€‚RabbitMQçš„é…[m
[31m-[m
[31m-ç½®å¯é€šè¿‡â€œspring.rabbitmqâ€æ¥é…ç½®RabbitMQï¼Œä¸»è¦åŒ…å«ï¼š[m
[31m-[m
[31m-spring.rabbitmq.host=localhost   #rabbitmqæœåŠ¡å™¨åœ°å€ï¼Œé»˜è®¤ä¸º[m
[31m-[m
[31m-localhost[m
[31m-spring.rabbitmq.port=5672 #rabbitmqç«¯å£ï¼Œé»˜è®¤ä¸º5672[m
[31m-[m
[31m-spring.rabbitmq.username=admin[m
[31m-[m
[31m-spring.rabbitmq.password=secret[m
[31m-[m
[31m-9.3.4ã€€JMSå®æˆ˜[m
[31m-     1.å®‰è£…ActiveMQ[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰éDockerå®‰è£…[m
[31m-[m
[31m-     è¯»è€…å¯è®¿é—®http://activemq.apache.org/activemq-5111-[m
[31m-release.htmlï¼Œä¸‹è½½åˆé€‚çš„ActiveMQç‰ˆæœ¬ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰Dockerå®‰è£…[m
[31m-[m
[31m-     å‰é¢å·²ç»ä¸‹è½½å¥½äº†ActiveMQçš„é•œåƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢å‘½[m
[31m-ä»¤è¿è¡Œé•œåƒï¼š[m
[31m-[m
[31m-docker run -d -p                 61616:61616  -[m
[31m-p 8161:8161 cloudesire/activemq[m
[31m-[m
[31m-     å…¶ä¸­61616æ˜¯æ¶ˆæ¯ä»£ç†çš„ç«¯å£ï¼Œ8161æ˜¯ActiveMQçš„ç®¡ç†ç•Œ[m
[31m-é¢ç«¯å£ï¼Œæœ€ååˆ«å¿˜äº†åœ¨VirtualBoxå¼€å¯61616åŠ8161çš„ç«¯å£æ˜ [m
[31m-å°„ã€‚[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8161å¯æ‰“å¼€ActiveMQçš„ç®¡ç†ç•Œé¢ï¼Œç®¡[m
[31m-ç†å‘˜è´¦å·å¯†ç é»˜è®¤ä¸ºadmin/adminï¼Œå¦‚å›¾9-16æ‰€ç¤ºã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰å†…åµŒActiveMQ[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥å°†ActiveMQå†…åµŒåœ¨ç¨‹åºé‡Œï¼Œåªè¦åœ¨é¡¹ç›®ä¾èµ–é‡ŒåŠ [m
[31m-å…¥activemq-brokerå³å¯ã€‚[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.apache.activemq</groupId>[m
[31m-                             <artifactId>activemq-broker</artifactId>[m
[31m-[m
[31m-                      </dependency>[m
[31m-                           å›¾9-16ã€€ActiveMQçš„ç®¡ç†ç•Œé¢[m
[31m-[m
[31m-     2.æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–æ— ã€‚[m
[31m-[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-       groupIdï¼šcom.wisely[m
[31m-       arctifactId:ch9_3_4[m
[31m-       package: com.wisely.ch9_3_4[m
[31m-[m
[31m-     è™½ç„¶Spring Bootæä¾›äº†JMSï¼ˆspring-boot-starter-hornetqï¼‰[m
[31m-çš„ä¾èµ–ï¼Œä½†é»˜è®¤æˆ‘ä»¬ä½¿ç”¨çš„æ¶ˆæ¯ä»£ç†æ˜¯HornetQï¼Œæœ¬ä¾‹å°†ä»¥[m
[31m-ActiveMQä¸ºä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ spring-jmså’Œactivemq-client[m
[31m-çš„ä¾èµ–ï¼Œæ‰€éœ€çš„å®Œæˆä¾èµ–å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                             <artifactId>spring-boot-starter</artifactId>[m
[31m-[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-[m
[31m-                             <groupId>org.springframework</groupId>[m
[31m-                             <artifactId>spring-jms</artifactId>[m
[31m-                      </dependency>[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.apache.activemq</groupId>[m
[31m-                             <artifactId>activemq-client</artifactId>[m
[31m-[m
[31m-                      </dependency>[m
[31m-[m
[31m-     é…ç½®ActiveMQæ¶ˆæ¯ä»£ç†çš„åœ°å€ï¼Œåœ¨application.propertiesé‡Œ[m
[31m-ä½¿ç”¨ï¼š[m
[31m-[m
[31m-       spring.activemq.broker-url=tcp://localhost:61616[m
[31m-[m
[31m-     åœ¨å®é™…æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯çš„å‘å¸ƒè€…å’Œæ¥æ”¶è€…ä¸€èˆ¬éƒ½æ˜¯åˆ†å¼€çš„ï¼Œ[m
[31m-è€Œè¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ¼”ç¤ºç®€å•ï¼Œå°†æ¶ˆæ¯å‘é€è€…å’Œæ¥æ”¶è€…æ”¾åœ¨ä¸€ä¸ªç¨‹[m
[31m-åºé‡Œã€‚[m
[31m-[m
[31m-     3.æ¶ˆæ¯å®šä¹‰[m
[31m-[m
[31m-     å®šä¹‰JMSå‘é€çš„æ¶ˆæ¯éœ€å®ç°MessageCreatoræ¥å£ï¼Œå¹¶é‡å†™å…¶[m
[31m-createMessageæ–¹æ³•ï¼š[m
[31m-[m
[31m-       package com.wisely.ch9_3_4;[m
[31m-[m
[31m-       import javax.jms.JMSException;[m
[31m-       import javax.jms.Message;[m
[31m-       import javax.jms.Session;[m
[31m-[m
[31m-       import org.springframework.jms.core.MessageCreator;[m
[31m-[m
[31m-       public class Msg implements MessageCreator{[m
[31m-[m
[31m-              @Override[m
[31m-              public Message createMessage(Session session) throws JMSException {[m
[31m-[m
[31m-                      return session.createTextMessage("æµ‹è¯•æ¶ˆæ¯");[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     4.æ¶ˆæ¯å‘é€åŠç›®çš„åœ°å®šä¹‰[m
[31m-[m
[31m-       package com.wisely.ch9_3_4;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.boot.CommandLineRunner;[m
[31m-       import org.springframework.boot.SpringApplication;[m
[31m-       import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-       import org.springframework.jms.core.JmsTemplate;[m
[31m-[m
[31m-       @SpringBootApplication[m
[31m-       public class Ch934Application implements CommandLineRunner{ //1[m
[31m-[m
[31m-              @Autowired[m
[31m-              JmsTemplate jmsTemplate; //2[m
[31m-[m
[31m-              public static void main(String[] args) {[m
[31m-                      SpringApplication.run(Ch934Application.class, args);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public void run(String... args) throws Exception {[m
[31m-[m
[31m-                      jmsTemplate.send("my-destination", new Msg()); //3[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ Spring Bootä¸ºæˆ‘ä»¬æä¾›äº†CommandLineRunneræ¥å£ï¼Œç”¨[m
[31m-äºç¨‹åºå¯åŠ¨åæ‰§è¡Œçš„ä»£ç ï¼Œé€šè¿‡é‡å†™å…¶runæ–¹æ³•æ‰§è¡Œã€‚[m
[31m-[m
[31m-     â‘¡æ³¨å…¥Spring Bootä¸ºæˆ‘ä»¬é…ç½®å¥½çš„JmsTemplateçš„Beanã€‚[m
[31m-     â‘¢é€šè¿‡JmsTemplateçš„sendæ–¹æ³•å‘my-destinationç›®çš„åœ°å‘é€[m
[31m-Msgçš„æ¶ˆæ¯ï¼Œè¿™é‡Œä¹Ÿç­‰äºåœ¨æ¶ˆæ¯ä»£ç†ä¸Šå®šä¹‰äº†ä¸€ä¸ªç›®çš„åœ°å«[m
[31m-my-destinationã€‚[m
[31m-[m
[31m-     5.æ¶ˆæ¯ç›‘å¬[m
[31m-[m
[31m-       package com.wisely.ch9_3_4;[m
[31m-[m
[31m-       import org.springframework.jms.annotation.JmsListener;[m
[31m-       import org.springframework.stereotype.Component;[m
[31m-[m
[31m-       @Component[m
[31m-       public class Receiver {[m
[31m-[m
[31m-              @JmsListener(destination = "my-destination")[m
[31m-              public void receiveMessage(String message) {[m
[31m-[m
[31m-                      System.out.println("æ¥å—åˆ°: <" + message + ">");[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     @JmsListeneræ˜¯Spring 4.1ä¸ºæˆ‘ä»¬æä¾›çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œç”¨æ¥[m
[31m-ç®€åŒ–JMSå¼€å‘ã€‚æˆ‘ä»¬åªéœ€åœ¨è¿™ä¸ªæ³¨è§£çš„å±æ€§destinationæŒ‡å®šè¦[m
[31m-ç›‘å¬çš„ç›®çš„åœ°ï¼Œå³å¯æ¥æ”¶è¯¥ç›®çš„åœ°å‘é€çš„æ¶ˆæ¯ã€‚æ­¤ä¾‹ç›‘å¬my-[m
[31m-destinationç›®çš„åœ°å‘é€çš„æ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     6.è¿è¡Œ[m
[31m-[m
[31m-     å¯åŠ¨ç¨‹åºï¼Œç¨‹åºä¼šè‡ªåŠ¨å‘ç›®çš„åœ°my-destinationå‘é€æ¶ˆæ¯ï¼Œ[m
[31m-è€ŒReceiverç±»æ³¨è§£äº†@JmsLisenerçš„æ–¹æ³•ä¼šè‡ªåŠ¨ç›‘å¬my-[m
[31m-destinationå‘é€çš„æ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     æ§åˆ¶å°æ˜¾ç¤ºReceiverå·²æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œå¦‚å›¾9-17æ‰€ç¤ºã€‚[m
[31m-                                å›¾9-17ã€€å·²æ¥æ”¶åˆ°æ¶ˆæ¯[m
[31m-[m
[31m-     åœ¨ActiveMQçš„ç®¡ç†é¡µé¢ä¹Ÿå¯ä»¥æŸ¥çœ‹æˆ‘ä»¬ç›®çš„åœ°çš„ç›¸å…³ä¿¡[m
[31m-æ¯ï¼Œå¦‚å›¾9-18æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                          å›¾9-18ã€€æŸ¥çœ‹ç›®çš„åœ°çš„ç›¸å…³ä¿¡æ¯[m
[31m-[m
[31m-9.3.5ã€€AMQPå®æˆ˜[m
[31m-[m
[31m-     1.å®‰è£…RabbitMQ[m
[31m-     ï¼ˆ1ï¼‰éDockerå®‰è£…[m
[31m-     RabbitMQæ˜¯åŸºäºerlangè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥å®‰è£…RabbitMQå…ˆ[m
[31m-è¦ä¸‹è½½å®‰è£…erlangï¼Œä¸‹è½½åœ°å€ä¸º[m
[31m-http://www.erlang.org/download.htmlï¼›ç„¶åä¸‹è½½RabbitMQï¼Œä¸‹[m
[31m-è½½åœ°å€ä¸ºhttps://www.rabbitmq.com/download.htmlã€‚[m
[31m-     ï¼ˆ2ï¼‰Dockerå®‰è£…[m
[31m-     å‰é¢å·²ç»ä¸‹è½½å¥½äº†RabbitMQçš„é•œåƒï¼Œä»¥ä¸‹é¢å‘½ä»¤è¿è¡Œä¸€ä¸ª[m
[31m-å®¹å™¨ï¼š[m
[31m-[m
[31m-       docker run -d -p 5672:5672 -p 15672:15672 rabbitmq:3-[m
[31m-       management[m
[31m-[m
[31m-     å…¶ä¸­5672æ˜¯æ¶ˆæ¯ä»£ç†çš„ç«¯å£ï¼Œ15672æ˜¯Webç®¡ç†ç•Œé¢çš„ç«¯[m
[31m-å£ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å¸¦ç®¡ç†ç•Œé¢çš„RabbitMQï¼›æœ€åè¿˜è¦åœ¨[m
[31m-VirtualBoxåšä»¥ä¸‹è¿™ä¸¤ä¸ªç«¯å£çš„æ˜ å°„ã€‚[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š15672ï¼Œæ‰“å¼€ç®¡ç†ç•Œé¢ï¼Œé»˜è®¤è´¦å·å¯†[m
[31m-ç ä¸ºguest/guestï¼Œå¦‚å›¾9-19æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                            å›¾9-19ã€€RabbitMQç®¡ç†ç•Œé¢[m
[31m-[m
[31m-     2.æ–°å»ºSpring Booté¡¹ç›®[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºAMQPï¼ˆspring-boot-starter-[m
[31m-amqpï¼‰ã€‚[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-groupIdï¼šcom.wisely[m
[31m-arctifactId:ch9_3_5[m
[31m-package: com.wisely.ch9_3_5[m
[31m-[m
[31m-     Spring Booté»˜è®¤æˆ‘ä»¬çš„Rabbitä¸»æœºä¸ºlocalhostã€ç«¯å£å·ä¸º[m
[31m-5672ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— é¡»ä¸ºSpring Bootçš„application.propertiesé…ç½®[m
[31m-RabbitMQçš„è¿æ¥ä¿¡æ¯ã€‚[m
[31m-[m
[31m-     3.å‘é€ä¿¡æ¯åŠç›®çš„åœ°å®šä¹‰[m
[31m-[m
[31m-package com.wisely.ch9_3_5;[m
[31m-[m
[31m-import org.springframework.amqp.core.Queue;[m
[31m-import org.springframework.amqp.rabbit.core.RabbitTemplate;[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.boot.CommandLineRunner;[m
[31m-import org.springframework.boot.SpringApplication;[m
[31m-import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-import org.springframework.context.annotation.Bean;[m
[31m-[m
[31m-@SpringBootApplication[m
[31m-public class Ch935Application implements CommandLineRunner{[m
[31m-[m
[31m-       @Autowired[m
[31m-       RabbitTemplate rabbitTemplate; //1[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-              SpringApplication.run(Ch935Application.class, args);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       @Bean //2[m
[31m-       public Queue wiselyQueue(){[m
[31m-[m
[31m-              return new Queue("my-queue");[m
[31m-       }[m
[31m-[m
[31m-       @Override                                                    "æ¥è‡ª[m
[31m-       public void run(String... args) throws Exception {[m
[31m-[m
[31m-                         rabbitTemplate.convertAndSend("my-queue",[m
[31m-RabbitMQçš„é—®å€™"); //3[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ å¯æ³¨å…¥Spring Bootä¸ºæˆ‘ä»¬è‡ªåŠ¨é…ç½®å¥½çš„RabbitTemplateã€‚[m
[31m-[m
[31m-     â‘¡å®šä¹‰ç›®çš„åœ°å³é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—åç§°ä¸ºmy-queueã€‚[m
[31m-[m
[31m-     â‘¢é€šè¿‡RabbitTemplateçš„convertAndSendæ–¹æ³•å‘é˜Ÿåˆ—my-[m
[31m-queueå‘é€æ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     4.æ¶ˆæ¯ç›‘å¬[m
[31m-[m
[31m-       package com.wisely.ch9_3_5;[m
[31m-[m
[31m-       import org.springframework.amqp.rabbit.annotation.RabbitListener;[m
[31m-       import org.springframework.stereotype.Component;[m
[31m-[m
[31m-       @Component[m
[31m-       public class Receiver {[m
[31m-[m
[31m-              @RabbitListener(queues = "my-queue")[m
[31m-              public void receiveMessage(String message) {[m
[31m-[m
[31m-                      System.out.println("Received <" + message + ">");[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     ä½¿ç”¨@RabbitListeneræ¥ç›‘å¬RabbitMQçš„ç›®çš„åœ°å‘é€çš„æ¶ˆ[m
[31m-æ¯ï¼Œé€šè¿‡queueså±æ€§æŒ‡å®šè¦ç›‘å¬çš„ç›®çš„åœ°ã€‚[m
[31m-[m
[31m-     5.è¿è¡Œ[m
[31m-[m
[31m-     å¯åŠ¨ç¨‹åºï¼Œç¨‹åºä¼šè‡ªåŠ¨å‘ç›®çš„åœ°my-queueå‘é€æ¶ˆæ¯ï¼Œè€Œ[m
[31m-Receiverç±»æ³¨è§£äº†@RabbitListenerçš„æ–¹æ³•ä¼šè‡ªåŠ¨ç›‘å¬my-queue[m
[31m-å‘é€çš„æ¶ˆæ¯ã€‚[m
[31m-æ§åˆ¶å°æ˜¾ç¤ºå¦‚å›¾9-20æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾9-20ã€€æ§åˆ¶å°[m
[31m-[m
[31m-RabbitMQç®¡ç†ç•Œé¢æ˜¾ç¤ºå¦‚å›¾9-21æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                      å›¾9-21ã€€RabbitMQç®¡ç†ç•Œé¢[m
[31m-9.4ã€€ç³»ç»Ÿé›†æˆSpring Integration[m
[31m-[m
[31m-9.4.1ã€€Spring Integrationå¿«é€Ÿå…¥é—¨[m
[31m-[m
[31m-Spring       Ingegrationæä¾›äº†åŸºäºSpringçš„EIPï¼ˆEnterprise[m
[31m-[m
[31m-Integration    Patternsï¼Œä¼ä¸šé›†æˆæ¨¡å¼ï¼‰çš„å®ç°ã€‚Spring[m
[31m-[m
[31m-Integrationä¸»è¦è§£å†³çš„é—®é¢˜æ˜¯ä¸åŒç³»ç»Ÿä¹‹é—´äº¤äº’çš„é—®é¢˜ï¼Œé€šè¿‡[m
[31m-[m
[31m-å¼‚æ­¥æ¶ˆæ¯é©±åŠ¨æ¥è¾¾åˆ°ç³»ç»Ÿäº¤äº’æ—¶ç³»ç»Ÿä¹‹é—´çš„æ¾è€¦åˆã€‚æœ¬èŠ‚å°†åŸº[m
[31m-[m
[31m-äºæ— XMLé…ç½®çš„åŸåˆ™ä½¿ç”¨Javaé…ç½®ã€æ³¨è§£ä»¥åŠSpring[m
[31m-[m
[31m-Integration Java DSLæ¥ä½¿ç”¨Spring Integrationã€‚[m
[31m-[m
[31m-Spring         Integratinä¸»è¦ç”±Messageã€Channelå’ŒMessage[m
[31m-[m
[31m-EndPointç»„æˆã€‚[m
[31m-[m
[31m-9.4.2ã€€Message[m
[31m-[m
[31m-     Messageæ˜¯ç”¨æ¥åœ¨ä¸åŒéƒ¨åˆ†ä¹‹é—´ä¼ é€’çš„æ•°æ®ã€‚Messageç”±ä¸¤[m
[31m-éƒ¨åˆ†ç»„æˆï¼šæ¶ˆæ¯ä½“ï¼ˆpayloadï¼‰ä¸æ¶ˆæ¯å¤´ï¼ˆheaderï¼‰ã€‚æ¶ˆæ¯ä½“å¯[m
[31m-ä»¥æ˜¯ä»»ä½•æ•°æ®ç±»å‹ï¼ˆå¦‚XMLã€JSONï¼ŒJavaå¯¹è±¡ï¼‰ï¼›æ¶ˆæ¯å¤´è¡¨[m
[31m-ç¤ºçš„å…ƒæ•°æ®å°±æ˜¯è§£é‡Šæ¶ˆæ¯ä½“çš„å†…å®¹ã€‚[m
[31m-[m
[31m-public interface Message<T> {[m
[31m-       T getPayload();[m
[31m-       MessageHeaders getHeaders();[m
[31m-[m
[31m-}[m
[31m-9.4.3ã€€Channel[m
[31m-[m
[31m-     åœ¨æ¶ˆæ¯ç³»ç»Ÿä¸­ï¼Œæ¶ˆæ¯å‘é€è€…å‘é€æ¶ˆæ¯åˆ°é€šé“ï¼ˆChannelï¼‰ï¼Œ[m
[31m-æ¶ˆæ¯æ”¶å—è€…ä»é€šé“ï¼ˆChannelï¼‰æ¥æ”¶æ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     1.é¡¶çº§æ¥å£[m
[31m-     ï¼ˆ1ï¼‰MessageChannel[m
[31m-     MessageChannelæ˜¯Spring Integrationæ¶ˆæ¯é€šé“çš„é¡¶çº§æ¥å£ï¼š[m
[31m-[m
[31m-       public interface MessageChannel {[m
[31m-              public static final long INDEFINITE_TIMEOUT = -1;[m
[31m-              boolean send(Message<?> message);[m
[31m-              boolean send(Message<?> message, long timeout);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     å½“ä½¿ç”¨sendæ–¹æ³•å‘é€æ¶ˆæ¯æ—¶ï¼Œè¿”å›å€¼ä¸ºtrueï¼Œåˆ™è¡¨ç¤ºæ¶ˆæ¯å‘[m
[31m-é€æˆåŠŸã€‚MessageChannelæœ‰ä¸¤å¤§å­æ¥å£ï¼Œåˆ†åˆ«ä¸º[m
[31m-PollableChannleï¼ˆå¯è½®è¯¢ï¼‰å’ŒSubscribableChannelï¼ˆå¯è®¢é˜…ï¼‰ã€‚[m
[31m-æˆ‘ä»¬æ‰€æœ‰çš„æ¶ˆæ¯é€šé“ç±»éƒ½æ˜¯å®ç°è¿™ä¸¤ä¸ªæ¥å£ã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰PollableChannel[m
[31m-     PollableChannelå…·å¤‡è½®è¯¢è·å¾—æ¶ˆæ¯çš„èƒ½åŠ›ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       public interface PollableChannel extends MessageChannel {[m
[31m-              Message<?> receive();[m
[31m-              Message<?> receive(long timeout);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰SubscribableChannel[m
[31m-     SubscribableChannelå‘é€æ¶ˆæ¯ç»™è®¢é˜…äº†MessageHanlderçš„è®¢[m
[31m-é˜…è€…ï¼š[m
[31m-[m
[31m-       public interface SubscribableChannel extends MessageChannel {[m
[31m-              boolean subscribe(MessageHandler handler);[m
[31m-              boolean unsubscribe(MessageHandler handler);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     2.å¸¸ç”¨æ¶ˆæ¯é€šé“[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰PublishSubscribeChannel[m
[31m-[m
[31m-     PublishSubscribeChannelå…è®¸å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰è®¢é˜…è€…ï¼Œé…ç½®[m
[31m-æ–¹å¼å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-               public PublishSubscribeChannel publishSubscribeChannel()[m
[31m-       {[m
[31m-[m
[31m-                      PublishSubscribeChannel channel = new PublishSubscribeChannel()[m
[31m-                    return channel;[m
[31m-              }[m
[31m-[m
[31m-     å…¶ä¸­ï¼Œå½“å‰æ¶ˆæ¯é€šé“çš„idä¸ºpublishSubscribeChannelã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰QueueChannel[m
[31m-[m
[31m-     QueueChannelå…è®¸æ¶ˆæ¯æ¥æ”¶è€…è½®è¯¢è·å¾—ä¿¡æ¯ï¼Œç”¨ä¸€ä¸ªé˜Ÿåˆ—[m
[31m-ï¼ˆqueueï¼‰æ¥æ”¶æ¶ˆæ¯ï¼Œé˜Ÿåˆ—çš„å®¹é‡å¤§å°å¯é…ç½®ï¼Œé…ç½®æ–¹å¼å¦‚[m
[31m-ä¸‹ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public QueueChannel queueChannel(){[m
[31m-[m
[31m-                      QueueChannel channel = new QueueChannel(10);[m
[31m-                      return channel;[m
[31m-              }[m
[31m-[m
[31m-     å…¶ä¸­QueueChannelæ„é€ å‚æ•°10å³ä¸ºé˜Ÿåˆ—çš„å®¹é‡ã€‚[m
[31m-     ï¼ˆ3ï¼‰PriorityChannel[m
[31m-     PriorityChannelå¯æŒ‰ç…§ä¼˜å…ˆçº§å°†æ•°æ®å­˜å‚¨åˆ°å¯¹ï¼Œå®ƒä¾æ®äºæ¶ˆ[m
[31m-æ¯çš„æ¶ˆæ¯å¤´priorityå±æ€§ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public PriorityChannel priorityChannel(){[m
[31m-[m
[31m-                      PriorityChannel channel = new PriorityChannel(10);[m
[31m-                      return channel;[m
[31m-              }[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰RendezvousChannel[m
[31m-     RendezvousChannelç¡®ä¿æ¯ä¸€ä¸ªæ¥æ”¶è€…éƒ½æ¥æ”¶åˆ°æ¶ˆæ¯åå†å‘[m
[31m-é€æ¶ˆæ¯ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public RendezvousChannel rendezvousChannel(){[m
[31m-              RendezvousChannel channel = new RendezvousChannel();[m
[31m-              return channel;[m
[31m-              }[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰DirectChannel[m
[31m-     DirectChannelæ˜¯Spring Integrationé»˜è®¤çš„æ¶ˆæ¯é€šé“ï¼Œå®ƒå…è®¸[m
[31m-å°†æ¶ˆæ¯å‘é€ç»™ä¸ºä¸€ä¸ªè®¢é˜…è€…ï¼Œç„¶åé˜»ç¢å‘é€ç›´åˆ°æ¶ˆæ¯è¢«æ¥æ”¶ï¼Œ[m
[31m-é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š[m
[31m-@Bean[m
[31m-public DirectChannel directChannel(){[m
[31m-[m
[31m-       DirectChannel channel = new DirectChannel();[m
[31m-       return channel;[m
[31m-}[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰ExecutorChannel[m
[31m-[m
[31m-     ExecutorChannelå¯ç»‘å®šä¸€ä¸ªå¤šçº¿ç¨‹çš„task executorï¼Œé…ç½®æ–¹[m
[31m-å¼å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-             @Bean[m
[31m-              public ExecutorChannel executorChannel(){[m
[31m-              ExecutorChannel channel = new ExecutorChannel(executor());[m
[31m-              return channel;[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              public Executor executor(){[m
[31m-              ThreadPoolTaskExecutor taskExecutor = new ThreadPoolTaskExecutor();[m
[31m-[m
[31m-                      taskExecutor.setCorePoolSize(5);[m
[31m-                      taskExecutor.setMaxPoolSize(10);[m
[31m-                      taskExecutor.setQueueCapacity(25);[m
[31m-                      taskExecutor.initialize();[m
[31m-                      return taskExecutor;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-3.é€šé“æ‹¦æˆªå™¨[m
[31m-[m
[31m-Spring   Integrationç»™æ¶ˆæ¯é€šé“æä¾›äº†é€šé“æ‹¦æˆªå™¨[m
[31m-[m
[31m-ï¼ˆChannelInterceptorï¼‰ï¼Œç”¨æ¥æ‹¦æˆªå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„æ“ä½œã€‚[m
[31m-[m
[31m-     ChannelInterceptoræ¥å£å®šä¹‰å¦‚ä¸‹ï¼Œæˆ‘ä»¬åªéœ€å®ç°è¿™ä¸ªæ¥å£[m
[31m-å³å¯ï¼š[m
[31m-public interface ChannelInterceptor {[m
[31m-[m
[31m-                        Message<?>     preSend(Message<?[m
[31m-[m
[31m-> message, MessageChannel channel);[m
[31m-[m
[31m-                        void           postSend(Message<?[m
[31m-[m
[31m-> message, MessageChannel channel, boolean sent);[m
[31m-[m
[31m-              void      afterSendCompletion(Message<?[m
[31m-[m
[31m-> message, MessageChannel channel, boolean sent, Exception ex);[m
[31m-[m
[31m-   boolean preReceive(MessageChannel channel);[m
[31m-[m
[31m-                    Message<?>         postReceive(Message<?[m
[31m-[m
[31m-> message, MessageChannel channel);[m
[31m-[m
[31m-          void          afterReceiveCompletion(Message<?[m
[31m-[m
[31m-> message, MessageChannel channel, Exception ex);[m
[31m-[m
[31m-}[m
[31m-[m
[31m-æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„ä»£ç ç»™æ‰€æœ‰çš„channelå¢åŠ æ‹¦æˆªå™¨ï¼š[m
[31m-[m
[31m-channel.addInterceptor(someInterceptor);[m
[31m-[m
[31m-9.4.4ã€€Message EndPoint[m
[31m-[m
[31m-æ¶ˆæ¯ç«¯ç‚¹ï¼ˆMessage            Endpointï¼‰æ˜¯çœŸæ­£å¤„ç†æ¶ˆæ¯çš„[m
[31m-[m
[31m-ï¼ˆMessageï¼‰ç»„ä»¶ï¼Œå®ƒè¿˜å¯ä»¥æ§åˆ¶é€šé“çš„è·¯ç”±ã€‚æˆ‘ä»¬å¯ç”¨çš„æ¶ˆ[m
[31m-[m
[31m-æ¯ç«¯ç‚¹åŒ…å«å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-ï¼ˆ1ï¼‰Channel Adapter[m
[31m-[m
[31m-     é€šé“é€‚é…å™¨ï¼ˆChannel Adapterï¼‰æ˜¯ä¸€ç§è¿æ¥å¤–éƒ¨ç³»ç»Ÿæˆ–ä¼ [m
[31m-è¾“åè®®çš„ç«¯ç‚¹ï¼ˆEndPointï¼‰ï¼Œå¯ä»¥åˆ†ä¸ºå…¥ç«™ï¼ˆinboundï¼‰å’Œå‡ºç«™[m
[31m-ï¼ˆoutboundï¼‰ã€‚[m
[31m-[m
[31m-     é€šé“é€‚é…å™¨æ˜¯å•å‘çš„ï¼Œå…¥ç«™é€šé“é€‚é…å™¨åªæ”¯æŒæ¥æ”¶æ¶ˆæ¯ï¼Œ[m
[31m-å‡ºç«™é€šé“é€‚é…å™¨åªæ”¯æŒè¾“å‡ºæ¶ˆæ¯ã€‚[m
[31m-Spring Integrationå†…ç½®äº†å¦‚ä¸‹çš„é€‚é…å™¨ï¼š[m
[31m-[m
[31m-     RabbitMQã€Feedã€Fileã€FTP/SFTPã€Gemfireã€HTTPã€[m
[31m-TCP/UDPã€JDBCã€JPAã€JMSã€Mailã€MongoDBã€Redisã€[m
[31m-RMIã€Twitterã€XMPPã€WebServicesï¼ˆSOAPã€RESTï¼‰ã€[m
[31m-WebSocketç­‰ã€‚[m
[31m-[m
[31m-     Spring Integration extensionsé¡¹ç›®æä¾›äº†æ›´å¤šçš„æ”¯æŒï¼Œåœ°å€[m
[31m-ä¸ºï¼šhttps://github.com/spring-projects/spring-integration-[m
[31m-extensionsã€‚[m
[31m-[m
[31m-ï¼ˆ2ï¼‰Gateway[m
[31m-[m
[31m-     æ¶ˆæ¯ç½‘å…³ï¼ˆGatewayï¼‰ç±»ä¼¼äºAdapterï¼Œä½†æ˜¯æä¾›äº†åŒå‘çš„[m
[31m-è¯·æ±‚/è¿”å›é›†æˆæ–¹å¼ï¼Œä¹Ÿåˆ†ä¸ºå…¥ç«™ï¼ˆinboundï¼‰å’Œå‡ºç«™[m
[31m-ï¼ˆoutboundï¼‰ã€‚Spring Integrationå¯¹ç›¸åº”çš„Adapterå¤šéƒ½æä¾›äº†[m
[31m-Gatewayã€‚[m
[31m-[m
[31m-ï¼ˆ3ï¼‰Service Activator[m
[31m-[m
[31m-     Service Activatorå¯è°ƒç”¨Springçš„Beanæ¥å¤„ç†æ¶ˆæ¯ï¼Œå¹¶å°†å¤„[m
[31m-ç†åçš„ç»“æœè¾“å‡ºåˆ°æŒ‡å®šçš„æ¶ˆæ¯é€šé“ã€‚[m
[31m-[m
[31m-ï¼ˆ4ï¼‰Router[m
[31m-[m
[31m-è·¯ç”±ï¼ˆRouterï¼‰å¯æ ¹æ®æ¶ˆæ¯ä½“ç±»å‹ï¼ˆPayload    Type[m
[31m-[m
[31m-Routerï¼‰ã€æ¶ˆæ¯å¤´çš„å€¼ï¼ˆHeader Value Routerï¼‰ä»¥åŠå®šä¹‰å¥½çš„[m
[31m-[m
[31m-æ¥æ”¶è¡¨ï¼ˆRecipient List Routerï¼‰ä½œä¸ºæ¡ä»¶ï¼Œæ¥å†³å®šæ¶ˆæ¯ä¼ é€’åˆ°[m
[31m-[m
[31m-çš„é€šé“ã€‚[m
[31m-[m
[31m-ï¼ˆ5ï¼‰Filter[m
[31m-[m
[31m-     è¿‡æ»¤å™¨ï¼ˆFilterï¼‰ç±»ä¼¼äºè·¯ç”±ï¼ˆRouterï¼‰ï¼Œä¸åŒçš„æ˜¯è¿‡æ»¤å™¨[m
[31m-ä¸å†³å®šæ¶ˆæ¯è·¯ç”±åˆ°å“ªé‡Œï¼Œè€Œæ˜¯å†³å®šæ¶ˆæ¯æ˜¯å¦å¯ä»¥ä¼ é€’ç»™æ¶ˆæ¯é€š[m
[31m-é“ã€‚[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰Splitter[m
[31m-[m
[31m-     æ‹†åˆ†å™¨ï¼ˆSplitterï¼‰å°†æ¶ˆæ¯æ‹†åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†å•ç‹¬å¤„ç†ï¼Œæ‹†åˆ†[m
[31m-å™¨å¤„ç†çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªé›†åˆæˆ–è€…æ•°ç»„ã€‚[m
[31m-[m
[31m-     ï¼ˆ7ï¼‰Aggregator[m
[31m-[m
[31m-     èšåˆå™¨ï¼ˆAggregatorï¼‰ä¸æ‹†åˆ†å™¨ç›¸åï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª[m
[31m-java.util.Listä½œä¸ºå‚æ•°ï¼Œå°†å¤šä¸ªæ¶ˆæ¯åˆå¹¶ä¸ºä¸€ä¸ªæ¶ˆæ¯ã€‚[m
[31m-[m
[31m-     ï¼ˆ8ï¼‰Enricher[m
[31m-[m
[31m-     å½“æˆ‘ä»¬ä»å¤–éƒ¨è·å¾—æ¶ˆæ¯åï¼Œéœ€è¦å¢åŠ é¢å¤–çš„æ¶ˆæ¯åˆ°å·²æœ‰çš„[m
[31m-æ¶ˆæ¯ä¸­ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨æ¶ˆæ¯å¢å¼ºå™¨ï¼ˆEnricherï¼‰ã€‚æ¶ˆæ¯å¢å¼º[m
[31m-å™¨ä¸»è¦æœ‰æ¶ˆæ¯ä½“å¢å¼ºå™¨ï¼ˆPayload Enricherï¼‰å’Œæ¶ˆæ¯å¤´å¢å¼ºå™¨[m
[31m-ï¼ˆHeader Enricherï¼‰ä¸¤ç§ã€‚[m
[31m-[m
[31m-     ï¼ˆ9ï¼‰Transformer[m
[31m-[m
[31m-     è½¬æ¢å™¨ï¼ˆTransformerï¼‰æ˜¯å¯¹è·å¾—çš„æ¶ˆæ¯è¿›è¡Œä¸€å®šçš„é€»è¾‘è½¬[m
[31m-æ¢å¤„ç†ï¼ˆå¦‚æ•°æ®æ ¼å¼è½¬æ¢ï¼‰ã€‚[m
[31m-[m
[31m-     ï¼ˆ10ï¼‰Bridge[m
[31m-[m
[31m-     ä½¿ç”¨è¿æ¥æ¡¥ï¼ˆBridgeï¼‰å¯ä»¥ç®€å•åœ°å°†ä¸¤ä¸ªæ¶ˆæ¯é€šé“è¿æ¥èµ·[m
[31m-æ¥ã€‚[m
[31m-[m
[31m-9.4.5ã€€Spring Integration Java DSL[m
[31m-[m
[31m-     Spring Integrationæä¾›äº†ä¸€ä¸ªIntegrationFlowæ¥å®šä¹‰ç³»ç»Ÿç»§[m
[31m-æ‰¿æµç¨‹ï¼Œè€Œé€šè¿‡IntegrationFlowså’ŒIntegrationFlowBuilderæ¥å®[m
[31m-ç°ä½¿ç”¨Fluent APIæ¥å®šä¹‰æµç¨‹ã€‚åœ¨Fluent APIé‡Œï¼Œåˆ†åˆ«æä¾›äº†ä¸‹[m
[31m-é¢æ–¹æ³•æ¥æ˜ å°„Spring Integrationçš„ç«¯ç‚¹ï¼ˆEndPointï¼‰ã€‚[m
[31m-[m
[31m-       transform() -> Transformer[m
[31m-       filter() -> Filter[m
[31m-       handle() -> ServiceActivatorã€Adapterã€Gateway[m
[31m-       split() -> Splitter[m
[31m-       aggregate() -> Aggregator[m
[31m-       route() -> Router[m
[31m-       bridge() -> Bridge[m
[31m-[m
[31m-     ä¸€ä¸ªç®€å•çš„æµç¨‹å®šä¹‰å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-              @Bean[m
[31m-              public IntegrationFlow demoFlow() {[m
[31m-[m
[31m-                                      return IntegrationFlows.from("input") //ä»[m
[31m-       Channel inputè·å–æ¶ˆæ¯[m
[31m-[m
[31m-                                                                                                                    .[m
[31m-       <String, Integer>transform(Integer::parseInt) //å°†æ¶ˆæ¯è½¬æ¢æˆæ•´[m
[31m-       æ•°[m
[31m-[m
[31m-                                           .get(); //è·å¾—é›†æˆæµç¨‹å¹¶æ³¨å†Œä¸ºBean[m
[31m-              }[m
[31m-[m
[31m-9.4.6ã€€å®æˆ˜[m
[31m-[m
[31m-     æœ¬ç« å°†æ¼”ç¤ºè¯»å–https://spring.io/blog.atomçš„æ–°é—»èšåˆæ–‡[m
[31m-ä»¶ï¼Œatomæ˜¯ä¸€ç§xmlæ–‡ä»¶ï¼Œä¸”æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       <?xml version="1.0" encoding="UTF-8"?>[m
[31m-       <feed xmlns="http://www.w3.org/2005/Atom">[m
[31m-[m
[31m-           <title>Spring</title>[m
[31m-           <link rel="alternate" href="https://spring.io/blog" />[m
[31m-           <link rel="self" href="https://spring.io/blog.atom" />[m
[31m-           <id>http://spring.io/blog.atom</id>[m
[31m-           <icon>https://spring.io/favicon.ico</icon>[m
[31m-           <updated>2015-07-29T14:46:00Z</updated>[m
[31m-           <entry>[m
[31m-[m
[31m-                      <title>Spring Cloud Connectors 1.2.0 released</title>[m
[31m-                      <link rel="alternate" href="http://..." />[m
[31m-                      <category term="releases" label="Releases" />[m
[31m-                      <author>[m
[31m-[m
[31m-                         <name>some author[m
[31m-[m
[31m-       </name>[m
[31m-                      </author>[m
[31m-                      <id>tag:spring.io,2015-07-27:2196</id>[m
[31m-                      <updated>2015-07-29T14:46:00Z</updated>[m
[31m-                      <content type="html">...</content>[m
[31m-[m
[31m-           </entry>[m
[31m-       </feed>[m
[31m-[m
[31m-     æˆ‘ä»¬å°†è¯»å–åˆ°åˆ°æ¶ˆæ¯é€šè¿‡åˆ†ç±»ï¼ˆCategoryï¼‰ï¼Œå°†æ¶ˆæ¯è½¬åˆ°[m
[31m-ä¸åŒçš„æ¶ˆæ¯é€šé“ï¼Œå°†åˆ†ç±»ä¸ºreleaseså’Œengineeringçš„æ¶ˆæ¯å†™å…¥ç£[m
[31m-ç›˜æ–‡ä»¶ï¼Œå°†åˆ†ç±»ä¸ºnewsçš„æ¶ˆæ¯é€šè¿‡é‚®ä»¶å‘é€ã€‚[m
[31m-[m
[31m-     1.æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºIntegrationï¼ˆspring-boot-[m
[31m-starter-integrationï¼‰å’Œmailï¼ˆspring-boot-starter-mailï¼‰ã€‚[m
[31m-[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-       groupIdï¼šcom.wisely[m
[31m-       arctifactId:ch9_4[m
[31m-       package: com.wisely.ch9_4[m
[31m-[m
[31m-     å¦å¤–ï¼Œæˆ‘ä»¬è¿˜è¦æ·»åŠ Spring Integrationå¯¹atomåŠmailçš„æ”¯[m
[31m-æŒã€‚[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.integration</groupId>[m
[31m-                                                             <artifactId>spring-integration-[m
[31m-[m
[31m-       feed</artifactId>[m
[31m-                      </dependency>[m
[31m-[m
[31m-                             <dependency>[m
[31m-                             <groupId>org.springframework.integration</groupId>[m
[31m-[m
[31m-                                                             <artifactId>spring-integration-[m
[31m-       mail</artifactId>[m
[31m-[m
[31m-                      </dependency>[m
[31m-[m
[31m-     æœ¬ä¾‹çš„æ‰€æœ‰ä»£ç éƒ½åœ¨å…¥å£ç±»ä¸­å®Œæˆã€‚[m
[31m-[m
[31m-     2.è¯»å–æµç¨‹[m
[31m-[m
[31m-                @Value("https://spring.io/blog.atom") // 1[m
[31m-              Resource resource;[m
[31m-[m
[31m-              @Bean(name = PollerMetadata.DEFAULT_POLLER)[m
[31m-              public PollerMetadata poller() { // 2[m
[31m-[m
[31m-                      return Pollers.fixedRate(500).get();[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              public FeedEntryMessageSource feedMessageSource() throws IOExceptio[m
[31m-[m
[31m-                      FeedEntryMessageSource messageSource = new FeedEntryMessageSour[m
[31m-                      return messageSource;[m
[31m-              }[m
[31m-[m
[31m-              @Bean[m
[31m-              public IntegrationFlow myFlow() throws IOException {[m
[31m-[m
[31m-                      return IntegrationFlows.from(feedMessageSource()) //4[m
[31m-                                                  .<SyndEntry, String> route(payload -[m
[31m-[m
[31m-       > payload.getCategories().get(0).getName(),//5[m
[31m-                                                                                                   mapping -[m
[31m-[m
[31m-       > mapping.channelMapping("releases", "releasesChannel") //6[m
[31m-                                                                 .channelMapping("engineering", "enginee[m
[31m-                                                                 .channelMapping("news", "newsChannel"))[m
[31m-                      .get(); // 7[m
[31m-              }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é€šè¿‡@valueæ³¨è§£è‡ªåŠ¨è·å¾—https://spring.io/blog.atomçš„èµ„[m
[31m-æºã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨Fluent APIå’ŒPollersé…ç½®é»˜è®¤çš„è½®è¯¢æ–¹å¼ã€‚[m
[31m-[m
[31m-     â‘¢FeedEntryMessageSourceå®é™…ä¸ºfeedï¼šinbound-channel-[m
[31m-adapterï¼Œæ­¤å¤„å³æ„é€ feedçš„å…¥ç«™é€šé“é€‚é…å™¨ä½œä¸ºæ•°æ®è¾“å…¥ã€‚[m
[31m-[m
[31m-     â‘£æµç¨‹ä»fromæ–¹æ³•å¼€å§‹ã€‚[m
[31m-[m
[31m-     â‘¤é€šè¿‡è·¯ç”±æ–¹æ³•routeæ¥é€‰æ‹©è·¯ç”±ï¼Œæ¶ˆæ¯ä½“ï¼ˆpayloadï¼‰çš„ç±»[m
[31m-å‹ä¸ºSyndEntryï¼Œä½œä¸ºåˆ¤æ–­æ¡ä»¶çš„ç±»å‹ä¸ºStringï¼Œåˆ¤æ–­çš„å€¼æ˜¯é€š[m
[31m-è¿‡payloadè·å¾—çš„åˆ†ç±»ï¼ˆCategroyï¼‰ï¼›[m
[31m-[m
[31m-     â‘¥é€šè¿‡ä¸åŒåˆ†ç±»çš„å€¼è½¬å‘ä¸åŒçš„æ¶ˆæ¯é€šé“ï¼Œè‹¥åˆ†ç±»ä¸º[m
[31m-releasesï¼Œåˆ™è½¬å‘releasesChannelï¼›è‹¥åˆ†ç±»ä¸ºengineeringï¼Œåˆ™è½¬[m
[31m-å‘engineeringChannelï¼›è‹¥åˆ†ç±»ä¸ºnewsï¼Œåˆ™è½¬å‘newsChannelã€‚[m
[31m-[m
[31m-     â‘¦é€šè¿‡getæ–¹æ³•è·å¾—IntegrationFlowå®ä½“ï¼Œé…ç½®ä¸ºSpringçš„[m
[31m-Beanã€‚[m
[31m-[m
[31m-     3.releasesæµç¨‹[m
[31m-[m
[31m-              @Bean[m
[31m-              public IntegrationFlow releasesFlow() {[m
[31m-[m
[31m-                      return IntegrationFlows.from(MessageChannels.queue("releasesCha[m
[31m-                                    .<SyndEntry, String> transform([m
[31m-                                                                                                   payload -[m
[31m-[m
[31m-       > "ã€Š" + payload.getTitle() + "ã€‹ " + payload.getLink() + getProperty("l[m
[31m-                                    .handle(Files.outboundAdapter(new File("e:/ springblog"[m
[31m-                                                   .fileExistsMode(FileExistsMode.APPEND)[m
[31m-                                                   .charset("UTF-8")[m
[31m-                                                                  .fileNameGenerator(message -[m
[31m-[m
[31m-       > "releases.txt")[m
[31m-                                                   .get())[m
[31m-[m
[31m-                                    .get();[m
[31m-              }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä»æ¶ˆæ¯é€šé“releasesChannelå¼€å§‹è·å–æ•°æ®ã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨transformæ–¹æ³•è¿›è¡Œæ•°æ®è½¬æ¢ã€‚payloadç±»å‹ä¸º[m
[31m-SyndEntryï¼Œå°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå¹¶è‡ªå®šä¹‰æ•°æ®çš„æ ¼å¼ã€‚[m
[31m-[m
[31m-     â‘¢ç”¨handleæ–¹æ³•å¤„ç†fileçš„å‡ºç«™é€‚é…å™¨ã€‚Filesç±»æ˜¯ç”±Spring[m
[31m-Integration Java DSLæä¾›çš„Fluent APIç”¨æ¥æ„é€ æ–‡ä»¶è¾“å‡ºçš„é€‚é…[m
[31m-å™¨ã€‚[m
[31m-[m
[31m-     4.engineeringæµç¨‹[m
[31m-[m
[31m-              @Bean[m
[31m-              public IntegrationFlow engineeringFlow() {[m
[31m-[m
[31m-                      return IntegrationFlows.from(MessageChannels.queue("engineering[m
[31m-                                    .<SyndEntry, String> transform([m
[31m-                                                                                                              e-[m
[31m-[m
[31m-       > "ã€Š" + e.getTitle() + "ã€‹ " + e.getLink() + getProperty("line.separato[m
[31m-                                    .handle(Files.outboundAdapter(new File("e:/springblog")[m
[31m-                                                   .fileExistsMode(FileExistsMode.APPEND)[m
[31m-                                                   .charset("UTF-8")[m
[31m-                                                                  .fileNameGenerator(message -[m
[31m-[m
[31m-       > "engineering.txt")[m
[31m-                                                   .get())[m
[31m-[m
[31m-                                    .get();[m
[31m-              }[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     ä¸releasesæµç¨‹ç›¸åŒã€‚[m
[31m-[m
[31m-     5.newsæµç¨‹[m
[31m-[m
[31m-       @Bean[m
[31m-              public IntegrationFlow newsFlow() {[m
[31m-                      return IntegrationFlows.from(MessageChannels.queue("newsChannel[m
[31m-                                    .<SyndEntry, String> transform([m
[31m-                                                                                                   payload -[m
[31m-[m
[31m-       > "ã€Š" + payload.getTitle() + "ã€‹ " + payload.getLink() + getProperty("l[m
[31m-                                    .enrichHeaders( //1[m
[31m-                                                   Mail.headers()[m
[31m-                                                   .subject("æ¥è‡ªSpringçš„æ–°é—»")[m
[31m-                                                   .to("wisely-man@126.com")[m
[31m-                                                   .from("wisely-man@126.com"))[m
[31m-                                    .handle(Mail.outboundAdapter("smtp.126.com") //2[m
[31m-                                                   .port(25)[m
[31m-                                                   .protocol("smtp")[m
[31m-                                                                               .credentials("wisely-[m
[31m-[m
[31m-       man@126.com", "******")[m
[31m-                                                                           .javaMailProperties(p -[m
[31m-[m
[31m-       > p.put("mail.debug", "false")), e -> e.id("smtpOut"))[m
[31m-                                    .get();[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é€šè¿‡enricherHeaderæ¥å¢åŠ æ¶ˆæ¯å¤´çš„ä¿¡æ¯ã€‚[m
[31m-[m
[31m-     â‘¡é‚®ä»¶å‘é€çš„ç›¸å…³ä¿¡æ¯é€šè¿‡Spring Integration Java DSLæ[m
[31m-ä¾›çš„Mailçš„headersæ–¹æ³•æ¥æ„é€ ã€‚[m
[31m-[m
[31m-     â‘¢ä½¿ç”¨handleæ–¹æ³•æ¥å®šä¹‰é‚®ä»¶å‘é€çš„å‡ºç«™é€‚é…å™¨ï¼Œä½¿ç”¨[m
[31m-Spring Integration Java DSLæä¾›çš„Mail.outboundAdapteræ¥æ„[m
[31m-é€ ï¼Œè¿™é‡Œä½¿ç”¨wisely-man@126.comé‚®ç®±å‘è‡ªå·±å‘é€é‚®ä»¶ã€‚[m
[31m-     6.è¿è¡Œ[m
[31m-     ï¼ˆ1ï¼‰å†™æ–‡ä»¶ç»“æœ[m
[31m-     æŸ¥çœ‹Eï¼š\springblogç›®å½•ï¼Œå‘ç°å¤šäº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚å›¾9-22æ‰€[m
[31m-ç¤ºã€‚[m
[31m-[m
[31m-                                å›¾9-22ã€€springblagç›®å½•[m
[31m-[m
[31m-     engineering.txtæ–‡ä»¶å†…å®¹å¦‚å›¾9-23æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                          å›¾9-23ã€€engineering.txtæ–‡ä»¶å†…å®¹[m
[31m-[m
[31m-     releases.txtæ–‡ä»¶å†…å®¹å¦‚å›¾9-24æ‰€ç¤ºã€‚[m
[31m-                      å›¾9-24ã€€releases.txtæ–‡ä»¶å†…å®¹[m
[31m-[m
[31m-ï¼ˆ2ï¼‰é‚®ç®±æ¥æ”¶ç»“æœ[m
[31m-ç™»å½•é‚®ç®±å¯ä»¥çœ‹åˆ°åˆšæ‰å‘é€çš„é‚®ä»¶ï¼Œå¦‚å›¾9-25æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                        å›¾9-25ã€€åˆšæ‰å‘é€çš„é‚®ä»¶[m
[31m-ç¬¬10ç« ã€€Spring Bootå¼€å‘éƒ¨ç½²ä¸æµ‹è¯•[m
[31m-[m
[31m-10.1ã€€å¼€å‘çš„çƒ­éƒ¨ç½²[m
[31m-[m
[31m-10.1.1ã€€æ¨¡æ¿çƒ­éƒ¨ç½²[m
[31m-[m
[31m-     åœ¨Spring Booté‡Œï¼Œæ¨¡æ¿å¼•æ“çš„é¡µé¢é»˜è®¤æ˜¯å¼€å¯ç¼“å­˜çš„ï¼Œå¦‚[m
[31m-æœä¿®æ”¹äº†é¡µé¢çš„å†…å®¹ï¼Œåˆ™åˆ·æ–°é¡µé¢æ˜¯å¾—ä¸åˆ°ä¿®æ”¹åçš„é¡µé¢çš„å› [m
[31m-æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨application.propertiesä¸­å…³é—­æ¨¡æ¿å¼•æ“çš„ç¼“å­˜ï¼Œ[m
[31m-ä¾‹å¦‚ï¼š[m
[31m-[m
[31m-     Thymeleafçš„é…ç½®ï¼š[m
[31m-[m
[31m-       spring.thymeleaf.cache=false[m
[31m-[m
[31m-     FreeMarkerçš„é…ç½®ï¼š[m
[31m-[m
[31m-       spring.freemarker.cache=false[m
[31m-[m
[31m-     Groovyçš„é…ç½®ï¼š[m
[31m-[m
[31m-       spring.groovy.template.cache=false[m
[31m-     Velocityçš„é…ç½®ï¼š[m
[31m-[m
[31m-       spring.velocity.cache=false[m
[31m-[m
[31m-10.1.2ã€€Spring Loaded[m
[31m-[m
[31m-     Spring Loadedå¯å®ç°ä¿®æ”¹ç±»æ–‡ä»¶çš„çƒ­éƒ¨ç½²ã€‚ä¸‹è½½Spring[m
[31m-Loadedï¼Œåœ°å€ä¸ºï¼šhttp://repo.spring.io/simple/libs-release-[m
[31m-local/org/springframework/springloaded/1.2.3.RELEASE/springloaded-[m
[31m-1.2.3.RELEASE.jarï¼Œå®‰è£…å•å‡»Run Config urationsâ€¦ã€‚å¦‚å›¾10-1[m
[31m-æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                          å›¾10-1ã€€å•å‡»RunConfigurations[m
[31m-[m
[31m-     åœ¨Argumentsæ ‡ç­¾é¡µçš„vm argumentsä¸­å¡«å…¥å¦‚ä¸‹å†…å®¹ï¼Œæ³¨æ„[m
[31m-ä¸‹é¢æŒ‡å®šçš„springloadedçš„è·¯å¾„ï¼š[m
[31m-[m
[31m-       -javaagent:E:\springloaded-1.2.3.RELEASE.jar -noverify[m
[31m-     é¡µé¢æˆªå›¾å¦‚å›¾10-2æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              å›¾10-2ã€€Argumentsæ ‡ç­¾é¡µ[m
[31m-[m
[31m-10.1.3ã€€JRebel[m
[31m-[m
[31m-     JRebelæ˜¯Javaå¼€å‘çƒ­éƒ¨ç½²çš„æœ€ä½³å·¥å…·ï¼Œå…¶å¯¹Spring Bootä¹Ÿæ[m
[31m-ä¾›äº†æä½³çš„æ”¯æŒã€‚JRebelä¸ºæ”¶è´¹è½¯ä»¶ï¼Œå¯è¯•ç”¨14å¤©ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰å®‰è£…[m
[31m-     æ‰“å¼€EclipseMarketPlaceï¼Œå¦‚å›¾10-3æ‰€ç¤ºã€‚[m
[31m-                   å›¾10-3ã€€æ‰“å¼€Eclipse Marketplace[m
[31m-[m
[31m-æ£€ç´¢JRebelï¼Œå¹¶å®‰è£…ï¼Œå¦‚å›¾10-4æ‰€ç¤ºã€‚[m
[31m-                            å›¾10-4ã€€å®‰è£…JRebel[m
[31m-[m
[31m-é‡å¯STSï¼Œå³å¯å®Œæˆå®‰è£…ã€‚[m
[31m-ï¼ˆ2ï¼‰é…ç½®ä½¿ç”¨[m
[31m-æ³¨å†Œè¯•ç”¨ï¼Œå¦‚å›¾10-5æ‰€ç¤ºã€‚[m
[31m-                                å›¾10-5ã€€æ³¨å†Œ[m
[31m-[m
[31m-é€‰å®šSpring Bootï¼Œå¢åŠ JRebelåŠŸèƒ½ï¼Œå¦‚å›¾10-6æ‰€ç¤ºã€‚[m
[31m-                               å›¾10-6ã€€å¢åŠ JRebelåŠŸèƒ½[m
[31m-[m
[31m-     æ­¤æ—¶ä¸ºæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªrebel.xmlï¼Œç”¨æ¥é…ç½®çƒ­éƒ¨ç½²å†…å®¹ï¼Œ[m
[31m-å¦‚å›¾10-7æ‰€ç¤ºã€‚[m
[31m-                               å›¾10-7ã€€å¢åŠ çš„rebcl.xml[m
[31m-[m
[31m-     JRebelä¼šå¯¹Dï¼š/workspace-sts-[m
[31m-3.7.0.RELEASE/ch10/target/classesç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡Œçƒ­éƒ¨ç½²ï¼Œ[m
[31m-å¦‚å›¾10-8æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾10-8ã€€å¯¹æ–‡ä»¶è¿›è¡Œçƒ­éƒ¨ç½²[m
[31m-[m
[31m-     é¦–æ¬¡å¯åŠ¨ä¼šè¯¢é—®æ˜¯å¦ä»¥JRebelå¯åŠ¨ç¨‹åºï¼Œå¦‚å›¾10-9æ‰€ç¤ºã€‚[m
[31m-                       å›¾10-9ã€€è¯¢é—®æ˜¯å¦ä»¥JRebelå¯åŠ¨ç¨‹åº[m
[31m-[m
[31m-     å½“å¯åŠ¨æ—¶å‡ºç°å’ŒJRebelç›¸å…³çš„ä¿¡æ¯ï¼Œè¡¨æ˜é…ç½®æˆåŠŸï¼Œå¦‚å›¾[m
[31m-10-10æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                  å›¾10-10ã€€å¯åŠ¨æˆåŠŸ[m
[31m-[m
[31m-10.1.4ã€€spring-boot-devtools[m
[31m-[m
[31m-     åœ¨Spring Booté¡¹ç›®ä¸­æ·»åŠ spring-boot-devtoolsä¾èµ–å³å¯å®ç°[m
[31m-é¡µé¢ï¼Œå³ä»£ç çš„çƒ­éƒ¨ç½²ã€‚[m
[31m-[m
[31m-                  <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                             <artifactId>spring-boot-devtools</artifactId>[m
[31m-[m
[31m-                      </dependency>[m
[31m-10.2ã€€å¸¸è§„éƒ¨ç½²[m
[31m-[m
[31m-10.2.1ã€€jarå½¢å¼[m
[31m-[m
[31m-1.æ‰“åŒ…[m
[31m-[m
[31m-è‹¥æˆ‘ä»¬åœ¨æ–°å»ºSpring  Booté¡¹ç›®çš„æ—¶å€™ï¼Œé€‰æ‹©æ‰“åŒ…æ–¹å¼[m
[31m-[m
[31m-ï¼ˆPackagingï¼‰æ˜¯jarï¼Œåˆ™æˆ‘ä»¬åªéœ€ç”¨ï¼š[m
[31m-[m
[31m-mvn pakage[m
[31m-[m
[31m-å¦‚å›¾10-11æ‰€ç¤ºã€‚[m
[31m-                        å›¾10-11ã€€è¿è¡Œmvn pakage[m
[31m-[m
[31m-2.è¿è¡Œ[m
[31m-å¯ç›´æ¥ä½¿ç”¨ä¸‹é¢å‘½ä»¤è¿è¡Œï¼Œç»“æœå¦‚å›¾10-12æ‰€ç¤ºã€‚[m
[31m-[m
[31m-java -jar xx.jar[m
[31m-                          å›¾10-12ã€€è¿è¡Œjava-jar xx.jarå‘½ä»¤[m
[31m-[m
[31m-     3.æ³¨å†Œä¸ºLinuxçš„æœåŠ¡[m
[31m-[m
[31m-     Linuxä¸‹è¿è¡Œçš„è½¯ä»¶æˆ‘ä»¬é€šå¸¸æŠŠå®ƒæ³¨å†Œä¸ºæœåŠ¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±[m
[31m-å¯ä»¥é€šè¿‡å‘½ä»¤å¼€å¯ã€å…³é—­ä»¥åŠä¿æŒå¼€æœºå¯åŠ¨ç­‰åŠŸèƒ½ã€‚[m
[31m-[m
[31m-     è‹¥æƒ³ä½¿ç”¨æ­¤é¡¹åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€å°†ä»£ç ä¸­å…³äºspring-boot-[m
[31m-maven-pluginçš„é…ç½®ä¿®æ”¹ä¸ºï¼š[m
[31m-[m
[31m-              <build>[m
[31m-                      <plugins>[m
[31m-                             <plugin>[m
[31m-                                    <groupId>org.springframework.boot</groupId>[m
[31m-                                                               <artifactId>spring-boot-maven-[m
[31m-[m
[31m-       plugin</artifactId>[m
[31m-                                    <configuration>[m
[31m-                                           <executable>true</executable>[m
[31m-                                    </configuration>[m
[31m-[m
[31m-                             </plugin>[m
[31m-                      </plugins>[m
[31m-              </build>[m
[31m-     ç„¶åä½¿ç”¨mvn packageæ‰“åŒ…ã€‚[m
[31m-[m
[31m-     ä¸»æµçš„Linuxå¤§å¤šä½¿ç”¨init.dæˆ–systemdæ¥æ³¨å†ŒæœåŠ¡ã€‚ä¸‹é¢ä»¥[m
[31m-CentOS 6.6æ¼”ç¤ºinit.dæ³¨å†ŒæœåŠ¡ï¼›ä»¥CentOS 7.1æ¼”ç¤ºsystemdæ³¨å†Œ[m
[31m-æœåŠ¡ã€‚æ“ä½œç³»ç»Ÿå¯é€‰æ‹©ä½¿ç”¨VirtualBoxå®‰è£…æˆ–è€…ç›´æ¥å®‰è£…åœ¨æœº[m
[31m-å™¨ä¸Šã€‚[m
[31m-[m
[31m-     ç”¨SSHå®¢æˆ·ç«¯å°†jaråŒ…ä¸Šä¼ åˆ°CentOSçš„/var/appsä¸‹ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰å®‰è£…JDK[m
[31m-[m
[31m-     ä»Oracleå®˜ç½‘ä¸‹è½½JDKï¼Œæ³¨æ„é€‰æ‹©çš„æ˜¯ï¼šjdk-8u51-linux-[m
[31m-x64.rpmã€‚è¿™æ˜¯çº¢å¸½ç³»Linuxç³»ç»Ÿä¸“ç”¨å®‰è£…åŒ…æ ¼å¼ï¼Œå°†JDKä¸‹è½½[m
[31m-æ”¾ç½®åˆ°Linuxä¸‹ä»»æ„ç›®å½•ã€‚[m
[31m-[m
[31m-     æ‰§è¡Œä¸‹é¢å‘½ä»¤å®‰è£…JDKï¼š[m
[31m-[m
[31m-       rpm -ivh jdk-8u51-linux-x64.rpm[m
[31m-[m
[31m-ï¼ˆ2ï¼‰åŸºäºLinuxçš„init.déƒ¨ç½²[m
[31m-æ³¨å†ŒæœåŠ¡ï¼Œåœ¨CentOS 6.6çš„ç»ˆç«¯æ‰§è¡Œï¼š[m
[31m-[m
[31m-sudo ln -s                     /var/apps/ch10-0.0.1-[m
[31m-SNAPSHOT.jar /etc/init.d/ch10[m
[31m-[m
[31m-å…¶ä¸­ch10å°±æ˜¯æˆ‘ä»¬çš„æœåŠ¡åã€‚[m
[31m-å¯åŠ¨æœåŠ¡ï¼š[m
[31m-[m
[31m-service ch10 start[m
[31m-åœæ­¢æœåŠ¡ï¼š[m
[31m-[m
[31m-service ch10 stop[m
[31m-[m
[31m-æœåŠ¡çŠ¶æ€ï¼š[m
[31m-[m
[31m-service ch10 status[m
[31m-[m
[31m-å¼€æœºå¯åŠ¨ï¼š[m
[31m-[m
[31m-chkconfig ch10 on[m
[31m-[m
[31m-     é¡¹ç›®æ—¥å¿—å­˜æ”¾äº/var/log/ch10.logä¸‹ï¼Œå¯ç”¨catæˆ–tailç­‰å‘½ä»¤æŸ¥[m
[31m-çœ‹ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰åŸºäºLinuxçš„Systemdéƒ¨ç½²[m
[31m-[m
[31m-     åœ¨/etc/systemd/system/ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ch10.serviceï¼Œå¡«å…¥ä¸‹[m
[31m-é¢å†…å®¹ï¼š[m
[31m-[m
[31m-[Unit]                      -jar  /var/apps/ch10-0.0.1-[m
[31m-Description=ch10[m
[31m-After=syslog.target[m
[31m-[m
[31m-[Service][m
[31m-ExecStart= /usr/bin/java[m
[31m-SNAPSHOT.jar[m
[31m-[m
[31m-[Install][m
[31m-WantedBy=multi-user.target[m
[31m-     æ³¨æ„ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ä¿®æ”¹Descriptionå’ŒExecStartåé¢çš„å†…[m
[31m-å®¹ã€‚[m
[31m-[m
[31m-     å¯åŠ¨æœåŠ¡ï¼š[m
[31m-[m
[31m-       systemctl start ch10[m
[31m-       æˆ–systemctl start ch10.service[m
[31m-[m
[31m-     åœæ­¢æœåŠ¡ï¼š[m
[31m-[m
[31m-       systemctl stop ch10[m
[31m-       æˆ–systemctl stop ch10.service[m
[31m-[m
[31m-     æœåŠ¡çŠ¶æ€ï¼š[m
[31m-[m
[31m-       systemctl status ch10[m
[31m-       æˆ–systemctl status ch10.service[m
[31m-[m
[31m-     å¼€æœºå¯åŠ¨ï¼š[m
[31m-[m
[31m-       systemctl enable ch10[m
[31m-       æˆ–systemctl enbale ch10.service[m
[31m-[m
[31m-     é¡¹ç›®æ—¥å¿—ï¼š[m
[31m-[m
[31m-       journalctl -u ch10[m
[31m-       æˆ–journalctl -u ch10.service[m
[31m-10.2.2ã€€warå½¢å¼[m
[31m-[m
[31m-     1.æ‰“åŒ…æ–¹å¼ä¸ºwaræ—¶[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®æ—¶å¯é€‰æ‹©æ‰“åŒ…æ–¹å¼ï¼ˆPackagingï¼‰æ˜¯[m
[31m-warå½¢å¼ï¼Œå¦‚å›¾10-13æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                           å›¾10-13ã€€é€‰æ‹©æ‰“åŒ…æ–¹å¼ä¸ºwar[m
[31m-[m
[31m-     æ‰“åŒ…çš„æ–¹å¼å’ŒjaråŒ…ä¸€è‡´ï¼Œæ‰§è¡Œï¼š[m
[31m-[m
[31m-       mvn package[m
[31m-[m
[31m-     ç»“æœå¦‚å›¾10-14æ‰€ç¤ºã€‚[m
[31m-                                  å›¾10-14ã€€æ‰“åŒ…ç»“æœ[m
[31m-[m
[31m-     æœ€åç”Ÿæˆçš„waræ–‡ä»¶å¯ä»¥æ”¾åœ¨ä½ å–œæ¬¢çš„Servletå®¹å™¨ä¸Šè¿è¡Œã€‚[m
[31m-     2.æ‰“åŒ…æ–¹å¼ä¸ºjaræ—¶[m
[31m-     è‹¥æˆ‘ä»¬æ–°å»ºSpring Booté¡¹ç›®æ—¶é€‰æ‹©æ‰“åŒ…æ–¹å¼é€‰æ‹©çš„æ˜¯jarï¼Œ[m
[31m-éƒ¨ç½²æ—¶æˆ‘ä»¬åˆæƒ³è¦ç”¨waråŒ…å½¢å¼éƒ¨ç½²ï¼Œé‚£ä¹ˆæ€ä¹ˆå°†jarå½¢å¼è½¬æ¢[m
[31m-æˆwarå½¢å¼å‘¢ï¼Ÿå½“ç„¶éœ€æ±‚åè¿‡æ¥ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚[m
[31m-     æˆ‘ä»¬æ¯”è¾ƒä¸‹jaræ‰“åŒ…å’Œwaræ‰“åŒ…é¡¹ç›®æ–‡ä»¶çš„ä¸åŒä¹‹å¤„ï¼Œå³å¯[m
[31m-çŸ¥åšå¦‚ä¸‹ä¿®æ”¹å¯å°†jaræ‰“åŒ…æ–¹å¼è½¬æ¢æˆwaræ‰“åŒ…æ–¹å¼ã€‚[m
[31m-     åœ¨pom.xmlæ–‡ä»¶ä¸­ï¼Œå°†[m
[31m-[m
[31m-       <packaging>jar</packaging>[m
[31m-[m
[31m-     ä¿®æ”¹ä¸º[m
[31m-[m
[31m-       <packaging>war</packaging>[m
[31m-[m
[31m-     å¢åŠ ä¸‹é¢ä¾èµ–è¦†ç›–é»˜è®¤å†…åµŒçš„Tomcatä¾èµ–ï¼š[m
[31m-[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       tomcat</artifactId>[m
[31m-                             <scope>provided</scope>[m
[31m-[m
[31m-                      </dependency>[m
[31m-[m
[31m-     å¢åŠ ServletInitializerç±»ï¼Œå†…å®¹å¦‚ä¸‹ï¼š[m
[31m-import org.springframework.boot.builder.SpringApplicationBuilder;[m
[31m-import org.springframework.boot.context.web.SpringBootServletInitialize[m
[31m-[m
[31m-public class ServletInitializer extends SpringBootServletInitializer {[m
[31m-[m
[31m-       @Override[m
[31m-       protected SpringApplicationBuilder configure(SpringApplicationBuild[m
[31m-[m
[31m-              return application.sources(Ch10warApplication.class);[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-10.3ã€€äº‘éƒ¨ç½²â€”â€”åŸºäºDockerçš„éƒ¨ç½²[m
[31m-[m
[31m-     æœ¬èŠ‚æˆ‘ä»¬å°†åœ¨CentOS 7.1ä¸Šæ¼”ç¤ºç”¨Dockeréƒ¨ç½²Spring Boot[m
[31m-ç¨‹åºã€‚å‰é¢æˆ‘ä»¬è®²è¿°äº†ä½¿ç”¨å·²ç»ç¼–è¯‘å¥½çš„Dockeré•œåƒï¼Œæœ¬èŠ‚æˆ‘[m
[31m-ä»¬å°†è®²è¿°å¦‚ä½•ç¼–è¯‘è‡ªå·±çš„Dockeré•œåƒï¼Œå¹¶è¿è¡Œé•œåƒçš„å®¹å™¨ã€‚[m
[31m-[m
[31m-     ä¸»æµçš„äº‘è®¡ç®—ï¼ˆPAASï¼‰å¹³å°éƒ½æ”¯æŒå‘å¸ƒDockeré•œåƒã€‚[m
[31m-Dockeræ˜¯ä½¿ç”¨Dokerfileæ–‡ä»¶æ¥ç¼–è¯‘è‡ªå·±çš„é•œåƒçš„ã€‚[m
[31m-[m
[31m-10.3.1ã€€Dockerfile[m
[31m-[m
[31m-     Dockerfileä¸»è¦æœ‰å¦‚ä¸‹çš„æŒ‡ä»¤ã€‚[m
[31m-     ï¼ˆ1ï¼‰FROMæŒ‡ä»¤[m
[31m-     FROMæŒ‡ä»¤æŒ‡æ˜äº†å½“å‰é•œåƒç»§æ‰¿çš„åŸºé•œåƒã€‚ç¼–è¯‘å½“å‰é•œåƒ[m
[31m-æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½åŸºé•œåƒã€‚[m
[31m-     ç¤ºä¾‹ï¼š[m
[31m-[m
[31m-       FROM ubuntu[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰MAINTAINERæŒ‡ä»¤[m
[31m-     MAINTAINERæŒ‡ä»¤æŒ‡æ˜äº†å½“å‰é•œåƒçš„ä½œè€…ã€‚[m
[31m-     ç¤ºä¾‹ï¼š[m
[31m-       MAINTAINER wyf[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰RUNæŒ‡ä»¤[m
[31m-     RUNæŒ‡ä»¤å¯ä»¥åœ¨å½“å‰é•œåƒä¸Šæ‰§è¡ŒLinuxå‘½ä»¤å¹¶å½¢æˆä¸€ä¸ªæ–°[m
[31m-çš„å±‚ã€‚RUNæ˜¯ç¼–è¯‘æ—¶ï¼ˆbuildï¼‰çš„åŠ¨ä½œã€‚[m
[31m-     ç¤ºä¾‹å¯æœ‰å¦‚ä¸‹ä¸¤ç§æ ¼å¼ï¼ŒCMDå’ŒENTRYPOINTä¹Ÿæ˜¯å¦‚[m
[31m-æ­¤ï¼š[m
[31m-[m
[31m-       RUN /bin/bash -c "echo helloworld"[m
[31m-       æˆ–RUN ["/bin/bash", "-c", "echo hello"][m
[31m-[m
[31m-     ï¼ˆ4ï¼‰CMDæŒ‡ä»¤[m
[31m-     CMDæŒ‡ä»¤æŒ‡æ˜äº†å¯åŠ¨é•œåƒå®¹å™¨æ—¶çš„é»˜è®¤è¡Œä¸ºã€‚ä¸€ä¸ª[m
[31m-Dockerfileé‡Œåªèƒ½æœ‰ä¸€ä¸ªCMDæŒ‡ä»¤ã€‚CMDæŒ‡ä»¤é‡Œè®¾å®šçš„å‘½ä»¤å¯[m
[31m-ä»¥åœ¨è¿è¡Œé•œåƒæ—¶ä½¿ç”¨å‚æ•°è¦†ç›–ã€‚CMDæ˜¯è¿è¡Œæ—¶ï¼ˆrunï¼‰çš„åŠ¨[m
[31m-ä½œã€‚[m
[31m-     ç¤ºä¾‹ï¼š[m
[31m-[m
[31m-       CMD echo "this is a test"[m
[31m-[m
[31m-     å¯è¢«docker run-d image_name echo"this is not a test"è¦†ç›–ã€‚[m
[31m-     ï¼ˆ5ï¼‰EXPOSEæŒ‡ä»¤[m
[31m-     EXPOSEæŒ‡æ˜äº†é•œåƒè¿è¡Œæ—¶çš„å®¹å™¨å¿…éœ€ç›‘å¬æŒ‡å®šçš„ç«¯å£ã€‚[m
[31m-     ç¤ºä¾‹ï¼š[m
[31m-[m
[31m-       EXPOSE 8080[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰ENVæŒ‡ä»¤[m
[31m-     ENVæŒ‡ä»¤å¯ç”¨æ¥è®¾ç½®ç¯å¢ƒå˜é‡ã€‚[m
[31m-     ç¤ºä¾‹ï¼š[m
[31m-[m
[31m-       ENV myName=wyf[m
[31m-       æˆ–ENV myName wyf[m
[31m-[m
[31m-     ï¼ˆ7ï¼‰ADDæŒ‡ä»¤[m
[31m-     ADDæŒ‡ä»¤æ˜¯ä»å½“å‰å·¥ä½œç›®å½•å¤åˆ¶æ–‡ä»¶åˆ°é•œåƒç›®å½•ä¸­å»ã€‚[m
[31m-     ç¤ºä¾‹ï¼š[m
[31m-[m
[31m-       ADD test.txt /mydir/[m
[31m-[m
[31m-     ï¼ˆ8ï¼‰ENTRYPOINTæŒ‡ä»¤[m
[31m-     ENTRYPOINTæŒ‡ä»¤å¯è®©å®¹å™¨åƒä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºä¸€æ ·è¿è¡Œï¼Œ[m
[31m-è¿™æ ·é•œåƒè¿è¡Œæ—¶å¯ä»¥åƒè½¯ä»¶ä¸€æ ·æ¥æ”¶å‚æ•°æ‰§è¡Œã€‚[m
[31m-ENTRYPOINTæ˜¯è¿è¡Œæ—¶ï¼ˆrunï¼‰çš„åŠ¨ä½œã€‚[m
[31m-     ç¤ºä¾‹ï¼š[m
[31m-       ENTRYPOINT ["/bin/echo"][m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥å‘é•œåƒä¼ é€’å‚æ•°è¿è¡Œï¼š[m
[31m-[m
[31m-       docker run -d image_name "this is not a test"[m
[31m-[m
[31m-10.3.2ã€€å®‰è£…Docker[m
[31m-[m
[31m-     é€šè¿‡ä¸‹é¢å‘½ä»¤å®‰è£…Dockerï¼š[m
[31m-[m
[31m-       yum install docker[m
[31m-[m
[31m-     å¯åŠ¨Dockerå¹¶ä¿æŒå¼€æœºè‡ªå¯ï¼š[m
[31m-[m
[31m-       systemctl start docker[m
[31m-       systemctl enable docker[m
[31m-[m
[31m-10.3.3ã€€é¡¹ç›®ç›®å½•åŠæ–‡ä»¶[m
[31m-[m
[31m-     æˆ‘ä»¬ä½¿ç”¨æºç çš„ch10dockeræ¥ä½œä¸ºæ¼”ç¤ºç”¨çš„Spring Booté¡¹[m
[31m-ç›®ï¼Œè¿™ä¸ªé¡¹ç›®å¾ˆç®€å•ï¼Œåªä¿®æ”¹äº†å…¥å£ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       @SpringBootApplication[m
[31m-       @RestController[m
[31m-       public class Ch10dockerApplication {[m
[31m-              @RequestMapping("/")[m
[31m-              public String home() {[m
[31m-                      return "Hello Docker!!";[m
[31m-              }[m
[31m-              public static void main(String[] args) {[m
[31m-                      SpringApplication.run(Ch10dockerApplication.class, args);[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     åœ¨CentOS 7.1ä¸Šçš„/var/apps/ch10dockerç›®å½•ä¸‹æ”¾å…¥æˆ‘ä»¬ç¼–è¯‘[m
[31m-å¥½çš„ch10dockerçš„jaråŒ…ï¼Œå¦‚ch10docker-0.0.1-SNAPSHOT.jarï¼Œ[m
[31m-åœ¨åŒçº§ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªDokcerfileæ–‡ä»¶ã€‚[m
[31m-[m
[31m-     æ–‡ä»¶ç›®å½•å¦‚å›¾10-15æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                  å›¾10-15ã€€æ–‡ä»¶ç›®å½•[m
[31m-[m
[31m-     Dockerfileæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       FROM java:8[m
[31m-       MAINTAINER wyf[m
[31m-       ADD ch10docker-0.0.1-SNAPSHOT.jar app.jar[m
[31m-       EXPOSE 8080[m
[31m-       ENTRYPOINT ["java","-jar","/app.jar"][m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ åŸºé•œåƒä¸ºJavaï¼Œæ ‡ç­¾ï¼ˆç‰ˆæœ¬ï¼‰ä¸º8ã€‚[m
[31m-     â‘¡ä½œè€…ä¸ºwyfã€‚[m
[31m-     â‘¢å°†æˆ‘ä»¬çš„ch10docker-0.0.1-SNAPSHOT.jaræ·»åŠ åˆ°é•œåƒ[m
[31m-ä¸­ï¼Œå¹¶é‡å‘½åä¸ºapp.jarã€‚[m
[31m-     â‘£è¿è¡Œé•œåƒçš„å®¹å™¨ï¼Œç›‘å¬8080ç«¯å£ã€‚[m
[31m-     â‘¤å¯åŠ¨æ—¶è¿è¡Œjava-jar app.jarã€‚[m
[31m-[m
[31m-10.3.4ã€€ç¼–è¯‘é•œåƒ[m
[31m-[m
[31m-     åœ¨/var/apps/ch10dockerç›®å½•ä¸‹æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼Œæ‰§è¡Œç¼–è¯‘é•œ[m
[31m-åƒï¼š[m
[31m-[m
[31m-       docker build -t wisely/ch10docker .[m
[31m-[m
[31m-     å…¶ä¸­ï¼Œwisely/ch10dockerä¸ºé•œåƒåç§°ï¼Œæˆ‘ä»¬è®¾ç½®wiselyä½œä¸º[m
[31m-å‰ç¼€ï¼Œè¿™ä¹Ÿæ˜¯Dockeré•œåƒçš„ä¸€ç§å‘½åä¹ æƒ¯ã€‚[m
[31m-[m
[31m-     æ³¨æ„ï¼Œæœ€åè¿˜æœ‰ä¸€ä¸ªâ€œ.â€ï¼Œè¿™æ˜¯ç”¨æ¥æŒ‡æ˜Dockerfileè·¯å¾„[m
[31m-çš„ï¼Œâ€œ.â€è¡¨ç¤ºDockerfileåœ¨å½“å‰è·¯å¾„ä¸‹ã€‚[m
[31m-[m
[31m-     ç¼–è¯‘çš„è¿‡ç¨‹å¦‚å›¾10-16æ‰€ç¤ºã€‚[m
[31m-                            å›¾10-16ã€€ç¼–è¯‘è¿‡ç¨‹[m
[31m-[m
[31m-è¿™æ—¶æˆ‘ä»¬æŸ¥çœ‹æœ¬åœ°é•œåƒï¼Œå¦‚å›¾10-17æ‰€ç¤ºã€‚[m
[31m-[m
[31m-           å›¾10-17ã€€æœ¬åœ°é•œåƒ[m
[31m-[m
[31m-10.3.5ã€€è¿è¡Œ[m
[31m-[m
[31m-é€šè¿‡ä¸‹é¢å‘½ä»¤è¿è¡Œï¼š[m
[31m-[m
[31m-docker run -d --name ch10 -p 8080:8080 wisely/ch10docker[m
[31m-[m
[31m-æŸ¥çœ‹æˆ‘ä»¬å½“å‰çš„å®¹å™¨çŠ¶æ€ï¼Œå¦‚å›¾10-18æ‰€ç¤ºã€‚[m
[31m-[m
[31m-           å›¾10-18ã€€å½“å‰å®¹å™¨çŠ¶æ€[m
[31m-     å½“å‰çš„CentOSç³»ç»Ÿçš„ipä¸º192.168.31.171ï¼Œè®¿é—®[m
[31m-http://192.168.31.171ï¼š8008ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚å›¾10-19æ‰€ç¤ºé¡µ[m
[31m-é¢ã€‚[m
[31m-10.4ã€€Spring Bootçš„æµ‹è¯•[m
[31m-[m
[31m-     Spring Bootçš„æµ‹è¯•å’ŒSpring MVCçš„æµ‹è¯•ç±»ä¼¼ã€‚Spring Boot[m
[31m-ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª@SpringApplicationConfigurationæ¥æ›¿ä»£[m
[31m-@ContextConfigurationï¼Œç”¨æ¥é…ç½®Application Contextã€‚[m
[31m-[m
[31m-     åœ¨Spring Bootä¸­ï¼Œæ¯æ¬¡æ–°å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œéƒ½ä¼šè‡ªåŠ¨åŠ ä¸Š[m
[31m-spring-boot-starter-testçš„ä¾èµ–ï¼Œè¿™æ ·æˆ‘ä»¬å°±æ²¡æœ‰å¿…è¦æµ‹è¯•æ—¶å†[m
[31m-æ·»åŠ é¢å¤–çš„jaråŒ…ã€‚[m
[31m-[m
[31m-Spring  Bootè¿˜ä¼šå»ºä¸€ä¸ªå½“å‰é¡¹ç›®çš„æµ‹è¯•ç±»ï¼Œä½äº[m
[31m-[m
[31m-src/test/javaçš„æ ¹åŒ…ä¸‹ã€‚[m
[31m-[m
[31m-     æœ¬èŠ‚æˆ‘ä»¬å°†ç›´æ¥æ¼”ç¤ºä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼Œæµ‹è¯•æŸä¸€ä¸ªæ§åˆ¶å™¨[m
[31m-æ–¹æ³•æ˜¯å¦æ»¡è¶³æµ‹è¯•ç”¨ä¾‹ã€‚[m
[31m-[m
[31m-10.4.1ã€€æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºJPAï¼ˆspring-boot-starter-data-[m
[31m-jpaï¼‰ã€Webï¼ˆspring-boot-starter-webï¼‰ã€hsqldbï¼ˆå†…å­˜æ•°æ®[m
[31m-åº“ï¼‰ã€‚[m
[31m-[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-groupIdï¼šcom.wisely[m
[31m-arctifactId:ch10_4[m
[31m-package: com.wisely.ch10_4[m
[31m-10.4.2ã€€ä¸šåŠ¡ä»£ç [m
[31m-[m
[31m-     å®ä½“ç±»ï¼š[m
[31m-[m
[31m-       package com.wisely.ch10_4.domain;[m
[31m-[m
[31m-       import javax.persistence.Entity;[m
[31m-       import javax.persistence.GeneratedValue;[m
[31m-       import javax.persistence.Id;[m
[31m-[m
[31m-       @Entity[m
[31m-       public class Person {[m
[31m-[m
[31m-              @Id[m
[31m-              @GeneratedValue[m
[31m-              private Long id;[m
[31m-              private String name;[m
[31m-[m
[31m-              public Person() {[m
[31m-                      super();[m
[31m-[m
[31m-              }[m
[31m-              public Person(String name) {[m
[31m-[m
[31m-                      super();[m
[31m-                      this.name = name;[m
[31m-              }[m
[31m-              public Long getId() {[m
[31m-                      return id;[m
[31m-              }[m
[31m-              public void setId(Long id) {[m
[31m-                      this.id = id;[m
[31m-              }[m
[31m-              public String getName() {[m
[31m-                      return name;[m
[31m-              }[m
[31m-              public void setName(String name) {[m
[31m-                      this.name = name;[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     æ•°æ®è®¿é—®ï¼š[m
[31m-       package com.wisely.ch10_4.dao;[m
[31m-       import org.springframework.data.jpa.repository.JpaRepository;[m
[31m-       import com.wisely.ch10_4.domain.Person;[m
[31m-       public interface PersonRepository extends JpaRepository<Person, Long> {[m
[31m-       }[m
[31m-[m
[31m-     æ§åˆ¶å™¨ï¼š[m
[31m-[m
[31m-       package com.wisely.ch10_4.web;[m
[31m-       import java.util.List;[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.http.MediaType;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RequestMethod;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-       import com.wisely.ch10_4.dao.PersonRepository;[m
[31m-       import com.wisely.ch10_4.domain.Person;[m
[31m-       @RestController[m
[31m-       @RequestMapping("/person")[m
[31m-       public class PersonController {[m
[31m-[m
[31m-              @Autowired[m
[31m-              PersonRepository personRepository;[m
[31m-              @RequestMapping(method = RequestMethod.GET,produces = {MediaType.AP[m
[31m-              public List<Person> findAll(){[m
[31m-[m
[31m-                      return personRepository.findAll();[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-10.4.3ã€€æµ‹è¯•ç”¨ä¾‹[m
[31m-package com.wisely.ch10_4;[m
[31m-[m
[31m-import org.junit.Assert;[m
[31m-import org.junit.Before;[m
[31m-import org.junit.Test;[m
[31m-import org.junit.runner.RunWith;[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.boot.test.SpringApplicationConfiguration;[m
[31m-import org.springframework.http.MediaType;[m
[31m-import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;[m
[31m-import org.springframework.test.context.web.WebAppConfiguration;[m
[31m-import org.springframework.test.web.servlet.MockMvc;[m
[31m-import org.springframework.test.web.servlet.MvcResult;[m
[31m-import org.springframework.test.web.servlet.request.MockMvcRequestBuild[m
[31m-import org.springframework.test.web.servlet.setup.MockMvcBuilders;[m
[31m-import org.springframework.transaction.annotation.Transactional;[m
[31m-import org.springframework.web.context.WebApplicationContext;[m
[31m-[m
[31m-import com.fasterxml.jackson.core.JsonProcessingException;[m
[31m-import com.fasterxml.jackson.databind.ObjectMapper;[m
[31m-import com.wisely.ch10_4.dao.PersonRepository;[m
[31m-import com.wisely.ch10_4.domain.Person;[m
[31m-[m
[31m-@RunWith(SpringJUnit4ClassRunner.class)[m
[31m-@SpringApplicationConfiguration(classes = Ch104Application.class) //1[m
[31m-@WebAppConfiguration[m
[31m-@Transactional //2[m
[31m-public class Ch104ApplicationTests {[m
[31m-[m
[31m-       @Autowired[m
[31m-       PersonRepository personRepository;[m
[31m-[m
[31m-       MockMvc mvc;[m
[31m-[m
[31m-       @Autowired[m
[31m-       WebApplicationContext webApplicationContext;[m
[31m-[m
[31m-       String expectedJson;[m
[31m-[m
[31m-       @Before //3[m
[31m-       public void setUp() throws JsonProcessingException{[m
[31m-[m
[31m-              Person p1 = new Person("wyf");[m
[31m-              Person p2 = new Person("wisely");[m
[31m-              personRepository.save(p1);[m
[31m-              personRepository.save(p2);[m
[31m-[m
[31m-              expectedJson =Obj2Json(personRepository.findAll()); //4[m
[31m-              mvc = MockMvcBuilders.webAppContextSetup(webApplicationContext)[m
[31m-       }[m
[31m-[m
[31m-       protected String Obj2Json(Object obj) throws JsonProcessingExceptio[m
[31m-              ObjectMapper mapper = new ObjectMapper();[m
[31m-              return mapper.writeValueAsString(obj);[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       @Test[m
[31m-       public void testPersonController() throws Exception {[m
[31m-[m
[31m-              String uri="/person";[m
[31m-              MvcResult result = mvc.perform(MockMvcRequestBuilders.get(uri).[m
[31m-[m
[31m-                                                                                                                    .andRet[m
[31m-              int status = result.getResponse().getStatus(); //7[m
[31m-              String content = result.getResponse().getContentAsString(); //8[m
[31m-[m
[31m-                                         Assert.assertEquals("é”™è¯¯ï¼Œæ­£ç¡®çš„è¿”å›å€¼ä¸º[m
[31m-200",200, status); //9[m
[31m-[m
[31m-                             Assert.assertEquals("é”™è¯¯ï¼Œè¿”å›å€¼å’Œé¢„æœŸè¿”å›å€¼ä¸ä¸€[m
[31m-è‡´", expectedJson,content); //10[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ ä½¿ç”¨@SpringApplicationConfigurationæ›¿ä»£[m
[31m-[m
[31m-@ContextConfigurationæ¥é…ç½®Spring  Bootçš„Application[m
[31m-[m
[31m-Contextã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨@Transactionalæ³¨è§£ï¼Œç¡®ä¿æ¯æ¬¡æµ‹è¯•åçš„æ•°æ®å°†ä¼šè¢«[m
[31m-å›æ»šã€‚[m
[31m-[m
[31m-     â‘¢ä½¿ç”¨Junitçš„@Beforeæ³¨è§£å¯åœ¨æµ‹è¯•å¼€å§‹å‰è¿›è¡Œä¸€äº›åˆå§‹[m
[31m-åŒ–çš„å·¥ä½œã€‚[m
[31m-[m
[31m-â‘£è·å¾—æœŸå¾…è¿”å›çš„JSONå­—ç¬¦ä¸²ã€‚[m
[31m-[m
[31m-â‘¤å°†å¯¹è±¡è½¬æ¢æˆJSONå­—ç¬¦ä¸²ã€‚[m
[31m-     â‘¥è·å¾—ä¸€ä¸ªrequestçš„æ‰§è¡Œç»“æœã€‚[m
[31m-     â‘¦è·å¾—requestæ‰§è¡Œç»“æœçš„çŠ¶æ€ã€‚[m
[31m-     â‘§è·å¾—requestæ‰§è¡Œç»“æœçš„å†…å®¹ã€‚[m
[31m-     â‘¨å°†é¢„æœŸçŠ¶æ€200å’Œå®é™…çŠ¶æ€æ¯”è¾ƒã€‚[m
[31m-     â‘©å°†é¢„æœŸå­—ç¬¦ä¸²å’Œè¿”å›å­—ç¬¦ä¸²æ¯”è¾ƒã€‚[m
[31m-[m
[31m-10.4.4ã€€æ‰§è¡Œæµ‹è¯•[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥ä½¿ç”¨mavenå‘½ä»¤æ‰§è¡Œæµ‹è¯•ï¼š[m
[31m-[m
[31m-       mvn clean package[m
[31m-[m
[31m-     ç»“æœå¦‚å›¾10-20æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                  å›¾10-20ã€€æµ‹è¯•ç»“æœ[m
[31m-[m
[31m-     æˆ‘ä»¬è¿˜å¯ä»¥åœ¨STSç›´æ¥ä½¿ç”¨Run Asâ†’JUnit Testï¼Œæ•ˆæœå¦‚å›¾[m
[31m-10-21æ‰€ç¤ºã€‚[m
[31m-å›¾10-21ã€€ç›´æ¥ä½¿ç”¨RunAsâ†’Junit Test[m
[31m-ç¬¬11ç« ã€€åº”ç”¨ç›‘æ§[m
[31m-[m
[31m-     Spring Bootæä¾›äº†è¿è¡Œæ—¶çš„åº”ç”¨ç›‘æ§å’Œç®¡ç†çš„åŠŸèƒ½ã€‚æˆ‘ä»¬[m
[31m-å¯ä»¥é€šè¿‡httpã€JMXã€SSHåè®®æ¥è¿›è¡Œæ“ä½œã€‚å®¡è®¡ã€å¥åº·åŠæŒ‡[m
[31m-æ ‡ä¿¡æ¯å°†ä¼šè‡ªåŠ¨å¾—åˆ°ã€‚[m
[31m-[m
[31m-     Spring Bootæä¾›äº†ç›‘æ§å’Œç®¡ç†ç«¯ç‚¹ï¼Œå¦‚è¡¨11-1æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                              è¡¨11-1ã€€ç›‘æ§å’Œç®¡ç†ç«¯ç‚¹[m
[31m-11.1ã€€http[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥é€šè¿‡httpå®ç°å¯¹åº”ç”¨çš„ç›‘æ§å’Œç®¡ç†ï¼Œæˆ‘ä»¬åªéœ€åœ¨[m
[31m-pom.xmlä¸­å¢åŠ ä¸‹é¢ä¾èµ–å³å¯ï¼š[m
[31m-[m
[31m-              <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       actuator</artifactId>[m
[31m-              </dependency>[m
[31m-[m
[31m-æ—¢ç„¶é€šè¿‡httpç›‘æ§å’Œç®¡ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„é¡¹ç›®ä¸­å¿…ç„¶éœ€è¦[m
[31m-[m
[31m-Webçš„ä¾èµ–ã€‚æœ¬èŠ‚éœ€æ–°å»ºSpring           Booté¡¹ç›®ï¼Œä¾èµ–é€‰æ‹©ä¸ºï¼š[m
[31m-[m
[31m-Actuatorã€Webã€HATEOASã€‚[m
[31m-[m
[31m-11.1.1ã€€æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºActuatorï¼ˆspring-boot-starter-[m
[31m-actuatorï¼‰ã€Webï¼ˆspring-boot-starter-webï¼‰ã€[m
[31m-HATEOASï¼ˆspring-hateoasï¼‰ã€‚[m
[31m-[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-groupIdï¼šcom.wisely[m
[31m-arctifactId:ch11_1[m
[31m-package: com.wisely. ch11_1[m
[31m-11.1.2ã€€æµ‹è¯•ç«¯ç‚¹[m
[31m-[m
[31m-     é¡¹ç›®å»ºç«‹å¥½ä¹‹åæˆ‘ä»¬å³å¯æµ‹è¯•å„ä¸ªç«¯ç‚¹ã€‚[m
[31m-     ï¼ˆ1ï¼‰actuator[m
[31m-     è®¿é—®http://localhostï¼š8080/actuatorï¼Œæ•ˆæœå¦‚å›¾11-1æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                 å›¾11-1ã€€è®¿é—®actuator[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰autoconfig[m
[31m-     è®¿é—®http://localhostï¼š8080/autoconfigï¼Œæ•ˆæœå¦‚å›¾11-2æ‰€ç¤ºã€‚[m
[31m-                         å›¾11-2ã€€è®¿é—®autoconfig[m
[31m-[m
[31m-ï¼ˆ3ï¼‰beans[m
[31m-è®¿é—®http://localhostï¼š8080/beansï¼Œæ•ˆæœå¦‚å›¾11-3æ‰€ç¤ºã€‚[m
[31m-[m
[31m-         å›¾11-3ã€€è®¿é—®beans[m
[31m-[m
[31m-ï¼ˆ4ï¼‰dump[m
[31m-     è®¿é—®http://localhostï¼š8080/dumpï¼Œæ•ˆæœå¦‚å›¾11-4æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                  å›¾11-4ã€€è®¿é—®beans[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰configprops[m
[31m-     è®¿é—®http://localhostï¼š8080/configpropsï¼Œæ•ˆæœå¦‚å›¾11-5æ‰€[m
[31m-ç¤ºã€‚[m
[31m-     ï¼ˆ6ï¼‰health[m
[31m-     è®¿é—®http://localhostï¼š8080/healthï¼Œæ•ˆæœå¦‚å›¾11-6æ‰€ç¤ºã€‚[m
[31m-     ï¼ˆ7ï¼‰info[m
[31m-     è®¿é—®http://localhostï¼š8080/infoï¼Œæ•ˆæœå¦‚å›¾11-7æ‰€ç¤ºã€‚[m
[31m-å›¾11-5ã€€è®¿é—®ConfigProps[m
[31m-   å›¾11-6ã€€è®¿é—®health[m
[31m-                             å›¾11-7ã€€è®¿é—®info[m
[31m-[m
[31m-ï¼ˆ8ï¼‰metrics[m
[31m-è®¿é—®http://localhostï¼š8080/metricsï¼Œæ•ˆæœå¦‚å›¾11-8æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                           å›¾11-8ã€€è®¿é—®metrics[m
[31m-[m
[31m-ï¼ˆ9ï¼‰mappings[m
[31m-è®¿é—®http://localhostï¼š8080/mappingsï¼Œæ•ˆæœå¦‚å›¾11-9æ‰€ç¤ºã€‚[m
[31m-                                å›¾11-9ã€€è®¿é—®mappings[m
[31m-[m
[31m-     ï¼ˆ10ï¼‰shutdown[m
[31m-     shutdownç«¯ç‚¹é»˜è®¤æ˜¯å…³é—­çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨[m
[31m-application.propertiesä¸­å¼€å¯ï¼š[m
[31m-[m
[31m-       endpoints.shutdown.enabled=true[m
[31m-[m
[31m-     shutdownç«¯ç‚¹ä¸æ”¯æŒGETæäº¤ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸Šè®¿é—®[m
[31m-åœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨PostManæ¥æµ‹è¯•ã€‚ç”¨POSTæ–¹å¼è®¿é—®[m
[31m-http://localhostï¼š8080/shutdownï¼Œæ•ˆæœå¦‚å›¾11-10æ‰€ç¤ºã€‚[m
[31m-[m
[31m-     æ§åˆ¶å°æ•ˆæœå¦‚å›¾11-11æ‰€ç¤ºã€‚[m
[31m-                         å›¾11-10ã€€è®¿é—®shutdown[m
[31m-[m
[31m-                           å›¾11-11ã€€æ§åˆ¶å°æ•ˆæœ[m
[31m-[m
[31m-ï¼ˆ11ï¼‰trace[m
[31m-è®¿é—®http://localhostï¼š8080/traceï¼Œæ•ˆæœå¦‚å›¾11-12æ‰€ç¤ºã€‚[m
[31m-                                  å›¾11-12ã€€è®¿é—®trace[m
[31m-[m
[31m-11.1.3ã€€å®šåˆ¶ç«¯ç‚¹[m
[31m-[m
[31m-     å®šåˆ¶ç«¯ç‚¹ä¸€èˆ¬é€šè¿‡endpoints+ç«¯ç‚¹å+å±æ€§åæ¥è®¾ç½®ï¼Œæ¯æ®µ[m
[31m-ä¹‹é—´ç”¨.éš”å¼€ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰ä¿®æ”¹ç«¯ç‚¹id[m
[31m-[m
[31m-       endpoints.beans.id=mybeans[m
[31m-[m
[31m-     æ­¤æ—¶æˆ‘ä»¬è®¿é—®çš„ç«¯ç‚¹åœ°å€å°±å˜æˆäº†ï¼šhttp://localhostï¼š[m
[31m-8080/mybeansã€‚[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰å¼€å¯ç«¯ç‚¹[m
[31m-     ä¾‹å¦‚æˆ‘ä»¬å¼€å¯shutdownç«¯ç‚¹ï¼š[m
[31m-       endpoints.shutdown.enabled=true[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰å…³é—­ç«¯ç‚¹[m
[31m-     å…³é—­beansç«¯ç‚¹ï¼š[m
[31m-[m
[31m-       endpoints.beans.enabled=false[m
[31m-[m
[31m-     ï¼ˆ4ï¼‰åªå¼€å¯æ‰€éœ€ç«¯ç‚¹[m
[31m-     è‹¥åªå¼€å¯æ‰€éœ€ç«¯ç‚¹çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å…³é—­æ‰€æœ‰çš„ç«¯ç‚¹ï¼Œ[m
[31m-ç„¶åå†å¼€å¯æ‰€éœ€ç«¯ç‚¹æ¥å®ç°ï¼Œä¾‹å¦‚ï¼š[m
[31m-[m
[31m-       endpoints.enabled=false[m
[31m-       endpoints.beans.enabled=true[m
[31m-[m
[31m-     ï¼ˆ5ï¼‰å®šåˆ¶ç«¯ç‚¹è®¿é—®è·¯å¾„[m
[31m-     é»˜è®¤çš„ç«¯ç‚¹è®¿é—®è·¯å¾„æ˜¯åœ¨æ ¹ç›®å½•ä¸‹çš„ï¼Œå¦‚http://localhostï¼š[m
[31m-8080/beansã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢é…ç½®ä¿®æ”¹ï¼š[m
[31m-[m
[31m-       management.context-path=/manage[m
[31m-[m
[31m-     æ­¤æ—¶æˆ‘ä»¬çš„è®¿é—®åœ°å€å°±å˜æˆäº†ï¼šhttp://localhostï¼š[m
[31m-8080/manage/beans[m
[31m-[m
[31m-     ï¼ˆ6ï¼‰å®šåˆ¶ç«¯ç‚¹è®¿é—®ç«¯å£[m
[31m-     å½“æˆ‘ä»¬åŸºäºå®‰å…¨çš„è€ƒè™‘ï¼Œä¸æ›éœ²ç«¯ç‚¹çš„ç«¯å£åˆ°å¤–éƒ¨æ—¶ï¼Œå°±[m
[31m-éœ€è¦åº”ç”¨æœ¬èº«çš„ä¸šåŠ¡ç«¯å£å’Œç«¯ç‚¹æ‰€ç”¨çš„ç«¯å£ä½¿ç”¨ä¸åŒçš„ç«¯å£ã€‚[m
[31m-æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹é…ç½®æ”¹å˜ç«¯ç‚¹è®¿é—®çš„ç«¯å£ï¼š[m
[31m-[m
[31m-       management.port=8081[m
[31m-[m
[31m-     ï¼ˆ7ï¼‰å…³é—­httpç«¯ç‚¹[m
[31m-     ç®¡ç†httpç«¯ç‚¹å¯ä½¿ç”¨ä¸‹é¢é…ç½®å®ç°ï¼š[m
[31m-[m
[31m-       management.port=-1[m
[31m-[m
[31m-11.1.4ã€€è‡ªå®šä¹‰ç«¯ç‚¹[m
[31m-[m
[31m-     å½“Spring Bootæä¾›çš„ç«¯ç‚¹ä¸èƒ½æ»¡è¶³æˆ‘ä»¬ç‰¹æ®Šçš„éœ€æ±‚ï¼Œè€Œæˆ‘[m
[31m-ä»¬åˆéœ€è¦å¯¹ç‰¹æ®Šçš„åº”ç”¨çŠ¶æ€è¿›è¡Œç›‘æ§çš„æ—¶å€™ï¼Œå°±éœ€è¦è‡ªå®šä¹‰ä¸€[m
[31m-ä¸ªç«¯ç‚¹ã€‚[m
[31m-[m
[31m-     æœ¬ä¾‹æ¼”ç¤ºå½“åº”ç”¨æ”¹å˜äº†ä¸€ä¸ªå˜é‡çš„çŠ¶æ€æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡[m
[31m-ç«¯ç‚¹ç›‘æ§å˜é‡çš„çŠ¶æ€ã€‚[m
[31m-[m
[31m-     æˆ‘ä»¬åªéœ€ç»§æ‰¿ä¸€ä¸ªAbstractEndpointçš„å®ç°ç±»ï¼Œå¹¶å°†å…¶æ³¨å†Œ[m
[31m-ä¸ºBeanå³å¯ã€‚[m
[31m-[m
[31m-     1.çŠ¶æ€æœåŠ¡[m
[31m-[m
[31m-       package com.wisely.ch11_1;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-@Service[m
[31m-public class StatusService {[m
[31m-[m
[31m-       private String status;[m
[31m-[m
[31m-       public String getStatus() {[m
[31m-              return status;[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       public void setStatus(String status) {[m
[31m-              this.status = status;[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-æ­¤ç±»æ— ä»»ä½•ç‰¹åˆ«ï¼Œä»…ä¸ºæ”¹å˜statusçš„å€¼ã€‚[m
[31m-[m
[31m-2.è‡ªå®šä¹‰ç«¯ç‚¹[m
[31m-[m
[31m-package com.wisely.ch11_1;[m
[31m-[m
[31m-import org.springframework.beans.BeansException;[m
[31m-import org.springframework.boot.actuate.endpoint.AbstractEndpoint;[m
[31m-import org.springframework.boot.context.properties.ConfigurationPropert[m
[31m-import org.springframework.context.ApplicationContext;[m
[31m-import org.springframework.context.ApplicationContextAware;[m
[31m-[m
[31m-@ConfigurationProperties(prefix = "endpoints.status", ignoreUnknownFiel[m
[31m-public class StatusEndPoint extends AbstractEndpoint<String> implements[m
[31m-[m
[31m-       ApplicationContext context;[m
[31m-[m
[31m-       public StatusEndPoint() {[m
[31m-              super("status");[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-       @Override[m
[31m-              public String invoke() { //3[m
[31m-                      StatusService statusService = context.getBean(StatusService.cla[m
[31m-[m
[31m-                      return "The Current Status is :"+statusService.getStatus();[m
[31m-              }[m
[31m-[m
[31m-              @Override[m
[31m-              public void setApplicationContext(ApplicationContext arg0) throws B[m
[31m-[m
[31m-                      this.context = arg0;[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ é€šè¿‡@ConfigurationPropertiesçš„è®¾ç½®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨[m
[31m-application.propertiesä¸­é€šè¿‡endpoints.statusé…ç½®æˆ‘ä»¬çš„ç«¯ç‚¹ã€‚[m
[31m-[m
[31m-     â‘¡ç»§æ‰¿AbstractEndpointç±»ï¼ŒAbstractEndpointæ˜¯Endpointæ¥[m
[31m-å£çš„æŠ½è±¡å®ç°ï¼Œå½“å‰ç±»ä¸€å®šè¦é‡å†™invokeæ–¹æ³•ã€‚å®ç°[m
[31m-ApplicationContextAwareæ¥å£å¯ä»¥è®©å½“å‰ç±»å¯¹Springå®¹å™¨çš„èµ„[m
[31m-æºæœ‰æ„è¯†ï¼Œå³å¯è®¿é—®å®¹å™¨çš„èµ„æºã€‚[m
[31m-[m
[31m-     â‘¢é€šè¿‡é‡å†™invokeæ–¹æ³•ï¼Œè¿”å›æˆ‘ä»¬è¦ç›‘æ§çš„å†…å®¹ã€‚[m
[31m-[m
[31m-     3.æ³¨å†Œç«¯ç‚¹å¹¶å®šä¹‰æ¼”ç¤ºæ§åˆ¶å™¨[m
[31m-[m
[31m-       package com.wisely.ch11_1;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.boot.SpringApplication;[m
[31m-       import org.springframework.boot.actuate.endpoint.Endpoint;[m
[31m-       import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-       import org.springframework.context.annotation.Bean;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-       @SpringBootApplication[m
[31m-       @RestController[m
[31m-       public class DemoApplication {[m
[31m-[m
[31m-              @Autowired[m
[31m-              StatusService statusService;[m
[31m-[m
[31m-              public static void main(String[] args) {[m
[31m-                      SpringApplication.run(DemoApplication.class, args);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-              @Bean //1[m
[31m-              public Endpoint<String> status() {[m
[31m-              Endpoint<String> status = new StatusEndPoint();[m
[31m-              return status;[m
[31m-              }[m
[31m-              @RequestMapping("/change") //2[m
[31m-              public String changeStatus(String status){[m
[31m-              statusService.setStatus(status);[m
[31m-              return "OK";[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ æ³¨å†Œç«¯ç‚¹çš„Beanã€‚[m
[31m-[m
[31m-     â‘¡å®šä¹‰æ§åˆ¶å™¨æ–¹æ³•ç”¨æ¥æ”¹å˜statusã€‚[m
[31m-[m
[31m-     4.è¿è¡Œ[m
[31m-[m
[31m-     å¯åŠ¨ç¨‹åºï¼Œè®¿é—®http://localhostï¼š8080/statusï¼Œæ­¤æ—¶æ•ˆæœå¦‚[m
[31m-å›¾11-13æ‰€ç¤ºã€‚[m
[31m-                                  å›¾11-13ã€€è®¿é—®status[m
[31m-[m
[31m-     å½“æˆ‘ä»¬é€šè¿‡æ§åˆ¶å™¨è®¿é—®http://localhostï¼š8080/changeï¼Ÿ[m
[31m-status=runningï¼Œæ”¹å˜statusçš„å€¼çš„æ—¶å€™ï¼Œå¦‚å›¾11-14æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                               å›¾11-14ã€€æ”¹å˜statusçš„å€¼[m
[31m-[m
[31m-     æˆ‘ä»¬åœ¨é€šè¿‡è®¿é—®http://localhostï¼š8080/statusæŸ¥çœ‹statusçš„çŠ¶[m
[31m-æ€æ—¶ï¼Œç»“æœå¦‚å›¾11-15æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾11-15ã€€æŸ¥çœ‹statusçš„çŠ¶æ€[m
[31m-11.1.5ã€€è‡ªå®šä¹‰HealthIndicator[m
[31m-[m
[31m-     Healthä¿¡æ¯éƒ½æ˜¯ä»ApplicationContextä¸­æ‰€æœ‰çš„[m
[31m-HealthIndicatorçš„Beanä¸­æ”¶é›†çš„ï¼ŒSpringä¸­å†…ç½®äº†ä¸€äº›[m
[31m-HealthIndicatorï¼Œå¦‚è¡¨11-2æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                     è¡¨11-2ã€€Springä¸­å†…ç½®çš„HealthIndicator[m
[31m-[m
[31m-     åœ¨æœ¬èŠ‚æˆ‘ä»¬è®²è¿°äº†å¦‚ä½•å®šåˆ¶è‡ªå·±çš„HealthIndicatorï¼Œå®šåˆ¶è‡ª[m
[31m-å·±çš„HealthIndicatoræˆ‘ä»¬åªéœ€å®šä¸€ä¸ªå®ç°HealthIndicatoræ¥å£çš„[m
[31m-ç±»ï¼Œå¹¶æ³¨å†Œä¸ºBeanå³å¯ã€‚æ¥ç€ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä¾ç„¶é€šè¿‡ä¸Šä¾‹[m
[31m-çš„statuså€¼å†³å®šå¥åº·æƒ…å†µï¼Œåªæœ‰å½“statusçš„å€¼ä¸ºrunningæ—¶æ‰ä¸ºå¥[m
[31m-åº·ã€‚[m
[31m-[m
[31m-     1.HealthIndicatorå®ç°ç±»[m
[31m-[m
[31m-       package com.wisely.ch11_1;[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.boot.actuate.health.Health;[m
[31m-       import org.springframework.boot.actuate.health.HealthIndicator;[m
[31m-       import org.springframework.stereotype.Component;[m
[31m-       @Component[m
[31m-       public class StatusHealth implements HealthIndicator {//1[m
[31m-[m
[31m-              @Autowired[m
[31m-              StatusService statusService;[m
[31m-              @Override[m
[31m-              public Health health() {[m
[31m-[m
[31m-                      String status = statusService.getStatus();[m
[31m-                                 if(status == null||!status.equals("running"))[m
[31m-[m
[31m-       {[m
[31m-       return Health.down().withDetail("Error", "Not Running").build(); //2[m
[31m-[m
[31m-                      }[m
[31m-                      return Health.up().build(); //3[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ å®ç°HealthIndicatoræ¥å£å¹¶é‡å†™healthï¼ˆï¼‰æ–¹æ³•ã€‚[m
[31m-[m
[31m-     â‘¡å½“statusçš„å€¼ä¸ºérunningæ—¶æ„é€ å¤±è´¥ã€‚[m
[31m-[m
[31m-     â‘¢å…¶ä½™æƒ…å†µè¿è¡ŒæˆåŠŸã€‚[m
[31m-[m
[31m-     2.è¿è¡Œ[m
[31m-[m
[31m-     è¿è¡Œç¨‹åºï¼Œè®¿é—®http://localhostï¼š8080/healthï¼Œå¦‚å›¾11-16æ‰€[m
[31m-ç¤ºã€‚[m
[31m-                                 å›¾11-16ã€€è®¿é—®health[m
[31m-[m
[31m-     è¿™æ—¶æˆ‘ä»¬ä¿®æ”¹statusçš„å€¼ä¸ºrunningï¼Œè®¿é—®http://localhostï¼š[m
[31m-8080/changeï¼Ÿstatus=runningï¼Œå¦‚å›¾11-17æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                å›¾11-17ã€€è®¿é—®running[m
[31m-[m
[31m-     å†æ¬¡è®¿é—®http://localhostï¼š8080/healthï¼Œæ˜¾ç¤ºå¦‚å›¾11-18æ‰€[m
[31m-ç¤ºã€‚[m
[31m-å›¾11-18ã€€å†æ¬¡è®¿é—®heath[m
[31m-11.2ã€€JMX[m
[31m-[m
[31m-     æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡JMXå¯¹åº”ç”¨è¿›è¡Œç›‘æ§å’Œç®¡ç†ã€‚æœ¬èŠ‚åº”ç”¨ä¸Š[m
[31m-ä¸€èŠ‚çš„ä¾‹å­æ¼”ç¤ºã€‚[m
[31m-[m
[31m-     åœ¨æ§åˆ¶å°è°ƒç”¨Javaå†…ç½®çš„jconsoleæ¥å®ç°JMXç›‘æ§ï¼Œå¦‚å›¾[m
[31m-11-19æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                å›¾11-19ã€€è°ƒç”¨jconsole[m
[31m-[m
[31m-     è¿™æ—¶ä¼šæ‰“å¼€jconsoleé¡µé¢ï¼Œé€‰æ‹©å½“å‰ç¨‹åºçš„è¿›ç¨‹ï¼Œå¦‚å›¾11-[m
[31m-20æ‰€ç¤ºã€‚[m
[31m-                                å›¾11-20ã€€jconsoleé¡µé¢[m
[31m-[m
[31m-     è¿›å…¥ç•Œé¢åï¼Œåœ¨MBeanæ ‡ç­¾çš„org.springframework.bootåŸŸ[m
[31m-ä¸‹å¯å¯¹æˆ‘ä»¬çš„ç¨‹åºè¿›è¡Œç›‘æ§å’Œç®¡ç†ï¼Œå¦‚å›¾11-21æ‰€ç¤ºã€‚[m
[31m-å›¾11-21ã€€MBeanæ ‡ç­¾[m
[31m-11.3ã€€SSH[m
[31m-[m
[31m-     æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡SSHæˆ–TELNETç›‘æ§å’Œç®¡ç†æˆ‘ä»¬çš„åº”ç”¨ï¼Œ[m
[31m-è¿™ä¸€ç‚¹Spring Bootæ˜¯å€ŸåŠ©CraSHï¼ˆhttp://www.crashub.orgï¼‰æ¥å®[m
[31m-ç°çš„ã€‚åœ¨åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åªéœ€åœ¨Spring Booté¡¹ç›®ä¸­æ·»åŠ spring-[m
[31m-boot-starter-remote-shellä¾èµ–å³å¯ã€‚[m
[31m-[m
[31m-11.3.1ã€€æ–°å»ºSpring Booté¡¹ç›®[m
[31m-[m
[31m-     æ–°å»ºSpring Booté¡¹ç›®ï¼Œä¾èµ–ä¸ºRemote Shellï¼ˆspring-boot-[m
[31m-starter-remote-shellï¼‰ã€‚[m
[31m-[m
[31m-     é¡¹ç›®ä¿¡æ¯ï¼š[m
[31m-[m
[31m-       groupIdï¼šcom.wisely[m
[31m-       arctifactId:ch11_3[m
[31m-       package: com.wisely. ch11_3[m
[31m-[m
[31m-11.3.2ã€€è¿è¡Œ[m
[31m-[m
[31m-     å¯åŠ¨ç¨‹åºï¼Œæ­¤æ—¶æ§åˆ¶å°ä¼šæç¤ºSSHè®¿é—®çš„å¯†ç ï¼Œå¦‚å›¾11-22[m
[31m-æ‰€ç¤ºã€‚[m
[31m-                              å›¾11-22ã€€SSHè®¿é—®çš„å¯†ç [m
[31m-[m
[31m-     è¿™æ ·å°±å¯ä»¥é€šè¿‡ä¸‹é¢ä¿¡æ¯ç™»å½•æˆ‘ä»¬çš„ç¨‹åºï¼ˆSSHå®¢æˆ·ç«¯å¯[m
[31m-ä½¿ç”¨puTTYã€SecureCRTç­‰ï¼‰ï¼Œç™»å½•ç•Œé¢å¦‚å›¾11-23æ‰€ç¤ºã€‚[m
[31m-[m
[31m-       ä¸»æœº:localhost[m
[31m-       ç«¯å£:2000[m
[31m-       è´¦å·:user[m
[31m-       å¯†ç ï¼šä¸Šé¢æˆªå›¾[m
[31m-                                  å›¾11-23ã€€ç™»å½•ç•Œé¢[m
[31m-[m
[31m-     ç™»å½•åçš„æ•ˆæœå¦‚å›¾11-24æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                               å›¾11-24ã€€ç™»å½•åçš„æ•ˆæœ[m
[31m-[m
[31m-11.3.3ã€€å¸¸ç”¨å‘½ä»¤[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰help[m
[31m-     è¾“å…¥helpå‘½ä»¤ï¼Œè·å¾—å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚å›¾11-25æ‰€ç¤ºã€‚[m
[31m-                            å›¾11-25ã€€å‘½ä»¤åˆ—è¡¨[m
[31m-[m
[31m-ï¼ˆ2ï¼‰metrics[m
[31m-è¾“å…¥metricså‘½ä»¤ï¼Œæ•ˆæœå¦‚å›¾11-26æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                        å›¾11-26ã€€è¾“å…¥metricså‘½ä»¤[m
[31m-     ï¼ˆ3ï¼‰endpoint[m
[31m-     è¾“å…¥ä¸‹é¢å‘½ä»¤è·å¾—ç«¯ç‚¹åˆ—è¡¨ï¼Œå¦‚å›¾11-27æ‰€ç¤ºã€‚[m
[31m-[m
[31m-       endpoint list[m
[31m-[m
[31m-                                  å›¾11-27ã€€ç«¯ç‚¹åˆ—è¡¨[m
[31m-[m
[31m-     è°ƒç”¨æŸä¸€ä¸ªç«¯ç‚¹ï¼Œå¦‚è°ƒç”¨healthï¼Œå¦‚å›¾11-28æ‰€ç¤ºã€‚[m
[31m-[m
[31m-       endpoint invoke health[m
[31m-[m
[31m-                                 å›¾11-28ã€€è°ƒç”¨health[m
[31m-[m
[31m-11.3.4ã€€å®šåˆ¶ç™»å½•ç”¨æˆ·[m
[31m-[m
[31m-     æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨application.propertiesä¸‹å®šåˆ¶ä¸‹é¢çš„å±æ€§ï¼Œ[m
[31m-å®ç°ç”¨æˆ·çš„è´¦å·å¯†ç çš„å®šåˆ¶ï¼š[m
[31m-[m
[31m-       shell.auth.simple.user.name=wyf[m
[31m-       shell.auth.simple.user.password=wyf[m
[31m-[m
[31m-11.3.5ã€€æ‰©å±•å‘½ä»¤[m
[31m-[m
[31m-     å¯ä»¥åœ¨spring-boot-starter-remote-shell.jarä¸­çœ‹åˆ°Spring Boot[m
[31m-ä¸ºæˆ‘ä»¬å®šåˆ¶çš„å‘½ä»¤ï¼Œå¦‚å›¾11-29æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                         å›¾11-29ã€€Spring Bootå®šåˆ¶çš„å‘½ä»¤[m
[31m-[m
[31m-     å¦‚beans.groovyçš„ä»£ç ä¸ºï¼š[m
[31m-[m
[31m-       package commands[m
[31m-       import org.springframework.boot.actuate.endpoint.BeansEndpoint[m
[31m-       class beans {[m
[31m-[m
[31m-              @Usage("Display beans in ApplicationContext")[m
[31m-              @Command[m
[31m-              def main(InvocationContext context) {[m
[31m-                      def result = [:][m
[31m-                      context.attributes['spring.beanfactory'].getBeansOfType(BeansEn[m
[31m-       >[m
[31m-[m
[31m-                             result.put(name, endpoint.invoke())[m
[31m-                      }[m
[31m-                      result.size() == 1 ? result.values()[0] : result[m
[31m-              }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     éœ€è¦ç‰¹åˆ«æŒ‡å‡ºçš„æ˜¯ï¼Œè¿™é‡Œä½¿ç”¨äº†Groovyè¯­è¨€æ¥ç¼–åˆ¶å‘½ä»¤ï¼Œ[m
[31m-Groovyè¯­è¨€æ˜¯ç”±Springä¸»å¯¼çš„è¿è¡ŒäºJVMçš„åŠ¨æ€è¯­è¨€ï¼Œæ˜¯å¯ä»¥[m
[31m-æ›¿ä»£Javaä½œä¸ºå¼€å‘è¯­è¨€çš„ã€‚åœ¨è¿™é‡Œè¿˜éœ€è¯´æ˜çš„æ˜¯ï¼ŒSpring Boot[m
[31m-æ—¢å¯ä»¥ç”¨Javaè¯­è¨€å¼€å‘ï¼Œä¹Ÿå¯ä»¥ç”¨Groovyè¯­è¨€å¼€å‘ï¼Œæœ¬ä¹¦ä¸ºäº†[m
[31m-å‡å°‘å­¦ä¹ æ›²çº¿ï¼Œä»¥åŠè€ƒè™‘ç»å¤§æ•°è¯»è€…çš„ä½¿ç”¨ç°çŠ¶ï¼Œæ‰€ä»¥æ²¡æœ‰å¯¹[m
[31m-Groovyè¯­è¨€åŠGroovyå¼€å‘Springè¿›è¡Œä»‹ç»ï¼Œè¯»è€…å¦‚æœ‰å…´è¶£å¯è‡ª[m
[31m-è¡Œå­¦ä¹ Groovyã€‚[m
[31m-[m
[31m-     å¦ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„æ˜¯InvocationContextï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡[m
[31m-InvocationContextè·å¾—è¡¨11-3æ‰€ç¤ºçš„å±æ€§ã€‚[m
[31m-[m
[31m-                                      è¡¨11-3ã€€å±æ€§[m
[31m-[m
[31m-     è¿™é‡Œå°†ä»¥Groovyè¯­è¨€æ¼”ç¤ºä¸€ä¸ªå‘½ä»¤çš„å®šåˆ¶ï¼Œå‘½ä»¤å¯æ”¾åœ¨ä»¥[m
[31m-ä¸‹ç›®å½•ï¼ŒSpring Bootä¼šè‡ªåŠ¨æ‰«æï¼š[m
[31m-[m
[31m-       classpath*:/commands/**[m
[31m-       classpath*:/crash/commands/**[m
[31m-[m
[31m-     åœ¨src/main/resourcesä¸‹æ–°å»ºcommandsæ–‡ä»¶å¤¹ï¼Œæ–°å»º[m
[31m-hello.groovyï¼Œå†…å®¹å¦‚ä¸‹ï¼š[m
[31m-[m
[31m-       package commands[m
[31m-       import org.crsh.cli.Command[m
[31m-       import org.crsh.cli.Usage[m
[31m-       import org.crsh.command.InvocationContext[m
[31m-       class hello {[m
[31m-[m
[31m-              @Usage("Say Hello")//1[m
[31m-              @Command//2[m
[31m-              def main(InvocationContext context) {[m
[31m-[m
[31m-                      def bootVersion = context.attributes['spring.boot.version'];//3[m
[31m-                      def springVersion = context.attributes['spring.version']//4[m
[31m-[m
[31m-                      return "Hello,your Spring Boot version is "+bootVersion +",your[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä½¿ç”¨@Usageæ³¨è§£è§£é‡Šè¯¥å‘½ä»¤çš„ç”¨é€”ã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨@Commandæ³¨è§£å½“å‰æ˜¯ä¸€ä¸ªCRaSHå‘½ä»¤ã€‚[m
[31m-[m
[31m-     â‘¢è·å¾—Spring Bootçš„ç‰ˆæœ¬ï¼Œæ³¨æ„Groovyçš„æ–¹æ³•å’Œå˜é‡å£°æ˜[m
[31m-å…³é”®å­—ä¸ºdefã€‚[m
[31m-[m
[31m-     â‘£è·å¾—Springæ¡†æ¶çš„ç‰ˆæœ¬ã€‚[m
[31m-[m
[31m-     â‘¤è¿”å›å‘½ä»¤æ‰§è¡Œç»“æœã€‚[m
[31m-[m
[31m-     è¿è¡Œ[m
[31m-[m
[31m-     æ­¤æ—¶æˆ‘ä»¬è¿è¡Œç¨‹åºï¼Œå¹¶ä»¥SSHå®¢æˆ·ç«¯ç™»å½•ï¼Œè¾“å…¥helloå‘½[m
[31m-ä»¤ï¼Œå¯è·å¾—å¦‚å›¾11-32æ‰€ç¤ºç»“æœã€‚[m
[31m-å›¾11-32ã€€è¿è¡Œç¨‹åº[m
[31m-ç¬¬12ç« ã€€åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘[m
[31m-[m
[31m-12.1ã€€å¾®æœåŠ¡ã€åŸç”Ÿäº‘åº”ç”¨[m
[31m-[m
[31m-     å¾®æœåŠ¡ï¼ˆMicroserviceï¼‰æ˜¯è¿‘ä¸¤å¹´æ¥éå¸¸ç«çš„æ¦‚å¿µï¼Œå®ƒçš„å«[m
[31m-ä¹‰æ˜¯ï¼šä½¿ç”¨å®šä¹‰å¥½è¾¹ç•Œçš„å°çš„ç‹¬ç«‹ç»„ä»¶æ¥åšå¥½ä¸€ä»¶äº‹æƒ…ã€‚å¾®æœ[m
[31m-åŠ¡æ˜¯ç›¸å¯¹äºä¼ ç»Ÿå•å—å¼æ¶æ„è€Œè¨€çš„ã€‚[m
[31m-[m
[31m-     å•å—å¼æ¶æ„æ˜¯ä¸€ä»½ä»£ç ï¼Œéƒ¨ç½²å’Œä¼¸ç¼©éƒ½æ˜¯åŸºäºå•ä¸ªå•å…ƒè¿›[m
[31m-è¡Œçš„ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯æ˜“äºéƒ¨ç½²ï¼Œä½†æ˜¯é¢ä¸´ç€å¯ç”¨æ€§ä½ã€å¯ä¼¸ç¼©æ€§[m
[31m-å·®ã€é›†ä¸­å‘å¸ƒçš„ç”Ÿå‘½å‘¨æœŸä»¥åŠè¿åå•ä¸€åŠŸèƒ½åŸåˆ™ï¼ˆSingle[m
[31m-Responsibility Principleï¼‰ã€‚å¾®æœåŠ¡çš„å‡ºç°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒ[m
[31m-ä»¥å•ä¸ªç‹¬ç«‹çš„æœåŠ¡æ¥åšä¸€ä¸ªåŠŸèƒ½ï¼Œä¸”è¦åšå¥½è¿™ä¸ªåŠŸèƒ½ã€‚ä½†ä½¿ç”¨[m
[31m-å¾®æœåŠ¡ä¸å¯é¿å…åœ°å°†åŠŸèƒ½æŒ‰ç…§è¾¹ç•Œæ‹†åˆ†ä¸ºå•ä¸ªæœåŠ¡ï¼Œä½“ç°å‡ºåˆ†[m
[31m-å¸ƒå¼çš„ç‰¹å¾ï¼Œè¿™æ—¶æ¯ä¸ªå¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡å°†æ˜¯æˆ‘ä»¬è¦è§£å†³çš„é—®[m
[31m-é¢˜ã€‚[m
[31m-[m
[31m-     Spring Cloudçš„å‡ºç°ä¸ºæˆ‘ä»¬è§£å†³åˆ†å¸ƒå¼å¼€å‘å¸¸ç”¨åˆ°çš„é—®é¢˜ç»™[m
[31m-å‡ºäº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚Spring CloudåŸºäºSpring Bootï¼Œä¸ºæˆ‘ä»¬[m
[31m-æä¾›äº†é…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ–­è·¯å™¨ã€ä»£ç†æœåŠ¡ç­‰æˆ‘ä»¬åœ¨åšåˆ†[m
[31m-å¸ƒå¼å¼€å‘æ—¶å¸¸ç”¨é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚[m
[31m-[m
[31m-     åŸºäºSpring Cloudå¼€å‘çš„ç¨‹åºç‰¹åˆ«é€‚åˆåœ¨Dockeræˆ–è€…å…¶ä»–ä¸“[m
[31m-ä¸šPaaSï¼ˆå¹³å°å³æœåŠ¡ï¼Œå¦‚Cloud Foundryï¼‰éƒ¨ç½²ï¼Œæ‰€ä»¥åˆç§°ä½œåŸ[m
[31m-ç”Ÿäº‘åº”ç”¨ï¼ˆCloud Native Applicationï¼‰ã€‚[m
[31m-12.2ã€€Spring Cloudå¿«é€Ÿå…¥é—¨[m
[31m-[m
[31m-12.2.1ã€€é…ç½®æœåŠ¡[m
[31m-[m
[31m-     Spring Cloudæä¾›äº†Config Serverï¼Œå®ƒæœ‰åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘[m
[31m-ä¸­å¤–éƒ¨é…ç½®çš„åŠŸèƒ½ã€‚é€šè¿‡Config Serverï¼Œæˆ‘ä»¬å¯ä»¥é›†ä¸­å­˜å‚¨æ‰€[m
[31m-æœ‰åº”ç”¨çš„é…ç½®æ–‡ä»¶ã€‚[m
[31m-[m
[31m-     Config Serveræ”¯æŒåœ¨gitæˆ–è€…åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æ”¾ç½®é…ç½®æ–‡ä»¶ã€‚[m
[31m-å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ ¼å¼æ¥åŒºåˆ†ä¸åŒåº”ç”¨çš„ä¸åŒé…ç½®æ–‡ä»¶ï¼š[m
[31m-[m
[31m-       /{application}/{profile}[/{label}][m
[31m-       /{application}-{profile}.yml[m
[31m-       /{label}/{application}-{profile}.yml[m
[31m-       /{application}-{profile}.properties[m
[31m-       /{label}/{application}-{profile}.properties[m
[31m-[m
[31m-     Spring Cloudæä¾›äº†æ³¨è§£@EnableConfigServeræ¥å¯ç”¨é…ç½®[m
[31m-æœåŠ¡ã€‚[m
[31m-[m
[31m-12.2.2ã€€æœåŠ¡å‘ç°[m
[31m-[m
[31m-     Spring Cloudé€šè¿‡Netflix OSSçš„Eurekaæ¥å®ç°æœåŠ¡å‘ç°ï¼Œæœ[m
[31m-åŠ¡å‘ç°çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è®©æ¯ä¸ªæœåŠ¡ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ã€‚[m
[31m-[m
[31m-Eureka Serverä¸ºå¾®æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚[m
[31m-[m
[31m-Spring  Cloudä½¿ç”¨æ³¨è§£çš„æ–¹å¼æä¾›äº†EurekaæœåŠ¡ç«¯[m
[31m-ï¼ˆ@EnableEurekaServerï¼‰å’Œå®¢æˆ·ç«¯ï¼ˆ@EnableEurekaClientï¼‰ã€‚[m
[31m-[m
[31m-12.2.3ã€€è·¯ç”±ç½‘å…³[m
[31m-[m
[31m-     è·¯ç”±ç½‘å…³çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è®©æ‰€æœ‰çš„å¾®æœåŠ¡å¯¹å¤–åªæœ‰ä¸€ä¸ª[m
[31m-æ¥å£ï¼Œæˆ‘ä»¬åªéœ€è®¿é—®ä¸€ä¸ªç½‘å…³åœ°å€ï¼Œå³å¯ç”±ç½‘å…³å°†æˆ‘ä»¬çš„è¯·æ±‚[m
[31m-ä»£ç†åˆ°ä¸åŒçš„æœåŠ¡ä¸­ã€‚[m
[31m-[m
[31m-     Spring Cloudæ˜¯é€šè¿‡Zuulæ¥å®ç°çš„ï¼Œæ”¯æŒè‡ªåŠ¨è·¯ç”±æ˜ å°„åˆ°åœ¨[m
[31m-Eureka Serverä¸Šæ³¨å†Œçš„æœåŠ¡ã€‚Spring Cloudæä¾›äº†æ³¨è§£[m
[31m-@EnableZuulProxyæ¥å¯ç”¨è·¯ç”±ä»£ç†ã€‚[m
[31m-[m
[31m-12.2.4ã€€è´Ÿè½½å‡è¡¡[m
[31m-[m
[31m-     Spring Cloudæä¾›äº†Ribbonå’ŒFeignä½œä¸ºå®¢æˆ·ç«¯çš„è´Ÿè½½å‡[m
[31m-è¡¡ã€‚åœ¨Spring Cloudä¸‹ï¼Œä½¿ç”¨Ribbonç›´æ¥æ³¨å…¥ä¸€ä¸ªRestTemplate[m
[31m-å¯¹è±¡å³å¯ï¼Œæ­¤RestTemplateå·²åšå¥½è´Ÿè½½å‡è¡¡çš„é…ç½®ï¼›è€Œä½¿ç”¨[m
[31m-Feignåªéœ€å®šä¹‰ä¸ªæ³¨è§£ï¼Œæœ‰@FeignClientæ³¨è§£çš„æ¥å£ï¼Œç„¶åä½¿ç”¨[m
[31m-@RequestMappingæ³¨è§£åœ¨æ–¹æ³•ä¸Šæ˜ å°„è¿œç¨‹çš„RESTæœåŠ¡ï¼Œæ­¤æ–¹[m
[31m-æ³•ä¹Ÿæ˜¯åšå¥½è´Ÿè½½å‡è¡¡é…ç½®çš„ã€‚[m
[31m-[m
[31m-12.2.5ã€€æ–­è·¯å™¨[m
[31m-[m
[31m-     æ–­è·¯å™¨ï¼ˆCircuit Breakerï¼‰ï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³å½“æŸä¸ªæ–¹æ³•è°ƒ[m
[31m-ç”¨å¤±è´¥çš„æ—¶å€™ï¼Œè°ƒç”¨åå¤‡æ–¹æ³•æ¥æ›¿ä»£å¤±è´¥çš„æ–¹æ³•ï¼Œä»¥è¾¾åˆ°å®¹[m
[31m-é”™ã€é˜»æ­¢çº§è”é”™è¯¯ç­‰åŠŸèƒ½ã€‚[m
[31m-[m
[31m-     Spring Cloudä½¿ç”¨@EnableCircuitBreakeræ¥å¯ç”¨æ–­è·¯å™¨æ”¯[m
[31m-æŒï¼Œä½¿ç”¨@HystrixCommandçš„fallbackMethodæ¥æŒ‡å®šåå¤‡æ–¹[m
[31m-æ³•ã€‚[m
[31m-[m
[31m-     Spring Cloudè¿˜ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ§åˆ¶å°æ¥ç›‘æ§æ–­è·¯å™¨çš„è¿[m
[31m-è¡Œæƒ…å†µã€‚é€šè¿‡@EnableHystrixDashboardæ³¨è§£å¼€å¯ã€‚[m
[31m-12.3ã€€å®æˆ˜[m
[31m-[m
[31m-     å®æˆ˜éƒ¨åˆ†ä¸»è¦ç”±6ä¸ªå¾®æœåŠ¡ç»„æˆï¼š[m
[31m-     configï¼šé…ç½®æœåŠ¡å™¨ï¼Œæœ¬ä¾‹ä¸ºperson-serviceå’Œsome-service[m
[31m-æä¾›å¤–éƒ¨é…ç½®ã€‚[m
[31m-     discoveryï¼šEureka Serverä¸ºå¾®æœåŠ¡æä¾›æ³¨å†Œã€‚[m
[31m-     personï¼šä¸ºUIæ¨¡å—æä¾›ä¿å­˜personçš„RESTæœåŠ¡ã€‚[m
[31m-     someï¼šä¸ºUIæ¨¡å—è¿”å›ä¸€æ®µå­—ç¬¦ä¸²ã€‚[m
[31m-     UIï¼šä½œä¸ºåº”ç”¨ç½‘å…³ï¼Œæä¾›å¤–éƒ¨è®¿é—®çš„å”¯ä¸€å…¥å£ã€‚ä½¿ç”¨Feign[m
[31m-æ¶ˆè´¹personæœåŠ¡ã€Ribbonæ¶ˆè´¹someæœåŠ¡ï¼Œä¸”éƒ½æä¾›æ–­è·¯å™¨åŠŸ[m
[31m-èƒ½ï¼›[m
[31m-     monitorï¼šç›‘æ§UIæ¨¡å—ä¸­çš„æ–­è·¯å™¨ã€‚[m
[31m-     æœ¬ä¾‹æ²¡æœ‰å®Œå…¨åˆ—å‡ºä»£ç ï¼Œè¯»è€…å¯è‡ªè¡Œç¿»é˜…æºç ch12ã€‚[m
[31m-[m
[31m-12.3.1ã€€é¡¹ç›®æ„å»º[m
[31m-[m
[31m-     æ–°å»ºæ¨¡å—åŒ–çš„mavené¡¹ç›®ch12ï¼Œå…¶pom.xmlæ–‡ä»¶çš„ä¸»è¦éƒ¨åˆ†[m
[31m-å¦‚ä¸‹ã€‚[m
[31m-[m
[31m-     ï¼ˆ1ï¼‰ä½¿ç”¨<modules>æ ‡ç­¾æ¥å®ç°æ¨¡å—åŒ–ï¼š[m
[31m-[m
[31m-              <modules>[m
[31m-                      <module>config</module>[m
[31m-                      <module>discovery</module>[m
[31m-                      <module>ui</module>[m
[31m-                      <module>person</module>[m
[31m-                      <module>some</module>[m
[31m-                      <module>monitor</module>[m
[31m-              </modules>[m
[31m-[m
[31m-     ï¼ˆ2ï¼‰ä½¿ç”¨spring-cloud-starter-parentæ›¿ä»£spring-boot-starter-[m
[31m-parentï¼Œå…¶å…·å¤‡spring-boot-starter-parentçš„åŒæ ·åŠŸèƒ½å¹¶é™„åŠ äº†[m
[31m-Spring Cloudçš„ä¾èµ–ï¼Œå½“å‰æœ€æ–°ç¨³å®šç‰ˆä¸ºAngel.SR3ï¼š[m
[31m-[m
[31m-           <parent>[m
[31m-                      <groupId>org.springframework.cloud</groupId>[m
[31m-                                                          <artifactId>spring-cloud-starter-[m
[31m-[m
[31m-       parent</artifactId>[m
[31m-                      <version> Angel.SR3</version>[m
[31m-                      <relativePath/>[m
[31m-[m
[31m-       </parent>[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰åœ¨æ­¤pom.xmlæ–‡ä»¶é‡Œæ·»åŠ çš„dependencyå¯¹æ‰€æœ‰çš„å­æ¨¡[m
[31m-å—éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œå³åœ¨å­æ¨¡å—ä¸ç”¨å†é¢å¤–æ·»åŠ è¿™äº›ä¾èµ–ï¼š[m
[31m-[m
[31m-              <dependencies>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       web</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       actuator</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                           <artifactId>spring-boot-starter-[m
[31m-[m
[31m-       test</artifactId>[m
[31m-                             <scope>test</scope>[m
[31m-                      </dependency>[m
[31m-              </dependencies>[m
[31m-[m
[31m-12.3.2ã€€æœåŠ¡å‘ç°â€”â€”Discoveryï¼ˆEureka Serverï¼‰[m
[31m-[m
[31m-     1.ä¾èµ–[m
[31m-[m
[31m-     æœåŠ¡å‘ç°ä¾èµ–äºEureka Serverï¼Œæ‰€ä»¥æœ¬æ¨¡å—åŠ ä¸Šå¦‚ä¸‹ä¾èµ–[m
[31m-å³å¯ï¼š[m
[31m-[m
[31m-              <dependencies>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                             <artifactId>spring-cloud-starter</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                                             <artifactId>spring-cloud-starter-eureka-[m
[31m-[m
[31m-       server</artifactId>[m
[31m-                      </dependency>[m
[31m-[m
[31m-       </dependencies>[m
[31m-[m
[31m-     2.å…³é”®ä»£ç [m
[31m-[m
[31m-       package com.wisely.discovery;[m
[31m-[m
[31m-       import org.springframework.boot.SpringApplication;[m
[31m-       import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-       import org.springframework.cloud.netflix.eureka.server.EnableEurekaServ[m
[31m-[m
[31m-       @SpringBootApplication[m
[31m-       @EnableEurekaServer[m
[31m-       public class DiscoveryApplication {[m
[31m-          public static void main(String[] args) {[m
[31m-                     SpringApplication.run(DiscoveryApplication.class, args);[m
[31m-[m
[31m-              }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-ä¸€ä¸ªå¸¸è§„çš„Spring       Booté¡¹ç›®ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨[m
[31m-[m
[31m-@EnableEurekaServeræ³¨è§£å¼€å¯å¯¹EurekaServerçš„æ”¯æŒå³å¯ã€‚[m
[31m-[m
[31m-3.é…ç½®[m
[31m-[m
[31m-     åœ¨äº‘è®¡ç®—ç¯å¢ƒä¸‹ï¼Œä¹ æƒ¯ä¸Šä½¿ç”¨YAMLé…ç½®ï¼Œæ­¤å¤„æˆ‘ä»¬ä¹Ÿé‡‡[m
[31m-ç”¨YAMLé…ç½®ã€‚[m
[31m-[m
[31m-application.ymlï¼š[m
[31m-[m
[31m-server:[m
[31m-   port: 8761 #1[m
[31m-[m
[31m-eureka:[m
[31m-   instance:[m
[31m-       hostname: localhost #2[m
[31m-   client:[m
[31m-       register-with-eureka: false #3[m
[31m-[m
[31m-fetch-registry: false[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-â‘ å½“å‰Eureka ServeræœåŠ¡çš„ç«¯å£å·ä¸º8761ã€‚[m
[31m-â‘¡å½“å‰Eureka Serverçš„hostnameä¸ºlocalhostã€‚[m
[31m-â‘¢å½“å‰æœåŠ¡ä¸éœ€è¦åˆ°Eureka Serverä¸Šæ³¨å†Œã€‚[m
[31m-12.3.3ã€€é…ç½®â€”â€”Configï¼ˆConfig Serverï¼‰[m
[31m-[m
[31m-     1.ä¾èµ–[m
[31m-[m
[31m-     Spring Cloudä¸ºæˆ‘ä»¬æä¾›äº†ä½œä¸ºé…ç½®æœåŠ¡çš„ä¾èµ–spring-[m
[31m-cloud-config-serverï¼Œä»¥åŠä½œä¸ºeurekaå®¢æˆ·ç«¯çš„ä¾èµ–spring-cloud-[m
[31m-starter-eurekaï¼š[m
[31m-[m
[31m-              <dependencies>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                             <artifactId>spring-cloud-starter</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                                                           <artifactId>spring-cloud-config-[m
[31m-[m
[31m-       server</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                                                          <artifactId>spring-cloud-starter-[m
[31m-[m
[31m-       eureka</artifactId>[m
[31m-                      </dependency>[m
[31m-[m
[31m-       </dependencies>[m
[31m-[m
[31m-     2.å…³é”®ä»£ç [m
[31m-[m
[31m-       package com.wisely.config;[m
[31m-[m
[31m-       import org.springframework.boot.SpringApplication;[m
[31m-       import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-       import org.springframework.cloud.config.server.EnableConfigServer;[m
[31m-       import org.springframework.cloud.netflix.eureka.EnableEurekaClient;[m
[31m-[m
[31m-       @SpringBootApplication[m
[31m-       @EnableConfigServer //1[m
[31m-       @EnableEurekaClient //2[m
[31m-       public class ConfigApplication {[m
[31m-                public static void main(String[] args) {[m
[31m-                             SpringApplication.run(ConfigApplication.class, args);[m
[31m-[m
[31m-                      }[m
[31m-[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä½¿ç”¨@EnableConfigServerå¼€å¯é…ç½®æœåŠ¡å™¨çš„æ”¯æŒã€‚[m
[31m-[m
[31m-     â‘¡ä½¿ç”¨@EnableEurekaClientå¼€å¯ä½œä¸ºEureka Serverçš„å®¢æˆ·[m
[31m-ç«¯çš„æ”¯æŒã€‚[m
[31m-[m
[31m-     3.é…ç½®[m
[31m-[m
[31m-     bootstrap.yml[m
[31m-[m
[31m-       spring:[m
[31m-           application:[m
[31m-              name: config #1[m
[31m-           profiles:[m
[31m-              active: native #2[m
[31m-[m
[31m-       eureka:[m
[31m-           instance:[m
[31m-              non-secure-port: ${server.port:8888} #3[m
[31m-              metadata-map:[m
[31m-                  instanceId: ${spring.application.name}:${random.value} #4[m
[31m-           client:[m
[31m-              service-url:[m
[31m-                  defaultZone: http://${eureka.host:localhost}:${eureka.port:8761}/[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     è¿™é‡Œå¯¹bootstrap.ymlåšä¸€ä¸‹è§£é‡Šï¼ŒSpring Cloudåº”ç”¨æä¾›ä½¿[m
[31m-ç”¨bootstrap.ymlï¼ˆbootstrap.propertiesï¼‰è´Ÿè´£ä»å¤–éƒ¨èµ„æºåŠ è½½é…[m
[31m-ç½®å±æ€§ã€‚[m
[31m-[m
[31m-     â‘ åœ¨Erueka Serveræ³¨å†Œçš„æœåŠ¡åä¸ºconfigã€‚[m
[31m-[m
[31m-     â‘¡é…ç½®æœåŠ¡å™¨ä½¿ç”¨æœ¬åœ°é…ç½®ï¼ˆé»˜è®¤ä¸ºgité…ç½®ï¼‰ã€‚[m
[31m-[m
[31m-     â‘¢éSSLç«¯å£ï¼Œè‹¥ç¯å¢ƒå˜é‡ä¸­server.portæœ‰å€¼ï¼Œåˆ™ä½¿ç”¨ç¯å¢ƒ[m
[31m-å˜é‡çš„å€¼ï¼Œæ²¡æœ‰åˆ™ä½¿ç”¨8080ã€‚[m
[31m-[m
[31m-     â‘£é…ç½®åœ¨Eureka Serverçš„å®ä¾‹IDã€‚[m
[31m-[m
[31m-     â‘¤Eurekaå®¢æˆ·ç«¯è®¾ç½®Eureka Serverçš„åœ°å€ã€‚[m
[31m-[m
[31m-     application.yml[m
[31m-[m
[31m-       spring:[m
[31m-           cloud:[m
[31m-              config:[m
[31m-                  server:[m
[31m-                      native:[m
[31m-                         search-locations: classpath:/config #1[m
[31m-[m
[31m-       server:[m
[31m-           port: 8888[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     é…ç½®å…¶ä»–åº”ç”¨æ‰€éœ€çš„é…ç½®æ–‡ä»¶çš„ä½ç½®ä½äºç±»è·¯å¾„ä¸‹çš„[m
[31m-configç›®å½•ä¸‹ï¼Œå¦‚å›¾12-1æ‰€ç¤ºã€‚[m
[31m-                                  å›¾12-1ã€€configç›®å½•[m
[31m-[m
[31m-     é…ç½®æ–‡ä»¶çš„è§„åˆ™ä¸ºï¼šåº”ç”¨å+profile.ymlã€‚[m
[31m-[m
[31m-12.3.4ã€€æœåŠ¡æ¨¡å—â€”â€”PersonæœåŠ¡[m
[31m-[m
[31m-     1.ä¾èµ–[m
[31m-[m
[31m-     æœ¬æ¨¡å—éœ€è¦åšæ•°æ®åº“æ“ä½œï¼Œæ•…æ·»åŠ spring-boot-starter-data-[m
[31m-jpaä¾èµ–ï¼ˆåœ¨å¼€å‘ç¯å¢ƒä¸‹ä½¿ç”¨hsqldbï¼Œåœ¨Dockerç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨[m
[31m-PostgreSQLï¼‰ï¼›æœ¬æ¨¡å—è¿˜éœ€è¦ä½¿ç”¨Config Serverçš„é…ç½®ï¼Œæ•…æ·»[m
[31m-åŠ spring-cloud-config-clientä¾èµ–ã€‚[m
[31m-[m
[31m-              <dependencies>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                             <artifactId>spring-cloud-starter</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                                                           <artifactId>spring-cloud-config-[m
[31m-[m
[31m-       client</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                                                          <artifactId>spring-cloud-starter-[m
[31m-       eureka</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.boot</groupId>[m
[31m-                                                  <artifactId>spring-boot-starter-data-[m
[31m-[m
[31m-       jpa</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.hsqldb</groupId>[m
[31m-                             <artifactId>hsqldb</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>postgresql</groupId>[m
[31m-                             <artifactId>postgresql</artifactId>[m
[31m-                             <version>9.1-901-1.jdbc4</version>[m
[31m-                      </dependency>[m
[31m-[m
[31m-              </dependencies>[m
[31m-[m
[31m-     2.å…³é”®ä»£ç [m
[31m-[m
[31m-     æœ¬æ¨¡å—æ²¡æœ‰ç‰¹åˆ«å€¼å¾—å…³æ³¨çš„ä»£ç ï¼Œä¸»è¦æ˜¯å®ç°æ•°æ®åº“çš„ä¸€[m
[31m-ä¸ªä¿å­˜æ“ä½œï¼Œå¹¶å°†ä¿å­˜æ“ä½œæš´éœ²ç»™UIæ¨¡å—è°ƒç”¨ã€‚[m
[31m-[m
[31m-       package com.wisely.person.controller;[m
[31m-[m
[31m-       import java.util.List;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.data.domain.PageRequest;[m
[31m-       import org.springframework.web.bind.annotation.RequestBody;[m
[31m-       import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-       import org.springframework.web.bind.annotation.RequestMethod;[m
[31m-       import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-       import com.wisely.person.dao.PersonRepository;[m
[31m-       import com.wisely.person.domain.Person;[m
[31m-[m
[31m-       @RestController[m
[31m-       public class PersonController {[m
[31m-[m
[31m-              @Autowired[m
[31m-              PersonRepository personRepository;[m
[31m-       @RequestMapping(value = "/save", method = RequestMethod.POST)[m
[31m-       public List<Person> savePerson(@RequestBody String personName) {[m
[31m-       Person p = new Person(personName);[m
[31m-       personRepository.save(p);[m
[31m-       List<Person> people = personRepository.findAll(new PageRequest(0, 1[m
[31m-[m
[31m-              return people;[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-3.é…ç½®[m
[31m-[m
[31m-bootstrap.ymlï¼š[m
[31m-[m
[31m-spring:[m
[31m-   application:[m
[31m-       name: person[m
[31m-   cloud:[m
[31m-       config:[m
[31m-          enabled: true[m
[31m-          discovery:[m
[31m-              enabled: true[m
[31m-              service-id: CONFIG #1[m
[31m-[m
[31m-eureka:[m
[31m-   instance:[m
[31m-       non-secure-port: ${server.port:8082}[m
[31m-   client:[m
[31m-       service-url:[m
[31m-          defaultZone: http://${eureka.host:localhost}:${eureka.port:8761}/[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-     æŒ‡å®šConfig Serverçš„æœåŠ¡åï¼Œå°†ä¼šé€šè¿‡Eureka Serverå‘ç°[m
[31m-Config Serverã€‚[m
[31m-[m
[31m-     åœ¨å¼€å‘ç¯å¢ƒä¸‹ä½¿ç”¨hsqldbï¼šï¼ˆConfig  Serverä¸‹çš„[m
[31m-person.ymlï¼‰ï¼š[m
[31m-       spring:[m
[31m-           jpa:[m
[31m-              database: HSQL[m
[31m-[m
[31m-     åœ¨Dockerç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨PostgreSQLï¼ˆConfig Serverä¸‹çš„[m
[31m-person-docker.ymlï¼‰ï¼š[m
[31m-[m
[31m-       spring:[m
[31m-           jpa:[m
[31m-              database: POSTGRESQL[m
[31m-           datasource:[m
[31m-              platform: postgres[m
[31m-              url: jdbc:postgresql://postgres:5432/postgres[m
[31m-              username: postgres[m
[31m-              password: postgres[m
[31m-              driver-class-name: org.postgresql.Driver[m
[31m-[m
[31m-     application.ymlï¼š[m
[31m-[m
[31m-       server:[m
[31m-           port: 8082[m
[31m-[m
[31m-       spring:[m
[31m-           jpa:[m
[31m-              hibernate:[m
[31m-                  ddl-auto: update[m
[31m-[m
[31m-12.3.5ã€€æœåŠ¡æ¨¡å—â€”â€”SomeæœåŠ¡[m
[31m-[m
[31m-     1.ä¾èµ–[m
[31m-[m
[31m-             <dependencies>[m
[31m-              <dependency>[m
[31m-                     <groupId>org.springframework.cloud</groupId>[m
[31m-                     <artifactId>spring-cloud-starter</artifactId>[m
[31m-[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-[m
[31m-                     <groupId>org.springframework.cloud</groupId>[m
[31m-                                                    <artifactId>spring-cloud-config-[m
[31m-[m
[31m-client</artifactId>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>org.springframework.cloud</groupId>[m
[31m-                                                  <artifactId>spring-cloud-starter-[m
[31m-[m
[31m-eureka</artifactId>[m
[31m-              </dependency>[m
[31m-[m
[31m-       </dependencies>[m
[31m-[m
[31m-2.å…³é”®ä»£ç [m
[31m-[m
[31m-package com.wisely.some;[m
[31m-[m
[31m-import org.springframework.beans.factory.annotation.Value;[m
[31m-import org.springframework.boot.SpringApplication;[m
[31m-import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-import org.springframework.cloud.client.discovery.EnableDiscoveryClient[m
[31m-import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-import org.springframework.web.bind.annotation.RestController;[m
[31m-[m
[31m-@SpringBootApplication[m
[31m-@EnableDiscoveryClient[m
[31m-@RestController[m
[31m-public class SomeApplication {[m
[31m-[m
[31m-         @Value("${my.message}") //1[m
[31m-         private String message;[m
[31m-[m
[31m-         @RequestMapping(value = "/getsome")[m
[31m-         public String getsome(){[m
[31m-[m
[31m-                return message;[m
[31m-         }[m
[31m-       public static void main(String[] args) {[m
[31m-[m
[31m-              SpringApplication.run(SomeApplication.class, args);[m
[31m-       }[m
[31m-[m
[31m-}[m
[31m-æ­¤å¤„é€šè¿‡@Valueæ³¨å…¥çš„å€¼æ¥è‡ªäºConfig Serverã€‚[m
[31m-åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼ˆConfig Serverä¸‹çš„some.ymlï¼‰ã€‚[m
[31m-[m
[31m-my:[m
[31m-   message: Message from Development[m
[31m-[m
[31m-     åœ¨Dockerç”Ÿäº§ç¯å¢ƒä¸‹ï¼ˆConfig                     Serverä¸‹çš„some-[m
[31m-docker.ymlï¼‰ï¼š[m
[31m-[m
[31m-       my:[m
[31m-           message: Message from Production[m
[31m-[m
[31m-3.é…ç½®[m
[31m-[m
[31m-bootstrap.ymlï¼š[m
[31m-[m
[31m-spring:[m
[31m-   application:[m
[31m-       name: some[m
[31m-   cloud:[m
[31m-       config:[m
[31m-          enabled: true[m
[31m-          discovery:[m
[31m-              enabled: true[m
[31m-              service-id: CONFIG[m
[31m-[m
[31m-eureka:[m
[31m-   instance:[m
[31m-       non-secure-port: ${server.port:8083}[m
[31m-   client:[m
[31m-       service-url:[m
[31m-          defaultZone: http://${eureka.host:localhost}:${eureka.port:8761}/[m
[31m-     application.ymlï¼š[m
[31m-[m
[31m-       server:[m
[31m-           port: 8083[m
[31m-[m
[31m-12.3.6ã€€ç•Œé¢æ¨¡å—â€”â€”UIï¼ˆRibbonï¼ŒFeignï¼‰[m
[31m-[m
[31m-     1.ä¾èµ–[m
[31m-[m
[31m-     æœ¬æ¨¡å—ä¼šä½¿ç”¨ribbonã€feignã€zuulä»¥åŠCircuitBreakerï¼Œæ‰€ä»¥[m
[31m-éœ€æ·»åŠ ç›¸å…³ä¾èµ–ã€‚æœ¬æ¨¡å—æ˜¯ä¸€ä¸ªå…·æœ‰ç•Œé¢çš„æ¨¡å—ï¼Œæ‰€ä»¥é€šè¿‡[m
[31m-webjaråŠ è½½äº†ä¸€äº›å¸¸ç”¨çš„è„šæœ¬æ¡†æ¶ï¼š[m
[31m-[m
[31m-       <dependencies>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                             <artifactId>spring-cloud-starter</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                                                          <artifactId>spring-cloud-starter-[m
[31m-[m
[31m-       hystrix</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                                                          <artifactId>spring-cloud-starter-[m
[31m-[m
[31m-       zuul</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                                                           <artifactId>spring-cloud-config-[m
[31m-[m
[31m-       client</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                                                          <artifactId>spring-cloud-starter-[m
[31m-[m
[31m-       eureka</artifactId>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-[m
[31m-                     <groupId>org.springframework.cloud</groupId>[m
[31m-                                                  <artifactId>spring-cloud-starter-[m
[31m-[m
[31m-feign</artifactId>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>org.springframework.cloud</groupId>[m
[31m-                                                  <artifactId>spring-cloud-starter-[m
[31m-[m
[31m-ribbon</artifactId>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>org.webjars</groupId>[m
[31m-                     <artifactId>bootstrap</artifactId>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>org.webjars</groupId>[m
[31m-                     <artifactId>angularjs</artifactId>[m
[31m-                     <version>1.3.15</version>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>org.webjars</groupId>[m
[31m-                     <artifactId>angular-ui-router</artifactId>[m
[31m-                     <version>0.2.13</version>[m
[31m-              </dependency>[m
[31m-              <dependency>[m
[31m-                     <groupId>org.webjars</groupId>[m
[31m-                     <artifactId>jquery</artifactId>[m
[31m-              </dependency>[m
[31m-[m
[31m-       </dependencies>[m
[31m-[m
[31m-2.å…³é”®ä»£ç [m
[31m-[m
[31m-ï¼ˆ1ï¼‰å…¥å£ï¼š[m
[31m-[m
[31m-package com.wisely.ui;[m
[31m-[m
[31m-import org.springframework.boot.SpringApplication;[m
[31m-import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-import org.springframework.cloud.client.circuitbreaker.EnableCircuitBre[m
[31m-import org.springframework.cloud.netflix.eureka.EnableEurekaClient;[m
[31m-import org.springframework.cloud.netflix.feign.EnableFeignClients;[m
[31m-import org.springframework.cloud.netflix.zuul.EnableZuulProxy;[m
[31m-@SpringBootApplication[m
[31m-@EnableEurekaClient[m
[31m-@EnableFeignClients //1[m
[31m-@EnableCircuitBreaker //2[m
[31m-@EnableZuulProxy //3[m
[31m-public class UiApplication {[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-              SpringApplication.run(UiApplication.class, args);[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-â‘ é€šè¿‡@EnableFeignClientså¼€å¯feignå®¢æˆ·ç«¯æ”¯æŒã€‚[m
[31m-[m
[31m-â‘¡é€šè¿‡@EnableCircuitBreakerå¼€å¯CircuitBreakerçš„æ”¯æŒã€‚[m
[31m-[m
[31m-â‘¢é€šè¿‡@EnableZuulProxyå¼€å¯ç½‘å…³ä»£ç†çš„æ”¯æŒ[m
[31m-[m
[31m-ï¼ˆ2ï¼‰ä½¿ç”¨feignè°ƒç”¨Person Serviceï¼š[m
[31m-[m
[31m-package com.wisely.ui.service;[m
[31m-[m
[31m-import java.util.List;[m
[31m-[m
[31m-import org.springframework.cloud.netflix.feign.FeignClient;[m
[31m-import org.springframework.http.MediaType;[m
[31m-import org.springframework.web.bind.annotation.RequestBody;[m
[31m-import org.springframework.web.bind.annotation.RequestMapping;[m
[31m-import org.springframework.web.bind.annotation.RequestMethod;[m
[31m-import org.springframework.web.bind.annotation.ResponseBody;[m
[31m-[m
[31m-import com.wisely.ui.domain.Person;[m
[31m-[m
[31m-@FeignClient("person")[m
[31m-public interface PersonService {[m
[31m-[m
[31m-         @RequestMapping(method = RequestMethod.POST, value = "/save",[m
[31m-                             produces = MediaType.APPLICATION_JSON_VALUE, consumes =[m
[31m-[m
[31m-              @ResponseBody List<Person> save(@RequestBody String name);[m
[31m-}[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     æˆ‘ä»¬åªéœ€é€šè¿‡ç®€å•çš„åœ¨æ¥å£ä¸­å£°æ˜æ–¹æ³•å³å¯è°ƒç”¨Personæœ[m
[31m-åŠ¡çš„RESTæœåŠ¡ã€‚[m
[31m-[m
[31m-     ï¼ˆ3ï¼‰è°ƒç”¨Person Serviceçš„æ–­è·¯å™¨ï¼š[m
[31m-[m
[31m-       package com.wisely.ui.service;[m
[31m-[m
[31m-       import java.util.ArrayList;[m
[31m-       import java.util.List;[m
[31m-[m
[31m-       import org.springframework.beans.factory.annotation.Autowired;[m
[31m-       import org.springframework.stereotype.Service;[m
[31m-       import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;[m
[31m-       import com.wisely.ui.domain.Person;[m
[31m-[m
[31m-       @Service[m
[31m-       public class PersonHystrixService {[m
[31m-[m
[31m-              @Autowired[m
[31m-              PersonService personService;[m
[31m-[m
[31m-              @HystrixCommand(fallbackMethod = "fallbackSave") //1[m
[31m-              public List<Person> save(String name) {[m
[31m-[m
[31m-                      return personService.save(name);[m
[31m-              }[m
[31m-[m
[31m-              public List<Person> fallbackSave(){[m
[31m-                      List<Person> list = new ArrayList<>();[m
[31m-                      Person p = new Person("Person Service æ•…éšœ");[m
[31m-                      list.add(p);[m
[31m-                      return list;[m
[31m-[m
[31m-              }[m
[31m-       }[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-[m
[31m-     â‘ ä½¿ç”¨@HystrixCommandçš„fallbackMethodå‚æ•°æŒ‡å®šï¼Œå½“[m
[31m-æœ¬æ–¹æ³•è°ƒç”¨å¤±è´¥æ—¶ï¼Œè°ƒç”¨åå¤‡æ–¹æ³•fallbackSaveã€‚[m
[31m-ï¼ˆ4ï¼‰ä½¿ç”¨ribbonè°ƒç”¨Some Seviceï¼Œå¹¶ä½¿ç”¨æ–­è·¯å™¨ï¼š[m
[31m-[m
[31m-package com.wisely.ui.service;[m
[31m-[m
[31m-import org.springframework.beans.factory.annotation.Autowired;[m
[31m-import org.springframework.stereotype.Service;[m
[31m-import org.springframework.web.client.RestTemplate;[m
[31m-[m
[31m-import com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;[m
[31m-[m
[31m-@Service[m
[31m-public class SomeHystrixService {[m
[31m-[m
[31m-       @Autowired[m
[31m-       RestTemplate restTemplate; //1[m
[31m-[m
[31m-       @HystrixCommand(fallbackMethod = "fallbackSome") //2[m
[31m-       public String getSome() {[m
[31m-[m
[31m-              return restTemplate.getForObject("http://some/getsome", String.[m
[31m-       }[m
[31m-[m
[31m-       public String fallbackSome(){[m
[31m-              return "some serviceæ¨¡å—æ•…éšœ";[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-ä»£ç è§£é‡Š[m
[31m-[m
[31m-åœ¨Spring         Bootä¸‹ä½¿ç”¨Ribbonï¼Œæˆ‘ä»¬åªéœ€æ³¨å…¥ä¸€ä¸ª[m
[31m-[m
[31m-RestTemplateå³å¯ï¼ŒSpring Bootå·²ä¸ºæˆ‘ä»¬åšå¥½äº†é…ç½®ã€‚[m
[31m-[m
[31m-     ä½¿ç”¨@HystrixCommandçš„fallbackMethodå‚æ•°æŒ‡å®šï¼Œå½“æœ¬[m
[31m-æ–¹æ³•è°ƒç”¨å¤±è´¥æ—¶è°ƒç”¨åå¤‡æ–¹æ³•fallbackSomeã€‚[m
[31m-[m
[31m-3.é…ç½®[m
[31m-[m
[31m-bootstrap.ymlï¼š[m
[31m-       spring:[m
[31m-           application:[m
[31m-              name: ui[m
[31m-[m
[31m-       eureka:[m
[31m-           instance:[m
[31m-              non-secure-port: ${server.port:80}[m
[31m-           client:[m
[31m-              service-url:[m
[31m-                  defaultZone: http://${eureka.host:localhost}:${eureka.port:8761}/[m
[31m-[m
[31m-     application.yml[m
[31m-[m
[31m-       server:[m
[31m-           port: 80[m
[31m-[m
[31m-12.3.7ã€€æ–­è·¯å™¨ç›‘æ§â€”â€”Monitorï¼ˆDashBoardï¼‰[m
[31m-[m
[31m-     1.ä¾èµ–[m
[31m-[m
[31m-             <dependencies>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                             <artifactId>spring-cloud-starter</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                                           <artifactId>spring-cloud-starter-hystrix-[m
[31m-[m
[31m-       dashboard</artifactId>[m
[31m-                      </dependency>[m
[31m-                      <dependency>[m
[31m-                             <groupId>org.springframework.cloud</groupId>[m
[31m-                                                          <artifactId>spring-cloud-starter-[m
[31m-[m
[31m-       turbine</artifactId>[m
[31m-                      </dependency>[m
[31m-[m
[31m-              </dependencies>[m
[31m-2.ä¸»è¦ä»£ç [m
[31m-[m
[31m-package com.wisely.monitor;[m
[31m-[m
[31m-import org.springframework.boot.SpringApplication;[m
[31m-import org.springframework.boot.autoconfigure.SpringBootApplication;[m
[31m-import org.springframework.cloud.netflix.eureka.EnableEurekaClient;[m
[31m-import org.springframework.cloud.netflix.hystrix.dashboard.EnableHystri[m
[31m-import org.springframework.cloud.netflix.turbine.EnableTurbine;[m
[31m-[m
[31m-@SpringBootApplication[m
[31m-@EnableEurekaClient[m
[31m-@EnableHystrixDashboard[m
[31m-@EnableTurbine[m
[31m-public class MonitorApplication {[m
[31m-[m
[31m-       public static void main(String[] args) {[m
[31m-              SpringApplication.run(MonitorApplication.class, args);[m
[31m-[m
[31m-       }[m
[31m-}[m
[31m-[m
[31m-3.é…ç½®[m
[31m-[m
[31m-bootstrap.yml[m
[31m-[m
[31m-spring:[m
[31m-   application:[m
[31m-       name: monitor[m
[31m-[m
[31m-eureka:[m
[31m-   instance:[m
[31m-       nonSecurePort: ${server.port:8989}[m
[31m-   client:[m
[31m-       serviceUrl:[m
[31m-          defaultZone: http://${eureka.host:localhost}:${eureka.port:8761}/[m
[31m-[m
[31m-application.yml[m
[31m-       server:[m
[31m-           port: 8989[m
[31m-[m
[31m-12.3.8ã€€è¿è¡Œ[m
[31m-[m
[31m-     æˆ‘ä»¬ä¾æ¬¡å¯åŠ¨DiscoveryApplicationã€ConfigApplicationï¼Œå[m
[31m-é¢æ‰€æœ‰çš„å¾®æœåŠ¡å¯åŠ¨ä¸åˆ†é¡ºåºï¼Œæœ€åå¯åŠ¨MonitorApplicationã€‚[m
[31m-æ­¤æ—¶è®¿é—®http://localhostï¼š8761ï¼ŒæŸ¥çœ‹Eureka Serverï¼Œå¦‚å›¾12-2[m
[31m-æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾12-2ã€€æŸ¥çœ‹Eureka Server[m
[31m-[m
[31m-     1.è®¿é—®UIæœåŠ¡[m
[31m-     UIæœåŠ¡æ—¢æ˜¯æˆ‘ä»¬çš„é¡µé¢ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬çš„ç½‘å…³ä»£ç†ã€‚åœ¨å®é™…ç”Ÿ[m
[31m-äº§ç¯å¢ƒä¸­ï¼ŒæœåŠ¡å™¨é˜²ç«å¢™åªéœ€å°†æ­¤ç«¯å£æš´éœ²ç»™å¤–ç½‘å³å¯ï¼Œè®¿é—®[m
[31m-http://localhostï¼Œå¦‚å›¾12-3æ‰€ç¤ºã€‚[m
[31m-                          å›¾12-3ã€€è®¿é—®localhost[m
[31m-[m
[31m-ï¼ˆ1ï¼‰è°ƒç”¨Person Serviceï¼Œå¦‚å›¾12-4æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                       å›¾12-4ã€€è°ƒç”¨person-service[m
[31m-[m
[31m-ï¼ˆ2ï¼‰è°ƒç”¨Some serviceï¼Œå¦‚å›¾12-5æ‰€ç¤ºã€‚[m
[31m-                              å›¾12-5ã€€è°ƒç”¨some-service[m
[31m-[m
[31m-     2.æ–­è·¯å™¨[m
[31m-     æ­¤æ—¶åœæ­¢Person Serviceå’ŒSome Serviceï¼Œè§‚å¯Ÿæ–­è·¯å™¨çš„æ•ˆ[m
[31m-æœï¼Œåˆ†åˆ«å¦‚å›¾12-6å’Œå›¾12-7æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾12-6ã€€åœæ­¢Person Service[m
[31m-[m
[31m-                              å›¾12-7ã€€åœæ­¢Some Service[m
[31m-[m
[31m-     3.æ–­è·¯å™¨ç›‘æ§[m
[31m-     è®¿é—®http://localhostï¼š8989/hystrix.streamï¼Œå¦‚å›¾12-8æ‰€ç¤ºã€‚[m
[31m-                       å›¾12-8ã€€è®¿é—®hystrix.stream[m
[31m-[m
[31m-è¾“å…¥http://localhost/hystrix.streamï¼Œå¦‚å›¾12-9æ‰€ç¤ºã€‚[m
[31m-[m
[31m-              å›¾12-9ã€€è¾“å…¥http://localhost/hystrix.stream[m
[31m-[m
[31m-ç›‘æ§ç•Œé¢å¦‚å›¾12-10æ‰€ç¤ºã€‚[m
[31m-å›¾12-10ã€€ç›‘æ§ç•Œé¢[m
[31m-12.4ã€€åŸºäºDockeréƒ¨ç½²[m
[31m-[m
[31m-     ä»¥Spring Cloudå¼€å‘çš„å¾®æœåŠ¡ç¨‹åºååˆ†é€‚åˆåœ¨Dockerç¯å¢ƒä¸‹[m
[31m-éƒ¨ç½²ã€‚[m
[31m-[m
[31m-12.4.1ã€€Dockerfileç¼–å†™[m
[31m-[m
[31m-     ä»¥ä¸Š6ä¸ªå¾®æœåŠ¡çš„Dockerfileçš„ç¼–å†™å‡ ä¹å®Œå…¨ä¸€è‡´ï¼Œæ­¤å¤„åª[m
[31m-ä»¥configæ¨¡å—ä¸ºä¾‹ã€‚[m
[31m-[m
[31m-     1.runboot.shè„šæœ¬ç¼–å†™[m
[31m-[m
[31m-     ä½äºsrc/main/dockerä¸‹ï¼š[m
[31m-[m
[31m-sleep 10[m
[31m-[m
[31m-java      -Djava.security.egd=file:/dev/./urandom  -[m
[31m-[m
[31m-jar /app/app.jar[m
[31m-[m
[31m-æ ¹æ®å¯åŠ¨é¡ºåºï¼Œè°ƒæ•´sleepçš„æ—¶é—´ã€‚[m
[31m-[m
[31m-2.Dockerfileç¼–å†™[m
[31m-[m
[31m-ä½äºsrc/main/dockerä¸‹ï¼š[m
[31m-[m
[31m-FROM java:8[m
[31m-VOLUME /tmp[m
[31m-RUN mkdir /app[m
[31m-ADD config-1.0.0-SNAPSHOT.jar /app/app.jar[m
[31m-ADD runboot.sh /app/[m
[31m-       RUN bash -c 'touch /app/app.jar'[m
[31m-       WORKDIR /app[m
[31m-       RUN chmod a+x runboot.sh[m
[31m-       EXPOSE 8888[m
[31m-       CMD /app/runboot.sh[m
[31m-[m
[31m-     ä¸ºä¸åŒçš„å¾®æœåŠ¡æˆ‘ä»¬åªéœ€ä¿®æ”¹ï¼š[m
[31m-[m
[31m-       ADD config-1.0.0-SNAPSHOT.jar /app/app.jar[m
[31m-[m
[31m-     ä»¥åŠç«¯å£[m
[31m-[m
[31m-       EXPOSE 8888[m
[31m-[m
[31m-     3.Dockerçš„mavenæ’ä»¶[m
[31m-[m
[31m-     åœ¨å¼€å‘æœºå™¨ç¼–è¯‘Dockeré•œåƒåˆ°æœåŠ¡å™¨ï¼Œä½¿ç”¨docker-maven-[m
[31m-pluginå³å¯ï¼Œåœ¨æ‰€æœ‰ç¨‹åºçš„pom.xmlå†…å¢åŠ ï¼š[m
[31m-[m
[31m-       <build>[m
[31m-                      <plugins>[m
[31m-                             <plugin>[m
[31m-                                    <groupId>com.spotify</groupId>[m
[31m-                                                                        <artifactId>docker-maven-[m
[31m-[m
[31m-       plugin</artifactId>[m
[31m-                                    <configuration>[m
[31m-                                           <imageName>${project.name}:${project.version}[m
[31m-[m
[31m-       </imageName>[m
[31m-                                           <dockerDirectory>${project.basedir}/src/main/docker[m
[31m-                                           <skipDockerBuild>false</skipDockerBuild>[m
[31m-                                           <resources>[m
[31m-                                                   <resource>[m
[31m-                                                          <directory>${project.build.directory}[m
[31m-[m
[31m-       </directory>[m
[31m-                                                          <include>${project.build.finalName}.jar</in[m
[31m-                                                   </resource>[m
[31m-                                           </resources>[m
[31m-                                    </configuration>[m
[31m-                             </plugin>[m
[31m-                      </plugins>[m
[31m-       </build>[m
[31m-[m
[31m-     4.ç¼–è¯‘é•œåƒ[m
[31m-     ä½¿ç”¨docker-maven-pluginï¼Œé»˜è®¤å°†Dockerç¼–è¯‘åˆ°localhostã€‚[m
[31m-å¦‚æœæ˜¯è¿œç¨‹LinuxæœåŠ¡å™¨ï¼Œè¯·åœ¨ç¯å¢ƒå˜é‡ä¸­é…ç½®[m
[31m-DOCKER_HOSTï¼Œæœ¬ä¾‹çš„LinuxæœåŠ¡å™¨çš„åœ°å€æ˜¯192.168.1.68ï¼Œ[m
[31m-å¦‚å›¾12-11æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                           å›¾12-11ã€€LinuxæœåŠ¡å™¨çš„åœ°å€[m
[31m-[m
[31m-     åœ¨æ§åˆ¶å°ä¸‹è¿›å…¥ch12ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢è¯­å¥ï¼š[m
[31m-[m
[31m-       mvn clean package docker:build -DskipTests[m
[31m-[m
[31m-     ç¼–è¯‘å®Œæˆåæ•ˆæœå¦‚å›¾12-12æ‰€ç¤ºã€‚[m
[31m-                                 å›¾12-12ã€€ç¼–è¯‘åæ•ˆæœ[m
[31m-[m
[31m-     æŸ¥çœ‹LinuxæœåŠ¡å™¨ä¸Šçš„é•œåƒï¼Œå¦‚å›¾12-13æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                          å›¾12-13ã€€LinuxæœåŠ¡å™¨ä¸Šçš„é•œåƒ[m
[31m-[m
[31m-12.4.2ã€€Docker Compose[m
[31m-[m
[31m-     Docker Composeæ˜¯ç”¨æ¥å®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨åº”ç”¨çš„å·¥å…·ã€‚å…³[m
[31m-äºDockerComposeçš„å®‰è£…å’Œä½¿ç”¨è¯·æŸ¥çœ‹[m
[31m-https://docs.docker.com/compose/ã€‚[m
[31m-[m
[31m-     Docker Composeä½¿ç”¨ä¸€ä¸ªdocker-compose.ymlæ¥æè¿°å¤šå®¹å™¨[m
[31m-çš„å®šä¹‰ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤è¿è¡Œæ•´ä¸ªåº”ç”¨ã€‚[m
[31m-[m
[31m-       docker-compose up[m
[31m-12.4.3ã€€Docker-compose.ymlç¼–å†™[m
[31m-[m
[31m-       postgresdb:[m
[31m-           image: busybox[m
[31m-           volumes:[m
[31m-              - /var/lib/postgresql/data[m
[31m-[m
[31m-       postgres:[m
[31m-           name: postgres[m
[31m-           image: postgres[m
[31m-           hostname: postgres[m
[31m-           volumes_from:[m
[31m-              - postgresdb[m
[31m-[m
[31m-       # ports:[m
[31m-       # - "5432:5432"[m
[31m-[m
[31m-           environment:[m
[31m-              - POSTGRES_USER=postgres[m
[31m-              - POSTGRES_PASSWORD=postgres[m
[31m-[m
[31m-       discovery:[m
[31m-           image: "discovery:1.0.0-SNAPSHOT"[m
[31m-           hostname: discovery[m
[31m-           name: discovery[m
[31m-           ports:[m
[31m-             - "8761:8761"[m
[31m-[m
[31m-       config:[m
[31m-           image: "config:1.0.0-SNAPSHOT"[m
[31m-           hostname: config[m
[31m-           name: config[m
[31m-           links:[m
[31m-              - discovery[m
[31m-           environment:[m
[31m-                EUREKA_HOST: discovery[m
[31m-                EUREKA_PORT: 8761[m
[31m-[m
[31m-       # ports:[m
[31m-       # - "8888:8888"[m
[31m-[m
[31m-       person:[m
[31m-           image: person:1.0.0-SNAPSHOT[m
[31m-           hostname: person[m
[31m-           links:[m
[31m-              - discovery[m
[31m-              - config[m
[31m-       - postgres[m
[31m-   environment:[m
[31m-[m
[31m-         EUREKA_HOST: discovery[m
[31m-         EUREKA_PORT: 8761[m
[31m-         SPRING_PROFILES_ACTIVE: docker[m
[31m-# ports:[m
[31m-# - "8082:8082"[m
[31m-[m
[31m-some:[m
[31m-   image: some:1.0.0-SNAPSHOT[m
[31m-   hostname: some[m
[31m-   links:[m
[31m-       - discovery[m
[31m-       - config[m
[31m-   environment:[m
[31m-         EUREKA_HOST: discovery[m
[31m-         EUREKA_PORT: 8761[m
[31m-         SPRING_PROFILES_ACTIVE: docker[m
[31m-[m
[31m-# ports:[m
[31m-# - "8083:8083"[m
[31m-[m
[31m-ui:[m
[31m-   image: ui:1.0.0-SNAPSHOT[m
[31m-   hostname: ui[m
[31m-   links:[m
[31m-       - discovery[m
[31m-       - config[m
[31m-       - person[m
[31m-       - some[m
[31m-   environment:[m
[31m-         EUREKA_HOST: discovery[m
[31m-         EUREKA_PORT: 8761[m
[31m-         SPRING_PROFILES_ACTIVE: docker[m
[31m-   ports:[m
[31m-       - "80:80"[m
[31m-[m
[31m-monitor:[m
[31m-   image: monitor:1.0.0-SNAPSHOT[m
[31m-   hostname: monitor[m
[31m-   links:[m
[31m-       - discovery[m
[31m-       - config[m
[31m-       - person[m
[31m-       - some[m
[31m-       - ui[m
[31m-   environment:[m
[31m-         EUREKA_HOST: discovery[m
[31m-         EUREKA_PORT: 8761[m
[31m-                SPRING_PROFILES_ACTIVE: docker[m
[31m-       # ports:[m
[31m-       # - "8989:8989"[m
[31m-[m
[31m-     ä»£ç è§£é‡Š[m
[31m-     â‘ enviromentï¼šç»™å®¹å™¨ä½¿ç”¨çš„å˜é‡ï¼Œåœ¨å®¹å™¨ä¸­ä½¿ç”¨${}æ¥è°ƒ[m
[31m-ç”¨ã€‚[m
[31m-     â‘¡linksï¼šå½“å‰å®¹å™¨ä¾èµ–çš„å®¹å™¨ï¼Œå¯ç›´æ¥ä½¿ç”¨ä¾èµ–å®¹å™¨çš„å·²[m
[31m-æœ‰ç«¯å£ã€‚[m
[31m-     â‘¢portsï¼šå°†æˆ‘ä»¬è¦æš´éœ²çš„ç«¯å£æ˜ å°„å‡ºæ¥ï¼Œä¸éœ€è¦æš´éœ²çš„ç«¯[m
[31m-å£åˆ™ä¸åšæ˜ å°„ã€‚[m
[31m-[m
[31m-12.4.4ã€€è¿è¡Œ[m
[31m-[m
[31m-     å°†docker-compose.ymlä¸Šä¼ è‡³LinuxæœåŠ¡å™¨ä¸Šï¼Œåœ¨æ–‡ä»¶å½“å‰[m
[31m-ç›®å½•æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š[m
[31m-[m
[31m-       docker-compose up -d[m
[31m-[m
[31m-     -dè¡¨ç¤ºåå°è¿è¡Œã€‚[m
[31m-     å¯åŠ¨è¿è¡Œæ•ˆæœå¦‚å›¾12-14æ‰€ç¤ºã€‚[m
[31m-                               å›¾12-14ã€€å¯åŠ¨è¿è¡Œæ•ˆæœ[m
[31m-[m
[31m-     è¿™æ—¶æˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°è®¿é—®http://192.168.1.68ï¼š8761å’Œ[m
[31m-http://192.168.1.68ï¼Œåˆ†åˆ«å¦‚å›¾12-15å’Œå›¾12-16æ‰€ç¤ºã€‚[m
[31m-[m
[31m-               å›¾12-15ã€€è®¿é—®æ•ˆæœï¼ˆhttp://192.168.1.68ï¼š8761ï¼‰[m
[31m-å›¾12-16ã€€è®¿é—®æ•ˆæœï¼ˆhttp://192.168.1.68ï¼‰[m
[31m-                     é™„å½•A[m
[31m-[m
[31m-A.1ã€€åŸºäºJHipsterçš„ä»£ç ç”Ÿæˆ[m
[31m-[m
[31m-     JHipsteræ˜¯ä¸€ä¸ªä»£ç ç”Ÿæˆå™¨ï¼Œå¯ä»¥ç”¨æ¥ç”ŸæˆåŸºäºSpring Boot[m
[31m-å’ŒAngularJSçš„é¡¹ç›®ã€‚[m
[31m-[m
[31m-     1.å®‰è£…Node.JS[m
[31m-     ä¸‹è½½åœ°å€ï¼šhttps://nodejs.org/download/[m
[31m-     2.å®‰è£…Gitå®¢æˆ·ç«¯[m
[31m-     ä¸‹è½½åœ°å€ï¼šhttps://git-scm.com/download/win[m
[31m-     3.å®‰è£…Yeoman generator[m
[31m-[m
[31m-       npm install -g yo[m
[31m-[m
[31m-     4.å®‰è£…JHipster[m
[31m-[m
[31m-       npm install -g generator-jhipster[m
[31m-5.å®‰è£…Bower[m
[31m-[m
[31m-npm install -g bower[m
[31m-[m
[31m-6.å®‰è£…Grunt[m
[31m-[m
[31m-npm install -g grunt-cli[m
[31m-[m
[31m-7.ä½¿ç”¨JHipsterç”Ÿæˆé¡¹ç›®[m
[31m-[m
[31m-mkdir hello-boot[m
[31m-cd hello-boot[m
[31m-yo jhipster[m
[31m-[m
[31m-æ‰§è¡Œä¸‹é¢ä»£ç ï¼Œæ•ˆæœå¦‚å›¾A-1æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                             å›¾A-1ã€€æ‰§è¡Œæ•ˆæœ[m
[31m-æŒ‰ç…§æç¤ºå‘å¯¼è¿›è¡Œæ“ä½œï¼Œå¦‚å›¾A-2æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                       å›¾A-2ã€€æŒ‰ç…§æç¤ºå‘å¯¼æ“ä½œ[m
[31m-[m
[31m-æœ€ç»ˆå®Œæˆçš„ç»“æœå¦‚å›¾A-3æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                                å›¾A-3ã€€å®Œæˆ[m
[31m-[m
[31m-ç”Ÿæˆçš„ä»£ç æ–‡ä»¶ç»“æ„å¦‚å›¾A-4æ‰€ç¤ºã€‚[m
[31m-[m
[31m-      å›¾A-4ã€€æ–‡ä»¶ç»“æ„[m
[31m-[m
[31m-8.è¿è¡Œ[m
[31m-     åœ¨ç¨‹åºç›®å½•ä¸‹ï¼Œæ‰§è¡Œä¸‹é¢ä»£ç ï¼š[m
[31m-[m
[31m-       mvn spring-boot:run[m
[31m-[m
[31m-     è®¿é—®http://localhostï¼š8080ï¼Œæ•ˆæœå¦‚å›¾A-5æ‰€ç¤ºã€‚[m
[31m-[m
[31m-                         å›¾A-5ã€€è®¿é—®http://localhostï¼š8080[m
[31m-[m
[31m-     ä»¥è´¦å·å’Œå¯†ç éƒ½ä¸ºadminç™»å½•ç³»ç»Ÿï¼ŒJHipsterå·²ä¸ºæˆ‘ä»¬åšäº†[m
[31m-å¾ˆå¤šåŸºç¡€çš„å·¥ä½œï¼Œå¦‚å›¾A-6æ‰€ç¤ºã€‚[m
[31m-å›¾A-6ã€€ç™»å½•ç³»ç»Ÿ[m
[31m-A.2ã€€å¸¸ç”¨åº”ç”¨å±æ€§é…ç½®åˆ—è¡¨[m
[31m-[m
[31m-# ===================================================================[m
[31m-[m
[31m-# COMMON SPRING BOOT PROPERTIES[m
[31m-[m
[31m-#[m
[31m-[m
[31m-# This sample file is provided as a guideline. Do NOT copy it in its[m
[31m-[m
[31m-# entirety to your own application.             ^^^[m
[31m-[m
[31m-# ===================================================================[m
[31m-[m
[31m-# ----------------------------------------[m
[31m-# CORE PROPERTIES[m
[31m-# ----------------------------------------[m
[31m-[m
[31m-# BANNER[m
[31m-banner.charset=UTF-8 # banner file encoding[m
[31m-banner.location=classpath:banner.txt # banner file location[m
[31m-[m
[31m-# SPRING CONFIG (ConfigFileApplicationListener[m
[31m-[m
[31m-)[m
[31m-spring.config.name= # config file name (default to 'application')[m
[31m-spring.config.location= # location of config file[m
[31m-[m
[31m-# PROFILES[m
[31m-spring.profiles.active= # comma list of active profiles[m
[31m-[m
[31m-spring.profiles.include= # unconditionally activate the specified comma[m
[31m-# APPLICATION SETTINGS (SpringApplication[m
[31m-)[m
[31m-spring.main.sources= # sources (class name, package name or XML resourc[m
[31m-spring.main.web-environment= # detect by default[m
[31m-spring.main.show-banner=true[m
[31m-spring.main....= # see class for all properties[m
[31m-# ADMIN (SpringApplicationAdminJmxAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.application.admin.enabled=false # enable admin features for the[m
[31m-spring.application.admin.jmx-[m
[31m-name=org.springframework.boot:type=Admin,name=SpringApplication # JMX n[m
[31m-# OUTPUT[m
[31m-spring.output.ansi.enabled=detect # Configure the ANSI output ("detect"[m
[31m-# LOGGING[m
[31m-logging.path=/var/logs[m
[31m-logging.file=myapp.log[m
[31m-logging.config= # location of config file (default classpath:logback.xm[m
[31m-logging.level.*= # levels for loggers, e.g. "logging.level.org.springfr[m
[31m-# IDENTITY (ContextIdApplicationContextInitializer[m
[31m-[m
[31m-)[m
[31m-spring.application.name=[m
[31m-spring.application.index=[m
[31m-# EMBEDDED SERVER CONFIGURATION (ServerProperties[m
[31m-[m
[31m-)[m
[31m-server.port=8080[m
[31m-server.address= # bind to a specific NIC[m
[31m-server.session-timeout= # session timeout in seconds[m
[31m-server.context-[m
[31m-parameters.*= # Servlet context init parameters, e.g. server.context-[m
[31m-parameters.a=alpha[m
[31m-server.context-path= # the context path, defaults to '/'[m
[31m-server.jsp-servlet.class-[m
[31m-name=org.apache.jasper.servlet.JspServlet # The class name of the JSP s[m
[31m-server.jsp-servlet.init-[m
[31m-parameters.*= # Init parameters used to configure the JSP servlet[m
[31m-server.jsp-[m
[31m-servlet.registered=true # Whether or not the JSP servlet is registered[m
[31m-server.servlet-path= # the servlet path, defaults to '/'[m
[31m-server.display-name= # the display name of the application[m
[31m-server.ssl.enabled=true # if SSL support is enabled[m
[31m-server.ssl.client-auth= # want or need[m
[31m-server.ssl.key-alias=[m
[31m-server.ssl.ciphers= # supported SSL ciphers[m
[31m-server.ssl.key-password=[m
[31m-server.ssl.key-store=[m
[31m-server.ssl.key-store-password=[m
[31m-server.ssl.key-store-provider=[m
[31m-server.ssl.key-store-type=[m
[31m-server.ssl.protocol=TLS[m
[31m-server.ssl.trust-store=[m
[31m-server.ssl.trust-store-password=[m
[31m-server.ssl.trust-store-provider=[m
[31m-server.ssl.trust-store-type=[m
[31m-server.tomcat.access-log-[m
[31m-pattern= # log pattern of the access log[m
[31m-server.tomcat.access-log-[m
[31m-enabled=false # is access logging enabled[m
[31m-server.tomcat.compression=off # is compression enabled (off, on, or an[m
[31m-server.tomcat.compressable-mime-[m
[31m-types=text/html,text/xml,text/plain # comma-[m
[31m-separated list of mime types that Tomcat will compress[m
[31m-server.tomcat.internal-[m
[31m-proxies=10\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|\\[m
[31m-[m
[31m-              192\\.168\\.\\d{1,3}\\.\\d{1,3}|\\[m
[31m-              169\\.254\\.\\d{1,3}\\.\\d{1,3}|\\[m
[31m-              127\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|\\[m
[31m-              172\\.1[6-9]{1}\\.\\d{1,3}\\.\\d{1,3}|\\[m
[31m-              172\\.2[0-9]{1}\\.\\d{1,3}\\.\\d{1,3}|\\[m
[31m-[m
[31m-                                                                                        172\\.3[0-1][m
[31m-{1}\\.\\d{1,3}\\.\\d{1,3} # regular expression matching trusted IP addr[m
[31m-server.tomcat.protocol-header=x-forwarded-[m
[31m-proto # front end proxy forward header[m
[31m-server.tomcat.port-header= # front end proxy port header[m
[31m-server.tomcat.remote-ip-header=x-forwarded-for[m
[31m-server.tomcat.basedir=/tmp # base dir (usually not needed, defaults to[m
[31m-server.tomcat.background-processor-delay=30; # in seconds[m
[31m-server.tomcat.max-http-header-[m
[31m-size= # maximum size in bytes of the HTTP message header[m
[31m-server.tomcat.max-[m
[31m-threads = 0 # number of threads in protocol handler[m
[31m-server.tomcat.uri-encoding = UTF-[m
[31m-8 # character encoding to use for URL decoding[m
[31m-server.undertow.access-log-[m
[31m-enabled=false # if access logging is enabled[m
[31m-server.undertow.access-log-[m
[31m-pattern=common # log pattern of the access log[m
[31m-server.undertow.access-log-dir=logs # access logs directory[m
[31m-server.undertow.buffer-size= # size of each buffer in bytes[m
[31m-server.undertow.buffers-per-[m
[31m-region= # number of buffer per region[m
[31m-server.undertow.direct-[m
[31m-buffers=false # allocate buffers outside the Java heap[m
[31m-server.undertow.io-[m
[31m-threads= # number of I/O threads to create for the worker[m
[31m-server.undertow.worker-threads= # number of worker threads[m
[31m-[m
[31m-# SPRING MVC (WebMvcProperties[m
[31m-[m
[31m-)[m
[31m-spring.mvc.locale= # set fixed locale, e.g. en_UK[m
[31m-spring.mvc.date-[m
[31m-format= # set fixed date format, e.g. dd/MM/yyyy[m
[31m-spring.mvc.favicon.enabled=true[m
[31m-spring.mvc.message-codes-resolver-[m
[31m-format= # PREFIX_ERROR_CODE / POSTFIX_ERROR_CODE[m
[31m-spring.mvc.ignore-default-model-on-[m
[31m-redirect=true # If the the content of the "default" model should be ign[m
[31m-spring.view.prefix= # MVC view prefix[m
[31m-spring.view.suffix= # ... and suffix[m
[31m-[m
[31m-# SPRING RESOURCES HANDLING (ResourceProperties[m
[31m-[m
[31m-)[m
[31m-spring.resources.cache-[m
[31m-period= # cache timeouts in headers sent to browser[m
[31m-spring.resources.add-[m
[31m-mappings=true # if default mappings should be added[m
[31m-# MULTIPART (MultipartProperties[m
[31m-[m
[31m-)[m
[31m-multipart.enabled=true[m
[31m-multipart.file-size-[m
[31m-threshold=0 # Threshold after which files will be written to disk.[m
[31m-multipart.location= # Intermediate location of uploaded files.[m
[31m-multipart.max-file-size=1Mb # Max file size.[m
[31m-multipart.max-request-size=10Mb # Max request size.[m
[31m-# SPRING HATEOAS (HateoasProperties[m
[31m-[m
[31m-)[m
[31m-spring.hateoas.apply-to-primary-object-[m
[31m-mapper=true # if the primary mapper should also be configured[m
[31m-# HTTP encoding (HttpEncodingProperties[m
[31m-[m
[31m-)[m
[31m-spring.http.encoding.charset=UTF-[m
[31m-8 # the encoding of HTTP requests/responses[m
[31m-spring.http.encoding.enabled=true # enable http encoding support[m
[31m-spring.http.encoding.force=true # force the configured encoding[m
[31m-# HTTP message conversion[m
[31m-spring.http.converters.preferred-json-[m
[31m-mapper= # the preferred JSON mapper to use for HTTP message conversion.[m
[31m-# HTTP response compression (GzipFilterProperties[m
[31m-)[m
[31m-spring.http.gzip.buffer-[m
[31m-size= # size of the output buffer in bytes[m
[31m-spring.http.gzip.deflate-compression-[m
[31m-level= # the level used for deflate compression (0-9)[m
[31m-spring.http.gzip.deflate-no-[m
[31m-wrap= # noWrap setting for deflate compression (true or false)[m
[31m-spring.http.gzip.enabled=true # enable gzip filter support[m
[31m-spring.http.gzip.excluded-agents= # comma-[m
[31m-separated list of user agents to exclude from compression[m
[31m-spring.http.gzip.exclude-agent-patterns= # comma-[m
[31m-separated list of regular expression patterns to control user agents ex[m
[31m-spring.http.gzip.exclude-paths= # comma-[m
[31m-separated list of paths to exclude from compression[m
[31m-spring.http.gzip.exclude-path-patterns= # comma-[m
[31m-separated list of regular expression patterns to control the paths that[m
[31m-spring.http.gzip.methods= # comma-[m
[31m-separated list of HTTP methods for which compression is enabled[m
[31m-spring.http.gzip.mime-types= # comma-[m
[31m-separated list of MIME types which should be compressed[m
[31m-spring.http.gzip.excluded-mime-types= # comma-[m
[31m-separated list of MIME types to exclude from compression[m
[31m-spring.http.gzip.min-gzip-[m
[31m-size= # minimum content length required for compression to occur[m
[31m-spring.http.gzip.vary= # Vary header to be sent on responses that may b[m
[31m-[m
[31m-# JACKSON (JacksonProperties[m
[31m-[m
[31m-)[m
[31m-spring.jackson.date-format= # Date format string (e.g. yyyy-[m
[31m-MM-dd HH:mm:ss), or a fully-[m
[31m-qualified date format class name (e.g. com.fasterxml.jackson.databind.u[m
[31m-spring.jackson.property-naming-[m
[31m-strategy= # One of the constants on Jackson's PropertyNamingStrategy (e[m
[31m-qualified class name of a PropertyNamingStrategy subclass[m
[31m-spring.jackson.deserialization.*= # see Jackson's DeserializationFeatur[m
[31m-spring.jackson.generator.*= # see Jackson's JsonGenerator.Feature[m
[31m-spring.jackson.joda-date-time-[m
[31m-format= # Joda date time format string[m
[31m-spring.jackson.mapper.*= # see Jackson's MapperFeature[m
[31m-spring.jackson.parser.*= # see Jackson's JsonParser.Feature[m
[31m-spring.jackson.serialization.*= # see Jackson's SerializationFeature[m
[31m-spring.jackson.serialization-[m
[31m-inclusion= # Controls the inclusion of properties during serialization[m
[31m-[m
[31m-# THYMELEAF (ThymeleafAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.thymeleaf.check-template-location=true[m
[31m-spring.thymeleaf.prefix=classpath:/templates/[m
[31m-spring.thymeleaf.excluded-view-names= # comma-[m
[31m-separated list of view names that should be excluded from resolution[m
[31m-spring.thymeleaf.view-names= # comma-[m
[31m-separated list of view names that can be resolved[m
[31m-spring.thymeleaf.suffix=.html[m
[31m-spring.thymeleaf.mode=HTML5[m
[31m-spring.thymeleaf.enabled=true # enable MVC view resolution[m
[31m-spring.thymeleaf.encoding=UTF-8[m
[31m-spring.thymeleaf.content-type=text/html # ;charset=[m
[31m-<encoding> is added[m
[31m-spring.thymeleaf.cache=true # set to false for hot refresh[m
[31m-[m
[31m-# FREEMARKER (FreeMarkerAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.freemarker.allow-request-override=false[m
[31m-spring.freemarker.cache=true[m
[31m-spring.freemarker.check-template-location=true[m
[31m-spring.freemarker.charset=UTF-8[m
[31m-spring.freemarker.content-type=text/html[m
[31m-spring.freemarker.enabled=true # enable MVC view resolution[m
[31m-spring.freemarker.expose-request-attributes=false[m
[31m-spring.freemarker.expose-session-attributes=false[m
[31m-spring.freemarker.expose-spring-macro-helpers=false[m
[31m-spring.freemarker.prefix=[m
[31m-spring.freemarker.request-context-attribute=[m
[31m-spring.freemarker.settings.*=[m
[31m-spring.freemarker.suffix=.ftl[m
[31m-spring.freemarker.template-loader-[m
[31m-path=classpath:/templates/ # comma-separated list[m
[31m-spring.freemarker.view-[m
[31m-names= # whitelist of view names that can be resolved[m
[31m-# GROOVY TEMPLATES (GroovyTemplateAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.groovy.template.cache=true[m
[31m-spring.groovy.template.charset=UTF-8[m
[31m-spring.groovy.template.check-template-[m
[31m-location=true # check that the templates location exists[m
[31m-spring.groovy.template.configuration.*= # See GroovyMarkupConfigurer[m
[31m-spring.groovy.template.content-type=text/html[m
[31m-spring.groovy.template.enabled=true # enable MVC view resolution[m
[31m-spring.groovy.template.prefix=classpath:/templates/[m
[31m-spring.groovy.template.suffix=.tpl[m
[31m-spring.groovy.template.view-[m
[31m-names= # whitelist of view names that can be resolved[m
[31m-[m
[31m-# VELOCITY TEMPLATES (VelocityAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.velocity.allow-request-override=false[m
[31m-spring.velocity.cache=true[m
[31m-spring.velocity.check-template-location=true[m
[31m-spring.velocity.charset=UTF-8[m
[31m-spring.velocity.content-type=text/html[m
[31m-spring.velocity.date-tool-attribute=[m
[31m-spring.velocity.enabled=true # enable MVC view resolution[m
[31m-spring.velocity.expose-request-attributes=false[m
[31m-spring.velocity.expose-session-attributes=false[m
[31m-spring.velocity.expose-spring-macro-helpers=false[m
[31m-spring.velocity.number-tool-attribute=[m
[31m-spring.velocity.prefer-file-system-[m
[31m-access=true # prefer file system access for template loading[m
[31m-spring.velocity.prefix=[m
[31m-spring.velocity.properties.*=[m
[31m-spring.velocity.request-context-attribute=[m
[31m-spring.velocity.resource-loader-path=classpath:/templates/[m
[31m-spring.velocity.suffix=.vm[m
[31m-spring.velocity.toolbox-config-[m
[31m-location= # velocity Toolbox config location, for example "/WEB-[m
[31m-INF/toolbox.xml"[m
[31m-spring.velocity.view-[m
[31m-names= # whitelist of view names that can be resolved[m
[31m-# MUSTACHE TEMPLATES (MustacheAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.mustache.cache=true[m
[31m-spring.mustache.charset=UTF-8[m
[31m-spring.mustache.check-template-location=true[m
[31m-spring.mustache.content-type=UTF-8[m
[31m-spring.mustache.enabled=true # enable MVC view resolution[m
[31m-spring.mustache.prefix=[m
[31m-spring.mustache.suffix=.html[m
[31m-spring.mustache.view-[m
[31m-names= # whitelist of view names that can be resolved[m
[31m-# JERSEY (JerseyProperties[m
[31m-[m
[31m-)[m
[31m-spring.jersey.type=servlet # servlet or filter[m
[31m-spring.jersey.init= # init params[m
[31m-spring.jersey.filter.order=[m
[31m-# INTERNATIONALIZATION (MessageSourceAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.messages.basename=messages[m
[31m-spring.messages.cache-seconds=-1[m
[31m-spring.messages.encoding=UTF-8[m
[31m-[m
[31m-# SECURITY (SecurityProperties[m
[31m-)[m
[31m-security.user.name=user # login username[m
[31m-security.user.password= # login password[m
[31m-security.user.role=USER # role assigned to the user[m
[31m-security.require-ssl=false # advanced settings ...[m
[31m-security.enable-csrf=false[m
[31m-security.basic.enabled=true[m
[31m-security.basic.realm=Spring[m
[31m-security.basic.path= # /**[m
[31m-security.basic.authorize-mode= # ROLE, AUTHENTICATED, NONE[m
[31m-security.filter-order=0[m
[31m-security.headers.xss=false[m
[31m-security.headers.cache=false[m
[31m-security.headers.frame=false[m
[31m-security.headers.content-type=false[m
[31m-security.headers.hsts=all # none / domain / all[m
[31m-security.sessions=stateless # always / never / if_required / stateless[m
[31m-security.ignored= # Comma-[m
[31m-separated list of paths to exclude from the default secured paths[m
[31m-[m
[31m-# OAuth2 client (OAuth2ClientProperties[m
[31m-[m
[31m-spring.oauth2.client.client-id= # OAuth2 client id[m
[31m-spring.oauth2.client.client-[m
[31m-secret= # OAuth2 client secret. A random secret is generated by default[m
[31m-[m
[31m-# OAuth2 SSO (OAuth2SsoProperties[m
[31m-[m
[31m-spring.oauth2.sso.filter-[m
[31m-order= # Filter order to apply if not providing an explicit WebSecurity[m
[31m-spring.oauth2.sso.login-[m
[31m-path= # Path to the login page, i.e. the one that triggers the redirect[m
[31m-[m
[31m-# DATASOURCE (DataSourceAutoConfiguration[m
[31m- & DataSourceProperties[m
[31m-[m
[31m-)[m
[31m-spring.datasource.name= # name of the data source[m
[31m-spring.datasource.initialize=true # populate using data.sql[m
[31m-spring.datasource.schema= # a schema (DDL) script resource reference[m
[31m-spring.datasource.data= # a data (DML) script resource reference[m
[31m-spring.datasource.sql-script-[m
[31m-encoding= # a charset for reading SQL scripts[m
[31m-spring.datasource.platform= # the platform to use in the schema resourc[m
[31m-${platform}.sql)[m
[31m-spring.datasource.continue-on-[m
[31m-error=false # continue even if can't be initialized[m
[31m-spring.datasource.separator=; # statement separator in SQL initializati[m
[31m-spring.datasource.driver-class-name= # JDBC Settings...[m
[31m-spring.datasource.url=[m
[31m-spring.datasource.username=[m
[31m-spring.datasource.password=[m
[31m-spring.datasource.jndi-[m
[31m-name= # For JNDI lookup (class, url, username & password are ignored wh[m
[31m-spring.datasource.max-[m
[31m-active=100 # Advanced configuration...[m
[31m-spring.datasource.max-idle=8[m
[31m-spring.datasource.min-idle=8[m
[31m-spring.datasource.initial-size=10[m
[31m-spring.datasource.validation-query=[m
[31m-spring.datasource.test-on-borrow=false[m
[31m-spring.datasource.test-on-return=false[m
[31m-spring.datasource.test-while-idle=[m
[31m-spring.datasource.time-between-eviction-runs-millis=[m
[31m-spring.datasource.min-evictable-idle-time-millis=[m
[31m-spring.datasource.max-wait=[m
[31m-spring.datasource.jmx-[m
[31m-enabled=false # Export JMX MBeans (if supported)[m
[31m-[m
[31m-# DAO (PersistenceExceptionTranslationAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.dao.exceptiontranslation.enabled=true[m
[31m-[m
[31m-# MONGODB (MongoProperties[m
[31m-[m
[31m-)[m
[31m-spring.data.mongodb.host= # the db host[m
[31m-spring.data.mongodb.port=27017 # the connection port (defaults to 27107[m
[31m-spring.data.mongodb.uri=mongodb://localhost/test # connection URL[m
[31m-spring.data.mongodb.database=[m
[31m-spring.data.mongodb.authentication-database=[m
[31m-spring.data.mongodb.grid-fs-database=[m
[31m-spring.data.mongodb.username=[m
[31m-spring.data.mongodb.password=[m
[31m-spring.data.mongodb.repositories.enabled=true # if spring data reposito[m
[31m-[m
[31m-# JPA (JpaBaseConfiguration[m
[31m-[m
[31m-, HibernateJpaAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.jpa.properties.*= # properties to set on the JPA connection[m
[31m-spring.jpa.open-in-view=true[m
[31m-spring.jpa.show-sql=true[m
[31m-spring.jpa.database-platform=[m
[31m-spring.jpa.database=[m
[31m-spring.jpa.generate-[m
[31m-ddl=false # ignored by Hibernate, might be useful for other vendors[m
[31m-spring.jpa.hibernate.naming-strategy= # naming classname[m
[31m-spring.jpa.hibernate.ddl-auto= # defaults to create-[m
[31m-drop for embedded dbs[m
[31m-spring.data.jpa.repositories.enabled=true # if spring data repository s[m
[31m-[m
[31m-# JTA (JtaAutoConfiguration[m
[31m-)[m
[31m-spring.jta.log-dir= # transaction log dir[m
[31m-spring.jta.*= # technology specific configuration[m
[31m-[m
[31m-# ATOMIKOS[m
[31m-spring.jta.atomikos.connectionfactory.borrow-connection-[m
[31m-timeout=30 # Timeout, in seconds, for borrowing connections from the po[m
[31m-spring.jta.atomikos.connectionfactory.ignore-session-[m
[31m-transacted-[m
[31m-flag=true # Whether or not to ignore the transacted flag when creating[m
[31m-spring.jta.atomikos.connectionfactory.local-transaction-[m
[31m-mode=false # Whether or not local transactions are desired[m
[31m-spring.jta.atomikos.connectionfactory.maintenance-[m
[31m-interval=60 # The time, in seconds, between runs of the pool's maintena[m
[31m-spring.jta.atomikos.connectionfactory.max-idle-[m
[31m-time=60 # The time, in seconds, after which connections are cleaned up[m
[31m-spring.jta.atomikos.connectionfactory.max-[m
[31m-lifetime=0 # The time, in seconds, that a connection can be pooled for[m
[31m-spring.jta.atomikos.connectionfactory.max-pool-[m
[31m-size=1 # The maximum size of the pool[m
[31m-spring.jta.atomikos.connectionfactory.min-pool-[m
[31m-size=1 # The minimum size of the pool[m
[31m-spring.jta.atomikos.connectionfactory.reap-[m
[31m-timeout=0 # The reap timeout, in seconds, for borrowed connections. 0 d[m
[31m-spring.jta.atomikos.connectionfactory.unique-resource-[m
[31m-name=jmsConnectionFactory # The unique name used to identify the resour[m
[31m-spring.jta.atomikos.datasource.borrow-connection-[m
[31m-timeout=30 # Timeout, in seconds, for borrowing connections from the po[m
[31m-spring.jta.atomikos.datasource.default-isolation-[m
[31m-level= # Default isolation level of connections provided by the pool[m
[31m-spring.jta.atomikos.datasource.login-[m
[31m-timeout= # Timeout, in seconds, for establishing a database connection[m
[31m-spring.jta.atomikos.datasource.maintenance-[m
[31m-interval=60 # The time, in seconds, between runs of the pool's maintena[m
[31m-spring.jta.atomikos.datasource.max-idle-[m
[31m-time=60 # The time, in seconds, after which connections are cleaned up[m
[31m-spring.jta.atomikos.datasource.max-[m
[31m-lifetime=0 # The time, in seconds, that a connection can be pooled for[m
[31m-spring.jta.atomikos.datasource.max-pool-[m
[31m-size=1 # The maximum size of the pool[m
[31m-spring.jta.atomikos.datasource.min-pool-[m
[31m-size=1 # The minimum size of the pool[m
[31m-spring.jta.atomikos.datasource.reap-[m
[31m-timeout=0 # The reap timeout, in seconds, for borrowed connections. 0 d[m
[31m-spring.jta.atomikos.datasource.test-[m
[31m-query= # SQL query or statement used to validate a connection before re[m
[31m-spring.jta.atomikos.datasource.unique-resource-[m
[31m-name=dataSource # The unique name used to identify the resource during[m
[31m-[m
[31m-# BITRONIX[m
[31m-spring.jta.bitronix.connectionfactory.acquire-[m
[31m-increment=1 # Number of connections to create when growing the pool[m
[31m-spring.jta.bitronix.connectionfactory.acquisition-[m
[31m-interval=1 # Time, in seconds, to wait before trying to acquire a conne[m
[31m-spring.jta.bitronix.connectionfactory.acquisition-[m
[31m-timeout=30 # Timeout, in seconds, for acquiring connections from the po[m
[31m-spring.jta.bitronix.connectionfactory.allow-local-[m
[31m-transactions=true # Whether or not the transaction manager should allow[m
[31m-XA transactions[m
[31m-spring.jta.bitronix.connectionfactory.apply-transaction-[m
[31m-timeout=false # Whether or not the transaction timeout should be set on[m
[31m-spring.jta.bitronix.connectionfactory.automatic-enlisting-[m
[31m-enabled=true # Whether or not resources should be enlisted and delisted[m
[31m-spring.jta.bitronix.connectionfactory.cache-producers-[m
[31m-consumers=true # Whether or not produces and consumers should be cached[m
[31m-spring.jta.bitronix.connectionfactory.defer-connection-[m
[31m-release=true # Whether or not the provider can run many transactions on[m
[31m-spring.jta.bitronix.connectionfactory.ignore-recovery-[m
[31m-failures=false # Whether or not recovery failures should be ignored[m
[31m-spring.jta.bitronix.connectionfactory.max-idle-[m
[31m-time=60 # The time, in seconds, after which connections are cleaned up[m
[31m-spring.jta.bitronix.connectionfactory.max-pool-[m
[31m-size=10 # The maximum size of the pool. 0 denotes no limit[m
[31m-spring.jta.bitronix.connectionfactory.min-pool-[m
[31m-size=0 # The minimum size of the pool[m
[31m-spring.jta.bitronix.connectionfactory.password= # The password to use t[m
[31m-spring.jta.bitronix.connectionfactory.share-transaction-[m
[31m-connections=false # Whether or not connections in the ACCESSIBLE state[m
[31m-spring.jta.bitronix.connectionfactory.test-[m
[31m-connections=true # Whether or not connections should be tested when acq[m
[31m-spring.jta.bitronix.connectionfactory.two-pc-ordering-[m
[31m-position=1 # The postion that this resource should take during two-[m
[31m-phase commit (always first is Integer.MIN_VALUE, always last is Integer[m
[31m-spring.jta.bitronix.connectionfactory.unique-[m
[31m-name=jmsConnectionFactory # The unique name used to identify the resour[m
[31m-spring.jta.bitronix.connectionfactory.use-tm-[m
[31m-join=true Whether or not TMJOIN should be used when starting XAResource[m
[31m-spring.jta.bitronix.connectionfactory.user= # The user to use to connec[m
[31m-spring.jta.bitronix.datasource.acquire-[m
[31m-increment=1 # Number of connections to create when growing the pool[m
[31m-spring.jta.bitronix.datasource.acquisition-[m
[31m-interval=1 # Time, in seconds, to wait before trying to acquire a conne[m
[31m-spring.jta.bitronix.datasource.acquisition-[m
[31m-timeout=30 # Timeout, in seconds, for acquiring connections from the po[m
[31m-spring.jta.bitronix.datasource.allow-local-[m
[31m-transactions=true # Whether or not the transaction manager should allow[m
[31m-XA transactions[m
[31m-spring.jta.bitronix.datasource.apply-transaction-[m
[31m-timeout=false # Whether or not the transaction timeout should be set on[m
[31m-spring.jta.bitronix.datasource.automatic-enlisting-[m
[31m-enabled=true # Whether or not resources should be enlisted and delisted[m
[31m-spring.jta.bitronix.datasource.cursor-[m
[31m-holdability= # The default cursor holdability for connections[m
[31m-spring.jta.bitronix.datasource.defer-connection-[m
[31m-release=true # Whether or not the database can run many transactions on[m
[31m-spring.jta.bitronix.datasource.enable-jdbc4-connection-[m
[31m-test # Whether or not Connection.isValid() is called when acquiring a c[m
[31m-spring.jta.bitronix.datasource.ignore-recovery-[m
[31m-failures=false # Whether or not recovery failures should be ignored[m
[31m-spring.jta.bitronix.datasource.isolation-[m
[31m-level= # The default isolation level for connections[m
[31m-spring.jta.bitronix.datasource.local-auto-[m
[31m-commit # The default auto-[m
[31m-commit mode for local transactions[m
[31m-spring.jta.bitronix.datasource.login-[m
[31m-timeout= # Timeout, in seconds, for establishing a database connection[m
[31m-spring.jta.bitronix.datasource.max-idle-[m
[31m-time=60 # The time, in seconds, after which connections are cleaned up[m
[31m-spring.jta.bitronix.datasource.max-pool-[m
[31m-size=10 # The maximum size of the pool. 0 denotes no limit[m
[31m-spring.jta.bitronix.datasource.min-pool-[m
[31m-size=0 # The minimum size of the pool[m
[31m-spring.jta.bitronix.datasource.prepared-statement-cache-[m
[31m-size=0 # The target size of the prepared statement cache. 0 disables th[m
[31m-spring.jta.bitronix.datasource.share-transaction-[m
[31m-connections=false # Whether or not connections in the ACCESSIBLE state[m
[31m-spring.jta.bitronix.datasource.test-[m
[31m-query # SQL query or statement used to validate a connection before ret[m
[31m-spring.jta.bitronix.datasource.two-pc-ordering-[m
[31m-position=1 # The position that this resource should take during two-[m
[31m-phase commit (always first is Integer.MIN_VALUE, always last is Integer[m
[31m-spring.jta.bitronix.datasource.unique-[m
[31m-name=dataSource # The unique name used to identify the resource during[m
[31m-spring.jta.bitronix.datasource.use-tm-[m
[31m-join=true Whether or not TMJOIN should be used when starting XAResource[m
[31m-[m
[31m-# SOLR ([m
[31m-SolrProperties[m
[31m-[m
[31m-)[m
[31m-spring.data.solr.host=http://127.0.0.1:8983/solr[m
[31m-spring.data.solr.zk-host=[m
[31m-spring.data.solr.repositories.enabled=true # if spring data repository[m
[31m-# ELASTICSEARCH (ElasticsearchProperties[m
[31m-[m
[31m-)[m
[31m-spring.data.elasticsearch.cluster-[m
[31m-name= # The cluster name (defaults to elasticsearch)[m
[31m-spring.data.elasticsearch.cluster-[m
[31m-nodes= # The address(es) of the server node (comma-[m
[31m-separated; if not specified starts a client node)[m
[31m-spring.data.elasticsearch.properties.*= # Additional properties used to[m
[31m-spring.data.elasticsearch.repositories.enabled=true # if spring data re[m
[31m-# DATA REST (RepositoryRestConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.data.rest.base-[m
[31m-path= # base path against which the exporter should calculate its links[m
[31m-# FLYWAY (FlywayProperties[m
[31m-[m
[31m-)[m
[31m-flyway.*= # Any public property available on the auto-[m
[31m-configured `Flyway` object[m
[31m-flyway.check-[m
[31m-location=false # check that migration scripts location exists[m
[31m-flyway.locations=classpath:db/migration # locations of migrations scrip[m
[31m-flyway.schemas= # schemas to update[m
[31m-flyway.init-version= 1 # version to start migration[m
[31m-flyway.init-[m
[31m-sqls= # SQL statements to execute to initialize a connection immediatel[m
[31m-flyway.sql-migration-prefix=V[m
[31m-flyway.sql-migration-suffix=.sql[m
[31m-flyway.enabled=true[m
[31m-flyway.url= # JDBC url if you want Flyway to create its own DataSource[m
[31m-flyway.user= # JDBC username if you want Flyway to create its own DataS[m
[31m-flyway.password= # JDBC password if you want Flyway to create its own D[m
[31m-[m
[31m-# LIQUIBASE (LiquibaseProperties[m
[31m-[m
[31m-)[m
[31m-liquibase.change-log=classpath:/db/changelog/db.changelog-[m
[31m-master.yaml[m
[31m-liquibase.check-change-log-[m
[31m-location=true # check the change log location exists[m
[31m-liquibase.contexts= # runtime contexts to use[m
[31m-liquibase.default-schema= # default database schema to use[m
[31m-liquibase.drop-first=false[m
[31m-liquibase.enabled=true[m
[31m-liquibase.url= # specific JDBC url (if not set the default datasource i[m
[31m-liquibase.user= # user name for liquibase.url[m
[31m-liquibase.password= # password for liquibase.url[m
[31m-[m
[31m-# JMX[m
[31m-spring.jmx.default-domain= # JMX domain name[m
[31m-spring.jmx.enabled=true # Expose MBeans from Spring[m
[31m-spring.jmx.mbean-server=mBeanServer # MBeanServer bean name[m
[31m-[m
[31m-# RABBIT (RabbitProperties[m
[31m-[m
[31m-)[m
[31m-spring.rabbitmq.addresses= # connection addresses (e.g. myhost:9999,oth[m
[31m-spring.rabbitmq.dynamic=true # create an AmqpAdmin bean[m
[31m-spring.rabbitmq.host= # connection host[m
[31m-spring.rabbitmq.port= # connection port[m
[31m-spring.rabbitmq.password= # login password[m
[31m-spring.rabbitmq.requested-[m
[31m-heartbeat= # requested heartbeat timeout, in seconds; zero for none[m
[31m-spring.rabbitmq.ssl.enabled=false # enable SSL support[m
[31m-spring.rabbitmq.ssl.key-[m
[31m-store= # path to the key store that holds the SSL certificate[m
[31m-spring.rabbitmq.ssl.key-store-[m
[31m-password= # password used to access the key store[m
[31m-spring.rabbitmq.ssl.trust-[m
[31m-store= # trust store that holds SSL certificates[m
[31m-spring.rabbitmq.ssl.trust-store-[m
[31m-password= # password used to access the trust store[m
[31m-spring.rabbitmq.username= # login user[m
[31m-spring.rabbitmq.virtual-[m
[31m-host= # virtual host to use when connecting to the broker[m
[31m-[m
[31m-# REDIS (RedisProperties[m
[31m-[m
[31m-)[m
[31m-spring.redis.database= # database name[m
[31m-spring.redis.host=localhost # server host[m
[31m-spring.redis.password= # server password[m
[31m-spring.redis.port=6379 # connection port[m
[31m-spring.redis.pool.max-idle=8 # pool settings ...[m
[31m-spring.redis.pool.min-idle=0[m
[31m-spring.redis.pool.max-active=8[m
[31m-spring.redis.pool.max-wait=-1[m
[31m-spring.redis.sentinel.master= # name of Redis server[m
[31m-spring.redis.sentinel.nodes= # comma-[m
[31m-separated list of host:port pairs[m
[31m-spring.redis.timeout= # connection timeout in milliseconds[m
[31m-[m
[31m-# ACTIVEMQ (ActiveMQProperties[m
[31m-[m
[31m-)[m
[31m-spring.activemq.broker-[m
[31m-url=tcp://localhost:61616 # connection URL[m
[31m-spring.activemq.user=[m
[31m-spring.activemq.password=[m
[31m-spring.activemq.in-[m
[31m-memory=true # broker kind to create if no broker-[m
[31m-url is specified[m
[31m-spring.activemq.pooled=false[m
[31m-[m
[31m-# HornetQ (HornetQProperties[m
[31m-[m
[31m-)[m
[31m-spring.hornetq.mode= # connection mode (native, embedded)[m
[31m-spring.hornetq.host=localhost # hornetQ host (native mode)[m
[31m-spring.hornetq.port=5445 # hornetQ port (native mode)[m
[31m-spring.hornetq.embedded.enabled=true # if the embedded server is enable[m
[31m-jms-server.jar)[m
[31m-spring.hornetq.embedded.server-id= # auto-[m
[31m-generated id of the embedded server (integer)[m
[31m-spring.hornetq.embedded.persistent=false # message persistence[m
[31m-spring.hornetq.embedded.data-[m
[31m-directory= # location of data content (when persistence is enabled)[m
[31m-spring.hornetq.embedded.queues= # comma-[m
[31m-separated queues to create on startup[m
[31m-spring.hornetq.embedded.topics= # comma-[m
[31m-separated topics to create on startup[m
[31m-spring.hornetq.embedded.cluster-[m
[31m-password= # customer password (randomly generated by default)[m
[31m-[m
[31m-# JMS (JmsProperties[m
[31m-[m
[31m-)[m
[31m-spring.jms.jndi-[m
[31m-name= # JNDI location of a JMS ConnectionFactory[m
[31m-spring.jms.pub-sub-[m
[31m-domain= # false for queue (default), true for topic[m
[31m-[m
[31m-# Email (MailProperties[m
[31m-[m
[31m-)[m
[31m-spring.mail.host=smtp.acme.org # mail server host[m
[31m-spring.mail.port= # mail server port[m
[31m-spring.mail.username=[m
[31m-spring.mail.password=[m
[31m-spring.mail.default-encoding=UTF-[m
[31m-8 # encoding to use for MimeMessages[m
[31m-spring.mail.properties.*= # properties to set on the JavaMail session[m
[31m-spring.mail.jndi-name= # JNDI location of a Mail Session[m
[31m-[m
[31m-# SPRING BATCH (Ba[m
[31m-[m
[31m-tchProperties[m
[31m-[m
[31m-)[m
[31m-spring.batch.job.names=job1,job2[m
[31m-spring.batch.job.enabled=true[m
[31m-spring.batch.initializer.enabled=true[m
[31m-spring.batch.schema= # batch schema to load[m
[31m-spring.batch.table-[m
[31m-prefix= # table prefix for all the batch meta-data tables[m
[31m-[m
[31m-# SPRING CACHE (CacheProperties[m
[31m-[m
[31m-)[m
[31m-spring.cache.type= # generic, ehcache, hazelcast, infinispan, jcache, r[m
[31m-spring.cache.cache-[m
[31m-names= # cache names to create on startup[m
[31m-spring.cache.ehcache.config= # location of the ehcache configuration[m
[31m-spring.cache.hazelcast.config= # location of the hazelcast configuratio[m
[31m-spring.cache.infinispan.config= # location of the infinispan configurat[m
[31m-spring.cache.jcache.config= # location of jcache configuration[m
[31m-spring.cache.jcache.provider= # fully qualified name of the CachingProv[m
[31m-spring.cache.guava.spec= # guava specs[m
[31m-# AOP[m
[31m-spring.aop.auto=[m
[31m-spring.aop.proxy-target-class=[m
[31m-# FILE ENCODING (FileEncodingApplicationListener[m
[31m-[m
[31m-)[m
[31m-spring.mandatory-file-[m
[31m-encoding= # Expected character encoding the application must use[m
[31m-# SPRING SOCIAL (SocialWebAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.social.auto-connection-[m
[31m-views=true # Set to true for default connection views or false if you p[m
[31m-# SPRING SOCIAL FACEBOOK (FacebookAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.social.facebook.app-[m
[31m-id= # your application's Facebook App ID[m
[31m-spring.social.facebook.app-[m
[31m-secret= # your application's Facebook App Secret[m
[31m-# SPRING SOCIAL LINKEDIN (LinkedInAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.social.linkedin.app-[m
[31m-id= # your application's LinkedIn App ID[m
[31m-spring.social.linkedin.app-[m
[31m-secret= # your application's LinkedIn App Secret[m
[31m-# SPRING SOCIAL TWITTER (TwitterAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.social.twitter.app-[m
[31m-id= # your application's Twitter App ID[m
[31m-spring.social.twitter.app-[m
[31m-secret= # your application's Twitter App Secret[m
[31m-[m
[31m-# SPRING MOBILE SITE PREFERENCE (SitePreferenceAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.mobile.sitepreference.enabled=true # enabled by default[m
[31m-[m
[31m-# SPRING MOBILE DEVICE VIEWS (DeviceDelegatingViewResolverAutoConfigura[m
[31m-[m
[31m-)[m
[31m-spring.mobile.devicedelegatingviewresolver.enabled=true # disabled by d[m
[31m-spring.mobile.devicedelegatingviewresolver.enable-[m
[31m-fallback= # enable support for fallback resolution, default to false.[m
[31m-spring.mobile.devicedelegatingviewresolver.normal-prefix=[m
[31m-spring.mobile.devicedelegatingviewresolver.normal-suffix=[m
[31m-spring.mobile.devicedelegatingviewresolver.mobile-[m
[31m-prefix=mobile/[m
[31m-spring.mobile.devicedelegatingviewresolver.mobile-suffix=[m
[31m-spring.mobile.devicedelegatingviewresolver.tablet-[m
[31m-prefix=tablet/[m
[31m-spring.mobile.devicedelegatingviewresolver.tablet-suffix=[m
[31m-[m
[31m-# ----------------------------------------[m
[31m-# DEVTOOLS PROPERTIES[m
[31m-# ----------------------------------------[m
[31m-[m
[31m-# DEVTOOLS (DevToolsProperties[m
[31m-)[m
[31m-spring.devtools.restart.enabled=true # enable automatic restart[m
[31m-spring.devtools.restart.exclude= # patterns that should be excluding fo[m
[31m-spring.devtools.restart.poll-[m
[31m-interval= # amount of time (in milliseconds) to wait between polling fo[m
[31m-spring.devtools.restart.quiet-[m
[31m-period= # amount of quiet time (in milliseconds) requited without any c[m
[31m-spring.devtools.restart.trigger-[m
[31m-file= # name of a specific file that when changed will trigger the rest[m
[31m-spring.devtools.livereload.enabled=true # enable a livereload.com compa[m
[31m-spring.devtools.livereload.port=35729 # server port.[m
[31m-[m
[31m-# REMOTE DEVTOOLS (RemoteDevToolsProperties[m
[31m-[m
[31m-)[m
[31m-spring.devtools.remote.context-path=/.~~spring-[m
[31m-boot!~ # context path used to handle the remote connection[m
[31m-spring.devtools.remote.debug.enabled=true # enable remote debug support[m
[31m-spring.devtools.remote.debug.local-[m
[31m-port=8000 # local remote debug server port[m
[31m-spring.devtools.remote.restart.enabled=true # enable remote restart[m
[31m-spring.devtools.remote.secret= # a shared secret required to establish[m
[31m-spring.devtools.remote.secret-header-name=X-AUTH-[m
[31m-TOKEN # HTTP header used to transfer the shared secret[m
[31m-[m
[31m-# ----------------------------------------[m
[31m-# ACTUATOR PROPERTIES[m
[31m-# ----------------------------------------[m
[31m-[m
[31m-# MANAGEMENT HTTP SERVER (ManagementServerProperties[m
[31m-[m
[31m-)[m
[31m-management.port= # defaults to 'server.port'[m
[31m-management.address= # bind to a specific NIC[m
[31m-management.context-path= # default to '/'[m
[31m-management.add-application-context-[m
[31m-header= # default to true[m
[31m-management.security.enabled=true # enable security[m
[31m-management.security.role=ADMIN # role required to access the management[m
[31m-management.security.sessions=stateless # session creating policy to use[m
[31m-[m
[31m-# PID FILE (ApplicationPidFileWriter[m
[31m-[m
[31m-)[m
[31m-spring.pidfile= # Location of the PID file to write[m
[31m-[m
[31m-# ENDPOINTS (AbstractEndpoint[m
[31m-[m
[31m- subclasses)[m
[31m-endpoints.autoconfig.id=autoconfig[m
[31m-endpoints.autoconfig.sensitive=true[m
[31m-endpoints.autoconfig.enabled=true[m
[31m-endpoints.beans.id=beans[m
[31m-endpoints.beans.sensitive=true[m
[31m-endpoints.beans.enabled=true[m
[31m-endpoints.configprops.id=configprops[m
[31m-endpoints.configprops.sensitive=true[m
[31m-endpoints.configprops.enabled=true[m
[31m-endpoints.configprops.keys-to-[m
[31m-sanitize=password,secret,key # suffix or regex[m
[31m-endpoints.dump.id=dump[m
[31m-endpoints.dump.sensitive=true[m
[31m-endpoints.dump.enabled=true[m
[31m-endpoints.enabled=true # enable all endpoints[m
[31m-endpoints.env.id=env[m
[31m-endpoints.env.sensitive=true[m
[31m-endpoints.env.enabled=true[m
[31m-endpoints.env.keys-to-[m
[31m-sanitize=password,secret,key # suffix or regex[m
[31m-endpoints.health.id=health[m
[31m-endpoints.health.sensitive=true[m
[31m-endpoints.health.enabled=true[m
[31m-endpoints.health.mapping.*= # mapping of health statuses to HttpStatus[m
[31m-endpoints.health.time-to-live=1000[m
[31m-endpoints.info.id=info[m
[31m-endpoints.info.sensitive=false[m
[31m-endpoints.info.enabled=true[m
[31m-endpoints.mappings.enabled=true[m
[31m-endpoints.mappings.id=mappings[m
[31m-endpoints.mappings.sensitive=true[m
[31m-endpoints.metrics.id=metrics[m
[31m-endpoints.metrics.sensitive=true[m
[31m-endpoints.metrics.enabled=true[m
[31m-endpoints.shutdown.id=shutdown[m
[31m-endpoints.shutdown.sensitive=true[m
[31m-endpoints.shutdown.enabled=false[m
[31m-endpoints.trace.id=trace[m
[31m-endpoints.trace.sensitive=true[m
[31m-endpoints.trace.enabled=true[m
[31m-[m
[31m-# ENDPOINTS CORS CONFIGURATION (MvcEndpointCorsProperties[m
[31m-[m
[31m-)[m
[31m-endpoints.cors.allow-[m
[31m-credentials= # set whether user credentials are support. When not set,[m
[31m-endpoints.cors.allowed-origins= # comma-[m
[31m-separated list of origins to allow. * allows all origins. When not set,[m
[31m-endpoints.cors.allowed-methods= # comma-[m
[31m-separated list of methods to allow. * allows all methods. When not set,[m
[31m-endpoints.cors.allowed-headers= # comma-[m
[31m-separated list of headers to allow in a request. * allows all headers.[m
[31m-endpoints.cors.exposed-headers= # comma-[m
[31m-separated list of headers to include in a response.[m
[31m-endpoints.cors.max-[m
[31m-age=1800 # how long, in seconds, the response from a pre-[m
[31m-flight request can be cached by clients.[m
[31m-[m
[31m-# HEALTH INDICATORS (previously health.*)[m
[31m-[m
[31m-management.health.db.enabled=true[m
[31m-[m
[31m-management.health.elasticsearch.enabled=true[m
[31m-[m
[31m-management.health.elasticsearch.indices=        # comma-[m
[31m-[m
[31m-separated index names[m
[31m-[m
[31m-management.health.elasticsearch.response-[m
[31m-[m
[31m-timeout=100 # the time, in milliseconds, to wait for a response from th[m
[31m-[m
[31m-management.health.diskspace.enabled=true[m
[31m-[m
[31m-management.health.diskspace.path=.[m
[31m-[m
[31m-management.health.diskspace.threshold=10485760[m
[31m-[m
[31m-management.health.jms.enabled=true[m
[31m-[m
[31m-management.health.mail.enabled=true[m
[31m-[m
[31m-management.health.mongo.enabled=true[m
[31m-[m
[31m-management.health.rabbit.enabled=true[m
[31m-management.health.redis.enabled=true[m
[31m-management.health.solr.enabled=true[m
[31m-management.health.status.order=DOWN, OUT_OF_SERVICE, UNKNOWN, UP[m
[31m-[m
[31m-# MVC ONLY ENDPOINTS[m
[31m-endpoints.jolokia.path=/jolokia[m
[31m-endpoints.jolokia.sensitive=true[m
[31m-endpoints.jolokia.enabled=true # when using Jolokia[m
[31m-[m
[31m-# JMX ENDPOINT (EndpointMBeanExportProperties[m
[31m-[m
[31m-)[m
[31m-endpoints.jmx.enabled=true # enable JMX export of all endpoints[m
[31m-endpoints.jmx.domain= # the JMX domain, defaults to 'org.springboot'[m
[31m-endpoints.jmx.unique-names=false[m
[31m-endpoints.jmx.static-names=[m
[31m-[m
[31m-# JOLOKIA (JolokiaProperties[m
[31m-[m
[31m-)[m
[31m-jolokia.config.*= # See Jolokia manual[m
[31m-[m
[31m-# REMOTE SHELL[m
[31m-shell.auth=simple # jaas, key, simple, spring[m
[31m-shell.command-refresh-interval=-1[m
[31m-shell.command-path-[m
[31m-patterns= # classpath*:/commands/**, classpath*:/crash/commands/**[m
[31m-shell.config-path-patterns= # classpath*:/crash/*[m
[31m-shell.disabled-commands=jpa*,jdbc*,jndi* # comma-[m
[31m-separated list of commands to disable[m
[31m-shell.disabled-plugins=false # don't expose plugins[m
[31m-shell.ssh.enabled= # ssh settings ...[m
[31m-shell.ssh.key-path=[m
[31m-shell.ssh.port=[m
[31m-shell.telnet.enabled= # telnet settings ...[m
[31m-shell.telnet.port=[m
[31m-shell.auth.jaas.domain= # authentication settings ...[m
[31m-shell.auth.key.path=[m
[31m-shell.auth.simple.user.name=[m
[31m-shell.auth.simple.user.password=[m
[31m-shell.auth.spring.roles=[m
[31m-[m
[31m-# METRICS EXPORT (MetricExportProperties[m
[31m-[m
[31m-)[m
[31m-spring.metrics.export.enabled=true # flag to disable all metric exports[m
[31m-spring.metrics.export.delay-[m
[31m-millis=5000 # delay in milliseconds between export ticks[m
[31m-spring.metrics.export.send-[m
[31m-latest=true # flag to switch off any available optimizations based on n[m
[31m-spring.metrics.export.includes= # list of patterns for metric names to[m
[31m-spring.metrics.export.excludes= # list of patterns for metric names to[m
[31m-spring.metrics.export.redis.aggregate-key-[m
[31m-pattern= # pattern that tells the aggregator what to do with the keys f[m
[31m-spring.metrics.export.redis.prefix=spring.metrics # prefix for redis re[m
[31m-spring.metrics.export.redis.key=keys.spring.metrics # key for redis rep[m
[31m-spring.metrics.export.triggers.*= # specific trigger properties per Met[m
[31m-[m
[31m-# SENDGRID (SendGridAutoConfiguration[m
[31m-[m
[31m-)[m
[31m-spring.sendgrid.username= # SendGrid account username[m
[31m-spring.sendgrid.password= # SendGrid account password[m
[31m-spring.sendgrid.proxy.host= # SendGrid proxy host[m
[31m-spring.sendgrid.proxy.port= # SendGrid proxy port[m
[31m-[m
[31m-# GIT INFO[m
[31m-spring.git.properties= # resource ref to generated git info properties[m
[31m-              Table of Contents[m
[31m-[m
[31m-ç‰ˆæƒä¿¡æ¯[m
[31m-[m
[31m-å‰è¨€[m
[31m-[m
[31m-ç¬¬ä¸€éƒ¨åˆ† ç‚¹ç›Spring 4.x[m
[31m-      ç¬¬1ç«  SpringåŸºç¡€[m
[31m-                  1.1 Springæ¦‚è¿°[m
[31m-                  1.2 Springé¡¹ç›®å¿«é€Ÿæ­å»º[m
[31m-                  1.3 SpringåŸºç¡€é…ç½®[m
[31m-      ç¬¬2ç«  Springå¸¸ç”¨é…ç½®[m
[31m-                  2.1 Beançš„Scope[m
[31m-                  2.2 Spring ELå’Œèµ„æºè°ƒç”¨[m
[31m-                  2.3 Beançš„åˆå§‹åŒ–å’Œé”€æ¯[m
[31m-[m
[31m-                  2.4 Profile[m
[31m-                  2.5 äº‹ä»¶ï¼ˆApplication Eventï¼‰[m
[31m-      ç¬¬3ç«  Springé«˜çº§è¯é¢˜[m
[31m-[m
[31m-                  3.1 Spring Aware[m
[31m-                  3.2 å¤šçº¿ç¨‹[m
[31m-                  3.3 è®¡åˆ’ä»»åŠ¡[m
[31m-                  3.4 æ¡ä»¶æ³¨è§£@Conditional[m
[31m-                  3.5 ç»„åˆæ³¨è§£ä¸å…ƒæ³¨è§£[m
[31m-                  3.6 @Enable*æ³¨è§£çš„å·¥ä½œåŸç†[m
[31m-                  3.7 æµ‹è¯•[m
[31m-ç¬¬äºŒéƒ¨åˆ† ç‚¹ç›Spring MVC 4.x[m
[31m-      ç¬¬4ç«  Spring MVCåŸºç¡€[m
[31m-                  4.1 Spring MVCæ¦‚è¿°[m
[31m-                  4.2 Spring MVCé¡¹ç›®å¿«é€Ÿæ­å»º[m
[31m-                  4.3 Spring MVCçš„å¸¸ç”¨æ³¨è§£[m
[31m-                  4.4 Spring MVCåŸºæœ¬é…ç½®[m
[31m-                  4.5 Spring MVCçš„é«˜çº§é…ç½®[m
[31m-                  4.6 Spring MVCçš„æµ‹è¯•[m
[31m-ç¬¬ä¸‰éƒ¨åˆ† å®æˆ˜Spring Boot[m
[31m-      ç¬¬5ç«  Spring BootåŸºç¡€[m
[31m-                  5.1 Spring Bootæ¦‚è¿°[m
[31m-                  5.2 Spring Bootå¿«é€Ÿæ­å»º[m
[31m-ç¬¬6ç«  Spring Bootæ ¸å¿ƒ[m
[31m-            6.1 åŸºæœ¬é…ç½®[m
[31m-            6.2 å¤–éƒ¨é…ç½®[m
[31m-            6.3 æ—¥å¿—é…ç½®[m
[31m-            6.4 Profileé…ç½®[m
[31m-            6.5 Spring Bootè¿è¡ŒåŸç†[m
[31m-[m
[31m-ç¬¬7ç«  Spring Bootçš„Webå¼€å‘[m
[31m-            7.1 Spring Bootçš„Webå¼€å‘æ”¯æŒ[m
[31m-            7.2 Thymeleafæ¨¡æ¿å¼•æ“[m
[31m-            7.3 Webç›¸å…³é…ç½®[m
[31m-            7.4 Tomcaté…ç½®[m
[31m-            7.5 Faviconé…ç½®[m
[31m-[m
[31m-            7.6 WebSocket[m
[31m-            7.7 åŸºäºBootstrapå’ŒAngularJSçš„ç°ä»£Webåº”ç”¨[m
[31m-ç¬¬8ç«  Spring Bootçš„æ•°æ®è®¿é—®[m
[31m-            8.1 å¼•å…¥Docker[m
[31m-[m
[31m-            8.2 Spring Data JPA[m
[31m-[m
[31m-            8.3 Spring Data REST[m
[31m-            8.4 å£°åå¼äº‹åŠ¡[m
[31m-            8.5 æ•°æ®ç¼“å­˜Cache[m
[31m-            8.6 éå…³ç³»å‹æ•°æ®åº“NoSQL[m
[31m-ç¬¬9ç«  Spring Bootä¼ä¸šçº§å¼€å‘[m
[31m-            9.1 å®‰å…¨æ§åˆ¶Spring Security[m
[31m-            9.2 æ‰¹å¤„ç†Spring Batch[m
[31m-            9.3 å¼‚æ­¥æ¶ˆæ¯[m
[31m-            9.4 ç³»ç»Ÿé›†æˆSpring Integration[m
[31m-ç¬¬10ç«  Spring Bootå¼€å‘éƒ¨ç½²ä¸æµ‹è¯•[m
[31m-            10.1 å¼€å‘çš„çƒ­éƒ¨ç½²[m
[31m-            10.2 å¸¸è§„éƒ¨ç½²[m
[31m-            10.3 äº‘éƒ¨ç½²â€”â€”åŸºäºDockerçš„éƒ¨ç½²[m
[31m-            10.4 Spring Bootçš„æµ‹è¯•[m
[31m-ç¬¬11ç«  åº”ç”¨ç›‘æ§[m
[31m-[m
[31m-            11.1 http[m
[31m-[m
[31m-            11.2 JMX[m
[31m-[m
[31m-            11.3 SSH[m
[31m-ç¬¬12ç«  åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘[m
[31m-[m
[31m-            12.1 å¾®æœåŠ¡ã€åŸç”Ÿäº‘åº”ç”¨[m
[31m-                  12.2 Spring Cloudå¿«é€Ÿå…¥é—¨[m
[31m-                  12.3 å®æˆ˜[m
[31m-                  12.4 åŸºäºDockeréƒ¨ç½²[m
[31m-é™„å½•A[m
[31m-      A.1 åŸºäºJHipsterçš„ä»£ç ç”Ÿæˆ[m
[31m-      A.2 å¸¸ç”¨åº”ç”¨å±æ€§é…ç½®åˆ—è¡¨[m
[31m-[m
\ No newline at end of file[m
